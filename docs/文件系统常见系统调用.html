<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ–‡ä»¶ç³»ç»Ÿå¸¸è§ç³»ç»Ÿè°ƒç”¨ - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#mount">mount</a><ul></ul></li><li><a href="#open">open</a><ul></ul></li><li><a href="#write">write</a><ul></ul></li><li><a href="#read">read</a><ul></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>æ–‡ä»¶ç³»ç»Ÿå¸¸è§ç³»ç»Ÿè°ƒç”¨</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2023-05-27
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      linux
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><p>ä¸Šä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™äº†æ²¡æœ‰å¸¦ç£ç›˜è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿï¼Œäº†è§£äº†æ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„å¤§è‡´æµç¨‹ï¼Œæœ¬ç« èŠ‚æˆ‘ä»¬ç»§ç»­åœ¨ä¸Šä¸€ç« èŠ‚çš„åŸºç¡€ä¸Šå®Œå–„æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶æ¢³ç†ä»ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´å¤§è‡´çš„è°ƒç”¨æµç¨‹ã€‚å®éªŒçš„ä»£ç æˆ‘ä»¬ä½¿ç”¨å¼€æºçš„ç¤ºä¾‹<a href="https://github.com/sysprog21/simplefs/tree/master">https://github.com/sysprog21/simplefs/tree/master</a>ï¼Œåœ¨å¯åŠ¨æœ¬ç« èŠ‚ä¹‹å‰å»ºè®®å…ˆæ­å»ºå¥½è¯•éªŒç¯å¢ƒï¼Œå°†simplefsæŒ‚è½½èµ·æ¥ï¼Œå½“ç„¶æœ‰ä½™åŠ›çš„ä¹Ÿå¯ä»¥åœ¨ä¸Šä¸€èŠ‚ç¤ºä¾‹ä»£ç çš„åŸºç¡€ä¸Šå€Ÿé‰´å¼€æºçš„ç¤ºä¾‹è¡¥å…¨ã€‚</p>
<h2 id="mount">mount</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_ab0e4b315b4839d6ff4e073fd3791a6a.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿå¸¸è§ç³»ç»Ÿè°ƒç”¨/images/wp_editor_md_ab0e4b315b4839d6ff4e073fd3791a6a.jpg"/></a></p>
<p>æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæœ‰ä¸¤ä¸ªå…³é”®ç‚¹</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªVFS struct super_blockçš„å®ä¾‹ï¼Œå¹¶ä»ç£ç›˜ä¸­è¯»å–ç£ç›˜super_blockä¿¡æ¯å¡«å……ï¼ŒåŒæ—¶åˆ†é…ä¸€ä¸ªæ ¹inodeä»ç£ç›˜ä¸­è¯»å–ä¿¡æ¯å¡«å……ï¼Œå¹¶åˆ›å»ºæ ¹inodeå¯¹åº”çš„æ ¹dentryã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªstruct mountå®ä¾‹ï¼ˆåŒ…å«äº†struct vfsmountï¼‰ä»¥åŠæŒ‚è½½ç‚¹struct mountpointå®ä¾‹ï¼Œå¹¶æ·»åŠ åˆ°å…¨å±€æ–‡ä»¶ç³»ç»Ÿçš„hashè¡¨ä¸­ï¼Œå»ºç«‹èµ·æ–‡ä»¶ç³»ç»Ÿæ ‘çš„è”ç³»ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯ç¬¬ä¸€ä¸ªå…³é”®ç‚¹çš„æµç¨‹å’Œæ•°æ®ç»“æ„ç›´æ¥çš„å…³ç³»ã€‚ <a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_5bf84857cf5d61aa7a307c09fb6ed045.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿå¸¸è§ç³»ç»Ÿè°ƒç”¨/images/wp_editor_md_5bf84857cf5d61aa7a307c09fb6ed045.jpg"/></a></p>
<p>mount_bdevä¸»è¦åšäº†3ä»¶äº‹æƒ…ï¼Œç¬¬ä¸€è°ƒç”¨blkdev_get_by_pathæ ¹æ®/dev/xxxåå­—æ‰¾åˆ°ç›¸åº”çš„è®¾å¤‡å¹¶æ‰“å¼€å®ƒï¼Œç¬¬äºŒè°ƒç”¨sgetæ ¹æ®æ‰“å¼€çš„è®¾å¤‡ï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰å¯¹åº”ç£ç›˜çš„supper_blockï¼Œå¦‚æœæ²¡æœ‰å°±åˆ†é…ä¸€ä¸ªã€‚ç¬¬ä¸‰è°ƒç”¨fill_superå›è°ƒå‡½æ•°å¡«å……super_blockã€‚æ–‡ä»¶ç³»ç»Ÿå»ºç«‹èµ·æ¥ä¹‹åï¼Œå¯¹æ–‡ä»¶çš„è¯»å†™å°±é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ¥è¿›è¡Œã€‚</p>
<p>ä»¥ä¸‹æ˜¯ç¬¬äºŒä¸ªå…³é”®ç‚¹æ•°æ®ç»“æ„å®ä¾‹ç›´æ¥çš„è”ç³»</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_f307cc0a505c961826536d6361fd67c9.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿå¸¸è§ç³»ç»Ÿè°ƒç”¨/images/wp_editor_md_f307cc0a505c961826536d6361fd67c9.jpg"/></a></p>
<p>è·¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„è§£æ</p>
<div class="codehilite"><pre><span></span><code><span class="n">path_lookupat</span>
<span class="n">link_path_walk</span>
<span class="n">walk_component</span>
<span class="n">step_into</span>
<span class="n">handle_mounts</span>
<span class="n">traverse_mounts</span>
<span class="n">__traverse_mounts</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">path</span><span class="w"> </span><span class="o">*</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="p">......)</span>
<span class="p">{</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">DCACHE_MANAGED_DENTRY</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">......</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">DCACHE_MOUNTED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span><span class="c1">// ç›®å½•æ˜¯æŒ‚è½½ç‚¹ï¼Ÿ</span>
<span class="w">            </span><span class="k">struct</span><span class="w"> </span><span class="nc">vfsmount</span><span class="w"> </span><span class="o">*</span><span class="n">mounted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lookup_mnt</span><span class="p">(</span><span class="n">path</span><span class="p">);</span><span class="w"> </span><span class="c1">//è·å–vfsmount</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mounted</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">      </span><span class="c1">// ... in our namespace</span>
<span class="w">                </span><span class="n">dput</span><span class="p">(</span><span class="n">path</span><span class="o">-&gt;</span><span class="n">dentry</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">need_mntput</span><span class="p">)</span>
<span class="w">                    </span><span class="n">mntput</span><span class="p">(</span><span class="n">path</span><span class="o">-&gt;</span><span class="n">mnt</span><span class="p">);</span>
<span class="w">                </span><span class="n">path</span><span class="o">-&gt;</span><span class="n">mnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mounted</span><span class="p">;</span><span class="w"> </span><span class="c1">//å¡«å……æ–°çš„vfsmount</span>
<span class="w">                </span><span class="n">path</span><span class="o">-&gt;</span><span class="n">dentry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dget</span><span class="p">(</span><span class="n">mounted</span><span class="o">-&gt;</span><span class="n">mnt_root</span><span class="p">);</span><span class="c1">//æ–°æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•</span>
<span class="w">                </span><span class="c1">// here we know it's positive</span>
<span class="w">                </span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="o">-&gt;</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_flags</span><span class="p">;</span>
<span class="w">                </span><span class="n">need_mntput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">......</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ååˆ›å»ºsuper_blockã€mountã€mountpointã€æ ¹inodeã€æ ¹dentryå¯¹è±¡ã€‚</li>
<li>ä¸€ä¸ªç›®å½•å¯ä»¥è¢«å¤šä¸ªæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼Œæ–°æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿä¼šå¯¼è‡´ä¹‹å‰çš„æŒ‚è½½è¢«éšè—ã€‚</li>
<li>ä¸€ä¸ªç›®å½•è¢«æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åï¼ŒåŸæ¥ç›®å½•çš„å…¶ä»–å­ç›®å½•å’Œæ–‡ä»¶ä¼šè¢«éšè—ã€‚</li>
<li>æ¯æ¬¡æŒ‚è½½éƒ½ä¼šæœ‰ä¸€ä¸ªmountå®ä¾‹æè¿°æœ¬æ¬¡æŒ‚è½½ã€‚</li>
</ul>
<h2 id="open">open</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_8528505d429a8e009fb75355ed45fb87.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿå¸¸è§ç³»ç»Ÿè°ƒç”¨/images/wp_editor_md_8528505d429a8e009fb75355ed45fb87.jpg"/></a></p>
<p>å…ˆè°ƒç”¨get_ununsed_fd_flagsè·å–ä¸€ä¸ªç©ºé—²çš„fdã€‚ â€ƒâ€ƒè°ƒç”¨link_path_walkå¯¹è·¯å¾„åè¿›è¡ŒæŸ¥æ‰¾ï¼Œé‡Œé¢æ˜¯ä¸ªå¾ªç¯ä¼šä½¿ç”¨â€/â€åˆ†éš”é€å±‚å¤„ç†ï¼Œå¦‚æœä¾æ¬¡è§£æå‘ç°å­ç›®å½•æ˜¯æ–°çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆç›¸å½“äºä»Aæ–‡ä»¶ç³»ç»Ÿè·¨åˆ°Bæ–‡ä»¶ç³»ç»Ÿï¼‰åˆ™è¿›è¡Œæ›´æ–°pathï¼Œpathä¸­å­˜å‚¨äº†vfsmountå’Œdentryã€‚æ–‡ä»¶/mnt/simplefs/testï¼Œlink_path_walkä¼šè§£æå‰é¢å¾—è·¯å¾„éƒ¨åˆ†/mnt/simplefsï¼Œè§£æå®Œæ¯•å¾—æ—¶å€™nameidataçš„dentryä¸ºè·¯å¾„åçš„æœ€åä¸€éƒ¨åˆ†çš„çˆ¶ç›®å½•/mnt/simplefsï¼Œè€Œnameidata-&gt;filenameä¸ºè·¯å¾„åçš„æœ€åä¸€éƒ¨åˆ†â€testâ€ã€‚å†æŸ¥æ‰¾æ–‡ä»¶è·¯å¾„æœ€åä¸€éƒ¨åˆ†å¯¹åº”çš„dentryï¼Œlinuxä¸ºäº†æé«˜ç›®å½•é¡¹ç›®å¯¹è±¡çš„å¤„ç†æ•ˆç‡ï¼Œå®ç°äº†ä¸€ä¸ªç›®å½•é¡¹çš„é«˜é€Ÿæ¢æˆdentry cacheï¼ŒæŸ¥è¯¢çš„æ—¶å€™å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œè°ƒç”¨çš„æ˜¯lookup_fastï¼Œå¦‚æœç¼“å­˜æ²¡æœ‰æ‰¾åˆ°å°±è°ƒç”¨åˆ°å¯¹åº”çš„æ–‡ä»¶ç³»ç»Ÿä¸­å»ç…§ï¼Œå¯¹åº”çš„æ˜¯ä¸Šä¸€çº§ç›®å½•inodeçš„inode_operations-&gt;lookupå‡½æ•°ï¼Œæœ€ç»ˆå°†æ‰¾åˆ°åçš„æ–°ç”Ÿæˆçš„dentryèµ‹å€¼åˆ°pathä¸­ã€‚ â€ƒâ€ƒæœ€åè°ƒç”¨do_openä¸‹é™·åˆ°f-&gt;f_op-&gt;openè°ƒç”¨åˆ°å…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåœ¨vfs_openä¸­ä¹Ÿä¼šå°†æ–‡ä»¶ç›¸å…³çš„ä¿¡æ¯å¡«å……åˆ°struct fileä¸­ï¼Œå¦‚f-&gt;f_inodeï¼Œf-&gt;f_mappingç­‰ã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_85d5fc2e5423a704768684e4773497ea.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿå¸¸è§ç³»ç»Ÿè°ƒç”¨/images/wp_editor_md_85d5fc2e5423a704768684e4773497ea.jpg"/></a></p>
<h2 id="write">write</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_3dae3acc7713f3df1ae7985e6ecb33de.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿå¸¸è§ç³»ç»Ÿè°ƒç”¨/images/wp_editor_md_3dae3acc7713f3df1ae7985e6ecb33de.jpg"/></a></p>
<p>ç”¨æˆ·ç©ºé—´writeé€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥åˆ°å†…æ ¸å±‚vfs_writeï¼Œåœ¨vfs_writeä¸­åˆ¤æ–­æ˜¯struct file_operationså¡«å……çš„æ˜¯writeè¿˜æ˜¯write_iterï¼Œè¿™é‡Œé€‰æ‹©çš„æ˜¯write_iterï¼Œåœ¨simplefsæ–‡ä»¶ç³»ç»Ÿä¸­write_iteræ³¨å†Œçš„æ˜¯é€šç”¨å†™generic_file_write_iterï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¼šæ ¹æ®æ ‡å¿—IOCB_DIRECTåˆ¤æ–­å†™å¦‚æ˜¯å¦è¦ç»è¿‡ç¼“å­˜ã€‚ â€ƒâ€ƒç¼“å­˜æ˜¯å†…å­˜ä¸­çš„ä¸€å—å†…å­˜ï¼ŒLinuxä¸ºäº†è¿›ä¸€æ­¥æ”¹è¿›æ€§èƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šç›´æ¥æ“ä½œç¡¬ç›˜ï¼Œè€Œæ˜¯è¯»å†™éƒ½åœ¨å†…å­˜ä¸­ï¼Œå¾…ä¸€å®šæ—¶æœºååœ¨ä¸€å¹¶æ‰¹é‡å†™å…¥ç£ç›˜ï¼Œä»¥æé«˜è¯»å†™æ•ˆç‡ã€‚æ ¹æ®æ˜¯å¦ä½¿ç”¨å†…å­˜ä½œä¸ºç¼“å­˜ï¼Œå¯ä»¥æŠŠæ–‡ä»¶çš„I/Oæ“ä½œåˆ†ä¸ºç¼“å­˜I/Oå’Œç›´æ¥I/Oï¼Œç›´æ¥I/Oçš„æ–¹å¼æ˜¯ä¸ç»è¿‡ç¼“å­˜ã€‚ â€ƒâ€ƒé»˜è®¤æƒ…å†µä¸ºäº†æé«˜å†™æ•ˆç‡éƒ½ä¼šè°ƒç”¨generic_perform_writeä½¿ç”¨ç¼“å­˜I/Oçš„æ–¹å¼å†™å…¥ï¼Œåœ¨generic_perform_writeä¸­åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>è°ƒç”¨å…·ä½“æ–‡ä»¶ç³»ç»Ÿæ³¨å†Œçš„write_beginï¼Œåœ¨è¯¥å‡½æ•°ä¸­ï¼Œå¦‚æœæ˜¯æ—¥å¿—å¼çš„æ–‡ä»¶ç³»ç»Ÿä¼šå…ˆè®°å½•ç›¸å…³æ—¥å¿—ï¼Œè¿™é‡Œçš„simplefsæ–‡ä»¶ç³»ç»Ÿä¸å¸¦æ—¥å¿—ç³»ç»Ÿã€‚å¦å¤–é‡è¦çš„äº‹æƒ…å°±æ˜¯è·å–pageé¡µï¼Œåœ¨struct fileä¸­æœ‰ä¸€ä¸ªæˆå‘˜struct address_spaceï¼Œstruct address_space-&gt;i_pagesæ˜¯ä¸€ä¸ªxarrayæ ‘ï¼Œç£ç›˜çš„å†…å®¹æ˜ å°„åˆ°è¿™é¢—æ ‘ä¸Šã€‚åœ¨å‡†å¤‡å†™å…¥æ•°æ®æ—¶ï¼Œä¼šä»æ ‘ä¸­æŸ¥è¯¢æ˜¯å¦æœ‰å¯¹åº”ä¸ªpageï¼Œå¦‚æœæœ‰åˆ™è·å–åˆ°è¯¥pageï¼Œå¦‚æœæ²¡æœ‰åˆ™é‡æ–°åˆ†é…ä¸€ä¸ªpageï¼Œæ·»åŠ åˆ°æ ‘ä¸Šã€‚</li>
<li>è·å¾—pageåï¼Œè°ƒç”¨copy_page_from_iter_atomicå°†ç”¨æˆ·ç©ºé—´æ•°æ®å†™åˆ°pageä¸­ã€‚</li>
<li>æ•°æ®å†™åˆ°pageåï¼Œå°†å¯¹ç”¨çš„pageè®¾ç½®ä¸ºè„é¡µï¼Œè„é¡µçš„æ•°æ®æ˜¯éœ€è¦å®šæœŸåŒæ­¥åˆ°ç£ç›˜çš„ã€‚</li>
<li>æœ€ååœ¨balance_dirty_pages_ratelimitedä¼šæ£€æŸ¥æ˜¯å¦è¦è¿›è¡Œç¼“å­˜æ•°æ®çš„åˆ·å†™ï¼Œå¯ä»¥çœ‹å‡ºåœ¨æ¯æ¬¡å†™ç¼“å­˜æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¯¥å‡½æ•°æ¥æ£€æŸ¥ä¸€ä¸‹é¡µç¼“å­˜çš„æ€»å®¹é‡ï¼Œå¦‚æœè¶…è¿‡è®¾å®šçš„é˜ˆå€¼å°±ä¼šç«‹å³è§¦å‘wb_workfnè¿›è¡Œå†™å…¥åˆ°ç£ç›˜ã€‚å¹³æ—¶ç”¨çš„syncä¹Ÿæ˜¯ï¼Œå°†ç¼“å­˜ä¸ç£ç›˜è¿›è¡ŒåŒæ­¥ã€‚</li>
</ul>
<p>è®ºO_DIRECTå’ŒO_SYNC?</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_f601d1c0ee31ff7d992ef4982f376f45.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿå¸¸è§ç³»ç»Ÿè°ƒç”¨/images/wp_editor_md_f601d1c0ee31ff7d992ef4982f376f45.jpg"/></a></p>
<h2 id="read">read</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_b200393de75355dfd208c2e0f43e8551.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿå¸¸è§ç³»ç»Ÿè°ƒç”¨/images/wp_editor_md_b200393de75355dfd208c2e0f43e8551.jpg"/></a></p>
<p>å¤§ä½“æµç¨‹è·Ÿwriteçš„ç±»ä¼¼ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹å”¤é†’I/Oè¯»çš„æ–¹å¼ï¼Œé€šè¿‡filemap_get_pagesè·å–pageï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¸ä½†è¯»å–ä¸€é¡µï¼Œè¿˜æœ‰è¿›è¡Œé¢„è¯»ï¼Œè°ƒç”¨page_cache_sync_readaheadå‡½æ•°å‘èµ·é¢„è¯»æ“ä½œï¼Œè¿™æ¬¡é¢„è¯»çš„æ“ä½œåº”è¯¥æ˜¯åœ¨åŸæ¥çš„pageç¼“å­˜åŸºç¡€ä¸Šå‘èµ·é¢„è¯»è¡¥å……ï¼Œé¢„è¯»åå†è¿›è¡Œåˆ¤æ–­æ˜¯å¦æ‰¾åˆ°è¦è¯»æ•°æ®å¯¹åº”çš„pageï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰åˆ™ç›´æ¥åˆ†é…ä¸€ä¸ªpageæ·»åŠ åˆ°æ ‘ä¸Šï¼Œç„¶åä»ç£ç›˜ä¸­è¯»å–æ•°æ®å¡«å……ï¼Œæ¥ç€åˆ¤æ–­ä¸€ä¸‹pageçš„æ•°æ®æ˜¯å¦å¡«æ»¡éœ€è¦é¢„è¯»ï¼Œå¦‚æœéœ€è¦åˆ™å‘èµ·ä¸€æ¬¡å¼‚æ­¥é¢„è¯»æ“ä½œã€‚æœ€åæ‰¾åˆ°è¦è¯»æ•°æ®å¯¹åº”çš„pageåï¼Œè°ƒç”¨copy_page_to_iterå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p></div>
  <div class="post-nav">
    <a class="prev" href="ä¸€åˆ‡çš†æ–‡ä»¶ä¹‹å­—ç¬¦è®¾å¤‡.html">â† ä¸€åˆ‡çš†æ–‡ä»¶ä¹‹å­—ç¬¦è®¾å¤‡</a>
    <a class="next" href="å®ç°ç®€å•æ–‡ä»¶ç³»ç»Ÿ.html">å®ç°ç®€å•æ–‡ä»¶ç³»ç»Ÿ â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

