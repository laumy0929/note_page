<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>freertosæ ˆæº¢å‡ºæ£€æµ‹åŸç† - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#_1">æ ˆæº¢å‡ºæ£€æµ‹åŸç†</a><ul><li><a href="#configcheck_for_stack_overflow-1">configCHECK_FOR_STACK_OVERFLOW 1</a></li><li><a href="#configcheck_for_stack_overflow-1_1">configCHECK_FOR_STACK_OVERFLOW &gt; 1</a></li></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>freertosæ ˆæº¢å‡ºæ£€æµ‹åŸç†</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2024-05-24
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      rtos
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><ul>
<li>portSTACK_GROWTH &gt; 0ï¼šæ ˆå‘ä¸Šç”Ÿé•¿</li>
<li>portSTACK_GROWTH &lt; 0: æ ˆå‘ä¸‹ç”Ÿé•¿ï¼Œæœ¬ç« ä½¿ç”¨æ ˆå‘ä¸‹ç”Ÿé•¿</li>
</ul>
<p>æ‰“å¼€ configRECORD_STACK_HIGH_ADDRESS 1ï¼Œå°†PCBä¸­å°†æ‰“å¼€pxEndOfStackï¼Œç»“æ„å¦‚ä¸‹ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="nl">adress</span><span class="p">:</span><span class="mi">0</span><span class="o">+</span><span class="n">ulStackDepth</span><span class="w">       </span><span class="o">-------------------</span><span class="w"> </span><span class="n">pxEndOfStack</span><span class="err">ï¼ˆ</span><span class="n">æ ˆåº•</span><span class="err">ï¼‰</span>
<span class="w">                            </span><span class="o">|</span><span class="n">XXXXXXXXXXXXXXXXXX</span><span class="o">|</span>
<span class="nl">adress</span><span class="p">:</span><span class="mi">0</span><span class="o">+</span><span class="n">x</span><span class="w">                  </span><span class="o">--------------------</span><span class="n">pxTopOfStack</span><span class="p">(</span><span class="n">æ ˆé¡¶</span><span class="p">)</span><span class="w">    </span><span class="o">/</span><span class="w"> </span><span class="n">StkCur</span><span class="p">(</span><span class="n">å½“å‰æ ˆ</span><span class="p">)</span>
<span class="w">                            </span><span class="o">|</span><span class="w">                  </span><span class="o">|</span>
<span class="w">                            </span><span class="o">|</span><span class="w">                  </span><span class="o">|</span>
<span class="w">                            </span><span class="o">|</span><span class="w">                  </span><span class="o">|</span>
<span class="nl">adress</span><span class="p">:</span><span class="mi">0</span><span class="w">                    </span><span class="o">-------------------</span><span class="w"> </span><span class="n">pxStack</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">pxTaskStatus</span><span class="o">-&gt;</span><span class="n">pxStackBase</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">StkBot</span>
</code></pre></div>
<h2 id="_1">æ ˆæº¢å‡ºæ£€æµ‹åŸç†</h2>
<h3 id="configcheck_for_stack_overflow-1">configCHECK_FOR_STACK_OVERFLOW 1</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">#if ( ( configCHECK_FOR_STACK_OVERFLOW == 1 ) &amp;&amp; ( portSTACK_GROWTH &lt; 0 ) )</span>

<span class="cm">/* Only the current stack state is to be checked. */</span>
<span class="w">    </span><span class="cp">#define taskCHECK_FOR_STACK_OVERFLOW()                                                            \</span>
<span class="cp">    {                                                                                                 \</span>
<span class="cp">        </span><span class="cm">/* Is the currently saved stack pointer within the stack limit? */</span><span class="cp">                            \</span>
<span class="cp">        if( pxCurrentTCB-&gt;pxTopOfStack &lt;= pxCurrentTCB-&gt;pxStack )                                     \</span>
<span class="cp">        {                                                                                             \</span>
<span class="cp">            vApplicationStackOverflowHook( ( TaskHandle_t ) pxCurrentTCB, pxCurrentTCB-&gt;pcTaskName ); \</span>
<span class="cp">        }                                                                                             \</span>
<span class="cp">    }</span>
<span class="cp">#endif </span><span class="cm">/* configCHECK_FOR_STACK_OVERFLOW == 1 */</span>
</code></pre></div>
<p>å› ä¸ºæ ˆæ˜¯å‘ä¸‹ç”Ÿé•¿çš„ï¼Œæ‰€æœ‰åˆ¤æ–­pxCurrentTCB-&gt;pxTopOfStack &lt;= pxCurrentTCB-&gt;pxStackå³è¡¨ç¤ºæº¢å‡ºã€‚</p>
<h3 id="configcheck_for_stack_overflow-1_1">configCHECK_FOR_STACK_OVERFLOW &gt; 1</h3>
<p>æ‰“å¼€tskSET_NEW_STACKS_TO_KNOWN_VALUE =1</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#if ( ( configCHECK_FOR_STACK_OVERFLOW &gt; 1 ) || ( configUSE_TRACE_FACILITY == 1 ) || ( INCLUDE_uxTaskGetStackHighWaterMark == 1 ) || ( INCLUDE_uxTaskGetStackHighWaterMark2 == 1 ) )</span>
<span class="w">    </span><span class="cp">#define tskSET_NEW_STACKS_TO_KNOWN_VALUE    1</span>
<span class="cp">#else</span>
<span class="w">    </span><span class="cp">#define tskSET_NEW_STACKS_TO_KNOWN_VALUE    0</span>
<span class="cp">#endif</span>
</code></pre></div>
<p>å°†æ ˆå¡«å……ä¸º 0xa5</p>
<div class="codehilite"><pre><span></span><code><span class="n">prvInitialiseNewTask</span>
<span class="w">       </span><span class="cp">#if ( tskSET_NEW_STACKS_TO_KNOWN_VALUE == 1 )</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="cm">/* Fill the stack with a known value to assist debugging. */</span>
<span class="w">            </span><span class="p">(</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">memset</span><span class="p">(</span><span class="w"> </span><span class="n">pxNewTCB</span><span class="o">-&gt;</span><span class="n">pxStack</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">tskSTACK_FILL_BYTE</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ulStackDepth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="w"> </span><span class="n">StackType_t</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="cp">#endif </span><span class="cm">/* tskSET_NEW_STACKS_TO_KNOWN_VALUE */</span>
</code></pre></div>
<p>é€šè¿‡æ¯”è¾ƒæ ˆé¡¶çš„å€¼æ˜¯å¦ä¸ç­‰äº0xa5a5a5a5æ¥åˆ¤æ–­æ ˆæº¢å‡ºï¼Œå‰é¢è®²æ ˆéƒ½å¡«å……ä¸º0xa5ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#if ( ( configCHECK_FOR_STACK_OVERFLOW &gt; 1 ) &amp;&amp; ( portSTACK_GROWTH &lt; 0 ) )</span>

<span class="w">    </span><span class="cp">#define taskCHECK_FOR_STACK_OVERFLOW()                                                            \</span>
<span class="cp">    {                                                                                                 \</span>
<span class="cp">        const uint32_t * const pulStack = ( uint32_t * ) pxCurrentTCB-&gt;pxStack;                       \</span>
<span class="cp">        const uint32_t ulCheckValue = ( uint32_t ) 0xa5a5a5a5;                                        \</span>
<span class="cp">                                                                                                      \</span>
<span class="cp">        if( ( pulStack[ 0 ] != ulCheckValue ) ||                                                      \</span>
<span class="cp">            ( pulStack[ 1 ] != ulCheckValue ) ||                                                      \</span>
<span class="cp">            ( pulStack[ 2 ] != ulCheckValue ) ||                                                      \</span>
<span class="cp">            ( pulStack[ 3 ] != ulCheckValue ) )                                                       \</span>
<span class="cp">        {                                                                                             \</span>
<span class="cp">            vApplicationStackOverflowHook( ( TaskHandle_t ) pxCurrentTCB, pxCurrentTCB-&gt;pcTaskName ); \</span>
<span class="cp">        }                                                                                             \</span>
<span class="cp">    }</span>

<span class="cp">#endif </span><span class="cm">/* #if( configCHECK_FOR_STACK_OVERFLOW &gt; 1 ) */</span>
<span class="cm">/*-----------------------------------------------------------*/</span>
</code></pre></div>
<p>æ‰€ä»¥ä¸¤ç§æ£€æµ‹æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯é€šè¿‡æ¯”è¾ƒpxTopOfStackçš„æ˜¯å¦å°äºèµ·å§‹åœ°å€ï¼Œç¬¬äºŒç§æ˜¯çœ‹å¡«å……çš„æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹ã€‚</p></div>
  <div class="post-nav">
    <a class="prev" href="kasanåŸç†.html">â† kasanåŸç†</a>
    <a class="next" href="risc-v-backtraceå®ç°åŸç†.html">RISC-V backtraceå®ç°åŸç† â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

