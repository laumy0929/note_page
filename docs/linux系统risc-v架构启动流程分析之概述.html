<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Linuxç³»ç»ŸRISC-Væ¶æ„å¯åŠ¨æµç¨‹åˆ†æä¹‹æ¦‚è¿° - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>Linuxç³»ç»ŸRISC-Væ¶æ„å¯åŠ¨æµç¨‹åˆ†æä¹‹æ¦‚è¿°</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2024-07-07
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      risc-v
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><p><a href="https://www.laumy.tech/wp-content/uploads/2024/07/wp_editor_md_916371e84407b542dab3272d403af53f.jpg"><img alt="" src="assets/doc/02-risc-v/ä¸€ã€linuxç³»ç»Ÿrisc-væ¶æ„å¯åŠ¨æµç¨‹åˆ†æä¹‹æ¦‚è¿°/images/wp_editor_md_916371e84407b542dab3272d403af53f.jpg"/></a> å…¸å‹çš„linuxç³»ç»Ÿå¯åŠ¨æµç¨‹å¦‚ä¸Šï¼Œä½†æœ¬æ–‡ä¸»è¦æ¢è®¨çš„æ˜¯OSçš„å¯åŠ¨æµç¨‹ï¼Œopensbiï¼Œubootæš‚ä¸æ¶‰åŠã€‚ä¸»è¦å›´ç»•arch/riscv/kernel/head.Sè¿›è¡Œåˆ†æã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">_start</span>
<span class="w">  </span><span class="n">j</span><span class="w"> </span><span class="n">_start_kernel</span>

<span class="n">_start_kernel</span>
<span class="w">  </span><span class="n">arch</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="c1">//å…³ä¸­æ–­ï¼Œå…³æµ®ç‚¹æ£€æµ‹ï¼ŒæŒ‘é€‰ä¸€ä¸ªä¸»hartå¯åŠ¨åˆå§‹åŒ–åºåˆ—</span>
<span class="w">  </span><span class="n">clear</span><span class="w"> </span><span class="n">bss</span><span class="c1">//æ¸…é™¤BSS</span>
<span class="w">  </span><span class="n">setup_vm</span><span class="c1">//ä¸ºæ‰“å¼€MMUåšå‡†å¤‡ï¼Œfixmapæ˜ å°„ï¼Œå†…æ ¸ç²—ç²’åº¦æ˜ å°„ï¼Œfdtæ˜ å°„</span>
<span class="n">fixmap</span><span class="w"> </span><span class="n">mapping</span>
<span class="n">trampoline</span><span class="w"> </span><span class="n">mapping</span>
<span class="n">early</span><span class="w"> </span><span class="n">Kernel</span><span class="w"> </span><span class="n">mapping</span>
<span class="n">æ˜ å°„çš„é¡µè¡¨</span><span class="err">ï¼š</span><span class="n">ç²—ç²’åº¦æ˜ å°„</span><span class="err">ï¼Œ</span><span class="n">åªä½¿ç”¨åˆ°PMD</span><span class="err">ï¼Œ</span><span class="n">ä¸ä¼šç”¨åˆ°PTE</span>
<span class="w">            </span><span class="n">early_pg_dir</span><span class="p">[</span><span class="n">PTRS_PER_PGD</span><span class="p">]</span>
<span class="n">trampoline_pmd</span><span class="p">[</span><span class="n">PTRS_PER_PMD</span><span class="p">]</span>
<span class="n">early_pmd</span><span class="p">[</span><span class="n">PTRS_PER_PMD</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NUM_EARLY_PMDS</span><span class="p">]</span>

<span class="n">fixed</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">fdt</span>
<span class="n">è™šæ‹Ÿåœ°å€æ˜¯FIX_FDT</span><span class="p">,</span><span class="w"> </span><span class="n">å°†DBTçš„ç‰©ç†åœ°å€åˆ°å¡«å……fixmap_pte</span><span class="p">[</span><span class="n">PTRS_PER_PTE</span><span class="p">]</span>

<span class="w">  </span><span class="n">Relocate</span>
<span class="w">     </span><span class="n">ä½¿èƒ½MMU</span><span class="err">ï¼Œ</span><span class="n">åˆ‡æ¢åˆ°è™šæ‹Ÿåœ°å€è¿è¡Œ</span>

<span class="w">  </span><span class="n">parse_dtb</span><span class="w"> </span><span class="c1">//è§£æè®¾å¤‡æ ‘</span>
<span class="w">     </span><span class="n">early_init_dt_scan</span>
<span class="w">  </span><span class="n">start_kernel</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code><span class="n">start_kernel</span>
<span class="w">   </span><span class="n">setup_arch</span>
<span class="w">      </span><span class="n">setup_bootmem</span>
<span class="w">     </span><span class="n">paging_init</span><span class="p">()</span>
<span class="w">   </span><span class="n">trap_init</span><span class="w"> </span><span class="c1">//å¼‚å¸¸åˆå§‹åŒ–</span>
<span class="w">   </span><span class="n">mm_init</span><span class="w"> </span><span class="c1">//kernel å†…å­˜åˆå§‹åŒ–</span>
<span class="w">   </span><span class="n">sched_init</span><span class="w"> </span><span class="c1">//è°ƒåº¦åˆå§‹åŒ–</span>
<span class="w">   </span><span class="n">early_irq_init</span><span class="w"> </span><span class="c1">//irqåˆå§‹åŒ–</span>
<span class="w">   </span><span class="n">init_IQR</span>
<span class="w">   </span><span class="n">tick_init</span>
<span class="w">   </span><span class="n">init_times</span><span class="w"> </span><span class="c1">//timeråˆå§‹åŒ–</span>
<span class="w">   </span><span class="n">hrtimer_init</span>
<span class="w">   </span><span class="n">softirq_init</span>
<span class="w">   </span><span class="n">time_init</span>
<span class="w">   </span><span class="n">arch_call_rest_init</span>
<span class="w">     </span><span class="n">rest_init</span>
<span class="w">       </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kernel_thread</span><span class="p">(</span><span class="n">kernel_init</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">CLONE_FS</span><span class="p">);</span><span class="w"> </span>
<span class="w">         </span><span class="n">kernel_init</span>
<span class="w">           </span><span class="nf">kernel_init_freeable</span><span class="p">();</span><span class="w"> </span>
<span class="w">             </span><span class="n">prepare_namespace</span>
<span class="w">               </span><span class="n">mount_root</span><span class="p">()</span><span class="w"> </span><span class="c1">//æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ</span>
<span class="w">         </span><span class="n">run_init_process</span><span class="p">(</span><span class="n">execute_command</span><span class="p">)</span><span class="w"> </span><span class="c1">//å¯åŠ¨ç¬¬ä¸€ä¸ªåº”ç”¨è¿›ç¨‹</span>
</code></pre></div>
<p>ç³»ç»Ÿåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå…³é”®ç¯èŠ‚æ˜¯ä½¿èƒ½MMUï¼Œè€Œä½¿èƒ½MMUå°±éœ€è¦ä½¿ç”¨è™šæ‹Ÿåœ°å€ï¼Œé‚£ä¹ˆå°±ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼Œå¦‚ä½•è§£å†³äº†ï¼Ÿ 1.å†…å­˜ç®¡ç†æ²¡å‡†å¤‡å¥½ã€‚ 2.éœ€è¦åˆ†é…é¡µè¡¨ã€‚ 3.å¼€äº†MMUåï¼Œåˆ†é…çš„é¡µè¡¨èƒ½å¤Ÿç”¨è™šæ‹Ÿåœ°å€è®¿é—®ï¼Œå¦åˆ™è®¿é—®ä¸äº†é¡µè¡¨æ— æ³•å¡«å……ã€‚ 4.å¼€äº†MMUåï¼Œè¦èƒ½å¤Ÿç”¨è™šæ‹Ÿåœ°å€è®¿é—®å†…æ ¸ä»£ç ï¼Œæ— æ³•æ— æ³•è¿è¡Œã€‚ 5.å¼€äº†MMUåï¼Œèƒ½å¤Ÿç”¨è™šæ‹Ÿåœ°å€è®¿é—®è®¾å¤‡æ ‘ï¼Œæ— æ³•è¯»å–å†…æ ¸å†…å­˜çš„ç›¸å…³ä¿¡æ¯ã€‚</p></div>
  <div class="post-nav">
    <a class="prev" href="æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ.html">â† æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ</a>
    <a class="next" href="linux-risc-v-head-sè°ƒè¯•è®°å½•.html">Linux risc-v head.Sè°ƒè¯•è®°å½• â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

