<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#dentry-cache">dentry cache</a><ul></ul></li><li><a href="#inode-cache">inode cache</a><ul></ul></li><li><a href="#page-cache">page cache</a><ul><li><a href="#_1">é€šè¿‡æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼</a></li><li><a href="#_2">é€šè¿‡ç£ç›˜çš„æ–¹å¼æ“ä½œ</a></li><li><a href="#direct-io">Direct IOå†™</a></li></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>æ–‡ä»¶ç³»ç»Ÿç¼“å­˜</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2023-06-05
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      linux
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><div class="codehilite"><pre><span></span><code><span class="cp">#To free pagecache</span>
<span class="n">echo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">drop_caches</span>

<span class="cp">#To free dentry and inode cache</span>
<span class="n">echo</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">drop_caches</span>

<span class="cp">#To free pagecache,dentry cache,inode cache</span>
<span class="n">echo</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">drop_caches</span>
</code></pre></div>
<h2 id="dentry-cache">dentry cache</h2>
<p>struct dentryåæ˜ çš„æ˜¯æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡ï¼ˆåŒ…æ‹¬ç›®å½•ã€æ–‡ä»¶ï¼‰åœ¨å†…æ ¸ä¸­æ‰€åœ¨æ–‡ä»¶ç³»ç»Ÿæ ‘çš„ä½ç½®ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿå¯¹æ–‡ä»¶çš„æ“ä½œä¸­inodeæ˜¯å¯¹åº”æ–‡ä»¶å¤„ç†çš„æ ¸å¿ƒå¯¹è±¡ï¼Œè€Œè¦æ‰¾åˆ°inodeå°±éœ€è¦å…ˆæ‰¾åˆ°dentryï¼Œdentryå¯¹è±¡å†…å®¹æŒ‡å‘äº†inodeã€‚å› æ­¤åœ¨æ–‡ä»¶ç³»ç»Ÿåšdentryçš„æœç´¢æ•ˆç‡ä¹Ÿä¸€å®šç¨‹åº¦ä¸Šå†³å®šç€æ–‡ä»¶ç³»ç»Ÿæ“ä½œæ•ˆç‡ï¼Œåœ¨linuxç³»ç»Ÿä¸­ä¸ºäº†æé«˜dentryçš„å¤„ç†æ•ˆç‡ï¼Œå®ç°äº†dentryé«˜é€Ÿç¼“å­˜ï¼Œdentry cacheç®€ç§°dcacheã€‚ åœ¨3.1.3ç« èŠ‚ä¸­æˆ‘ä»¬åˆ—å‡ºäº†dentryçš„æ•°æ®ç»“æ„ç»„æˆï¼Œå…¶ä¸­å¯¹äºæœç´¢çš„æå‡æœ‰ä¸¤ä¸ªå…³é”®æ•°æ®ç»“æ„ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">dentry</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">hlist_bl_node</span><span class="w"> </span><span class="n">d_hash</span><span class="p">;</span>
<span class="w">    </span><span class="n">strcut</span><span class="w"> </span><span class="n">list_head</span><span class="w"> </span><span class="n">d_lru</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>åœ¨æ–‡ä»¶ç³»ç»Ÿåˆå§‹åŒ–æ—¶ï¼Œè°ƒç”¨vfs_caches_init-&gt;dcache_initä¸ºå¯¹dcacheè¿›è¡Œåˆå§‹åŒ–ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªdentryçš„slabï¼Œç”¨äºåç»­dentryå¯¹è±¡çš„åˆ†é…ï¼ŒåŒæ—¶è¿˜åˆ†é…äº†ä¸€ä¸ªdentry_hashtableç”¨äºç®¡ç†dentryçš„å…¨å±€hashè¡¨ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">__init</span><span class="w"> </span><span class="nf">dcache_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">     * A constructor could be added for stable state like the lists,</span>
<span class="cm">     * but it is probably not worth it because of the cache nature</span>
<span class="cm">     * of the dcache.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="n">dentry_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KMEM_CACHE_USERCOPY</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span>
<span class="w">        </span><span class="n">SLAB_RECLAIM_ACCOUNT</span><span class="o">|</span><span class="n">SLAB_PANIC</span><span class="o">|</span><span class="n">SLAB_MEM_SPREAD</span><span class="o">|</span><span class="n">SLAB_ACCOUNT</span><span class="p">,</span>
<span class="w">        </span><span class="n">d_iname</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Hash may have been set up in dcache_init_early */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">hashdist</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="n">dentry_hashtable</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">alloc_large_system_hash</span><span class="p">(</span><span class="s">"Dentry cache"</span><span class="p">,</span>
<span class="w">                    </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">hlist_bl_head</span><span class="p">),</span>
<span class="w">                    </span><span class="n">dhash_entries</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">13</span><span class="p">,</span>
<span class="w">                    </span><span class="n">HASH_ZERO</span><span class="p">,</span>
<span class="w">                    </span><span class="o">&amp;</span><span class="n">d_hash_shift</span><span class="p">,</span>
<span class="w">                    </span><span class="nb">NULL</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">d_hash_shift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">d_hash_shift</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>å¯ä»¥cat /proc/slabinfo | grep dentryæŸ¥çœ‹dentryçš„æƒ…å†µã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_4563d1adba322baf728d76cc5d1408c9.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_4563d1adba322baf728d76cc5d1408c9.jpg"/></a></p>
<p>dcacheåœ¨kmem_cache_allocçš„åŸºç¡€ä¸Šå®šä¹‰äº†ä¸¤ä¸ªé«˜å±‚åˆ†é…æ¥å£ï¼šd_allocå’Œd_alloc_rootå‡½æ•°ï¼Œç”¨æ¥ä»dentry_cache slabä¸­åˆ†é…dentryå¯¹è±¡ã€‚d_alloc_rootæ—¶ç”¨æ¥ä¸ºæ–‡ä»¶ç³»ç»Ÿè·Ÿç›®å½•åˆ†é…dentryå¯¹è±¡çš„ã€‚ dentryé‡Šæ”¾åå¹¶ä¸ä¼šé©¬ä¸Šæ¸…é™¤æ‰ï¼Œè€Œæ˜¯ä¸ç¼“å­˜èµ·æ¥ï¼Œæ‰€ä»¥é€šå¸¸æœ‰3ç§çŠ¶æ€ï¼Œè€Œå…¶ä¸­unusedå’Œnegativeæ˜¯å¯ä»¥åœ¨ä¸»åŠ¨è§¦å‘é‡Šæ”¾æ˜¯å¯ä»¥è¿›è¡Œå›æ”¶çš„ã€‚</p>
<ul>
<li>inuseï¼šæ­£åœ¨è¢«ä½¿ç”¨ï¼Œå¼•ç”¨æŠ€æœ¯d_lockref&gt;0ã€‚</li>
<li>unusedï¼šæœªè¢«å†…æ ¸ä½¿ç”¨ï¼Œå¼•ç”¨æŠ€æœ¯d_lockrefä¸º0ï¼Œd_inodeä¸ºç©ºã€‚</li>
<li>negative:ç›¸åº”çš„ç£ç›˜inodeå·²ç»è¢«åˆ é™¤ï¼Œd_inodeä¸ºç©ºã€‚</li>
<li>dentryç»“æ„é€šå¸¸åœ¨è·¯å¾„æŸ¥æ‰¾è¢«åˆ›å»ºï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹2ç§ç®¡ç†æ–¹å¼</li>
<li>å“ˆå¸Œé“¾è¡¨ï¼šstatic struct hlist_bl_head *dentry_hashtable __read_mostlyï¼Œä»¥dentry-&gt;nameä½œä¸ºç´¢å¼•åœ¨dentryå…¨å±€hashè¡¨ä¸­ç®¡ç†ï¼Œç”¨äºæé«˜è·¯å¾„æŸ¥æ‰¾æ•ˆç‡ã€‚</li>
<li>LRUé“¾è¡¨ï¼šå¤„äºunusedå’ŒnegativeçŠ¶æ€ä¸å†ä½¿ç”¨çš„dentryéƒ½é€šè¿‡å…¶dentry-&gt;d_lruæŒ‡é’ˆé“¾æ¥åˆ°super_block-&gt;s_dentry_lruä¸­ï¼Œå½“éœ€è¦å†…å­˜å›æ”¶æ—¶ï¼Œç”±prune_dcache_sbå›æ”¶ä½¿ç”¨è¾ƒå°‘çš„dentryã€‚</li>
</ul>
<p>åœ¨linuxç³»ç»Ÿä¸­å®šä¹‰äº†dentry_stat_tæ•°æ®ç»“æ„æ¥ç»Ÿè®¡dcacheä¿¡æ¯ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">dentry_stat_t</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="kt">int</span><span class="w"> </span><span class="n">nr_dentry</span><span class="p">;</span><span class="w">       </span><span class="n">dentryçš„æ•°é‡</span>
<span class="w">       </span><span class="kt">int</span><span class="w"> </span><span class="n">nr_unused</span><span class="p">;</span><span class="w">       </span><span class="n">dentryä¸ºä½¿ç”¨çš„æ•°é‡</span>
<span class="w">       </span><span class="kt">int</span><span class="w"> </span><span class="n">age_limit</span><span class="p">;</span><span class="cm">/* age in seconds */</span>
<span class="w">       </span><span class="kt">int</span><span class="w"> </span><span class="n">want_pages</span><span class="p">;</span><span class="cm">/* pages requested by system */</span>
<span class="w">       </span><span class="kt">int</span><span class="w"> </span><span class="n">dummy</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>
<span class="k">extern</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">dentry_stat_t</span><span class="w"> </span><span class="n">dentry_stat</span><span class="p">;</span>
</code></pre></div>
<p>å¯ä»¥é€šè¿‡èŠ‚ç‚¹/proc/sys/fs/dentry-stateæ¥è·å–ï¼Œå¯ä»¥å‘ç°dentry-stateçš„nr_dentry:15227ä¸slab infoä¸­å·²ç»åˆ†é…å‡ºå»çš„å¯¹è±¡15229å·®ä¸å¤šï¼Œ16957è¡¨ç¤ºå½“å‰dentry cacheä¸­ä¸€å…±è¿˜æœ‰å¤šå°‘ä¸ªå¯¹è±¡åŒ…æ‹¬ä½¿ç”¨å’Œä¸ºä½¿ç”¨çš„ï¼Œ528è¡¨ç¤ºæ¯ä¸ªå¯¹è±¡çš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼Œå¯ä»¥çœ‹å‡ºä¸€ä¸ªå¯¹è±¡æ˜¯528å­—èŠ‚ï¼Œå¯¹åº”struct dentryæ•°æ®ç»“æ„çš„å¤§å°ã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_03895bace38c740c412d3f8445ef370d.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_03895bace38c740c412d3f8445ef370d.jpg"/></a></p>
<p>å½“ç³»ç»Ÿä½¿ç”¨echo 2 &gt; /proc/sys/vm/drop_cacheså¯ä»¥é‡Šæ”¾dentryå’Œinodeçš„ç¼“å­˜ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#To free dentry and inode cache</span>
<span class="n">echo</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">drop_caches</span>
</code></pre></div>
<p>æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤åï¼Œå¯ä»¥æŸ¥çœ‹èŠ‚ç‚¹/proc/sys/fs/dentry-stateæˆ–cat /proc/slabinfo | grep dentryå¯ä»¥çœ‹å‡ºdentryçš„æ•°é‡å˜å°‘äº†ï¼Œç³»ç»Ÿå›æ”¶äº†ã€‚</p>
<h2 id="inode-cache">inode cache</h2>
<p>Inodeæ˜¯ç”¨äºæè¿°ä¸€ä¸ªæ–‡ä»¶çš„ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªdentryä¸ä¹‹å¯¹åº”ï¼Œdentryå·²ç»æè¿°äº†ç³»ç»Ÿçš„ç›®å½•æ ‘ï¼Œæä¾›äº†è·¯å¾„æŸ¥æ‰¾çš„æ–¹æ³•ï¼Œæ‰€ä»¥inodeå°±ä¸éœ€è¦åœ¨æœç´¢æŸ¥è¯¢ä¸Šå¤„ç†å¤æ‚å…³ç³»ï¼Œç®¡ç†æ–¹å¼ä¹Ÿç›¸å¯¹ç®€å•ä¸å°‘ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">inode</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="cm">/* Stat data, not accessed from path walking */</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w">       </span><span class="n">i_ino</span><span class="p">;</span><span class="w">    </span><span class="c1">//ä¸å…¶i_sbä¸€èµ·è®¡ç®—hashä½œä¸ºåœ¨inode_hashtableä¸­çš„ç´¢å¼•</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">hlist_node</span><span class="w">   </span><span class="n">i_hash</span><span class="p">;</span><span class="w">    </span><span class="c1">//inode_hashtableå…¨å±€hashè¡¨ä¸­çš„èŠ‚ç‚¹</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">list_head</span><span class="w">    </span><span class="n">i_lru</span><span class="p">;</span><span class="w">      </span><span class="cm">/* inode LRU list */</span><span class="w">    </span><span class="c1">//å…¶i_sb-&gt;s_inode_lruä¸­çš„èŠ‚ç‚¹</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>ä¸dentryç±»ä¼¼ï¼Œåœ¨å†…æ ¸åˆå§‹åŒ–é˜¶æ®µï¼Œä¼šè°ƒç”¨inode_initåˆå§‹åŒ–ä¸€ä¸ªinode_cacheçš„slabå¯¹è±¡ï¼Œç”¨äºinodeçš„åˆ†é…ã€‚åŒæ—¶è¿˜åˆ›å»ºäº†ä¸€ä¸ªç”¨äºç®¡ç†inodeçš„å…¨å±€å“ˆå¸Œè¡¨inode_hashtableã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="n">__init</span><span class="w"> </span><span class="nf">inode_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="cm">/* inode slab cache */</span>
<span class="w">    </span><span class="n">inode_cachep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kmem_cache_create</span><span class="p">(</span><span class="s">"inode_cache"</span><span class="p">,</span>
<span class="w">                     </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">inode</span><span class="p">),</span>
<span class="w">                     </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                     </span><span class="p">(</span><span class="n">SLAB_RECLAIM_ACCOUNT</span><span class="o">|</span><span class="n">SLAB_PANIC</span><span class="o">|</span>
<span class="w">                     </span><span class="n">SLAB_MEM_SPREAD</span><span class="o">|</span><span class="n">SLAB_ACCOUNT</span><span class="p">),</span>
<span class="w">                     </span><span class="n">init_once</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Hash may have been set up in inode_init_early */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">hashdist</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="n">inode_hashtable</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">alloc_large_system_hash</span><span class="p">(</span><span class="s">"Inode-cache"</span><span class="p">,</span>
<span class="w">                    </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">hlist_head</span><span class="p">),</span>
<span class="w">                    </span><span class="n">ihash_entries</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">14</span><span class="p">,</span>
<span class="w">                    </span><span class="n">HASH_ZERO</span><span class="p">,</span>
<span class="w">                    </span><span class="o">&amp;</span><span class="n">i_hash_shift</span><span class="p">,</span>
<span class="w">                    </span><span class="o">&amp;</span><span class="n">i_hash_mask</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                    </span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Inodeç»“æ„ä¸»è¦æ¶‰åŠä¸¤ç§ç®¡ç†æ–¹å¼</p>
<ul>
<li>inodeå“ˆå¸Œè¡¨ï¼šinode_hashtableï¼Œ super_blockå’Œi_inoä½œä¸ºç´¢å¼•åœ¨inodeåœ¨å…¨å±€inode_hashtableä¸­ç®¡ç†ï¼Œä¸»è¦é€šè¿‡i_inoæŸ¥æ‰¾åˆ°inodeã€‚</li>
<li>LRUé“¾è¡¨ï¼šé€šè¿‡inode-&gt;i_lrué“¾æ¥åˆ°super_block-&gt;s_inode_lruä¸Šï¼Œè¡¨ç¤ºä¸å†ä½¿ç”¨çš„ç©ºé—²inodeï¼Œå½“éœ€è¦å†…å­˜å›æ”¶æ˜¯ï¼Œä»ä¸­é€‰å–æœ€å°‘ä½¿ç”¨çš„inodeè¿›è¡Œå›æ”¶ã€‚</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">inodes_stat_t</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">nr_inodes</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">nr_unused</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">dummy</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">      </span><span class="cm">/* padding for sysctl ABI compatibility */</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">inodes_stat_t</span><span class="w"> </span><span class="n">inodes_stat</span><span class="p">;</span>
</code></pre></div>
<p>ä¸dentryç±»ä¼¼ï¼Œinodeä¹Ÿå®šä¹‰äº†ä¸€ä¸ªinodes_statç”¨äºç»Ÿè®¡inodeä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡cat /proc/sys/fs/inode-stateæ¥æŸ¥è¯¢ã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_ee267a6f349bf5300cf59e781783111a.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_ee267a6f349bf5300cf59e781783111a.jpg"/></a></p>
<h2 id="page-cache">page cache</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_2191c43017604b7715dc53f66fa53585.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_2191c43017604b7715dc53f66fa53585.jpg"/></a></p>
<p>freeæ˜¾ç¤ºä¸­çš„buffå’Œcacheæ€ä¹ˆç†è§£ï¼Œä½¿ç”¨free -wä¼šå°†buffå’Œcacheåˆ†å¼€ï¼Œå­—é¢ä¸Šbufferç¼“å†²ï¼Œè€Œcacheæ˜¯ç¼“å­˜ã€‚ freeçš„æ•°æ®æ¥æºä¸/proc/meminfoä¹‹é—´çš„å…³ç³»ã€‚</p>
<ul>
<li>buffersï¼šå†…æ ¸ç¼“å†²åŒºçš„å†…å­˜ï¼Œå¯¹åº”çš„æ˜¯/proc/meminfoä¸­çš„Buffers</li>
<li>cache:æ˜¯å†…æ ¸é¡µç¼“å­˜å’Œslabç”¨åˆ°çš„å†…å­˜ï¼Œå¯¹åº”çš„æ˜¯/proc/meminfoä¸­cached+SReclainmableä¹‹å’Œã€‚</li>
<li>buff/cache:åˆ™æ˜¯bufferså’Œcacheä¹‹å’Œã€‚</li>
</ul>
<p>æ‰€ä»¥è¦ç†è§£freeä¸­buff/cacheçš„å…³é”®æ˜¯è¦ç†è§£buffersã€cachedã€SReclaimableä¸‰ä¸ªçš„æ¦‚å¿µï¼Œä¸‹é¢æ˜¯man procçš„æ„æ€ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">Buffers</span><span class="w"> </span><span class="o">%</span><span class="n">lu</span>
<span class="n">Relatively</span><span class="w"> </span><span class="n">temporary</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">blocks</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">shouldn</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">tremendously</span><span class="w"> </span><span class="n">large</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="n">MB</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">so</span><span class="p">).</span>

<span class="n">Cached</span><span class="w"> </span><span class="o">%</span><span class="n">lu</span>
<span class="n">In</span><span class="o">-</span><span class="n">memory</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">cache</span><span class="p">).</span><span class="w">  </span><span class="n">Doesn</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">SwapCached</span><span class="p">.</span>

<span class="n">SReclaimable</span><span class="w"> </span><span class="o">%</span><span class="n">lu</span><span class="w"> </span><span class="p">(</span><span class="n">since</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="mf">2.6.19</span><span class="p">)</span>
<span class="n">Part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Slab</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">reclaimed</span><span class="p">,</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">caches</span><span class="p">.</span>
</code></pre></div>
<ul>
<li>Buffers:æ˜¯å¯¹åŸå§‹ç£ç›˜å—çš„é›¶æ—¶å­˜å‚¨ï¼Œç”¨äºç¼“å­˜ç£ç›˜çš„æ•°æ®ï¼Œé€šå¸¸ä¸ä¼šç‰¹åˆ«å¤§ï¼ˆ20MBå·¦å³ï¼‰ï¼Œå› ä¸ºå¯¹åº”ç”¨æˆ·æ¥è¯´è¯»å†™æ•°æ®å¯èƒ½æ˜¯å‡ ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯å¯¹åº”ç£ç›˜æ¥è¯´æ˜¯æŒ‰blockæ¥æ“ä½œçš„ï¼Œè¿™æ ·å†…æ ¸å°±å¯ä»¥æŠŠåˆ†æ•£å†™é›†ä¸­èµ·æ¥ï¼Œå¦‚æŠŠå¤šæ¬¡å°çš„å†™é›†åˆå¹¶æˆå•æ¬¡å¤§çš„å†™ã€‚</li>
<li>Cachedï¼šæ˜¯ç£ç›˜è¯»å–æ–‡ä»¶çš„é¡µç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥ç¼“å­˜ä»æ–‡ä»¶è¯»å–çš„æ•°æ®ï¼Œè¿™æ ·ä¸‹æ¬¡è®¿é—®è¿™äº›æ–‡ä»¶æ•°æ®æ—¶ï¼Œæ—§å¯ä»¥ç›´æ¥ä»å†…å­˜å¿«é€Ÿè·å–ï¼Œè€Œä¸éœ€è¦å†æ¬¡è®¿é—®ç¼“æ…¢çš„ç£ç›˜ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬äº¤äº’åˆ°swapåˆ†åŒºçš„ã€‚</li>
<li>SReclaimable:æ˜¯slabçš„ä¸€éƒ¨åˆ†ã€‚SlabåŒ…å«å¯å›æ”¶å’Œä¸å¯å›æ”¶ä¸¤éƒ¨åˆ†ï¼Œå¯å›æ”¶çš„ç”¨SReclaimableè®°å½•ï¼ˆdentry cacheã€inode cacheå±äºslabçš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œä¸å¯å›æ”¶çš„ç”¨SUnrecalaimè®°å½•ã€‚</li>
</ul>
<p>ä»ä¸Šé¢bufferså’Œcachedçš„æ¥çœ‹ï¼Œbufferæ˜¯å¯¹ç£ç›˜çš„ï¼Œè€Œcacheæ˜¯é’ˆå¯¹æ–‡ä»¶é¡µç¼“å­˜è¯»çš„ï¼Œçœ‹èµ·æ¥æ˜¯åˆ†å¼€çš„ï¼Œä½†å®é™…ä¸Šbufferså’Œcachedå¹¶æ²¡æœ‰åˆ†å¼€ï¼Œéƒ½æ˜¯page cacheï¼Œä¸‹é¢å°†æ¥è¿›è¡Œé˜è¿°ã€‚ CPUçš„è¯»å†™é€Ÿåº¦ä¸ç£ç›˜çš„è¯»å†™é€Ÿåº¦æ˜¯æœ‰å¾ˆå¤§å·®è·çš„ï¼Œå› æ­¤æ–‡ä»¶ç³»ç»Ÿåœ¨è®¿é—®ç£ç›˜æ—¶ï¼Œå¹¶ä¸ä¼šç›´æ¥ä¸ç£ç›˜è¿›è¡Œäº¤äº’ï¼Œè€Œæ˜¯åœ¨å…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿä¸ç£ç›˜ä¹‹é—´ç”³è¯·ä¸€æ®µç¼“å†²bufferï¼Œè¿™æ®µç¼“å†²bufferå®é™…å°±æ˜¯ç”³è¯·äº†ä¸€å—å†…å­˜ï¼Œå°†ç£ç›˜çš„æ•°æ®ç¼“å­˜åˆ°è¿™å—å†…å­˜ä¸­ï¼Œå…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿå¯¹ç£ç›˜çš„è¯»å†™å°±è½¬æ¢ä¸ºå¯¹ç¼“å†²bufferçš„è¯»å†™è¿™æ ·å°±å¯ä»¥æé«˜å¤„ç†çš„é€Ÿåº¦ï¼Œç³»ç»Ÿè´Ÿè´£å®šæœŸçš„å°†ç¼“å†²buffä¸ç£ç›˜è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨syncçš„æ–¹å¼è¿›è¡ŒåŒæ­¥ã€‚ æ—©æœŸlinux0.11é˜¶æ®µï¼Œbuffer cacheåœ¨linuxä¸­å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯struct buffer_headï¼Œç®€ç§°bhï¼Œé¡¾åæ€ä¹‰ï¼Œè¡¨ç¤ºç¼“å†²åŒºå¤´éƒ¨ï¼Œè¿™ä¸ªç¼“å†²åŒºç¼“å†²çš„æ˜¯ç£ç›˜å—è®¾å¤‡æ•°æ®ï¼Œæ—©æœŸé˜¶æ®µä¸ºäº†æé«˜ç£ç›˜çš„è¯»å†™æ¶ˆæ¯ï¼Œåœ¨ç£ç›˜ä¹‹ä¸Šå¢åŠ äº†ä¸€ä¸ªç¼“å†²ï¼Œç£ç›˜çš„è¯»å†™å•ä½æ˜¯blockï¼Œä¸€èˆ¬blockçš„å¤§å°æ˜¯1KBï¼Œæ¯ä¸ªblockå°±å¯¹åº”ä¸€ä¸ªbhï¼Œè€Œbhçš„å†…å­˜ç”³è¯·æ˜¯ä»¥åŸå§‹çš„å†…å­˜åˆ†é…æ–¹å¼ï¼Œè¿˜æ²¡æœ‰åŸºäºpageæ¥åˆ†é…å†…å­˜ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">strcut</span><span class="w"> </span><span class="n">buffer_head</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">b_data</span><span class="p">;</span><span class="w">         </span><span class="cm">/* pointer to data block (1024 bytes) */</span><span class="c1">//æŒ‡é’ˆã€‚</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b_blocknr</span><span class="p">;</span><span class="w">  </span><span class="cm">/* block number */</span><span class="c1">// å—å·ã€‚</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">b_dev</span><span class="p">;</span><span class="w">     </span><span class="cm">/* device (0 = free) */</span><span class="c1">// æ•°æ®æºçš„è®¾å¤‡å·ã€‚</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">b_uptodate</span><span class="p">;</span><span class="w"> </span><span class="c1">// æ›´æ–°æ ‡å¿—ï¼šè¡¨ç¤ºæ•°æ®æ˜¯å¦å·²æ›´æ–°ã€‚</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">b_dirt</span><span class="p">;</span><span class="w">     </span><span class="cm">/* 0-clean,1-dirty */</span><span class="c1">//ä¿®æ”¹æ ‡å¿—:0 æœªä¿®æ”¹,1 å·²ä¿®æ”¹.</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">b_count</span><span class="p">;</span><span class="w">    </span><span class="cm">/* users using this block */</span><span class="c1">// ä½¿ç”¨çš„ç”¨æˆ·æ•°ã€‚</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">b_lock</span><span class="p">;</span><span class="w">     </span><span class="cm">/* 0 - ok, 1 -locked */</span><span class="c1">// ç¼“å†²åŒºæ˜¯å¦è¢«é”å®šã€‚</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">task_struct</span><span class="w"> </span><span class="o">*</span><span class="n">b_wait</span><span class="p">;</span><span class="w">   </span><span class="c1">// æŒ‡å‘ç­‰å¾…è¯¥ç¼“å†²åŒºè§£é”çš„ä»»åŠ¡ã€‚</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="n">b_prev</span><span class="p">;</span><span class="w">   </span><span class="c1">// hash é˜Ÿåˆ—ä¸Šå‰ä¸€å—ï¼ˆè¿™å››ä¸ªæŒ‡é’ˆç”¨äºç¼“å†²åŒºçš„ç®¡ç†ï¼‰ã€‚</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="n">b_next</span><span class="p">;</span><span class="w">   </span><span class="c1">// hash é˜Ÿåˆ—ä¸Šä¸‹ä¸€å—ã€‚</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="n">b_prev_free</span><span class="p">;</span><span class="w">  </span><span class="c1">// ç©ºé—²è¡¨ä¸Šå‰ä¸€å—ã€‚</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="n">b_next_free</span><span class="p">;</span><span class="w">  </span><span class="c1">// ç©ºé—²è¡¨ä¸Šä¸‹ä¸€å—ã€‚</span>
<span class="p">};</span>
</code></pre></div>
<p>å‘å±•åˆ°ä¸­é—´é˜¶æ®µæ—¶linux2.2ç‰ˆæœ¬ï¼Œbuffer å°±åŸºäºpageæ¥åˆ†é…å†…å­˜ï¼Œä½†æ˜¯page cacheå’Œbufferæ²¡æœ‰ä»€ä¹ˆç›´æ¥è¿ç»­ï¼Œæ˜¯å„è‡ªç‹¬ç«‹çš„ä½œç”¨ï¼Œpage cacheåªç”¨äºè´Ÿè´£mmapçš„éƒ¨åˆ†å¤„ç†ï¼Œbuffer ä¾æ—§è´Ÿè´£å¯¹ç£ç›˜IOçš„è®¿é—®ç¼“å†²ï¼Œå¦‚ä¸‹å›¾ã€‚ä½†è¿™æ ·å°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºread/writeæ˜¯ç»•è¿‡äº†page cacheï¼Œå°±ä¼šå¯¼è‡´mmapå’Œread/writeæ“ä½œåŒæ­¥é—®é¢˜ï¼Œç£ç›˜çš„åŒä¸€ä»½æ•°æ®åœ¨page cacheä¸­æœ‰ä¸€ä»½ï¼Œåœ¨bufferä¸­ä¹Ÿæœ‰ä¸€ä»½ï¼Œè¿™æ ·åˆ†ç¦»çš„è®¾è®¡è¿˜ä¼šå¯¼è‡´æµªè´¹å†…å­˜ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* First cache line: */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b_next</span><span class="p">;</span><span class="w">    </span><span class="cm">/* Hash queue list */</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b_blocknr</span><span class="p">;</span><span class="w">    </span><span class="cm">/* block number */</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b_size</span><span class="p">;</span><span class="w">       </span><span class="cm">/* block size */</span>
<span class="w">    </span><span class="n">kdev_t</span><span class="w"> </span><span class="n">b_dev</span><span class="p">;</span><span class="w">           </span><span class="cm">/* device (B_FREE = free) */</span>
<span class="w">    </span><span class="n">kdev_t</span><span class="w"> </span><span class="n">b_rdev</span><span class="p">;</span><span class="w">          </span><span class="cm">/* Real device */</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b_rsector</span><span class="p">;</span><span class="w">    </span><span class="cm">/* Real buffer location on disk */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b_this_page</span><span class="p">;</span><span class="w">   </span><span class="cm">/* circular list of buffers in one page */</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b_state</span><span class="p">;</span><span class="w">      </span><span class="cm">/* buffer state bitmap (see above) */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b_next_free</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b_count</span><span class="p">;</span><span class="w">       </span><span class="cm">/* users using this block */</span>

<span class="w">    </span><span class="cm">/* Non-performance-critical data follows. */</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b_data</span><span class="p">;</span><span class="w">          </span><span class="cm">/* pointer to data block (1024 bytes) */</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b_list</span><span class="p">;</span><span class="w">        </span><span class="cm">/* List that this buffer appears */</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b_flushtime</span><span class="p">;</span><span class="w">      </span><span class="cm">/* Time when this (dirty) buffer</span>
<span class="cm">                     * should be written */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">wait_queue</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b_wait</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">b_pprev</span><span class="p">;</span><span class="w">      </span><span class="cm">/* doubly linked list of hash-queue */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b_prev_free</span><span class="p">;</span><span class="w">   </span><span class="cm">/* doubly linked list of buffers */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b_reqnext</span><span class="p">;</span><span class="w">     </span><span class="cm">/* request queue */</span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">     * I/O completion</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">b_end_io</span><span class="p">)(</span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="n">bh</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">uptodate</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">b_dev_id</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_c03e7f7e9acca067687f6a673f3f3571.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_c03e7f7e9acca067687f6a673f3f3571.jpg"/></a></p>
<p>å‘å±•åˆ°ç¬¬ä¸‰é˜¶æ®µlinux 2.4ç‰ˆæœ¬ï¼Œå¯¹cacheå’Œbufferè¿›è¡Œäº†èåˆï¼Œå› ä¸ºbufferçš„ç”³è¯·ä¹Ÿæ˜¯åŸºäºpageçš„ï¼Œé‚£è¿™ä¸¤ä¸ªä¸ºä»€ä¹ˆä¸èåˆåœ¨ä¸€èµ·äº†ï¼Œèåˆåbuffer cacheå°±ç›´æ¥å­˜å‚¨åœ¨page cacheä¸­ï¼Œä½†æ˜¯ä¾æ—§ä¿ç•™äº†buffer cacheçš„æè¿°ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b_state</span><span class="p">;</span><span class="w">      </span><span class="cm">/* buffer state bitmap (see above) */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="n">b_this_page</span><span class="p">;</span><span class="cm">/* circular list of page's buffers */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">page</span><span class="w"> </span><span class="o">*</span><span class="n">b_page</span><span class="p">;</span><span class="w">        </span><span class="cm">/* the page this bh is mapped to */</span>

<span class="w">    </span><span class="n">sector_t</span><span class="w"> </span><span class="n">b_blocknr</span><span class="p">;</span><span class="w">     </span><span class="cm">/* start block number */</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">b_size</span><span class="p">;</span><span class="w">          </span><span class="cm">/* size of mapping */</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">b_data</span><span class="p">;</span><span class="w">           </span><span class="cm">/* pointer to data within the page */</span>

<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">block_device</span><span class="w"> </span><span class="o">*</span><span class="n">b_bdev</span><span class="p">;</span>
<span class="w">    </span><span class="n">bh_end_io_t</span><span class="w"> </span><span class="o">*</span><span class="n">b_end_io</span><span class="p">;</span><span class="w">      </span><span class="cm">/* I/O completion */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">b_private</span><span class="p">;</span><span class="w">        </span><span class="cm">/* reserved for b_end_io */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">list_head</span><span class="w"> </span><span class="n">b_assoc_buffers</span><span class="p">;</span><span class="w"> </span><span class="cm">/* associated with another mapping */</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">address_space</span><span class="w"> </span><span class="o">*</span><span class="n">b_assoc_map</span><span class="p">;</span><span class="w">  </span><span class="cm">/* mapping this buffer is</span>
<span class="cm">                           associated with */</span>
<span class="w">    </span><span class="n">atomic_t</span><span class="w"> </span><span class="n">b_count</span><span class="p">;</span><span class="w">       </span><span class="cm">/* users using this buffer_head */</span>
<span class="w">    </span><span class="n">spinlock_t</span><span class="w"> </span><span class="n">b_uptodate_lock</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Used by the first bh in a page, to</span>
<span class="cm">                     * serialise IO completion of other</span>
<span class="cm">                     * buffers in the page */</span>
<span class="p">};</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_939e0244c4a8a5c6156fae1672142e9c.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_939e0244c4a8a5c6156fae1672142e9c.jpg"/></a></p>
<p>è‡³æ­¤page cacheå’Œbuffer ä¸¤è€…çš„å…³ç³»èåˆäº†ã€‚ç£ç›˜çš„è¯»å†™æ˜¯æŒ‰blockä¸ºå•ä½æ“ä½œï¼Œä¸€ä¸ªblockå¯¹åº”ä¸€ä¸ªbuffer_headç¼“å†²ï¼Œå¦‚å—å•ä½æ˜¯1KBï¼Œé‚£ä¹ˆ1ä¸ªpage cacheå°±æœ‰4ä¸ªbuffer_headã€‚ å¯¹äºæ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œæ¥è¯´ï¼Œbufferå’Œcacheéƒ½æ˜¯page cacheï¼Œå¯¹åº”çš„æ˜¯è¿›ç¨‹æ‰“å¼€æ–‡ä»¶å†…å­˜çš„ç¼“å­˜ï¼Œç¼“å­˜åœ¨address_space::i_pagesçš„xarrayä¸Šï¼Œç¼“å­˜çš„æ•°é‡ä¸ºaddress_space::nrpagesã€‚</p>
<p>Buffer_headçš„åŸä¹‰æ˜¯ä¸blockå¯¹åº”ï¼ŒæŒ‰ç…§ç£ç›˜çš„å¸ƒå±€åˆ†ä¸ºå…ƒæ•°æ®åŒºå’Œæ•°æ®åŒºåŸŸï¼Œå…ƒæ•°æ®æ˜¯ç”¨äºç®¡ç†ç£ç›˜çš„å¦‚supper_blockã€inodeç­‰ï¼Œæ•°æ®åŒºåŸŸæ‰æ˜¯æ­£åœ¨çš„å¯¹åº”æ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„æ•°æ®ã€‚æ‰€ä»¥çš„å¯¹äºcacheå’Œbufferçš„åŒºåˆ«ï¼Œbufferè¿˜å­˜å‚¨äº†å¯¹ç£ç›˜ç®¡ç†çš„å…ƒæ•°æ®ç¼“å­˜ï¼Œè¿™éƒ¨åˆ† å†åæ¥åœ¨linux2.4ç‰ˆæœ¬ä¹‹åï¼Œæ–°çš„æ–‡ä»¶ç³»ç»Ÿå¼€å§‹å¼•å…¥äº†bioç»“æ„æ¥æ›¿æ¢buffer_headï¼Œä½†æ˜¯åŸæœ‰çš„ä¸€äº›æ–‡ä»¶ç³»ç»Ÿå¹¶æ²¡æœ‰å®Œå…¨æ›¿æ¢ä½¿ç”¨bioï¼Œæ‰€ä»¥äº†å°±éœ€è¦åšbioå…¼å®¹buffer_headï¼Œåœ¨ç£ç›˜æ“ä½œå‰ä¼šè°ƒç”¨åˆ°submit_bh_wbcå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šå°†buffer_headç»„è£…æˆbioï¼Œå› æ­¤æœ€ç»ˆå¯¹ç£ç›˜çš„æ“ä½œéƒ½ä¼šè½¬ä¸ºbioçš„æ–¹å¼ï¼Œæ–°çš„æ–‡ä»¶ç³»ç»Ÿå°±ç›´æ¥ä½¿ç”¨bioã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">submit_bh_wbc</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">op</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">op_flags</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">buffer_head</span><span class="w"> </span><span class="o">*</span><span class="n">bh</span><span class="p">,</span>
<span class="w">             </span><span class="k">enum</span><span class="w"> </span><span class="n">rw_hint</span><span class="w"> </span><span class="n">write_hint</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">writeback_control</span><span class="w"> </span><span class="o">*</span><span class="n">wbc</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">bio</span><span class="w"> </span><span class="o">*</span><span class="n">bio</span><span class="p">;</span>

<span class="w">    </span><span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">buffer_locked</span><span class="p">(</span><span class="n">bh</span><span class="p">));</span>
<span class="w">    </span><span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">buffer_mapped</span><span class="p">(</span><span class="n">bh</span><span class="p">));</span>
<span class="w">    </span><span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">bh</span><span class="o">-&gt;</span><span class="n">b_end_io</span><span class="p">);</span>
<span class="w">    </span><span class="n">BUG_ON</span><span class="p">(</span><span class="n">buffer_delay</span><span class="p">(</span><span class="n">bh</span><span class="p">));</span>
<span class="w">    </span><span class="n">BUG_ON</span><span class="p">(</span><span class="n">buffer_unwritten</span><span class="p">(</span><span class="n">bh</span><span class="p">));</span>

<span class="w">    </span><span class="cm">/*</span>
<span class="cm">     * Only clear out a write error when rewriting</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">test_set_buffer_req</span><span class="p">(</span><span class="n">bh</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">op</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">REQ_OP_WRITE</span><span class="p">))</span>
<span class="w">        </span><span class="n">clear_buffer_write_io_error</span><span class="p">(</span><span class="n">bh</span><span class="p">);</span>

<span class="w">    </span><span class="n">bio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bio_alloc</span><span class="p">(</span><span class="n">GFP_NOIO</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="n">fscrypt_set_bio_crypt_ctx_bh</span><span class="p">(</span><span class="n">bio</span><span class="p">,</span><span class="w"> </span><span class="n">bh</span><span class="p">,</span><span class="w"> </span><span class="n">GFP_NOIO</span><span class="p">);</span>

<span class="w">    </span><span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_iter</span><span class="p">.</span><span class="n">bi_sector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bh</span><span class="o">-&gt;</span><span class="n">b_blocknr</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">bh</span><span class="o">-&gt;</span><span class="n">b_size</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">9</span><span class="p">);</span>
<span class="w">    </span><span class="n">bio_set_dev</span><span class="p">(</span><span class="n">bio</span><span class="p">,</span><span class="w"> </span><span class="n">bh</span><span class="o">-&gt;</span><span class="n">b_bdev</span><span class="p">);</span>
<span class="w">    </span><span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_write_hint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">write_hint</span><span class="p">;</span>

<span class="w">    </span><span class="n">bio_add_page</span><span class="p">(</span><span class="n">bio</span><span class="p">,</span><span class="w"> </span><span class="n">bh</span><span class="o">-&gt;</span><span class="n">b_page</span><span class="p">,</span><span class="w"> </span><span class="n">bh</span><span class="o">-&gt;</span><span class="n">b_size</span><span class="p">,</span><span class="w"> </span><span class="n">bh_offset</span><span class="p">(</span><span class="n">bh</span><span class="p">));</span>
<span class="w">    </span><span class="n">BUG_ON</span><span class="p">(</span><span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_iter</span><span class="p">.</span><span class="n">bi_size</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">bh</span><span class="o">-&gt;</span><span class="n">b_size</span><span class="p">);</span>

<span class="w">    </span><span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_end_io</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end_bio_bh_io_sync</span><span class="p">;</span>
<span class="w">    </span><span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_private</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bh</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">buffer_meta</span><span class="p">(</span><span class="n">bh</span><span class="p">))</span>
<span class="w">        </span><span class="n">op_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">REQ_META</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">buffer_prio</span><span class="p">(</span><span class="n">bh</span><span class="p">))</span>
<span class="w">        </span><span class="n">op_flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">REQ_PRIO</span><span class="p">;</span>
<span class="w">    </span><span class="n">bio_set_op_attrs</span><span class="p">(</span><span class="n">bio</span><span class="p">,</span><span class="w"> </span><span class="n">op</span><span class="p">,</span><span class="w"> </span><span class="n">op_flags</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Take care of bh's that straddle the end of the device */</span>
<span class="w">    </span><span class="n">guard_bio_eod</span><span class="p">(</span><span class="n">bio</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wbc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">wbc_init_bio</span><span class="p">(</span><span class="n">wbc</span><span class="p">,</span><span class="w"> </span><span class="n">bio</span><span class="p">);</span>
<span class="w">        </span><span class="n">wbc_account_cgroup_owner</span><span class="p">(</span><span class="n">wbc</span><span class="p">,</span><span class="w"> </span><span class="n">bh</span><span class="o">-&gt;</span><span class="n">b_page</span><span class="p">,</span><span class="w"> </span><span class="n">bh</span><span class="o">-&gt;</span><span class="n">b_size</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">submit_bio</span><span class="p">(</span><span class="n">bio</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_9af7de69a4945a6d4443dfa9eab81f60.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_9af7de69a4945a6d4443dfa9eab81f60.jpg"/></a></p>
<p>ä»¥ä¸Šçš„page cacheå’Œbuffer cacheçš„èåˆæ˜¯é’ˆå¯¹ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼è®¿é—®å—è®¾å¤‡çš„åœºæ™¯ã€‚ä½†æ˜¯å¦‚æœä»¥ä¸‹çš„ä¸¤ä¸ªæ–¹å¼è®¿é—®ç£ç›˜â‘ ä½¿ç”¨æ–‡ä»¶â‘¡ä½¿ç”¨å—è®¾å¤‡èŠ‚ç‚¹ï¼Œè¿™ä¸¤ç§æ–¹å¼å¯¹åº”çš„page cacheæ˜¯ä¸åŒçš„ï¼Œæ–‡ä»¶çš„æ–¹å¼æ˜¯buff/cacheï¼Œè€Œå—è®¾å¤‡èŠ‚ç‚¹æ˜¯buffï¼ˆå®é™…ä¹Ÿæ˜¯page cacheåˆ†é…ï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹ä¸€ä¸ªç‰©ç†ç£ç›˜çš„blockæ•°æ®ä»ç„¶å¯¹åº”linuxå†…æ ¸çš„ä¸¤ä»½pageï¼Œä¸€ä¸ªæ˜¯é€šè¿‡é€šç”¨æ–‡ä»¶å±‚è®¿é—®çš„æ–‡ä»¶page cacheï¼ˆpage cacheï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯é€šè¿‡å—è®¾å¤‡èŠ‚ç‚¹è®¿é—®çš„page cacheï¼ˆbuffer cacheï¼‰ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé€šè¿‡å—è®¾å¤‡èŠ‚ç‚¹è®¿é—®å£°æ˜äº†O_DIRECTï¼Œå°†ä¼šç›´æ¥è®¿é—®ç£ç›˜ä¸ä¼šç»è¿‡buffã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_1d1e2bf632800324458f3d5dc461d846.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_1d1e2bf632800324458f3d5dc461d846.jpg"/></a></p>
<p>ä¸Šå›¾å¦‚æœåˆ†åˆ«ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæ–¹å¼/mnt/testçš„æ–¹å¼æˆ–è€…è£¸è®¾å¤‡/dev/sdaçš„æ–¹å¼å»å†™ç£ç›˜ï¼Œå³ä½¿æ˜¯ä¸€ä¸ªä½ç½®ï¼Œä½†æ˜¯å°†ä¼šæœ‰ä¸¤ä»½page cacheï¼Œå‰è€…çš„page cacheå¯¹åº”çš„å°±æ˜¯freeä¸­çš„cacheï¼Œè€Œåè¾¹çš„page cacheå¯¹åº”çš„æ˜¯freeä¸­çš„buffã€‚ å¯ä»¥ä»/proc/meminfoçš„å®ç°æ¥ç ”ç©¶ä¸€ä¸‹buffå’Œcacheçš„åŒºåˆ«ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">meminfo_proc_show</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">seq_file</span><span class="w"> </span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">sysinfo</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">committed</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">cached</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">available</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">pages</span><span class="p">[</span><span class="n">NR_LRU_LISTS</span><span class="p">];</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">sreclaimable</span><span class="p">,</span><span class="w"> </span><span class="n">sunreclaim</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">lru</span><span class="p">;</span>

<span class="w">    </span><span class="n">si_meminfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="n">si_swapinfo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="n">committed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vm_memory_committed</span><span class="p">();</span>

<span class="w">    </span><span class="n">cached</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_node_page_state</span><span class="p">(</span><span class="n">NR_FILE_PAGES</span><span class="p">)</span><span class="w"> </span><span class="o">-</span>
<span class="w">            </span><span class="n">total_swapcache_pages</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">bufferram</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cached</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="n">cached</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">lru</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LRU_BASE</span><span class="p">;</span><span class="w"> </span><span class="n">lru</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NR_LRU_LISTS</span><span class="p">;</span><span class="w"> </span><span class="n">lru</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">pages</span><span class="p">[</span><span class="n">lru</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_node_page_state</span><span class="p">(</span><span class="n">NR_LRU_BASE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lru</span><span class="p">);</span>

<span class="w">    </span><span class="n">available</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">si_mem_available</span><span class="p">();</span>
<span class="w">    </span><span class="n">sreclaimable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_node_page_state_pages</span><span class="p">(</span><span class="n">NR_SLAB_RECLAIMABLE_B</span><span class="p">);</span>
<span class="w">    </span><span class="n">sunreclaim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_node_page_state_pages</span><span class="p">(</span><span class="n">NR_SLAB_UNRECLAIMABLE_B</span><span class="p">);</span>

<span class="w">    </span><span class="n">show_val_kb</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="s">"MemTotal:       "</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">totalram</span><span class="p">);</span>
<span class="w">    </span><span class="n">show_val_kb</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="s">"MemFree:        "</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">freeram</span><span class="p">);</span>
<span class="w">    </span><span class="n">show_val_kb</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="s">"MemAvailable:   "</span><span class="p">,</span><span class="w"> </span><span class="n">available</span><span class="p">);</span>
<span class="w">    </span><span class="n">show_val_kb</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="s">"Buffers:        "</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">bufferram</span><span class="p">);</span><span class="w"> </span><span class="c1">//show_val_kbä¼šå°†pageæ•°é‡è½¬åŒ–ä¸ºkbã€‚</span>
<span class="w">    </span><span class="n">show_val_kb</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="s">"Cached:         "</span><span class="p">,</span><span class="w"> </span><span class="n">cached</span><span class="p">);</span>
<span class="n">show_val_kb</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="s">"SwapCached:     "</span><span class="p">,</span><span class="w"> </span><span class="n">total_swapcache_pages</span><span class="p">());</span>
<span class="p">......</span>
<span class="p">}</span>
</code></pre></div>
<p>å…ˆæ¥çœ‹çœ‹buffï¼Œbuffersä¸ºi.bufferramï¼Œè€Œè¯¥å€¼åœ¨si_meminfo(&amp;i)ä¸­è®¡ç®—è€Œæ¥ï¼Œåœ¨è¯¥å‡½æ•°ä¸­è°ƒç”¨nr_blockdev_pagesè®¡ç®—è€Œæ¥ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">si_meminfo</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sysinfo</span><span class="w"> </span><span class="o">*</span><span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">val</span><span class="o">-&gt;</span><span class="n">totalram</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">totalram_pages</span><span class="p">();</span>
<span class="w">    </span><span class="n">val</span><span class="o">-&gt;</span><span class="n">sharedram</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_node_page_state</span><span class="p">(</span><span class="n">NR_SHMEM</span><span class="p">);</span>
<span class="w">    </span><span class="n">val</span><span class="o">-&gt;</span><span class="n">freeram</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_zone_page_state</span><span class="p">(</span><span class="n">NR_FREE_PAGES</span><span class="p">);</span>
<span class="w">    </span><span class="n">val</span><span class="o">-&gt;</span><span class="n">bufferram</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr_blockdev_pages</span><span class="p">();</span>
<span class="w">    </span><span class="n">val</span><span class="o">-&gt;</span><span class="n">totalhigh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">totalhigh_pages</span><span class="p">();</span>
<span class="w">    </span><span class="n">val</span><span class="o">-&gt;</span><span class="n">freehigh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr_free_highpages</span><span class="p">();</span>
<span class="w">    </span><span class="n">val</span><span class="o">-&gt;</span><span class="n">mem_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PAGE_SIZE</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>å†çœ‹çœ‹ä¸‹é¢çš„å‡½æ•°è°ƒç”¨ï¼Œbuffersæ˜¯éå†æ‰€æœ‰çš„å—è®¾å¤‡ï¼Œç´¯åŠ address-&gt;i_mappingä¸Šnrpageså€¼ï¼Œè¯¥å€¼å°±æ˜¯xarrayæ ‘ä¸Šå¯¹åº”çš„pageæ•°é‡ï¼Œå¯¹åº”ä¸Šå›¾ä¸­ç›´æ¥æ“ä½œç£ç›˜èŠ‚ç‚¹è¯»å†™çš„æ–¹å¼ â€œopen /dev/sdaâ€ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">nr_blockdev_pages</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">inode</span><span class="w"> </span><span class="o">*</span><span class="n">inode</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">blockdev_superblock</span><span class="o">-&gt;</span><span class="n">s_inode_list_lock</span><span class="p">);</span>
<span class="w">    </span><span class="n">list_for_each_entry</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">blockdev_superblock</span><span class="o">-&gt;</span><span class="n">s_inodes</span><span class="p">,</span><span class="w"> </span><span class="n">i_sb_list</span><span class="p">)</span>
<span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_mapping</span><span class="o">-&gt;</span><span class="n">nrpages</span><span class="p">;</span>
<span class="w">    </span><span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">blockdev_superblock</span><span class="o">-&gt;</span><span class="n">s_inode_list_lock</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>å†æ¥çœ‹çœ‹cachedçš„è®¡ç®—cached = global_node_page_state(NR_FILE_PAGES) -total_swapcache_pages() - i.bufferramï¼Œå…¶ä¸­ global_node_page_state(NR_FILE_PAGES) ä¸ºvm_node_stat[NR_FILE_PAGES]çš„å€¼ã€‚å†…æ ¸ä¸­å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å˜é‡atomic_long_t vm_node_stat[]ï¼Œç”¨äºç»Ÿè®¡å…¨å±€å†…å­˜çš„ä¿¡æ¯ï¼Œæœç´¢å†…æ ¸ä¸­å…³äºNR_FILE_PAGESçš„æ ‡å¿—ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªå‡½æ•°ä¿®æ”¹ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">__mod_lruvec_page_state</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="c1">//å¯¹å…¨å±€å˜é‡vm_node_stat[item]å¢åŠ val</span>
<span class="n">__dec_lruvec_page_state</span><span class="p">()</span><span class="c1">//å¯¹å…¨å±€å˜é‡vm_node_stat[item]å‡1</span>
<span class="n">__inc_lruvec_page_state</span><span class="p">()</span><span class="c1">//å¯¹å…¨å±€å˜é‡vm_node_stat[item]åŠ 1</span>
</code></pre></div>
<p>ç¤ºä¾‹</p>
<div class="codehilite"><pre><span></span><code><span class="n">__mod_lruvec_page_state</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">NR_FILE_PAGES</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">nr</span><span class="p">)</span>
<span class="w">    </span><span class="n">__mod_node_page_state</span><span class="p">(</span><span class="n">page_pgdat</span><span class="p">(</span><span class="n">page</span><span class="p">),</span><span class="w"> </span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">)</span>
<span class="w">        </span><span class="n">node_page_state_add</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span><span class="w"> </span><span class="n">pgdat</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="c1">//delta=-nr</span>
<span class="w">            </span><span class="n">atomic_long_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pgdat</span><span class="o">-&gt;</span><span class="n">vm_stat</span><span class="p">[</span><span class="n">item</span><span class="p">]);</span>
<span class="w">                </span><span class="n">atomic_long_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vm_node_stat</span><span class="p">[</span><span class="n">item</span><span class="p">]);</span>
</code></pre></div>
<p>ä»ä¸Šé¢çš„å‡½æ•°è°ƒç”¨ï¼Œ__mod_lruvec_page_state(struct page *page,enum node_stat_item idx, int val)çš„ä½œç”¨å°±æ˜¯æ ¹æ®itemç±»å‹ï¼ˆè¿™é‡Œæ˜¯NR_FILE_PAGESï¼‰å¯¹å…¨å±€å˜é‡vm_node_stat[item]å¢åŠ valã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_f3b8752cc008370caa6d04d54648ab8d.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_f3b8752cc008370caa6d04d54648ab8d.jpg"/></a></p>
<p>ä»ä¸Šçš„å‡½æ•°è°ƒç”¨æµç¨‹å¯çŸ¥ï¼Œæ— è®ºæ˜¯æ–‡ä»¶ç³»ç»Ÿçš„å†™è¿˜æ˜¯è¯»ï¼Œå½“åˆ†é…æ–°çš„pageæ—¶ï¼Œä¼šè°ƒç”¨add_to_page_cache_lruå°†pageæ·»åŠ åˆ°xarrayæ ‘ä¸Šï¼Œå¹¶è°ƒç”¨__inc_lruvec_page_stateå¢åŠ pageè®¡æ•°ï¼ŒåŒæ—¶ä¼šæ·»åŠ åˆ°LRUé“¾è¡¨ç”¨äºåç»­å›æ”¶ã€‚é™¤äº†è°ƒç”¨generic_file_read/writeè¯»å†™æ–‡ä»¶ç³»ç»Ÿä¼šä¿®æ”¹vm_node_stat[NR_FILE_PAGES]å¤–ï¼Œè¿˜æœ‰ä¸å°‘æ“ä½œä¹Ÿä¼šè®©vm_node_stat[NR_FILE_PAGES]ä¼šå¢åŠ ï¼Œå¦‚é€šè¿‡devèŠ‚ç‚¹ç›´æ¥å¯¹ç£ç›˜çš„æ“ä½œï¼ˆbuffersï¼‰ï¼Œä»¥åŠåŒ¿åé¡µäº¤æ¢åˆ°swapåˆ†åŒºçš„ä¹Ÿä¼šä¿®æ”¹ã€‚å› æ­¤vm_node_stat[NR_FILE_PAGES]æ˜¯ä¸€ä¸ªæ€»çš„å€¼ï¼Œå®é™…åœ¨è®¡ç®—cachedçš„æ—¶å€™ä¼šæŠŠäº¤æ¢åˆ°swapåˆ†åŒºã€ä»¥åŠbuffersçš„å€¼å‡å»ã€‚cached = global_node_page_state(NR_FILE_PAGES) -total_swapcache_pages() - i.bufferramã€‚ æ€»ç»“ä¸‹ï¼š</p>
<ul>
<li>å¯¹äºæ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œæ–¹å¼æ¥è¯´(å¦‚/mnt/UDISK/test)ï¼Œå¤§éƒ¨åˆ†æ˜¯cachedï¼ˆbufferså’Œcachedä»¥åŠåˆå¹¶äº†ï¼‰ï¼Œä¼šå ç”¨å°‘éƒ¨åˆ†çš„bufferï¼Œä¸»è¦æ˜¯å­˜å‚¨ä¸€äº›å…ƒæ•°æ®çš„å­˜å‚¨æ˜¯åˆ’åˆ°bufferä¸­ã€‚</li>
<li>å¯¹äºç£ç›˜çš„æ“ä½œæ–¹å¼æ¥è¯´(å¦‚/dev/sda)ï¼Œåªæœ‰buffersã€‚</li>
</ul>
<p>å¯ä»¥ä½¿ç”¨æµ‹è¯•ä½¿ç”¨vmstatè§‚å¯Ÿbuffå’Œcacheçš„å˜åŒ–æƒ…å†µã€‚</p>
<h3 id="_1">é€šè¿‡æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼</h3>
<p>å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­</p>
<div class="codehilite"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">drop_caches</span>
<span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">urandom</span><span class="w"> </span><span class="n">of</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">UDISK</span><span class="o">/</span><span class="n">test</span><span class="w"> </span><span class="n">bs</span><span class="o">=</span><span class="mi">1</span><span class="n">M</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="mi">5</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_827ef7011e8e2b4aa8365a4b7697f41d.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_827ef7011e8e2b4aa8365a4b7697f41d.jpg"/></a></p>
<p>ä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»</p>
<div class="codehilite"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">drop_caches</span>
<span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="n">UDISK</span><span class="o">/</span><span class="n">test4</span><span class="w"> </span><span class="n">of</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">test</span><span class="w"> </span><span class="n">bs</span><span class="o">=</span><span class="mi">1</span><span class="n">M</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="mi">10</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_44bc99e407b69d52a81e94d04c40071b.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_44bc99e407b69d52a81e94d04c40071b.jpg"/></a></p>
<p>é€šè¿‡vmstatç»Ÿè®¡æ¥çœ‹ï¼Œå†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿext4ä¸Šæˆ–ä»æ–‡ä»¶ç³»ç»Ÿè¯»ï¼ŒåŸºæœ¬éƒ½æ˜¯cacheåœ¨å˜åŒ–ã€‚</p>
<h3 id="_2">é€šè¿‡ç£ç›˜çš„æ–¹å¼æ“ä½œ</h3>
<div class="codehilite"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">drop_caches</span>
<span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">urandom</span><span class="w"> </span><span class="n">of</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">mmcblk0p9</span><span class="w"> </span><span class="n">bs</span><span class="o">=</span><span class="mi">1</span><span class="n">M</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="mi">8</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_4c194f1fe83b6528d16b0e1a5b653b47.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_4c194f1fe83b6528d16b0e1a5b653b47.jpg"/></a></p>
<div class="codehilite"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">drop_caches</span>
<span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">mmcblk0p9</span><span class="w"> </span><span class="n">of</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span><span class="w"> </span><span class="n">bs</span><span class="o">=</span><span class="mi">1</span><span class="n">M</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="mi">8</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_192c954031181ebc77218932c4a3db40.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_192c954031181ebc77218932c4a3db40.jpg"/></a></p>
<p>é€šè¿‡ç£ç›˜çš„æ–¹å¼æ“ä½œï¼Œå¯ä»¥å‘ç°buffå’Œcacheéƒ½æœ‰å˜åŒ–ï¼ˆè¿™é‡Œçš„cacheè¿˜åŒ…æ‹¬äº†slabå¯ä»¥å›æ”¶éƒ¨åˆ†ï¼Œå¦‚æœæŸ¥è¯¢/proc/meminfoä¸‹çš„cachedå˜åŒ–ä¼šæ›´å°‘äº›ï¼‰ï¼Œä½†æ˜¯buffå˜åŒ–æ›´å¤§äº›ï¼Œç„¶åçªç„¶åˆé™å›å»äº†ï¼ˆè¢«ç³»ç»Ÿå›æ”¶äº†ï¼‰è¯»ç£ç›˜æ•°æ®ä¼šç¼“å­˜åˆ°bufferä¸­ã€‚</p>
<h3 id="direct-io">Direct IOå†™</h3>
<div class="codehilite"><pre><span></span><code><span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">urandom</span><span class="w"> </span><span class="n">of</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">mmcblk0p9</span><span class="w"> </span><span class="n">bs</span><span class="o">=</span><span class="mi">1</span><span class="n">M</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="w"> </span><span class="n">oflag</span><span class="o">=</span><span class="n">direct</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/11/wp_editor_md_a9b960b2e39d9ac78ba1ab0be66495e5.jpg"><img alt="" src="assets/doc/01-linux/æ–‡ä»¶ç³»ç»Ÿ/æ–‡ä»¶ç³»ç»Ÿç¼“å­˜/images/wp_editor_md_a9b960b2e39d9ac78ba1ab0be66495e5.jpg"/></a></p>
<p>å¯ä»¥å‘ç°buffï¼ŒcacheåŸºæœ¬æ²¡å˜åŒ–ã€‚</p></div>
  <div class="post-nav">
    <a class="prev" href="å†…å­˜åˆå§‹åŒ–åŸºæœ¬æ¦‚å¿µ.html">â† å†…å­˜åˆå§‹åŒ–åŸºæœ¬æ¦‚å¿µ</a>
    <a class="next" href="ä¸€åˆ‡çš†æ–‡ä»¶ä¹‹å—è®¾å¤‡é©±åŠ¨-å››.html">ä¸€åˆ‡çš†æ–‡ä»¶ä¹‹å—è®¾å¤‡é©±åŠ¨ï¼ˆå››ï¼‰ â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

