<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>lerobotè®¾å¤‡æ ‡å®š - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#why-calibrate">why calibrate</a><ul><li><a href="#_1">æ˜ç¡®ç”µæœºèŒƒå›´</a></li><li><a href="#_2">å½’ä¸€åŒ–ç”µæœºä½ç½®</a></li><li><a href="#_3">ç¡®ä¿æœºå™¨è¿è¡Œç²¾åº¦</a></li></ul></li><li><a href="#_4">æ ¡å‡†æµç¨‹</a><ul><li><a href="#_5">å‚æ•°è§£æä¸é…ç½®åˆå§‹åŒ–</a></li><li><a href="#_6">åˆ›å»ºè®¾å¤‡å®ä¾‹</a></li><li><a href="#_7">è¿æ¥è®¾å¤‡</a></li><li><a href="#_8">æ ‡å®šåŠ¨ä½œ</a></li><li><a href="#_9">è®¾å¤‡æ–­å¼€è¿æ¥</a></li></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>lerobotè®¾å¤‡æ ‡å®š</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2025-07-25
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      ai
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><h2 id="why-calibrate">why calibrate</h2>
<p>å…ˆæ¥çœ‹çœ‹æ ‡å®šåçš„æ•°æ®</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="s2">"shoulder_pan"</span><span class="p">:</span> <span class="p">{</span>                       <span class="c1">#è‚©éƒ¨æ—‹è½¬å…³èŠ‚</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"drive_mode"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"homing_offset"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1620</span><span class="p">,</span>
        <span class="s2">"range_min"</span><span class="p">:</span> <span class="mi">1142</span><span class="p">,</span>
        <span class="s2">"range_max"</span><span class="p">:</span> <span class="mi">2931</span>
    <span class="p">},</span>
    <span class="s2">"shoulder_lift"</span><span class="p">:</span> <span class="p">{</span>                          <span class="c1">#è‚©éƒ¨å‡é™å…³èŠ‚</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">"drive_mode"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"homing_offset"</span><span class="p">:</span> <span class="mi">2025</span><span class="p">,</span>
        <span class="s2">"range_min"</span><span class="p">:</span> <span class="mi">844</span><span class="p">,</span>
        <span class="s2">"range_max"</span><span class="p">:</span> <span class="mi">3053</span>
    <span class="p">},</span>
    <span class="s2">"elbow_flex"</span><span class="p">:</span> <span class="p">{</span>                           <span class="c1">#è‚˜éƒ¨å¼¯æ›²å…³èŠ‚</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">"drive_mode"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"homing_offset"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1208</span><span class="p">,</span>
        <span class="s2">"range_min"</span><span class="p">:</span> <span class="mi">963</span><span class="p">,</span>
        <span class="s2">"range_max"</span><span class="p">:</span> <span class="mi">3078</span>
    <span class="p">},</span>
    <span class="s2">"wrist_flex"</span><span class="p">:</span> <span class="p">{</span>                            <span class="c1">#è…•éƒ¨å¼¯æ›²å…³èŠ‚</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">"drive_mode"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"homing_offset"</span><span class="p">:</span> <span class="mi">2021</span><span class="p">,</span>
        <span class="s2">"range_min"</span><span class="p">:</span> <span class="mi">884</span><span class="p">,</span>
        <span class="s2">"range_max"</span><span class="p">:</span> <span class="mi">3222</span>
    <span class="p">},</span>
    <span class="s2">"wrist_roll"</span><span class="p">:</span> <span class="p">{</span>                             <span class="c1">#è…•éƒ¨æ—‹è½¬å…³èŠ‚</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">"drive_mode"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"homing_offset"</span><span class="p">:</span> <span class="o">-</span><span class="mi">777</span><span class="p">,</span>
        <span class="s2">"range_min"</span><span class="p">:</span> <span class="mi">142</span><span class="p">,</span>
        <span class="s2">"range_max"</span><span class="p">:</span> <span class="mi">3961</span>
    <span class="p">},</span>
    <span class="s2">"gripper"</span><span class="p">:</span> <span class="p">{</span>                                <span class="c1">#å¤¹çˆªå…³èŠ‚</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s2">"drive_mode"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">"homing_offset"</span><span class="p">:</span> <span class="mi">909</span><span class="p">,</span>
        <span class="s2">"range_min"</span><span class="p">:</span> <span class="mi">1978</span><span class="p">,</span>
        <span class="s2">"range_max"</span><span class="p">:</span> <span class="mi">3522</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>ä¸Šé¢æ•°æ®æ˜¯æ¯ä¸ªèˆµæœºçš„ç›¸å…³å‚æ•°ï¼Œä¸€å…±æœ‰6ä¸ªèˆµæœºï¼Œæ¯ä¸ªèˆµæœºéƒ½æœ‰ä¸€ä¸ªidæ¥æ ‡è¯†ï¼Œå¯ä»¥å¯¹åº”å®ç‰©æ¥çœ‹å®é™…æ˜¯ä»ä¸‹åˆ°ä¸Šã€‚</p>
<ul>
<li>id: ç”µæœºçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåœ¨æ€»çº¿é€šä¿¡æ—¶ç²¾å‡†å®šä½å’Œæ§åˆ¶ç‰¹å®šç”µæœºã€‚</li>
<li>drive_mode: ç”µæœºçš„é©±åŠ¨æ¨¡å¼ï¼Œå–å€¼ä¸º 0 è¡¨ç¤ºç‰¹å®šçš„é©±åŠ¨æ¨¡å¼ï¼Œä¸åŒé©±åŠ¨æ¨¡å¼ä¼šå½±å“ç”µæœºçš„è¿åŠ¨ç‰¹æ€§ä¸æ§åˆ¶æ–¹å¼ã€‚</li>
<li>homing_offsetï¼šå½’ä½åç§»é‡ï¼ŒæŒ‡ç”µæœºä»ç‰©ç†é›¶ç‚¹ä½ç½®åˆ°æ ¡å‡†é›¶ç‚¹ä½ç½®çš„åç§»é‡ã€‚æ­¤å‚æ•°èƒ½ä¿è¯ç”µæœºåœ¨æ¯æ¬¡å¯åŠ¨æ—¶éƒ½èƒ½å›åˆ°å‡†ç¡®çš„é›¶ç‚¹ä½ç½®ï¼Œä»è€Œæå‡è¿åŠ¨ç²¾åº¦ã€‚</li>
<li>range_min å’Œ range_maxï¼šç”µæœºè¿åŠ¨èŒƒå›´çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œä»¥æ•°å€¼å½¢å¼å‘ˆç°ã€‚è¿™ä¸¤ä¸ªå‚æ•°é™å®šäº†ç”µæœºçš„è¿åŠ¨è¾¹ç•Œï¼Œé¿å…å› è¶…å‡ºèŒƒå›´è€Œå¯¼è‡´ç¡¬ä»¶æŸåæˆ–è€…è¿åŠ¨å¼‚å¸¸ã€‚range_min å’Œ range_maxï¼šç”µæœºè¿åŠ¨èŒƒå›´çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œä»¥æ•°å€¼å½¢å¼å‘ˆç°ã€‚è¿™ä¸¤ä¸ªå‚æ•°é™å®šäº†ç”µæœºçš„è¿åŠ¨è¾¹ç•Œï¼Œé¿å…å› è¶…å‡ºèŒƒå›´è€Œå¯¼è‡´ç¡¬ä»¶æŸåæˆ–è€…è¿åŠ¨å¼‚å¸¸ã€‚</li>
</ul>
<p>ä¸Šé¢çš„å‚æ•°ä¿¡æ¯åœ¨ä»£ç ä¸­lerobot/src/lerobot/robots/koch_follower/koch_follower.py ä¸­å›è¿›è¡Œé…ç½®ã€‚</p>
<p>ä»ä¸Šé¢çš„é…ç½®ä¿¡æ¯å¯çŸ¥ï¼Œä¹‹æ‰€ä»¥è¦æ ‡å®šï¼Œå°±æ˜¯è¦è·å–ç”µæœºçš„ä¸€äº›ç‰©ç†ç‰¹æ€§ï¼Œä¸»è¦æ˜¯å‡ ä¸ªæ–¹é¢ï¼šæ˜ç¡®ç”µæœºç‰©ç†è¿åŠ¨èŒƒå›´ã€å½’ä¸€åŒ–ç”µæœºä½ç½®ã€ç¡®ä¿æœºå™¨äººè¿è¡Œç²¾åº¦ç­‰ã€‚</p>
<h3 id="_1">æ˜ç¡®ç”µæœºèŒƒå›´</h3>
<p>æœºå™¨çš„ç”µæœºè¦æœ‰ç‰¹å®šçš„ç‰©ç†è¿åŠ¨èŒƒå›´ï¼Œå› ä¸ºå‘é€è¦æ˜¯è¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œå›é€ æˆç¡¬ä»¶æŸåã€‚ä½¿ç”¨calibrateæ“ä½œå¯ä»¥è®°å½•æ¯ä¸ªç”µæœºçš„æœ€å°å’Œæœ€å¤§ä½ç½®é™åˆ¶ï¼Œä¿è¯åç»­å‘é€çš„æŒ‡ä»¤éƒ½åœ¨å®‰å…¨èŒƒå›´å†…ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">lerobot</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lerobot</span><span class="o">/</span><span class="n">robots</span><span class="o">/</span><span class="n">so101_follower</span><span class="o">/</span><span class="n">so101_follower</span><span class="o">.</span><span class="n">py</span>

<span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># ...å·²æœ‰ä»£ç ...</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">"Move all joints sequentially through their entire ranges "</span>
        <span class="s2">"of motion.</span><span class="se">\n</span><span class="s2">Recording positions. Press ENTER to stop..."</span>
    <span class="p">)</span>
    <span class="n">range_mins</span><span class="p">,</span> <span class="n">range_maxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">record_ranges_of_motion</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">motor</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">motors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="n">motor</span><span class="p">]</span> <span class="o">=</span> <span class="n">MotorCalibration</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">drive_mode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">homing_offset</span><span class="o">=</span><span class="n">homing_offsets</span><span class="p">[</span><span class="n">motor</span><span class="p">],</span>
                <span class="n">range_min</span><span class="o">=</span><span class="n">range_mins</span><span class="p">[</span><span class="n">motor</span><span class="p">],</span>
                <span class="n">range_max</span><span class="o">=</span><span class="n">range_maxes</span><span class="p">[</span><span class="n">motor</span><span class="p">],</span>
            <span class="p">)</span>
    <span class="c1"># ...å·²æœ‰ä»£ç ...</span>
</code></pre></div>
<h3 id="_2">å½’ä¸€åŒ–ç”µæœºä½ç½®</h3>
<p>ä¸åŒç”µæœºçš„åŸå§‹ä½ç½®å€¼å¯èƒ½éƒ½ç¦»æ•£çš„ä»»æ„å€¼ï¼Œè¿™äº›ä¾èµ–äºå…·ä½“çš„ç”µæœºå‹å·ï¼Œä¸å…·å¤‡é€šç”¨æ€§ã€‚calibrate æ“ä½œèƒ½å°†è¿™äº›åŸå§‹ä½ç½®å€¼å½’ä¸€åŒ–ä¸ºæœ‰æ„ä¹‰çš„è¿ç»­å€¼ï¼Œåƒç™¾åˆ†æ¯”ã€è§’åº¦ç­‰ï¼Œæ–¹ä¾¿åç»­å¤„ç†å’Œæ§åˆ¶ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">lerobot</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lerobot</span><span class="o">/</span><span class="n">motors</span><span class="o">/</span><span class="n">motors_bus</span><span class="o">.</span><span class="n">py</span>

    <span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">drive_mode</span><span class="p">):</span>
        <span class="n">motor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_to_name</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">motor</span><span class="p">]</span><span class="o">.</span><span class="n">norm_mode</span> <span class="ow">is</span> <span class="n">MotorNormMode</span><span class="o">.</span><span class="n">RANGE_M100_100</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="p">(((</span><span class="n">val</span> <span class="o">-</span> <span class="n">min_</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_</span> <span class="o">-</span> <span class="n">min_</span><span class="p">))</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span> <span class="o">-</span> <span class="mi">100</span>
            <span class="n">normalized_values</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">norm</span> <span class="k">if</span> <span class="n">drive_mode</span> <span class="k">else</span> <span class="n">norm</span>
        <span class="c1"># ...å·²æœ‰ä»£ç ...</span>
</code></pre></div>
<h3 id="_3">ç¡®ä¿æœºå™¨è¿è¡Œç²¾åº¦</h3>
<div class="codehilite"><pre><span></span><code><span class="n">lerobot</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">lerobot</span><span class="o">/</span><span class="n">robots</span><span class="o">/</span><span class="n">so100_leader</span><span class="o">/</span><span class="n">so100_leader</span><span class="o">.</span><span class="n">py</span> <span class="n">ä¸­çš„</span> <span class="n">calibrate</span>

<span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># ...å·²æœ‰ä»£ç ...</span>
    <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Move </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> to the middle of its range of motion and press ENTER...."</span><span class="p">)</span>
    <span class="n">homing_offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">set_half_turn_homings</span><span class="p">()</span>
    <span class="c1"># ...å·²æœ‰ä»£ç ...</span>
</code></pre></div>
<p>é€šè¿‡æ ¡å‡†ï¼Œå¯ä»¥ç¡®å®šç”µæœºçš„å½’ä½åç§»é‡ï¼ˆhoming offsetï¼‰ï¼Œè¿™æœ‰åŠ©äºæé«˜æœºå™¨äººè¿åŠ¨çš„ç²¾åº¦å’Œé‡å¤æ€§ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå‡†ç¡®çš„ä½ç½®æ§åˆ¶å¯¹æœºå™¨äººå®Œæˆä»»åŠ¡è‡³å…³é‡è¦ã€‚</p>
<p>æœ€åç»è¿‡æ ¡å‡†åçš„æ•°æ®ï¼Œåç»­æ— éœ€åœ¨é‡å¤æ ¡å‡†ï¼Œæ ¡å‡†ä¿å­˜çš„è·¯å¾„ä¸€èˆ¬åœ¨~/.cache/huggingface/lerobot/calibrationï¼Œå®é™…è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå›è¿›è¡ŒåŠ è½½ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">ä¿å­˜</span>
<span class="k">def</span> <span class="nf">_save_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpath</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">draccus</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">åŠ è½½</span>
<span class="k">def</span> <span class="nf">_load_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpath</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span> <span class="o">=</span> <span class="n">draccus</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MotorCalibration</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</code></pre></div>
<h2 id="_4">æ ¡å‡†æµç¨‹</h2>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">lerobot</span><span class="o">.</span><span class="n">calibrate</span> \
    <span class="o">--</span><span class="n">robot</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">so101_follower</span> \
    <span class="o">--</span><span class="n">robot</span><span class="o">.</span><span class="n">port</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyACM0</span> \
    <span class="o">--</span><span class="n">robot</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">R12252801</span>
</code></pre></div>
<p>ä¸Šé¢æ˜¯æ‰§è¡Œå‘½ä»¤ç¤ºä¾‹ï¼Œæ¥ä¸‹æ¥ä¸ªè·Ÿè¸ªä¸€ä¸‹æµç¨‹ã€‚Python è§£é‡Šå™¨æ¥æ”¶åˆ° python -m lerobot.calibrate å‘½ä»¤åï¼Œä¼šå°† lerobot.calibrate å½“ä½œä¸€ä¸ªå¯æ‰§è¡Œæ¨¡å—æ¥å¤„ç†ã€‚æŒ‰ç…§ Python æ¨¡å—æŸ¥æ‰¾æœºåˆ¶ï¼Œä¼šåœ¨ sys.path æ‰€åŒ…å«çš„è·¯å¾„é‡Œå¯»æ‰¾ lerobot/calibrate.py æ–‡ä»¶ï¼Œå¯¹åº”çš„æ–‡ä»¶è·¯å¾„ä¸ºlerobot/src/lerobot/calibrate.pyã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@draccus</span><span class="o">.</span><span class="n">wrap</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">CalibrateConfig</span><span class="p">):</span>
    <span class="n">init_logging</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">asdict</span><span class="p">(</span><span class="n">cfg</span><span class="p">)))</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">RobotConfig</span><span class="p">):</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">make_robot_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">TeleoperatorConfig</span><span class="p">):</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">make_teleoperator_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="n">device</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">calibrate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">device</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>
    <span class="n">device</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">calibrate</span><span class="p">()</span>
</code></pre></div>
<p>è°ƒç”¨calibrateå«ç¨ï¼Œä»calibrateå¯ä»¥çœ‹åˆ°ä¸»è¦çš„æ­¥éª¤ä¸ºï¼š</p>
<ul>
<li>å‚æ•°è§£æä¸é…ç½®åˆå§‹åŒ–</li>
<li>åˆ›å»ºè®¾å¤‡å®ä¾‹</li>
<li>è¿æ¥è®¾å¤‡</li>
<li>è®¾å¤‡æ ¡å‡†</li>
<li>è®¾å¤‡æ–­å¼€è¿æ¥</li>
</ul>
<h3 id="_5">å‚æ•°è§£æä¸é…ç½®åˆå§‹åŒ–</h3>
<p>calibrateå‡½æ•°è¢«@draccus.wrap()è£…é¥°ï¼Œdraccusæ˜¯ä¸€ä¸ªç”¨äºè§£æå‘½ä»¤è¡Œå‚æ•°å¹¶åˆ›å»ºé…ç½®å¯¹è±¡çš„åº“ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CalibrateConfig</span><span class="p">:</span>
    <span class="n">teleop</span><span class="p">:</span> <span class="n">TeleoperatorConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">robot</span><span class="p">:</span> <span class="n">RobotConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teleop</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Choose either a teleop or a robot."</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">teleop</span>
</code></pre></div>
<p>draccusä¼šæŠŠå‘½ä»¤è¡Œå‚æ•°--robot.type=so101_follower --robot.port=/dev/ttyACM0 --robot.id=R12252801è§£ææˆCalibrateConfigç±»çš„å®ä¾‹ã€‚robotå±æ€§ä¼šè¢«åˆå§‹åŒ–ä¸ºRobotConfigç±»å‹çš„å¯¹è±¡ï¼Œå¦‚æœæ˜¯--teleop.type=so101_leader å°†ä¼šåˆå§‹åŒ–ä¸ºTeleoperatorConfigç±»å‹çš„å¯¹è±¡ã€‚RobotConfigå¯¹è±¡åœ¨config.pyä¸­å®šä¹‰çš„ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">RobotConfig</span><span class="p">(</span><span class="n">draccus</span><span class="o">.</span><span class="n">ChoiceRegistry</span><span class="p">,</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="c1"># Allows to distinguish between different robots of the same type</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Directory to store calibration file</span>
    <span class="n">calibration_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"cameras"</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"width"</span><span class="p">,</span> <span class="s2">"height"</span><span class="p">,</span> <span class="s2">"fps"</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"Specifying '</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">' is required for the camera to be used in a robot"</span>
                        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_choice_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
</code></pre></div>
<p>å…¶ä¼šæ ¹æ®å‘½ä»¤è¡Œå‚æ•°æˆ–é…ç½®æ–‡ä»¶ä¸­çš„ç±»å‹å­—æ®µï¼ŒåŠ¨æ€é€‰æ‹©å¹¶åˆ›å»ºå¯¹åº”çš„é…ç½®å­ç±»å®ä¾‹ã€‚</p>
<p>å¦‚å½“å‰çš„å‚æ•°æœ‰typeï¼Œportï¼Œidåˆ†åˆ«è®¾ç½®ä¸ºso101_followerã€/dev/ttyACM0 å’Œ R12252801ã€‚</p>
<h3 id="_6">åˆ›å»ºè®¾å¤‡å®ä¾‹</h3>
<p>æ ¹æ®cfg.deviceç±»å‹ï¼Œè°ƒç”¨å¯¹åº”å·¥å‚å«ç¨åˆ›å»ºè®¾å¤‡å®ä¾‹ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">RobotConfig</span><span class="p">):</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">make_robot_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">TeleoperatorConfig</span><span class="p">):</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">make_teleoperator_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</code></pre></div>
<p>ç”±äº cfg.device æ˜¯ RobotConfig ç±»å‹ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ make_robot_from_config(cfg.device)ã€‚è¯¥å‡½æ•°å¯èƒ½å®šä¹‰åœ¨ /home/laumy/lerobot/src/lerobot/robots/<strong>init</strong>.py æˆ–è€…ç›¸å…³çš„å·¥å‚æ¨¡å—ä¸­ï¼Œä¾æ® cfg.device.type çš„å€¼ï¼ˆå³ so101_followerï¼‰ï¼Œä¼šåˆ›å»º SO101Follower ç±»çš„å®ä¾‹ã€‚</p>
<h3 id="_7">è¿æ¥è®¾å¤‡</h3>
<p>è°ƒç”¨ device.connect(calibrate=False) æ–¹æ³•è¿æ¥è®¾å¤‡ï¼Œlerobot/src/lerobot/robots/so101_follower/so101_follower.py æ–‡ä»¶ä¸­ï¼Œå…¶ connect æ–¹æ³•å¯èƒ½å¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calibrate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DeviceAlreadyConnectedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> already connected"</span><span class="p">)</span>

    <span class="c1"># è¿æ¥ä¸²å£æ€»çº¿</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bus</span> <span class="o">=</span> <span class="n">DynamixelBus</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">baudrate</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span> <span class="ow">and</span> <span class="n">calibrate</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>

    <span class="c1"># è¿æ¥æ‘„åƒå¤´</span>
    <span class="k">for</span> <span class="n">cam</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">cam</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> connected."</span><span class="p">)</span>
</code></pre></div>
<p>å› ä¸ºä¼ å…¥çš„ calibrate=Falseï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘è‡ªåŠ¨æ ¡å‡†ã€‚åœ¨è¿æ¥è¿‡ç¨‹ä¸­ï¼Œä¼šå…ˆè¿æ¥ä¸²å£æ€»çº¿ï¼Œå†è¿æ¥æ‘„åƒå¤´ï¼Œæœ€åè¿›è¡Œè®¾å¤‡é…ç½®ã€‚</p>
<h3 id="_8">æ ‡å®šåŠ¨ä½œ</h3>
<p>è°ƒç”¨ device.calibrate() æ–¹æ³•å¯¹è®¾å¤‡è¿›è¡Œæ ¡å‡†,SO101Follower ç±»çš„ calibrate æ–¹æ³•å¯èƒ½å¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Running calibration of </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># ç¦ç”¨æ‰­çŸ©</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>

    <span class="c1"># è®¾ç½®ç”µæœºå·¥ä½œæ¨¡å¼ä¸ºä½ç½®æ¨¡å¼</span>
    <span class="k">for</span> <span class="n">motor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">motors</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Operating_Mode"</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">OperatingMode</span><span class="o">.</span><span class="n">POSITION</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># æ‰‹åŠ¨æ“ä½œæç¤º</span>
    <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Move </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> to the middle of its range of motion and press ENTER...."</span><span class="p">)</span>

    <span class="c1"># è®¾ç½®åŠåœˆå½’é›¶åç§»é‡</span>
    <span class="n">homing_offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">set_half_turn_homings</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">"Move all joints sequentially through their entire ranges "</span>
        <span class="s2">"of motion.</span><span class="se">\n</span><span class="s2">Recording positions. Press ENTER to stop..."</span>
    <span class="p">)</span>

    <span class="c1"># è®°å½•å…³èŠ‚è¿åŠ¨èŒƒå›´</span>
    <span class="n">range_mins</span><span class="p">,</span> <span class="n">range_maxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">record_ranges_of_motion</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">motor</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">motors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="n">motor</span><span class="p">]</span> <span class="o">=</span> <span class="n">MotorCalibration</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">drive_mode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">homing_offset</span><span class="o">=</span><span class="n">homing_offsets</span><span class="p">[</span><span class="n">motor</span><span class="p">],</span>
            <span class="n">range_min</span><span class="o">=</span><span class="n">range_mins</span><span class="p">[</span><span class="n">motor</span><span class="p">],</span>
            <span class="n">range_max</span><span class="o">=</span><span class="n">range_maxes</span><span class="p">[</span><span class="n">motor</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="c1"># å°†æ ¡å‡†æ•°æ®å†™å…¥ç”µæœº</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">write_calibration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">)</span>

    <span class="c1"># ä¿å­˜æ ¡å‡†æ•°æ®</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_save_calibration</span><span class="p">()</span>
</code></pre></div>
<p>æ ¡å‡†è¿‡ç¨‹åŒ…å«ç¦ç”¨æ‰­çŸ©ã€è®¾ç½®ç”µæœºå·¥ä½œæ¨¡å¼ã€æ‰‹åŠ¨æ“ä½œæç¤ºã€è®°å½•å…³èŠ‚è¿åŠ¨èŒƒå›´ã€ä¿å­˜æ ¡å‡†æ•°æ®ç­‰æ­¥éª¤ã€‚</p>
<h3 id="_9">è®¾å¤‡æ–­å¼€è¿æ¥</h3>
<p>è°ƒç”¨ device.disconnect() æ–¹æ³•æ–­å¼€è®¾å¤‡è¿æ¥,SO101Follower ç±»çš„ disconnect æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DeviceNotConnectedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> is not connected."</span><span class="p">)</span>

    <span class="c1"># æ–­å¼€ä¸²å£æ€»çº¿è¿æ¥</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">disable_torque_on_disconnect</span><span class="p">)</span>

    <span class="c1"># æ–­å¼€æ‘„åƒå¤´è¿æ¥</span>
    <span class="k">for</span> <span class="n">cam</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">cam</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> disconnected."</span><span class="p">)</span>
</code></pre></div></div>
  <div class="post-nav">
    <a class="prev" href="lerobotç¤ºæ•™.html">â† lerobotç¤ºæ•™</a>
    <a class="next" href="æ¨¡å‹è®­ç»ƒgpuè·‘é£.html">æ¨¡å‹è®­ç»ƒGPUè·‘é£ â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

