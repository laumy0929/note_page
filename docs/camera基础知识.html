<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Camera基础知识 - Laumy的技术栈</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJax支持LaTeX数学公式 -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumy的技术栈</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="输入关键词回车搜索">
        </div>
        <div class="theme-toggle" title="切换主题" id="theme-toggle">☾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">首页</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="访问主站">主站点:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">文章目录</div>
          <nav id="toc"><ul><li><a href="#v4l2media-device-framework">V4L2与Media device Framework</a><ul></ul></li><li><a href="#video-input-framework">Video Input Framework</a><ul></ul></li><li><a href="#device-driver">Device Driver</a><ul><li><a href="#isp">ISP驱动框架</a></li><li><a href="#ae">AE模块流程</a></li><li><a href="#af">AF模块流程</a></li></ul></li><li><a href="#media">Media框架</a><ul><li><a href="#media_1">Media成员</a></li><li><a href="#pipeline">pipeline</a></li><li><a href="#v4l2-framework">V4L2 Framework</a></li></ul></li><li><a href="#_3">其他概念</a><ul></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>Camera基础知识</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">🕒</i>
      2024-08-29
    </span>
    <span class="meta-item">
      <i class="icon">📂</i>
      linux
    </span>
    <span class="meta-item">
      <i class="icon">👤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_26e12f1b4882155d60c3b04b7e5ebe1d.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_26e12f1b4882155d60c3b04b7e5ebe1d.jpg"/></a></p>
<p>框架可以分为kernle层、Video input framework、Device Driver层</p>
<h2 id="v4l2media-device-framework">V4L2与Media device Framework</h2>
<ul>
<li>V4L2 Framework： 是video for Linux Two的简称。是Linux标准通用基础视频框架，向下屏蔽的各厂商的事项，向上提供标准的接口。适用于收音机、视频编解码、视频捕获以及视频输出设备驱动，提供了/dev/videxX节点，应用可以通过该节点进行相应视频流和控制操作</li>
<li>Media Device Framework：Linux多媒体设备框架，适用于管理设备拓扑结构，提供/dev/mediaX节点，通过该节点应用可以获取媒体设备拓扑结构，并能够通过API控制子设备间数据流向。</li>
</ul>
<h2 id="video-input-framework">Video Input Framework</h2>
<ul>
<li>Video Control：视频命令处理，包括分辨率协商，数据格式处理，buffer管理等</li>
<li>Runtime Handle：运行时管理，包括pipeline管理，系统资源管理，中断调度等。</li>
<li>Event Process：事件管理，包括上层调用，中断等时间的接收与分发。</li>
<li>Config Handle：配置管理，如硬件拓扑结构，模组自适应列表等。</li>
</ul>
<h2 id="device-driver">Device Driver</h2>
<ul>
<li>Camera Modules：模组驱动，包括图像传感器，对焦电机，闪光灯等驱动</li>
<li>Camera Interface：接口驱动，包括MIPI，sub-LVDS、Hispi，bt656、bt601、bt1120、DC等。</li>
<li>Image Signal Process：图像处理驱动，包括基本的图像3A处理、3A统计等。</li>
<li>Video Input Post Process（VIPP）：视频输入后处理，包括Scaler、OSD等。</li>
</ul>
<h3 id="isp">ISP驱动框架</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_ea3bd37ca6e848cd72a35095abdb6289.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_ea3bd37ca6e848cd72a35095abdb6289.jpg"/></a></p>
<h3 id="ae">AE模块流程</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_9be0e12c79606f4408aa4d09320e8f48.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_9be0e12c79606f4408aa4d09320e8f48.jpg"/></a></p>
<h3 id="af">AF模块流程</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_525321101875d75f38f988970506e082.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_525321101875d75f38f988970506e082.jpg"/></a></p>
<h2 id="media">Media框架</h2>
<h3 id="media_1">Media成员</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_d5b16bd31269455181af4d82fd306f57.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_d5b16bd31269455181af4d82fd306f57.jpg"/></a> 在media框架下每个v4l2主设备（如video）和v4l2子设备（sensor/mipi/csi/isp/scaler）都是一个media entity实例。每个media entity含有若干个pad，其中source pad标识输出端，sink pad表示输入端。media entity 之间的pad可以通过link链接起来。</p>
<p>在media entity中两个特殊的entity 是sensor和video。sensor只有source pad作为整个数据流的源头，video只有sink pad作为整个数据流的终点。每一条完整的数据流必须包含一个sensor和一个video。</p>
<h3 id="pipeline">pipeline</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_d94ed6aceb0b620dab9b9ac7403a30c7.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_d94ed6aceb0b620dab9b9ac7403a30c7.jpg"/></a></p>
<p>连接sensor和video整个数据流我们称之为pipeline，上图中红色的link线形成了三条pipeline。打开/dev/mediax设备可以设置这些media entity的pad之间的link，当一个sensor和一个video之间的link都使能后，并且形成一条完整的通路，一条pipeline就形成了。子设备之间的格式协商、电源管理和数据流都是在这个pipeline上进行的。为了使用方便，驱动在注册时会根据device tree的配置生成默认的pipeline，使用者直接打开/dev/videx就可以获取sensor采集的图像。</p>
<h4 id="_1">单路输入单路输出</h4>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_58b4bc0b04b0a51347a5f421db9e99a5.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_58b4bc0b04b0a51347a5f421db9e99a5.jpg"/></a></p>
<h4 id="_2">单路输入双路输出</h4>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_88638e5ca90e6567c5f705e2a3db14fe.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_88638e5ca90e6567c5f705e2a3db14fe.jpg"/></a></p>
<p>适用于一路预览一路编码的场景</p>
<h4 id="isp_1">单路输入双ISP多路输出</h4>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_84bffc22320392919b419575174ace4d.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_84bffc22320392919b419575174ace4d.jpg"/></a></p>
<p>适用于一路预览、一路编码、一路ADAD的场景或者一路编码、一路1fsp/s编码、一路AI处理</p>
<h4 id="isp_2">双路输入双ISP多路输出</h4>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_729d9cdd7632dc10fb55ed20037f9a17.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_729d9cdd7632dc10fb55ed20037f9a17.jpg"/></a></p>
<p>用于全景相机场景，双目拼接。</p>
<h3 id="v4l2-framework">V4L2 Framework</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_08c1a07235a4f4b368683be8deee7467.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_08c1a07235a4f4b368683be8deee7467.jpg"/></a> <a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_164c1be03ca0c4b78ac40606414618b4.jpg"><img alt="" src="assets/doc/01-linux/设备驱动/camera基础知识/images/wp_editor_md_164c1be03ca0c4b78ac40606414618b4.jpg"/></a></p>
<h2 id="_3">其他概念</h2>
<ul>
<li>
<p>2D降噪：只在2维空间域进行降噪处理，方法是对一个像素将其与周围像素平均减少噪声，缺点是会造成画面模糊，特别是物体边缘部分。因此这种算法的改进主要进行边缘检测，边缘部分的像素不用来进行模糊。</p>
</li>
<li>
<p>3D降噪：增添了时域的处理（前后图片），因此变为3维。和2维的区别是，2D降噪只考虑一帧图像，而3D降噪进一步考虑帧与帧之间的时域关系，对每个像素进行时域上的平均。例如，假设场景静止，那么连续两帧图像内容没变，他们的差值就是2倍的噪声。通过减少时域上的改变降低噪声。相比于2D降噪，3D降噪效果更好，且不会造成边缘的模糊，但存在的主要问题是画面不会完成静止，如果对不属于同一个物理得了两个点进行降噪处理会造成错误。</p>
</li>
<li>
<p>ISP TDM模式： 一路ISP可以同时处理2路摄像头的输入数据，达到分时复用效果。</p>
</li>
<li>
<p>H264 I/B/P帧： I帧是帧内编码，不参考其他图像帧，只利用本帧信息编码；P帧预测编码帧，利用之前的I帧或P帧，采用运动预测的方式进行帧间预测编码；B帧，是双向预测编码图像帧，提供最高的压缩比，需要之前的I或P帧，也需要后来的图像P帧，采用运动预测方式进行帧间双向预测编码；</p>
</li>
<li>
<p>H264 BP/MP/HP: BP（base line profile）是基本画质，支持I/P帧；EP(extend profile)是进阶画质，支持I/P/B/SP/SI帧；MP（main profile）是主流画质，支持I/P/B帧。HP（high profile）是高级画质，在MP的基础上增加8*8内部预测，自定义量化，无损视频编码和更多的YUV格式。</p>
</li>
<li>
<p>H264 SPS: 全称是Sequence Paramater Set，中文叫作序列参数集。SPS保存着视频内容的规格参数，包括视频高度、视频宽度、帧率等等。</p>
</li>
<li>
<p>H264 PSP: PPS的全称是Picture Paramater Set，中文叫做图像参数集。PPS保存着视频帧的编码参数，包括熵编码模式、切片分割类型、初始量化参数、色度量化参数等等</p>
</li>
</ul></div>
  <div class="post-nav">
    <a class="prev" href="function-graph-tracer原理.html">← function graph tracer原理</a>
    <a class="next" href="动态function-tracer原理.html">动态function tracer原理 →</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright ©2022-2025 laumy 版权所有</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

