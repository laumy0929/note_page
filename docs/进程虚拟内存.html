<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>è¿›ç¨‹è™šæ‹Ÿå†…å­˜ - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#_1">è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´</a><ul><li><a href="#executable-and-linkable-formatelf">Executable and Linkable Formatï¼ˆELFï¼‰</a></li><li><a href="#_2">è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´å¸ƒå±€</a></li></ul></li><li><a href="#_3">è™šæ‹Ÿåœ°å€ç©ºé—´æè¿°</a><ul></ul></li><li><a href="#_4">æ“ä½œç³»ç»Ÿè§’åº¦çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½è¿è¡Œ</a><ul></ul></li><li><a href="#vma">VMAçš„æ“ä½œå‡½æ•°</a><ul><li><a href="#vma_1">VMAæŸ¥æ‰¾</a></li><li><a href="#vma_2">VMAæ’å…¥</a></li><li><a href="#vma_3">VMAåˆå¹¶ä¸æ‹†åˆ†</a></li></ul></li><li><a href="#malloc">mallocå‡½æ•°</a><ul><li><a href="#malloc_1">ä¸mallocç›¸å…³çš„å‡½æ•°</a></li><li><a href="#malloc_2">mallocç³»ç»Ÿè°ƒç”¨æµç¨‹</a></li></ul></li><li><a href="#mmap">mmapå‡½æ•°</a><ul><li><a href="#_5">åŸºæœ¬æ¦‚å¿µ</a></li><li><a href="#_6">å®ç°åŸç†</a></li></ul></li><li><a href="#_7">ç¼ºé¡µå¼‚å¸¸</a><ul><li><a href="#do_page_fault">do_page_fault</a></li><li><a href="#_8">åŒ¿åé¡µé¢</a></li><li><a href="#_9">æ–‡ä»¶é¡µé¢</a></li><li><a href="#swap">swapé¡µé¢æ¢å…¥</a></li><li><a href="#cow">é¡µé¢å†™æ—¶å¤åˆ¶COW</a></li></ul></li><li><a href="#rmap">RMAP</a><ul><li><a href="#_10">å…³é”®æ•°æ®ç»“æ„</a></li><li><a href="#_11">åŸºæœ¬åŸç†</a></li><li><a href="#_12">æ˜ å°„åˆ°ä¸€ä¸ªè¿›ç¨‹çš„åå‘æ˜ å°„</a></li><li><a href="#_13">æ˜ å°„åˆ°å¤šä¸ªè¿›ç¨‹çš„åå‘æ˜ å°„</a></li><li><a href="#_16">åå‘æ˜ å°„çš„åº”ç”¨</a></li></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>è¿›ç¨‹è™šæ‹Ÿå†…å­˜</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2023-08-26
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      linux
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><h2 id="_1">è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´</h2>
<h3 id="executable-and-linkable-formatelf">Executable and Linkable Formatï¼ˆELFï¼‰</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_084108bffd6a37851ac96f61c55c3863.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_084108bffd6a37851ac96f61c55c3863.jpg"/></a> â€ƒâ€ƒä¸Šå›¾æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„å†…å®¹ç»“æ„å›¾ï¼Œç”±ELF headerã€program headersã€å„sectionã€sections headersç»„æˆã€‚ - ELF headerï¼šæè¿°æ•´ä¸ªæ–‡ä»¶çš„åŸºæœ¬å±æ€§ï¼Œå¦‚æ–‡ä»¶ç‰ˆæœ¬å·ã€ç›®æ ‡æœºå™¨å‹å·ã€ç¨‹åºå…¥å£åœ°å€ç­‰ã€‚ - program headersï¼šæè¿°ELFæ–‡ä»¶è¯¥å¦‚ä½•è¢«æ“ä½œç³»ç»Ÿæ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå¯¹äºLOADç±»å‹çš„Segmentï¼Œæ¯ä¸ªSegmentå¯¹åº”ä¸€ä¸ªVMAã€‚å¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œå¹¶ä¸å…³å¿ƒå„ä¸ªsectionæ‰€åŒ…å«çš„å†…å®¹ï¼Œå®ƒåªå…³å¿ƒè·Ÿè£…è½½ç›¸å…³çš„é—®é¢˜ï¼Œæœ€ä¸»è¦çš„æ˜¯sectionçš„æƒé™ï¼ˆå¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œï¼‰ï¼Œæ‰€ä»¥å¯¹äºç›¸åŒç±»å‹çš„sectionï¼Œå°†ä¼šè¢«åˆå¹¶æˆè¦ç»™Segmentè¿›è¡Œæ˜ å°„ï¼Œå¦‚init/text/rodataï¼Œè¿™äº›éƒ½æ˜¯å¯è¯»å¯æ‰§è¡Œæ‰€ä»¥åˆå¹¶æˆä¸€ä¸ªSegmentæ¥æè¿°ã€‚å¯¹äº.oæ–‡ä»¶æ˜¯æ²¡æœ‰program headesçš„ã€‚ - sectionsï¼šä»£ç ç»è¿‡ç¼–è¯‘ä¹‹åï¼Œå°†ä¼šåˆ†ç±»é“¾æ¥å¤šä¸ªsectionï¼Œå¦‚init/text/data/bssã€‚ - sections headersï¼šç”¨äºELFæ–‡ä»¶ä¸­å„sectionsçš„ã€‚</p>
<h4 id="elf-header">ELF header</h4>
<p>æè¿°ELF headerçš„ç»“æ„ä½“</p>
<div class="codehilite"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">e_ident</span><span class="p">[</span><span class="n">EI_NIDENT</span><span class="p">];</span><span class="w"> </span><span class="cm">/* 16 bytes */</span>
<span class="w"> </span><span class="n">Elf64_Half</span><span class="w"> </span><span class="n">e_type</span><span class="p">;</span><span class="w"> </span><span class="cm">/* File type */</span>
<span class="w"> </span><span class="p">....</span>
<span class="w"> </span><span class="n">Elf64_Addr</span><span class="w"> </span><span class="n">e_entry</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Entry point virtual address */</span>
<span class="w"> </span><span class="n">Elf64_Off</span><span class="w"> </span><span class="n">e_phoff</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Prog headers file offset */</span>
<span class="w"> </span><span class="n">Elf64_Off</span><span class="w"> </span><span class="n">e_shoff</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Sec headers file offset */</span>
<span class="w"> </span><span class="p">....</span>
<span class="w"> </span><span class="n">Elf64_Half</span><span class="w"> </span><span class="n">e_phentsize</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Prog headers entry size */</span>
<span class="w"> </span><span class="n">Elf64_Half</span><span class="w"> </span><span class="n">e_phnum</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Prog headers entry count */</span>
<span class="w"> </span><span class="n">Elf64_Half</span><span class="w"> </span><span class="n">e_shentsize</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Sec headers entry size */</span>
<span class="w"> </span><span class="n">Elf64_Half</span><span class="w"> </span><span class="n">e_shnum</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Sec headers entry count */</span>
<span class="w"> </span><span class="n">Elf64_Half</span><span class="w"> </span><span class="n">e_shstrndx</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Sec string table index */</span>
<span class="p">}</span><span class="w"> </span><span class="n">Elf64_Ehdr</span><span class="p">;</span>
</code></pre></div>
<p>å¯ä»¥é€šè¿‡readelf -h æ¥è·å–ELFçš„headerä¿¡æ¯ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">$</span><span class="w"> </span><span class="n">readelf</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="n">wifi_daemon</span>
<span class="n">ELF</span><span class="w"> </span><span class="n">Header</span><span class="o">:</span>
<span class="w">  </span><span class="nl">Magic</span><span class="p">:</span><span class="w">   </span><span class="mf">7f</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="mi">4</span><span class="n">c</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="mo">02</span><span class="w"> </span><span class="mo">01</span><span class="w"> </span><span class="mo">01</span><span class="w"> </span><span class="mo">00</span><span class="w"> </span><span class="mo">00</span><span class="w"> </span><span class="mo">00</span><span class="w"> </span><span class="mo">00</span><span class="w"> </span><span class="mo">00</span><span class="w"> </span><span class="mo">00</span><span class="w"> </span><span class="mo">00</span><span class="w"> </span><span class="mo">00</span><span class="w"> </span><span class="mo">00</span>
<span class="w">  </span><span class="nl">Class</span><span class="p">:</span><span class="w">                             </span><span class="n">ELF64</span>
<span class="w">  </span><span class="nl">Data</span><span class="p">:</span><span class="w">                              </span><span class="mi">2</span><span class="err">'</span><span class="n">s</span><span class="w"> </span><span class="n">complement</span><span class="p">,</span><span class="w"> </span><span class="n">little</span><span class="w"> </span><span class="n">endian</span>
<span class="w">  </span><span class="nl">Version</span><span class="p">:</span><span class="w">                           </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
<span class="w">  </span><span class="n">OS</span><span class="o">/</span><span class="n">ABI</span><span class="o">:</span><span class="w">                            </span><span class="n">UNIX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">System</span><span class="w"> </span><span class="n">V</span>
<span class="w">  </span><span class="n">ABI</span><span class="w"> </span><span class="n">Version</span><span class="o">:</span><span class="w">                       </span><span class="mi">0</span>
<span class="w">  </span><span class="nl">Type</span><span class="p">:</span><span class="w">                              </span><span class="n">EXEC</span><span class="w"> </span><span class="p">(</span><span class="n">Executable</span><span class="w"> </span><span class="n">file</span><span class="p">)</span>
<span class="w">  </span><span class="nl">Machine</span><span class="p">:</span><span class="w">                           </span><span class="n">AArch64</span>
<span class="w">  </span><span class="nl">Version</span><span class="p">:</span><span class="w">                           </span><span class="mh">0x1</span>
<span class="w">  </span><span class="n">Entry</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">address</span><span class="o">:</span><span class="w">               </span><span class="mh">0x401c00</span>
<span class="w">  </span><span class="n">Start</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">headers</span><span class="o">:</span><span class="w">          </span><span class="mi">64</span><span class="w"> </span><span class="p">(</span><span class="n">bytes</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">file</span><span class="p">)</span>
<span class="w">  </span><span class="n">Start</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">headers</span><span class="o">:</span><span class="w">          </span><span class="mi">44568</span><span class="w"> </span><span class="p">(</span><span class="n">bytes</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">file</span><span class="p">)</span>
<span class="w">  </span><span class="nl">Flags</span><span class="p">:</span><span class="w">                             </span><span class="mh">0x0</span>
<span class="w">  </span><span class="n">Size</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">header</span><span class="o">:</span><span class="w">               </span><span class="mi">64</span><span class="w"> </span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
<span class="w">  </span><span class="n">Size</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">headers</span><span class="o">:</span><span class="w">           </span><span class="mi">56</span><span class="w"> </span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
<span class="w">  </span><span class="n">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">headers</span><span class="o">:</span><span class="w">         </span><span class="mi">9</span>
<span class="w">  </span><span class="n">Size</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">headers</span><span class="o">:</span><span class="w">           </span><span class="mi">64</span><span class="w"> </span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
<span class="w">  </span><span class="n">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">headers</span><span class="o">:</span><span class="w">         </span><span class="mi">29</span>
<span class="w">  </span><span class="n">Section</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="n">index</span><span class="o">:</span><span class="w"> </span><span class="mi">28</span>
</code></pre></div>
<h4 id="program-headers">program headers</h4>
<p>æè¿°Program headerçš„ç»“æ„ä½“ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Program header for ELF64.</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w">  </span><span class="p">{</span>
<span class="w">  </span><span class="n">Elf64_Word</span><span class="w"> </span><span class="n">p_type</span><span class="p">;</span><span class="w">    </span><span class="c1">// Type of segment</span>
<span class="w">  </span><span class="n">Elf64_Word</span><span class="w"> </span><span class="n">p_flags</span><span class="p">;</span><span class="w">   </span><span class="c1">// Segment flags</span>
<span class="w">  </span><span class="n">Elf64_Off</span><span class="w"> </span><span class="n">p_offset</span><span class="p">;</span><span class="w">   </span><span class="c1">// File offset where segment is located, in bytes</span>
<span class="w">  </span><span class="n">Elf64_Addr</span><span class="w"> </span><span class="n">p_vaddr</span><span class="p">;</span><span class="w">   </span><span class="c1">// Virtual address of beginning of segment</span>
<span class="w">  </span><span class="n">Elf64_Addr</span><span class="w"> </span><span class="n">p_paddr</span><span class="p">;</span><span class="w">   </span><span class="c1">// Physical addr of beginning of segment (OS-specific)</span>
<span class="w">  </span><span class="n">Elf64_Xword</span><span class="w"> </span><span class="n">p_filesz</span><span class="p">;</span><span class="w"> </span><span class="c1">// Num. of bytes in file image of segment (may be zero)</span>
<span class="w">  </span><span class="n">Elf64_Xword</span><span class="w"> </span><span class="n">p_memsz</span><span class="p">;</span><span class="w">  </span><span class="c1">// Num. of bytes in mem image of segment (may be zero)</span>
<span class="w">  </span><span class="n">Elf64_Xword</span><span class="w"> </span><span class="n">p_align</span><span class="p">;</span><span class="w">  </span><span class="c1">// Segment alignment constraint</span>
<span class="p">}</span><span class="w"> </span><span class="n">Elf64_Phdr</span><span class="p">;</span>
</code></pre></div>
<p>å¯ä»¥é€šè¿‡readelf -l []æ¥è·å–ELFçš„pragram headerä¿¡æ¯ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">$</span><span class="w"> </span><span class="n">readelf</span><span class="w"> </span><span class="o">-</span><span class="n">l</span><span class="w"> </span><span class="n">wifi_daemon</span>

<span class="n">Elf</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">EXEC</span><span class="w"> </span><span class="p">(</span><span class="n">Executable</span><span class="w"> </span><span class="n">file</span><span class="p">)</span>
<span class="n">Entry</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="mh">0x401c00</span>
<span class="n">There</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">headers</span><span class="p">,</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mi">64</span>

<span class="n">Program</span><span class="w"> </span><span class="n">Headers</span><span class="o">:</span>
<span class="w">  </span><span class="n">Type</span><span class="w">           </span><span class="n">Offset</span><span class="w">             </span><span class="n">VirtAddr</span><span class="w">           </span><span class="n">PhysAddr</span>
<span class="w">                 </span><span class="n">FileSiz</span><span class="w">            </span><span class="n">MemSiz</span><span class="w">              </span><span class="n">Flags</span><span class="w">  </span><span class="n">Align</span>
<span class="w">  </span><span class="n">PHDR</span><span class="w">           </span><span class="mh">0x0000000000000040</span><span class="w"> </span><span class="mh">0x0000000000400040</span><span class="w"> </span><span class="mh">0x0000000000400040</span>
<span class="w">                 </span><span class="mh">0x00000000000001f8</span><span class="w"> </span><span class="mh">0x00000000000001f8</span><span class="w">  </span><span class="n">R</span><span class="w">      </span><span class="mi">8</span>
<span class="w">  </span><span class="n">INTERP</span><span class="w">         </span><span class="mh">0x0000000000000238</span><span class="w"> </span><span class="mh">0x0000000000400238</span><span class="w"> </span><span class="mh">0x0000000000400238</span>
<span class="w">                 </span><span class="mh">0x000000000000001b</span><span class="w"> </span><span class="mh">0x000000000000001b</span><span class="w">  </span><span class="n">R</span><span class="w">      </span><span class="mi">1</span>
<span class="w">      </span><span class="p">[</span><span class="n">Requesting</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">interpreter</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ld</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">aarch64</span><span class="p">.</span><span class="n">so</span><span class="mf">.1</span><span class="p">]</span>
<span class="w">  </span><span class="n">LOAD</span><span class="w">           </span><span class="mh">0x0000000000000000</span><span class="w"> </span><span class="mh">0x0000000000400000</span><span class="w"> </span><span class="mh">0x0000000000400000</span>
<span class="w">                 </span><span class="mh">0x000000000000899c</span><span class="w"> </span><span class="mh">0x000000000000899c</span><span class="w">  </span><span class="n">R</span><span class="w"> </span><span class="n">E</span><span class="w">    </span><span class="mi">10000</span>
<span class="w">  </span><span class="n">LOAD</span><span class="w">           </span><span class="mh">0x0000000000008b60</span><span class="w"> </span><span class="mh">0x0000000000418b60</span><span class="w"> </span><span class="mh">0x0000000000418b60</span>
<span class="w">                 </span><span class="mh">0x00000000000005b4</span><span class="w"> </span><span class="mh">0x00000000000005e0</span><span class="w">  </span><span class="n">RW</span><span class="w">     </span><span class="mi">10000</span>
<span class="w">  </span><span class="n">DYNAMIC</span><span class="w">        </span><span class="mh">0x0000000000008b68</span><span class="w"> </span><span class="mh">0x0000000000418b68</span><span class="w"> </span><span class="mh">0x0000000000418b68</span>
<span class="w">                 </span><span class="mh">0x0000000000000270</span><span class="w"> </span><span class="mh">0x0000000000000270</span><span class="w">  </span><span class="n">RW</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="n">NOTE</span><span class="w">           </span><span class="mh">0x0000000000000254</span><span class="w"> </span><span class="mh">0x0000000000400254</span><span class="w"> </span><span class="mh">0x0000000000400254</span>
<span class="w">                 </span><span class="mh">0x0000000000000020</span><span class="w"> </span><span class="mh">0x0000000000000020</span><span class="w">  </span><span class="n">R</span><span class="w">      </span><span class="mi">4</span>
<span class="w">  </span><span class="n">GNU_EH_FRAME</span><span class="w">   </span><span class="mh">0x0000000000008628</span><span class="w"> </span><span class="mh">0x0000000000408628</span><span class="w"> </span><span class="mh">0x0000000000408628</span>
<span class="w">                 </span><span class="mh">0x000000000000008c</span><span class="w"> </span><span class="mh">0x000000000000008c</span><span class="w">  </span><span class="n">R</span><span class="w">      </span><span class="mi">4</span>
<span class="w">  </span><span class="n">GNU_STACK</span><span class="w">      </span><span class="mh">0x0000000000000000</span><span class="w"> </span><span class="mh">0x0000000000000000</span><span class="w"> </span><span class="mh">0x0000000000000000</span>
<span class="w">                 </span><span class="mh">0x0000000000000000</span><span class="w"> </span><span class="mh">0x0000000000000000</span><span class="w">  </span><span class="n">RW</span><span class="w">     </span><span class="mi">10</span>
<span class="w">  </span><span class="n">GNU_RELRO</span><span class="w">      </span><span class="mh">0x0000000000008b60</span><span class="w"> </span><span class="mh">0x0000000000418b60</span><span class="w"> </span><span class="mh">0x0000000000418b60</span>
<span class="w">                 </span><span class="mh">0x00000000000004a0</span><span class="w"> </span><span class="mh">0x00000000000004a0</span><span class="w">  </span><span class="n">R</span><span class="w">      </span><span class="mi">1</span>

<span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Segment</span><span class="w"> </span><span class="n">mapping</span><span class="o">:</span>
<span class="w">  </span><span class="n">Segment</span><span class="w"> </span><span class="n">Sections</span><span class="p">...</span>
<span class="w">   </span><span class="mo">00</span>
<span class="w">   </span><span class="mo">01</span><span class="w">     </span><span class="p">.</span><span class="n">interp</span>
<span class="mo">02</span><span class="w">     </span><span class="p">.</span><span class="n">interp</span><span class="w"> </span><span class="p">.</span><span class="n">note</span><span class="p">.</span><span class="n">ABI</span><span class="o">-</span><span class="n">tag</span><span class="w"> </span><span class="p">.</span><span class="n">hash</span><span class="w"> </span><span class="p">.</span><span class="n">gnu</span><span class="p">.</span><span class="n">hash</span><span class="w"> </span><span class="p">.</span><span class="n">dynsym</span><span class="w"> </span><span class="p">.</span><span class="n">dynstr</span><span class="w"> </span><span class="p">.</span><span class="n">gnu</span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="p">.</span><span class="n">gnu</span><span class="p">.</span><span class="n">version_r</span><span class="w"> </span><span class="p">.</span><span class="n">rela</span><span class="p">.</span><span class="n">dyn</span><span class="w"> </span><span class="p">.</span><span class="n">rela</span><span class="p">.</span><span class="n">plt</span><span class="w"> </span><span class="p">.</span><span class="n">init</span><span class="w"> </span><span class="p">.</span><span class="n">plt</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="p">.</span><span class="n">fini</span><span class="w"> </span><span class="p">.</span><span class="n">rodata</span><span class="w"> </span><span class="p">.</span><span class="n">eh_frame_hdr</span><span class="w"> </span><span class="p">.</span><span class="n">eh_frame</span>
<span class="w">   </span><span class="mo">03</span><span class="w">     </span><span class="p">.</span><span class="n">init_array</span><span class="w"> </span><span class="p">.</span><span class="n">fini_array</span><span class="w"> </span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">rel</span><span class="p">.</span><span class="n">ro</span><span class="w"> </span><span class="p">.</span><span class="n">dynamic</span><span class="w"> </span><span class="p">.</span><span class="n">got</span><span class="w"> </span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="p">.</span><span class="n">bss</span>
<span class="w">   </span><span class="mo">04</span><span class="w">     </span><span class="p">.</span><span class="n">dynamic</span>
<span class="w">   </span><span class="mo">05</span><span class="w">     </span><span class="p">.</span><span class="n">note</span><span class="p">.</span><span class="n">ABI</span><span class="o">-</span><span class="n">tag</span>
<span class="w">   </span><span class="mo">06</span><span class="w">     </span><span class="p">.</span><span class="n">eh_frame_hdr</span>
<span class="w">   </span><span class="mo">07</span>
<span class="w">   </span><span class="mi">08</span><span class="w">     </span><span class="p">.</span><span class="n">init_array</span><span class="w"> </span><span class="p">.</span><span class="n">fini_array</span><span class="w"> </span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">rel</span><span class="p">.</span><span class="n">ro</span><span class="w"> </span><span class="p">.</span><span class="n">dynamic</span><span class="w"> </span><span class="p">.</span><span class="n">got</span>
</code></pre></div>
<p>ä»ä¸Šå¯ä»¥çœ‹å‡ºä¸€å…±æœ‰9å„segmentï¼Œä¸å‰é¢elf headerä¿¡æ¯ä¸­çš„Number of program headers:9å¯¹åº”ã€‚è¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨02å’Œ03çš„segmentå³å¯ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªsegmentçš„ç±»å‹æ˜¯LOADç±»å‹ï¼Œæ¯ä¸ªsegmentå°±å¯¹åº”ä¸€ä¸ªVMAï¼Œä¸æˆ‘ä»¬åé¢å…³äºè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„æœ‰ç€éå¸¸é‡è¦çš„è”ç³»ã€‚ æ“ä½œç³»ç»Ÿåªå…³å¿ƒæ®µçš„æƒé™ï¼ˆå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œï¼‰ï¼Œæ‰€ä»¥å¯¹äºç›¸åŒç±»å‹æƒé™æ®µå¯ä»¥åˆå¹¶åˆ°ä¸€èµ·å½“ä½œä¸€ä¸ªæ®µæ¥æ˜ å°„ï¼Œæ‰€ä»¥é€šå¸¸çš„åˆ†ç±»æœ‰ä¸€ä¸‹ä¸‰ç§ï¼š - å¯è¯»å¯æ‰§è¡Œï¼šä»£ç å—ä¸ºä»£è¡¨ - å¯è¯»å¯å†™ï¼šdataå—å’ŒBSSå—ä¸ºä»£è¡¨ - åªè¯»ï¼šrodataå—ä¸ºä»£è¡¨</p>
<h4 id="sections">sections</h4>
<p>ä¸‹é¢æ˜¯æè¿°sections headersçš„ç»“æ„ä½“ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Section header.</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Elf32_Shdr</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">sh_name</span><span class="p">;</span><span class="w">      </span><span class="c1">// Section name (index into string table)</span>
<span class="w">  </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">sh_type</span><span class="p">;</span><span class="w">      </span><span class="c1">// Section type (SHT_*)</span>
<span class="w">  </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">sh_flags</span><span class="p">;</span><span class="w">     </span><span class="c1">// Section flags (SHF_*)</span>
<span class="w">  </span><span class="n">Elf32_Addr</span><span class="w"> </span><span class="n">sh_addr</span><span class="p">;</span><span class="w">      </span><span class="c1">// Address where section is to be loaded</span>
<span class="w">  </span><span class="n">Elf32_Off</span><span class="w"> </span><span class="n">sh_offset</span><span class="p">;</span><span class="w">     </span><span class="c1">// File offset of section data, in bytes</span>
<span class="w">  </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">sh_size</span><span class="p">;</span><span class="w">      </span><span class="c1">// Size of section, in bytes</span>
<span class="w">  </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">sh_link</span><span class="p">;</span><span class="w">      </span><span class="c1">// Section type-specific header table index link</span>
<span class="w">  </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">sh_info</span><span class="p">;</span><span class="w">      </span><span class="c1">// Section type-specific extra information</span>
<span class="w">  </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">sh_addralign</span><span class="p">;</span><span class="w"> </span><span class="c1">// Section address alignment</span>
<span class="w">  </span><span class="n">Elf32_Word</span><span class="w"> </span><span class="n">sh_entsize</span><span class="p">;</span><span class="w">   </span><span class="c1">// Size of records contained within the section</span>
<span class="p">};</span>
</code></pre></div>
<p>å¯ä»¥é€šè¿‡readelf -S []æ¥è¯»å–ELFçš„section headerçš„ä¿¡æ¯ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">$</span><span class="w"> </span><span class="n">readelf</span><span class="w"> </span><span class="o">-</span><span class="n">S</span><span class="w"> </span><span class="n">wifi_daemon</span>
<span class="n">There</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">headers</span><span class="p">,</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="mh">0xae18</span><span class="o">:</span>

<span class="n">Section</span><span class="w"> </span><span class="n">Headers</span><span class="o">:</span>
<span class="w">  </span><span class="p">[</span><span class="n">Nr</span><span class="p">]</span><span class="w"> </span><span class="n">Name</span><span class="w">              </span><span class="n">Type</span><span class="w">             </span><span class="n">Address</span><span class="w">           </span><span class="n">Offset</span>
<span class="w">       </span><span class="n">Size</span><span class="w">              </span><span class="n">EntSize</span><span class="w">          </span><span class="n">Flags</span><span class="w">  </span><span class="n">Link</span><span class="w">  </span><span class="n">Info</span><span class="w">  </span><span class="n">Align</span>
<span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="w">                   </span><span class="nb">NULL</span><span class="w">             </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="mo">00000000</span>
<span class="w">       </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">           </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span>
<span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">interp</span><span class="w">           </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">000000000040023</span><span class="mi">8</span><span class="w">  </span><span class="mo">0000023</span><span class="mi">8</span>
<span class="w">       </span><span class="mo">000000000000001</span><span class="n">b</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">1</span>
<span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">note</span><span class="p">.</span><span class="n">ABI</span><span class="o">-</span><span class="n">tag</span><span class="w">     </span><span class="n">NOTE</span><span class="w">             </span><span class="mo">0000000000400254</span><span class="w">  </span><span class="mo">00000254</span>
<span class="w">       </span><span class="mo">0000000000000020</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">4</span>
<span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">hash</span><span class="w">             </span><span class="n">HASH</span><span class="w">             </span><span class="mo">000000000040027</span><span class="mi">8</span><span class="w">  </span><span class="mo">0000027</span><span class="mi">8</span>
<span class="w">       </span><span class="mo">00000000000001</span><span class="n">a0</span><span class="w">  </span><span class="mo">0000000000000004</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">5</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">gnu</span><span class="p">.</span><span class="n">hash</span><span class="w">         </span><span class="n">GNU_HASH</span><span class="w">         </span><span class="mo">000000000040041</span><span class="mi">8</span><span class="w">  </span><span class="mo">0000041</span><span class="mi">8</span>
<span class="w">       </span><span class="mo">0000000000000024</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">5</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">dynsym</span><span class="w">           </span><span class="n">DYNSYM</span><span class="w">           </span><span class="mo">0000000000400440</span><span class="w">  </span><span class="mo">00000440</span>
<span class="w">       </span><span class="mo">000000000000061</span><span class="mi">8</span><span class="w">  </span><span class="mo">000000000000001</span><span class="mi">8</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">6</span><span class="w">     </span><span class="mi">1</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">dynstr</span><span class="w">           </span><span class="n">STRTAB</span><span class="w">           </span><span class="mo">0000000000400</span><span class="n">a58</span><span class="w">  </span><span class="mo">00000</span><span class="n">a58</span>
<span class="w">       </span><span class="mo">00000000000003</span><span class="n">b8</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">1</span>
<span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mi">7</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">gnu</span><span class="p">.</span><span class="n">version</span><span class="w">      </span><span class="n">VERSYM</span><span class="w">           </span><span class="mf">0000000000400e10</span><span class="w">  </span><span class="mf">00000e10</span>
<span class="w">       </span><span class="mo">00000000000000</span><span class="mi">82</span><span class="w">  </span><span class="mo">0000000000000002</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">5</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">2</span>
<span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">gnu</span><span class="p">.</span><span class="n">version_r</span><span class="w">    </span><span class="n">VERNEED</span><span class="w">          </span><span class="mf">0000000000400e98</span><span class="w">  </span><span class="mf">00000e98</span>
<span class="w">       </span><span class="mo">0000000000000060</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">6</span><span class="w">     </span><span class="mi">3</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="mi">9</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">rela</span><span class="p">.</span><span class="n">dyn</span><span class="w">         </span><span class="n">RELA</span><span class="w">             </span><span class="mo">0000000000400</span><span class="n">ef8</span><span class="w">  </span><span class="mo">00000</span><span class="n">ef8</span>
<span class="w">       </span><span class="mo">0000000000000030</span><span class="w">  </span><span class="mo">000000000000001</span><span class="mi">8</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">5</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">rela</span><span class="p">.</span><span class="n">plt</span><span class="w">         </span><span class="n">RELA</span><span class="w">             </span><span class="mf">0000000000400f</span><span class="mi">28</span><span class="w">  </span><span class="mf">00000f</span><span class="mi">28</span>
<span class="w">       </span><span class="mf">00000000000005e8</span><span class="w">  </span><span class="mo">000000000000001</span><span class="mi">8</span><span class="w">  </span><span class="n">AI</span><span class="w">       </span><span class="mi">5</span><span class="w">    </span><span class="mi">22</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">init</span><span class="w">             </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">0000000000401510</span><span class="w">  </span><span class="mo">00001510</span>
<span class="w">       </span><span class="mo">000000000000001</span><span class="mi">8</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="n">AX</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">4</span>
<span class="w">  </span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">plt</span><span class="w">              </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">0000000000401530</span><span class="w">  </span><span class="mo">00001530</span>
<span class="w">       </span><span class="mo">0000000000000410</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="n">AX</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">16</span>
<span class="w">  </span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w">             </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">0000000000401</span><span class="mi">940</span><span class="w">  </span><span class="mo">00001</span><span class="mi">940</span>
<span class="w">       </span><span class="mf">00000000000038e4</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="n">AX</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">64</span>
<span class="w">  </span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">fini</span><span class="w">             </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">0000000000405224</span><span class="w">  </span><span class="mo">00005224</span>
<span class="w">       </span><span class="mo">0000000000000014</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="n">AX</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">4</span>
<span class="w">  </span><span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">rodata</span><span class="w">           </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">000000000040523</span><span class="mi">8</span><span class="w">  </span><span class="mo">0000523</span><span class="mi">8</span>
<span class="w">       </span><span class="mf">00000000000033f</span><span class="mi">0</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">eh_frame_hdr</span><span class="w">     </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">000000000040</span><span class="mi">8628</span><span class="w">  </span><span class="mo">0000</span><span class="mi">8628</span>
<span class="w">       </span><span class="mo">00000000000000</span><span class="mi">8</span><span class="n">c</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">4</span>
<span class="w">  </span><span class="p">[</span><span class="mi">17</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">eh_frame</span><span class="w">         </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">000000000040</span><span class="mi">86</span><span class="n">b8</span><span class="w">  </span><span class="mo">0000</span><span class="mi">86</span><span class="n">b8</span>
<span class="w">       </span><span class="mf">00000000000002e4</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">   </span><span class="n">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">init_array</span><span class="w">       </span><span class="n">INIT_ARRAY</span><span class="w">       </span><span class="mo">000000000041</span><span class="mi">8</span><span class="n">b60</span><span class="w">  </span><span class="mo">0000</span><span class="mi">8</span><span class="n">b60</span>
<span class="w">       </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="mo">000000000000000</span><span class="mi">8</span><span class="w">  </span><span class="n">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">1</span>
<span class="w">  </span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">fini_array</span><span class="w">       </span><span class="n">FINI_ARRAY</span><span class="w">       </span><span class="mo">000000000041</span><span class="mi">8</span><span class="n">b60</span><span class="w">  </span><span class="mo">0000</span><span class="mi">8</span><span class="n">b60</span>
<span class="w">       </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="mo">000000000000000</span><span class="mi">8</span><span class="w">  </span><span class="n">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">1</span>
<span class="w">  </span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">rel</span><span class="p">.</span><span class="n">ro</span><span class="w">      </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">000000000041</span><span class="mi">8</span><span class="n">b60</span><span class="w">  </span><span class="mo">0000</span><span class="mi">8</span><span class="n">b60</span>
<span class="w">       </span><span class="mo">000000000000000</span><span class="mi">8</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="n">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="mi">21</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">dynamic</span><span class="w">          </span><span class="n">DYNAMIC</span><span class="w">          </span><span class="mo">000000000041</span><span class="mi">8</span><span class="n">b68</span><span class="w">  </span><span class="mo">0000</span><span class="mi">8</span><span class="n">b68</span>
<span class="w">       </span><span class="mo">0000000000000270</span><span class="w">  </span><span class="mo">0000000000000010</span><span class="w">  </span><span class="n">WA</span><span class="w">       </span><span class="mi">6</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="mi">22</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">got</span><span class="w">              </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">000000000041</span><span class="mi">8</span><span class="n">dd8</span><span class="w">  </span><span class="mo">0000</span><span class="mi">8</span><span class="n">dd8</span>
<span class="w">       </span><span class="mo">000000000000022</span><span class="mi">8</span><span class="w">  </span><span class="mo">000000000000000</span><span class="mi">8</span><span class="w">  </span><span class="n">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="mi">23</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">data</span><span class="w">             </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">000000000041</span><span class="mi">9000</span><span class="w">  </span><span class="mo">0000</span><span class="mi">9000</span>
<span class="w">       </span><span class="mo">0000000000000114</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="n">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="mi">24</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">bss</span><span class="w">              </span><span class="n">NOBITS</span><span class="w">           </span><span class="mo">000000000041</span><span class="mi">9118</span><span class="w">  </span><span class="mo">0000</span><span class="mi">9114</span>
<span class="w">       </span><span class="mo">000000000000002</span><span class="mi">8</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="n">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="mi">25</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">comment</span><span class="w">          </span><span class="n">PROGBITS</span><span class="w">         </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="mo">0000</span><span class="mi">9114</span>
<span class="w">       </span><span class="mo">0000000000000033</span><span class="w">  </span><span class="mo">0000000000000001</span><span class="w">  </span><span class="n">MS</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">1</span>
<span class="w">  </span><span class="p">[</span><span class="mi">26</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">symtab</span><span class="w">           </span><span class="n">SYMTAB</span><span class="w">           </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="mo">0000</span><span class="mi">9148</span>
<span class="w">       </span><span class="mo">00000000000011</span><span class="n">a0</span><span class="w">  </span><span class="mo">000000000000001</span><span class="mi">8</span><span class="w">          </span><span class="mi">27</span><span class="w">   </span><span class="mi">103</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="p">[</span><span class="mi">27</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">strtab</span><span class="w">           </span><span class="n">STRTAB</span><span class="w">           </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="mo">0000</span><span class="n">a2e8</span>
<span class="w">       </span><span class="mo">0000000000000</span><span class="n">a38</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">           </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">1</span>
<span class="w">  </span><span class="p">[</span><span class="mi">28</span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="n">shstrtab</span><span class="w">         </span><span class="n">STRTAB</span><span class="w">           </span><span class="mo">0000000000000000</span><span class="w">  </span><span class="mo">0000</span><span class="n">ad20</span>
<span class="w">       </span><span class="mf">00000000000000f</span><span class="mi">4</span><span class="w">  </span><span class="mo">0000000000000000</span><span class="w">           </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">1</span>
<span class="n">Key</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Flags</span><span class="o">:</span>
<span class="w">  </span><span class="n">W</span><span class="w"> </span><span class="p">(</span><span class="n">write</span><span class="p">),</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">(</span><span class="n">alloc</span><span class="p">),</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="p">(</span><span class="n">execute</span><span class="p">),</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="p">(</span><span class="n">merge</span><span class="p">),</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
<span class="w">  </span><span class="n">I</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="p">),</span><span class="w"> </span><span class="n">L</span><span class="w"> </span><span class="p">(</span><span class="n">link</span><span class="w"> </span><span class="n">order</span><span class="p">),</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="p">(</span><span class="n">group</span><span class="p">),</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">(</span><span class="n">TLS</span><span class="p">),</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="p">(</span><span class="n">exclude</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="n">unknown</span><span class="p">)</span>
<span class="w">  </span><span class="n">O</span><span class="w"> </span><span class="p">(</span><span class="n">extra</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="n">processing</span><span class="w"> </span><span class="n">required</span><span class="p">)</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="p">(</span><span class="n">OS</span><span class="w"> </span><span class="n">specific</span><span class="p">),</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">(</span><span class="n">processor</span><span class="w"> </span><span class="n">specific</span><span class="p">)</span>
</code></pre></div>
<p>å¯ä»¥çœ‹å‡ºwifi_daemonä¸­ä¸€å…±æœ‰29ä¸ªsectionï¼Œä¸ELF headeræè¿°å†…å®¹ä¸­çš„Number of section headers:29æ˜¯åŒ¹é…çš„ã€‚</p>
<h3 id="_2">è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´å¸ƒå±€</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_84f197c7354956b9c09ec9d32ccdec97.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_84f197c7354956b9c09ec9d32ccdec97.jpg"/></a> â€ƒâ€ƒç³»ç»Ÿå¯¹è™šæ‹Ÿåœ°å€ç©ºé—´è¿›è¡Œå¸ƒå±€ï¼Œåœ¨2.3ç« èŠ‚ä¸­æè¿°äº†å†…æ ¸ç©ºé—´çš„åˆ’åˆ†ï¼ŒåŒæ ·é’ˆå¯¹ç”¨æˆ·ç©ºé—´ä¹Ÿæœ‰è¿›è¡Œäº†åˆ’åˆ†ã€‚å¯ä»¥åˆ†ä¸º4ç±»ï¼š - æ ˆï¼šç”¨äºç»´æŠ¤å‡½æ•°è°ƒç”¨çš„ä¸Šä¸‹æ–‡ï¼Œæ ˆåœ¨ç”¨æˆ·ç©ºé—´çš„æœ€é«˜åœ°å€å¤„åˆ†é…ï¼Œåœ°å€æ˜¯å‘ä¸‹å¢é•¿ã€‚ - å †ï¼šç”¨æˆ·ç¨‹åºåŠ¨æ€åˆ†é…å†…å­˜çš„åŒºåŸŸï¼Œå½“ä½¿ç”¨mallocåˆ†é…å†…å­˜æ—¶ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´å°†åœ¨è¿™ä¸ªèŒƒå›´ï¼Œåœ°å€å‘ä¸Šå¢é•¿ã€‚ - MMAP:åœ¨æ ˆå’Œå †ç©ºé—´æœ‰ä¸€ä¸ªMMAPåŒºåŸŸï¼Œä¸»è¦ç”¨äºmmapç³»ç»Ÿè°ƒç”¨çš„æ˜ å°„ã€‚åŒ…æ‹¬æ–‡ä»¶æ˜ å°„ï¼ˆåŒ…å«åŠ¨æ€åº“ã€æ–‡ä»¶IOï¼‰å’ŒåŒ¿åæ˜ å°„ã€‚ - å¯æ‰§è¡Œæ–‡ä»¶æ˜ åƒï¼šå­˜å‚¨å¯æ‰§è¡Œæ–‡ä»¶åœ¨å†…å­˜çš„æ˜ åƒï¼Œè£…è½½å™¨ä¼šå°†ELFå†…å®¹è¯»å–æˆ–æ˜ å°„åˆ°è¿™é‡Œã€‚ â€ƒâ€ƒå¯æ‰§è¡Œæ–‡ä»¶æ˜ åƒå¯å†è¿›è¡Œåˆ†ç±»ï¼Œå‰é¢ç« èŠ‚æè¿°äº†ï¼Œç¨‹åºæœ€ç»ˆç¼–è¯‘ä¸´ç•Œæˆå„ä¸ªsectionsï¼Œå¦‚textï¼Œdataï¼Œbssç­‰ç­‰ï¼Œä½†å¯¹äºç³»ç»Ÿæ¥è¯´å…³æ³¨çš„æ˜¯åŠ è½½çš„æ–¹å¼ï¼Œå¦‚è¯»å†™æ‰§è¡Œæƒé™ï¼Œå› æ­¤å¯æ‰§è¡Œæ–‡ä»¶æ˜ åƒçš„åˆ†ç±»æ˜¯æŒ‰ç…§æƒé™åˆ’åˆ†çš„ã€‚å¦‚ä¸Šåˆ†ä¸ºåªè¯»æƒé™ï¼ˆå¯¹åº”init,textç­‰sectionï¼‰ï¼Œè¯»å†™æƒé™ï¼ˆå¯¹åº”.data,bssç­‰ï¼‰ã€‚</p>
<h2 id="_3">è™šæ‹Ÿåœ°å€ç©ºé—´æè¿°</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_0bc071fc49abb0b7ab2526ed0779b15c.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_0bc071fc49abb0b7ab2526ed0779b15c.jpg"/></a> â€ƒâ€ƒLinuxç³»ç»Ÿæ“ä½œçš„æ˜¯è™šæ‹Ÿåœ°å€ï¼Œè®¿é—®å®é™…å†…å­˜éœ€è¦å°†è™šæ‹Ÿåœ°å€é€šè¿‡MMUæŸ¥è¯¢é¡µè¡¨ï¼Œè½¬åŒ–ä¸ºç‰©ç†åœ°å€ã€‚ç”¨æˆ·ç©ºé—´çš„è™šæ‹Ÿåœ°å€å¯ä»¥æŒ‰ç…§å¦‚ä¸Šå›¾è¿›è¡Œåˆ†ä¸ºå‡ ä¸ªsegmentï¼Œæ¯ä¸ªsegmentéƒ½å¯¹åº”ä¸€ä¸ªVMAã€‚è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ï¼Œæ˜¯æ¯ä¸ªVMAåˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ã€‚ â€ƒâ€ƒVMAä½œä¸ºè¿›ç¨‹åœ°å€ç©ºé—´ä¸€å—è¿ç»­åŒºåŸŸï¼Œä½¿ç”¨struct vm_area_structç»“æ„ä½“è¿›è¡Œæè¿°ã€‚è¯¥ç»“æ„ä½“ä¸­æè¿°äº†è¿ç»­åŒºåŸŸçš„èµ·å§‹åœ°å€å’Œåœ°å€ã€‚ â€ƒâ€ƒVMAä¹‹é—´é€šè¿‡åŒå‘é“¾æ¥è¿æ¥åœ¨ä¸€èµ·ï¼Œåœ¨struct vm_area_structä¸­vm_nextï¼Œvm_prevåˆ†åˆ«æŒ‡å‘ä¸‹ä¸€ä¸ªVMAå’Œä¸Šä¸€ä¸ªVMAï¼Œä½¿ç”¨åŒå‘é“¾è¡¨æ¥ç»„ç»‡VMAï¼Œä¾¿äºè¿›ç¨‹è™šæ‹Ÿåœ°å€å¯¹VMAçš„æ’å…¥ã€‚ â€ƒâ€ƒVMAåŒæ—¶åˆè¢«åŠ å…¥åˆ°ä¸€æ£µçº¢é»‘æ ‘ä¸­ï¼Œåœ¨struct vm_area_structä¸­çš„vm_rbæè¿°çº¢é»‘æ ‘çš„èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹åœ¨struct mm_struct mm_rbæ¥æè¿°ï¼Œæ—¢ç„¶VMAé€šè¿‡é“¾è¡¨ä¸²ä¸€èµ·äº†ï¼Œä¸ºä»€ä¹ˆå†ä½¿ç”¨çº¢é»‘æ ‘æ¥ç»„ç»‡ï¼Œä¸»è¦æ˜¯ä½¿ç”¨çº¢é»‘æ ‘èƒ½å¤ŸåŠ å¿«è¿›ç¨‹æœç´¢VMAçš„é€Ÿåº¦ã€‚ â€ƒâ€ƒmm_structæ•°æ®ç»“æ„ä¸­çš„pgdæŒ‡å‘äº†è¯¥è¿›ç¨‹çš„é¡µè¡¨é¡µç›®å½•ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ä¸€ä»½ç‹¬ç«‹çš„é¡µè¡¨ï¼Œå½“CPUç¬¬ä¸€æ¬¡è®¿é—®è™šæ‹Ÿåœ°å€ç©ºé—´æ—¶ï¼Œå¦‚æœæŸ¥è¯¢é¡µè¡¨æ‰¾ä¸åˆ°å¯¹åº”çš„ç‰©ç†é¡µï¼Œå°†ä¼šå‘ç”Ÿç¼ºé¡µå¼‚å¸¸ï¼Œåœ¨ç¼ºé¡µå¼‚å¸¸ä¸­ï¼Œè¿›è¡Œåˆ†é…ç‰©ç†é¡µé¢ï¼Œå½“ç„¶å¦‚æœé¡µè¡¨æ²¡æœ‰åˆ›å»ºï¼Œéœ€è¦å…ˆç”³è¯·ç‰©ç†é¡µé¢åˆ›å»ºé¡µè¡¨ï¼Œæœ€åå°†ç‰©ç†é¡µé¢å¡«å……åˆ°é¡µè¡¨ä¸­ï¼Œå®Œæˆè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»ã€‚ â€ƒâ€ƒä¸Šå›¾ä¸­æ•°æ®ç»“æ„çš„å±‚çº§å…³ç³»struct task_struct-&gt;struct mm_struct-&gt;struct vm_area_structã€‚ â€ƒâ€ƒå¯ä»¥é€šè¿‡èŠ‚ç‚¹/proc/[pid]/mapsæ¥æŸ¥çœ‹å†…å­˜mappingsï¼Œä¸‹é¢ä¾‹å­ä¸­æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºä¸€ä¸ªVMAã€‚å¯ä»¥man procæ¥æŸ¥çœ‹å„é¡¹å‚æ•°æ„ä¹‰ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">address</span><span class="w">           </span><span class="n">perms</span><span class="w"> </span><span class="n">offset</span><span class="w">  </span><span class="n">dev</span><span class="w">   </span><span class="n">inode</span><span class="w">       </span><span class="n">pathname</span>
<span class="mo">00400000-00452000</span><span class="w"> </span><span class="n">r</span><span class="o">-</span><span class="n">xp</span><span class="w"> </span><span class="mo">00000000</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mo">02</span><span class="w"> </span><span class="mi">173521</span><span class="w">      </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">dbus</span><span class="o">-</span><span class="n">daemon</span>
<span class="mo">00651000-00652000</span><span class="w"> </span><span class="n">r</span><span class="o">--</span><span class="n">p</span><span class="w"> </span><span class="mo">00051000</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mo">02</span><span class="w"> </span><span class="mi">173521</span><span class="w">      </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">dbus</span><span class="o">-</span><span class="n">daemon</span>
<span class="mo">00652000-00655000</span><span class="w"> </span><span class="n">rw</span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mo">00052000</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mo">02</span><span class="w"> </span><span class="mi">173521</span><span class="w">      </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">dbus</span><span class="o">-</span><span class="n">daemon</span>
<span class="mf">00e03000-00e24000</span><span class="w"> </span><span class="n">rw</span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mo">00000000</span><span class="w"> </span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="w"> </span><span class="mi">0</span><span class="w">           </span><span class="p">[</span><span class="n">heap</span><span class="p">]</span>
<span class="p">...</span>
<span class="mi">35</span><span class="n">b1800000</span><span class="mi">-35</span><span class="n">b1820000</span><span class="w"> </span><span class="n">r</span><span class="o">-</span><span class="n">xp</span><span class="w"> </span><span class="mo">00000000</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mo">02</span><span class="w"> </span><span class="mi">135522</span><span class="w">  </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">ld</span><span class="mf">-2.15</span><span class="p">.</span><span class="n">so</span>
<span class="mi">35</span><span class="n">b1a1f000</span><span class="mi">-35</span><span class="n">b1a20000</span><span class="w"> </span><span class="n">r</span><span class="o">--</span><span class="n">p</span><span class="w"> </span><span class="mf">0001f</span><span class="mo">000</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mo">02</span><span class="w"> </span><span class="mi">135522</span><span class="w">  </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">ld</span><span class="mf">-2.15</span><span class="p">.</span><span class="n">so</span>
<span class="mi">35</span><span class="n">b1a20000</span><span class="mi">-35</span><span class="n">b1a21000</span><span class="w"> </span><span class="n">rw</span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mo">00020000</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mo">02</span><span class="w"> </span><span class="mi">135522</span><span class="w">  </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">ld</span><span class="mf">-2.15</span><span class="p">.</span><span class="n">so</span>
<span class="mi">35</span><span class="n">b1a21000</span><span class="mi">-35</span><span class="n">b1a22000</span><span class="w"> </span><span class="n">rw</span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mo">00000000</span><span class="w"> </span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="w"> </span><span class="mi">0</span>
<span class="mi">35</span><span class="n">b1c00000</span><span class="mi">-35</span><span class="n">b1dac000</span><span class="w"> </span><span class="n">r</span><span class="o">-</span><span class="n">xp</span><span class="w"> </span><span class="mo">00000000</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mo">02</span><span class="w"> </span><span class="mi">135870</span><span class="w">  </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="mf">-2.15</span><span class="p">.</span><span class="n">so</span>
<span class="mi">35</span><span class="n">b1dac000</span><span class="mi">-35</span><span class="n">b1fac000</span><span class="w"> </span><span class="o">---</span><span class="n">p</span><span class="w"> </span><span class="mo">001</span><span class="n">ac000</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mo">02</span><span class="w"> </span><span class="mi">135870</span><span class="w">  </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="mf">-2.15</span><span class="p">.</span><span class="n">so</span>
<span class="mi">35</span><span class="n">b1fac000</span><span class="mi">-35</span><span class="n">b1fb0000</span><span class="w"> </span><span class="n">r</span><span class="o">--</span><span class="n">p</span><span class="w"> </span><span class="mo">001</span><span class="n">ac000</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mo">02</span><span class="w"> </span><span class="mi">135870</span><span class="w">  </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="mf">-2.15</span><span class="p">.</span><span class="n">so</span>
<span class="mi">35</span><span class="n">b1fb0000</span><span class="mi">-35</span><span class="n">b1fb2000</span><span class="w"> </span><span class="n">rw</span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mo">001</span><span class="n">b0000</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mo">02</span><span class="w"> </span><span class="mi">135870</span><span class="w">  </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="mf">-2.15</span><span class="p">.</span><span class="n">so</span>
<span class="p">..</span>
<span class="mf">7f</span><span class="n">ffb2c0d000</span><span class="mi">-7</span><span class="n">fffb2c2e000</span><span class="w"> </span><span class="n">rw</span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mo">00000000</span><span class="w"> </span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="w"> </span><span class="mi">0</span><span class="w">   </span><span class="p">[</span><span class="n">stack</span><span class="p">]</span>
</code></pre></div>
<ul>
<li>address: VMAå¯¹åº”çš„èµ·å§‹åœ°å€ï¼Œå¯¹åº”struct vm_area_structä¸­çš„vm_start,vm_endã€‚</li>
<li>permsï¼šVMAçš„æƒé™ï¼Œr=read,w=write,x=execute,s=shared,p=privateã€‚så’ŒpäºŒé€‰ä¸€ï¼Œä¸»è¦æ˜¯åˆ¤æ–­å½“å‰çš„åœ°å€ç©ºé—´æ˜¯è¿›ç¨‹ç§æœ‰ï¼Œè¿˜æ˜¯å…±äº«ã€‚</li>
<li>offset: æ–‡ä»¶æ˜ å°„ï¼Œè¡¨ç¤ºæ­¤æ®µè™šæ‹Ÿå†…å­˜èµ·å§‹åœ°å€åœ¨æ–‡ä»¶ä¸­ä»¥é¡µä¸ºå•ä½çš„åç§»ï¼ŒåŒ¿åæ˜ å°„ä¸º0ã€‚</li>
<li>devï¼šæ‰€æ˜ å°„æ–‡ä»¶æ‰€å±çš„è®¾å¤‡å·ï¼ŒåŒ¿åæ˜ å°„ä¸º0ã€‚</li>
<li>inode:æ˜ å°„æ–‡æ‰€å±èŠ‚ç‚¹èŠ‚ç‚¹å·ï¼ŒåŒ¿åæ˜ å°„ä¸º0ã€‚</li>
<li>pathnameï¼šæ–‡ä»¶æ˜ å°„ï¼Œå¯¹åº”çš„å°±æ˜¯æ˜ å°„çš„æ–‡ä»¶åã€‚åŒ¿åæ˜ å°„ï¼Œæ˜¯æ­¤æ®µè™šæ‹Ÿå†…å­˜åœ¨è¿›ç¨‹çš„è§’è‰²ï¼Œå¦‚heapï¼Œstackç­‰ã€‚ â€ƒâ€ƒæ˜¯å¦å¯ä»¥æŸ¥çœ‹è¿›ç¨‹è™šæ‹Ÿå†…å­˜éƒ½è¢«è°å ç”¨äº†ï¼Œå¯¹åº”çš„VMAçš„å¤§å°æ˜¯å¦æœ‰å¢å¤§è¶‹åŠ¿ï¼Œå¯ä»¥ç”¨äºåˆ¤æ–­å†…å­˜æ³„éœ²ï¼Ÿ</li>
</ul>
<h2 id="_4">æ“ä½œç³»ç»Ÿè§’åº¦çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½è¿è¡Œ</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_5491bb24c4969fa6e432263f97684337.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_5491bb24c4969fa6e432263f97684337.jpg"/></a> â€ƒâ€ƒä»æ“ä½œç³»ç»Ÿè§’åº¦çœ‹ï¼Œä¸€ä¸ªè¿›ç¨‹æœ€å…³é”®çš„ç‰¹å¾æ˜¯å®ƒæ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¿™ä½¿å¾—å®ƒè·Ÿåˆ«çš„è¿›ç¨‹æœ‰å·®åˆ«ã€‚ä¸‹é¢æ¥çœ‹ä¸€ä¸ªç¨‹åºè¢«æ‰§è¡Œæ¯”è¾ƒé€šç”¨çš„æƒ…å½¢ï¼Œæµç¨‹å¦‚ä¸‹ï¼š - åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ - å»ºç«‹æ‰§è¡Œç¨‹åºè™šæ‹Ÿç©ºé—´ä¸å¯æ‰§è¡Œæ–‡ä»¶çš„æ˜ å°„å…³ç³»ã€‚ - å°†CPUçš„æŒ‡ä»¤å¯„å­˜å™¨è®¾ç½®æˆå¯æ‰§è¡Œæ–‡ä»¶çš„å…¥å£å‡½æ•°ï¼Œå¯åŠ¨è¿è¡Œã€‚ - è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ç¼ºé¡µå¼‚å¸¸å°†æŒ‡ä»¤ã€æ•°æ®è£…è½½è¿›å†…å­˜ã€‚ ï¼ˆ1ï¼‰åˆ›å»ºç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ â€ƒâ€ƒç³»ç»Ÿè®¿é—®ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿåœ°å€ï¼Œè™šæ‹Ÿåœ°å€é€šè¿‡æŸ¥è¯¢é¡µè¡¨æ‰¾åˆ°å¯¹åº”çš„ç‰©ç†å†…å­˜ï¼Œå› æ­¤æœ€å¼€å§‹æ˜¯åˆ›å»ºå¥½è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè€Œåˆ›å»ºè™šæ‹Ÿåœ°å€ç©ºé—´å®é™…ä¸Šå¹¶ä¸æ˜¯åˆ›å»ºç©ºé—´ç›´æ¥å»ºç«‹å¥½è·Ÿç‰©ç†å†…å­˜çš„è¿ç»­ï¼Œè€Œæ˜¯å…ˆåˆ›å»ºæ˜ å°„å‡½æ•°æ‰€éœ€è¦çš„ç›¸åº”æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚task_struct,mm_structç­‰ã€‚å¯¹åº”é¡µè¡¨çš„åˆ›å»ºï¼Œå®é™…ä¸Šåªåˆ†é…äº†ä¸€ä¸ªé¡µç›®å½•å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦è®¾ç½®é¡µçš„æ˜ å°„å…³ç³»ï¼Œç­‰å®é™…ç¨‹åºè®¿é—®çš„æ—¶å€™é€šè¿‡ç¼ºé¡µå¼‚å¸¸æ‰è¿›è¡Œè®¾ç½®ã€‚ ï¼ˆ2ï¼‰å»ºç«‹æ‰§è¡Œç¨‹åºè™šæ‹Ÿç©ºé—´ä¸å¯æ‰§è¡Œæ–‡ä»¶çš„æ˜ å°„å…³ç³» â€ƒâ€ƒä¸Šä¸€ä¸ªæ­¥éª¤å»ºç«‹äº†è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¿™ä¸€æ­¥æ‰€åšçš„å»ºç«‹è™šæ‹Ÿç©ºé—´ä¸å¯æ‰§è¡Œæ–‡ä»¶çš„æ˜ å°„å…³ç³»ï¼Œå› ä¸ºç¨‹åºæ‰§è¡Œæ—¶å‘ç”Ÿç¼ºé¡µå¼‚å¸¸ï¼Œç³»ç»Ÿä¼šä»ç‰©ç†å†…å­˜åˆ†é…ä¸€å—å†…å­˜ï¼Œç„¶åå°†ç¼ºé¡µä»ç£ç›˜è¯»å–åˆ°å†…å­˜ä¸­ï¼Œå†è®¾ç½®ç¼ºé¡µçš„è™šæ‹Ÿé¡µå’Œç‰©ç†é¡µçš„æ˜ å°„å…³ç³»ï¼Œè¿™æ ·ç¨‹åºå°±å¯ä»¥è¿è¡Œäº†ã€‚å› æ­¤ï¼Œå½“ç¨‹åºå‘ç”Ÿç¼ºé¡µå¼‚å¸¸æ—¶ï¼Œéœ€è¦çŸ¥é“ç¨‹åºå½“å‰çš„é¡µåœ¨ç£ç›˜çš„é‚£ä¸€ä¸ªä½ç½®ã€‚ Linuxç³»ç»Ÿå°†è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†é…æˆå¤šä¸ªæ®µï¼Œè¿™ä¸ªæ®µå«åšè™šæ‹Ÿå†…å­˜åŒºåŸŸï¼ˆVMAï¼ŒVirtual Memory Areaï¼‰ã€‚å¦‚ç³»ç»Ÿåˆ›å»ºè¿›ç¨‹åï¼Œä¼šè®¾ç½®ä¸€ä¸ª.textæ®µï¼ˆåŸåˆ™ä¸Šåº”è¯¥æ—¶å¤šä¸ªsectionsçš„åˆå¹¶ï¼‰çš„VMAã€‚ ï¼ˆ3ï¼‰å°†CPUçš„æŒ‡ä»¤å¯„å­˜å™¨è®¾ç½®å¯æ‰§è¡Œç¨‹åºæ–‡ä»¶çš„å…¥å£å‡½æ•° è¿™ä¸€æ­¥å°±æ˜¯å°†ELFæ–‡ä»¶å¤´ä¸­ä¿å­˜çš„å…¥å£åœ°å€èµ‹å€¼ä¸ºPCï¼Œç„¶åå¯åŠ¨è¿è¡Œã€‚ ï¼ˆ4ï¼‰ç¼ºé¡µå¼‚å¸¸ â€ƒâ€ƒåœ¨ä¸Šè¿°æ­¥éª¤æ‰§è¡Œåï¼Œå®é™…å¯æ‰§è¡Œæ–‡ä»¶çš„æŒ‡ä»¤å’Œæ•°æ®éƒ½è¿˜æ²¡æœ‰è£…å…¥åˆ°å†…å­˜ä¸­ï¼Œæ“ä½œç³»ç»Ÿåªæ˜¯é€šè¿‡è¯¥å¯æ‰§è¡Œæ–‡ä»¶å¤´éƒ¨ä¿¡æ¯å»ºç«‹èµ·å¯æ‰§è¡Œæ–‡ä»¶å’Œè¿›ç¨‹è™šæ‹Ÿå†…å­˜ç©ºé—´ç›´æ¥çš„æ˜ å°„å…³ç³»ï¼Œå½“ç¨‹åºå¯åŠ¨è¿è¡Œæ—¶ï¼Œæ‰§è¡Œç›¸å…³çš„è™šæ‹Ÿåœ°å€ï¼Œå½“å‘ç°è¿™è™šæ‹Ÿåœ°å€å¯¹åº”çš„ç‰©ç†é¡µé¢ä¸ºç©ºï¼Œå°†ä¼šå‘ç”Ÿç¼ºé¡µå¼‚å¸¸ï¼Œç¼ºé¡µå¼‚å¸¸ä¼šåˆ†é…ä¸€å—å†…å­˜ï¼Œç„¶åå°†å¯æ‰§è¡Œæ–‡ä»¶çš„æŒ‡ä»¤å’Œæ•°æ®ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåç»­å°±å¯ä»¥ç›´æ¥è®¿é—®å†…å­˜è¿›è¡Œè¯»å†™è®¿é—®æ‰§è¡Œäº†ã€‚</p>
<h2 id="vma">VMAçš„æ“ä½œå‡½æ•°</h2>
<h3 id="vma_1">VMAæŸ¥æ‰¾</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_cae6bbb4ff624621c3e6bdbb77955519.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_cae6bbb4ff624621c3e6bdbb77955519.jpg"/></a></p>
<h3 id="vma_2">VMAæ’å…¥</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_ba7570a966d1b3c3b242f39fc77d8418.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_ba7570a966d1b3c3b242f39fc77d8418.jpg"/></a></p>
<h3 id="vma_3">VMAåˆå¹¶ä¸æ‹†åˆ†</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_1dfe4e90e363a34ba15fee26101bf260.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_1dfe4e90e363a34ba15fee26101bf260.jpg"/></a> <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_337f56c246f926c63fa4d98c2d2426a4.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_337f56c246f926c63fa4d98c2d2426a4.jpg"/></a></p>
<h2 id="malloc">mallocå‡½æ•°</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_04081ca9a41741a9307555d8f308df40.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_04081ca9a41741a9307555d8f308df40.jpg"/></a> â€ƒâ€ƒç”¨æˆ·ç©ºé—´åˆ†é…å†…å­˜ï¼Œä¸ä¼šæ¯æ¬¡ç”³è¯·éƒ½å‘linuxå†…æ ¸åšä¸€ä¸ªç³»ç»Ÿè°ƒç”¨è¿›è¡Œåˆ†é…è·å–å†…å­˜ï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·ç©ºé—´ç»´æŒç€ä¸€ä¸ªç¼“å†²æ± ï¼Œè¿™ä¸ªç¼“å†²æ± æœ‰è‡ªå·±çš„å†…å­˜ç®¡ç†ç®—æ³•ã€‚å½“ç”¨æˆ·è¿›è¡Œmallocæ—¶å€™ï¼Œå¦‚æœç¼“å­˜æ± ä¸­æœ‰å†…å­˜ï¼Œå°±ç›´æ¥è·å–è¿”å›ï¼Œå¦‚æœç¼“å­˜æ± ä¸­æ²¡æœ‰å†…å­˜ï¼Œå°±ä¼šä¸‹é™·åšç³»ç»Ÿè°ƒç”¨åˆ°linuxå†…æ ¸ä¸­è·å–å†…å­˜ã€‚ â€ƒâ€ƒç”¨æˆ·ç©ºé—´é€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘å†…æ ¸è·å–å†…å­˜æ—¶åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šå½“åˆ†é…çš„å†…å­˜å°äºM_MMAP_THRESHOLDé˜ˆå€¼æ—¶ä¼šä½¿ç”¨brkç³»ç»Ÿè°ƒç”¨æ¥æ‰©å±•å †ç©ºé—´ï¼Œå½“åˆ†é…å†…å­˜å¤§äºM_MMAP_THRESHOLDé˜ˆå€¼æ—¶ï¼Œä¼šä½¿ç”¨mmapè¿›è¡Œæ˜ å°„åˆ†é…ã€‚M_MMAP_THRESHOLDé€šå¸¸ä¸º128Kï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è°ƒç”¨malloptå‡½æ•°æ¥ä¿®æ”¹è¯¥é˜ˆå€¼ã€‚ â€ƒâ€ƒmallocé€šè¿‡brkæ–¹å¼ç”³è¯·çš„å†…å­˜ï¼Œfreeé‡Šæ”¾å†…å­˜æ—¶ï¼Œå¹¶ä¸ä¼šå½’è¿˜ç»™ç³»ç»Ÿï¼Œè€Œæ˜¯ç¼“å­˜åˆ°mallocå†…å­˜æ± ä¸­ï¼Œå¾…ä¸‹æ¬¡ä½¿ç”¨ã€‚ â€ƒâ€ƒmallocé€šè¿‡mmapç”³è¯·åˆ°çš„å†…å­˜ï¼Œfreeé‡Šæ”¾å†…å­˜æ—¶ï¼Œä¼šæŠŠå†…å­˜å½’è¿˜ç»™ç³»ç»Ÿï¼Œå†…å­˜å¾—åˆ°çœŸæ­£é‡Šæ”¾ã€‚</p>
<h3 id="malloc_1">ä¸mallocç›¸å…³çš„å‡½æ•°</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_9d33544fd7defac58768bf0fb0b0870e.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_9d33544fd7defac58768bf0fb0b0870e.jpg"/></a></p>
<h3 id="malloc_2">mallocç³»ç»Ÿè°ƒç”¨æµç¨‹</h3>
<p>å¾…è¡¥å……</p>
<h2 id="mmap">mmapå‡½æ•°</h2>
<h3 id="_5">åŸºæœ¬æ¦‚å¿µ</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_c946072d39436dd061b81a53b731b460.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_c946072d39436dd061b81a53b731b460.jpg"/></a> â€ƒâ€ƒmmapç”¨äºå†…å­˜æ˜ å°„ï¼Œå°†ä¸€æ®µåŒºåŸŸæ˜ å°„åˆ°è‡ªå·±çš„è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ã€‚è¿™æ®µåŒºåŸŸå¯ä»¥æ˜¯æ–‡ä»¶é¡µå±æ€§ä¹Ÿå¯ä»¥æ˜¯ç‰©ç†é¡µå±æ€§ï¼Œæ‰€ä»¥åˆ†ä¸ºä¸¤ç§ï¼š - æ–‡ä»¶æ˜ å°„ï¼šå°†æ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹ç©ºé—´ï¼Œæ–‡ä»¶å­˜æ”¾åœ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼ˆæ–‡ä»¶å†…å®¹ä¼šä»¥page cacheç¼“å­˜åˆ°ç‰©ç†å†…å­˜ä¸­ï¼‰ã€‚ - åŒ¿åæ˜ å°„ï¼šæ²¡æœ‰æ–‡ä»¶å¯¹åº”çš„åŒºåŸŸï¼Œå†…å®¹åœ¨ç‰©ç†å†…å­˜ä¸Šã€‚ â€ƒâ€ƒmmapç”¨äºæ–‡ä»¶æ˜ å°„èƒ½æé«˜è¯»å†™æ•ˆç‡ï¼Œä¸»è¦çš„å·®å¼‚ç‚¹æ˜¯å¸¸è§„çš„æ–‡ä»¶æ“ä½œéœ€è¦ä»ç£ç›˜åˆ°é¡µç¼“å­˜æ‹·è´ï¼Œç„¶åå†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´è¿˜æœ‰æ‹·è´ï¼Œæœ‰ä¸¤æ¬¡æ•°æ®æ‹·è´åŠ¨ä½œï¼›è€Œmmapæ“æ§æ–‡ä»¶ï¼Œåªéœ€è¦ä»ç£ç›˜åˆ°ç”¨æˆ·ä¸»å­˜ä¸€æ¬¡æ‹·è´ï¼Œåç»­çš„è¯»å†™ç›´æ¥å¯¹ä¸»å­˜è¯»å†™ï¼Œç›¸å½“äºå°‘äº†ä¾æ¬¡å†…æ ¸åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ã€‚ mmapé’ˆå¯¹è¿›ç¨‹æ˜¯å¦å¯è§ï¼Œæœ‰åˆ†ä¸ºä¸¤ç§ï¼š <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_ab5e85f7a85316f3f5b2ba2614daef10.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_ab5e85f7a85316f3f5b2ba2614daef10.jpg"/></a> - ç§æœ‰æ˜ å°„ï¼šæ•°æ®æºæ‹·è´ä¸€æ¬¡å‰¯æœ¬ï¼Œè¿›ç¨‹ä¹‹é—´äº’ä¸å½±å“ã€‚ - å…±äº«æ˜ å°„ï¼šå…±äº«çš„è¿›ç¨‹éƒ½èƒ½çœ‹åˆ°ã€‚ æ ¹æ®æ’åˆ—ç»„åˆå°±æœ‰4ä¸­æ˜ å°„æƒ…å†µï¼š - ç§æœ‰åŒ¿åæ˜ å°„ï¼šå¯ä»¥ç”¨äºåˆ†é…å¤§çš„å†…å­˜ï¼Œå¦‚mallocå †ç©ºé—´ã€‚ - å…±äº«åŒ¿åéšå°„ï¼šå¯ç”¨äºçˆ¶å­è¿›ç¨‹é—´é€šä¿¡ï¼Œåœ¨å†…å­˜æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º/dev/zeroè®¾å¤‡ã€‚ - ç§æœ‰æ–‡ä»¶æ˜ å°„ï¼šå¸¸ç”¨äºåŠ¨æ€åº“çš„åŠ è½½ï¼Œå¦‚ä»£ç æ®µï¼Œæ•°æ®æ®µç­‰ã€‚ - å…±äº«æ–‡ä»¶æ˜ å°„ï¼šéçˆ¶å­ä¹‹é—´çš„è¿›ç¨‹é—´é€šä¿¡ï¼Œæ–‡ä»¶è¯»å†™ç­‰ã€‚ <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_a712591b39c53c00e36b92c9b8c57f1d.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_a712591b39c53c00e36b92c9b8c57f1d.jpg"/></a></p>
<h3 id="_6">å®ç°åŸç†</h3>
<p>do_mmapå‡½æ•°è°ƒç”¨æµç¨‹å¾…è¡¥å…….....</p>
<p>ä¸¾ä¾‹mmapæ–‡ä»¶å†…å­˜æ˜ å°„çš„å®ç°è¿‡ç¨‹ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š - 1.åˆ›å»ºmmapè™šæ‹Ÿåœ°å€ç©ºé—´VMA â€ƒâ€ƒå¦‚æœmmapæ²¡æœ‰æŒ‡å®šè™šæ‹Ÿåœ°å€ç©ºé—´åŒºåŸŸï¼Œåˆ™æœç´¢ä¸€æ®µç©ºé—²çš„è¿ç»­è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå¹¶åˆ†é…ä¸€ä¸ªvm_area_structå®ä¾‹æ·»åŠ åˆ°çº¢é»‘æ ‘å’Œé“¾è¡¨ä¸­ã€‚ - 2.å»ºç«‹VMAä¸æ–‡ä»¶ç‰©ç†åœ°å€ï¼ˆåœ¨ç£ç›˜é‚£ä¸ªä½ç½®ï¼‰çš„æ˜ å°„å…³ç³» â€ƒâ€ƒé€šè¿‡è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿinodeæ¨¡å—å®šä½åˆ°æ–‡ä»¶åœ¨ç£ç›˜çš„ä½ç½®ï¼Œå»ºç«‹VMAä¸æ–‡ä»¶çš„è”ç³»ã€‚ call_mmap-&gt;file-&gt;f_op-&gt;mmapï¼Ÿ - 3.è®¿é—®æ–‡ä»¶å¯¹åº”çš„è™šæ‹Ÿåœ°å€ï¼Œå¼•å‘ç¼ºé¡µå¼‚å¸¸ï¼Œå°†æ–‡ä»¶å†…å®¹åŠ è½½åˆ°å†…å­˜ â€ƒâ€ƒå‰é¢é˜¶æ®µï¼Œå¹¶æ²¡æœ‰å°†æ–‡ä»¶çš„æ•°æ®æ‹·è´åˆ°å†…å­˜ä¸­ï¼ŒçœŸæ­£çš„æ–‡ä»¶è¯»å–æ˜¯è¿›ç¨‹å‘èµ·è¯»å†™æ“ä½œæ—¶ã€‚è¿›ç¨‹åœ¨è¯»è´§å†™æ“ä½œè®¿é—®æ˜ å°„çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œé€šè¿‡æŸ¥è¯¢é¡µè¡¨ï¼Œå‘ç°è¿™ä¸€æ®µåœ°å€å¹¶ä¸å†ç‰©ç†é¡µé¢ä¸Šï¼Œå¼•å‘ç¼ºé¡µå¼‚å¸¸ï¼Œäºæ˜¯å…ˆä»ç£ç›˜åŠ è½½æ•°æ®åˆ°å†…å­˜ä¸­ã€‚åç»­å †æ–‡ä»¶çš„è¯»å†™ï¼Œç›´æ¥å°±å¯¹å¯¹åº”çš„ç‰©ç†å†…å­˜è¯»å†™ï¼Œå½“æ”¹å˜äº†å†…å®¹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†è„é¡µé¢å†™å›åˆ°ç£ç›˜ä¸Šï¼Œå½“å‰ä¹Ÿå¯ä»¥å¼ºè¡ŒåŒæ­¥ï¼ˆmsyncï¼‰</p>
<h2 id="_7">ç¼ºé¡µå¼‚å¸¸</h2>
<p>Linuxç³»ç»Ÿæœ‰ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§å°±æ˜¯ç”¨æˆ·â€œæ¬ºéª—æ€§â€ï¼Œå¦‚é€šè¿‡mallocç”³è¯·äº†å†…å­˜ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶æ²¡æœ‰åˆ†é…å†…å­˜ç»™ä½ ï¼Œç­‰å®é™…è®¿é—®å†…å­˜çš„æ—¶å€™æ‰ä¼šåˆ†é…ç»™ä½ ã€‚ç”¨æˆ·å¾ˆå¤šé‡è¦çš„åˆå§‹åŒ–æ“ä½œåªæ˜¯é’ˆå¯¹è™šæ‹Ÿå†…å­˜çš„ï¼Œè™šæ‹Ÿå†…å­˜å®é™…å¯¹åº”çš„ç‰©ç†å†…å­˜ç©ºé—´å¹¶æ²¡æœ‰åˆ†é…ï¼Œç­‰å®é™…éœ€è¦è®¿é—®çš„æ—¶å€™æ‰ä¼šè¿›è¡Œåˆ†é…ï¼Œå› æ­¤å½“è¿›ç¨‹è®¿é—®è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå‘ç°è™šæ‹Ÿåœ°å€ç©ºé—´æ²¡æœ‰ä¸ç‰©ç†å†…å­˜å»ºç«‹æ˜ å°„å…³ç³»ï¼Œå¤„ç†å™¨å°±ä¼šè‡ªåŠ¨è§¦å‘ç¼ºé¡µå¼‚å¸¸ï¼ˆç¼ºé¡µä¸­æ–­ï¼‰ã€‚ä¸‹é¢æ˜¯è§¦å‘ç¼ºé¡µå¼‚å¸¸çš„ä¸€äº›åœºæ™¯æƒ…å½¢ï¼š <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_aa1d714693eea980f6d11968869cfc16.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_aa1d714693eea980f6d11968869cfc16.jpg"/></a> â€ƒâ€ƒç¼ºé¡µå¼‚å¸¸ä¼šæ‰§è¡Œåˆ°å¯¹åº”çš„ä¸­æ–­å‡½æ•°ï¼Œä¼šè·Ÿå®é™…çš„å¤„ç†å™¨æ¶æ„æœ‰äº›å…³ç³»ï¼Œåœ¨å®é™…ä¸­ç¼ºé¡µå¼‚å¸¸æœ€ç»ˆä¼šè°ƒç”¨åˆ°do_page_faultï¼ˆarch/arm64/mm/fault.cï¼‰å‡½æ•°ï¼Œæ¥ä¸‹æ¥å°†ä¼šä»è¿™ä¸ªå‡½æ•°è¿›è¡Œé‡ç‚¹åˆ†æã€‚</p>
<h3 id="do_page_fault">do_page_fault</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_223927592e2f268ae6884bf365121175.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_223927592e2f268ae6884bf365121175.jpg"/></a></p>
<h3 id="_8">åŒ¿åé¡µé¢</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_0656050714f015845bcc645afbb7fb80.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_0656050714f015845bcc645afbb7fb80.jpg"/></a> â€ƒâ€ƒå‘ç”ŸåŒ¿åé¡µç¼ºé¡µå¼‚å¸¸ï¼Œä¸€èˆ¬æ˜¯â‘ malloc/mmapåˆ†é…è¿›ç¨‹åœ°å€ç©ºé—´åŒºåŸŸï¼Œæ²¡æœ‰å¯¹åº”çš„ç‰©ç†å†…å­˜å°†ä¼šè§¦å‘åˆ†é…ã€‚â‘¡ ç”¨æˆ·æ ˆä¸å¤Ÿæ—¶ï¼Œè¿›è¡Œæ ˆåŒºçš„æ‰©å¤§å¤„ç†ã€‚ â€ƒâ€ƒåŒ¿åé¡µé¢åˆ†é…æ—¶ï¼Œä¼šåˆ¤æ–­é¡µé¢æ˜¯å¦å¯å†™ï¼Œå¦‚æœæ˜¯åªè¯»æƒé™ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šåˆ†é…ä¸€ä¸ªzero pageã€‚Zero pageæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç‰©ç†é¡µï¼ˆå®é™…æ²¡æœ‰ä½¿ç”¨ç‰©ç†å†…å­˜ç©ºé—´ï¼‰ï¼Œé‡Œé¢å€¼å…¨éƒ¨ä¸º0ï¼Œzero pageé’ˆå¯¹åŒ¿åé¡µåœºæ™¯ä¸“é—¨è¿›è¡Œçš„ä¼˜åŒ–ï¼Œä¸»è¦æ˜¯èŠ‚çœå†…å­˜å’Œå¯¹æ€§èƒ½çš„ä¸€å®šä¼˜åŒ–ã€‚å½“mallocæˆ–è€…mmapåˆ†é…å†…å­˜ä»…ä»…æ˜¯è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„è™šæ‹Ÿå†…å­˜ï¼Œå¦‚æœç”¨ç¨‹åºéœ€è¦è¯»è¿™ä¸ªmallocåˆ†é…çš„è™šæ‹Ÿå†…å­˜ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè¿”å›å…¨0çš„æ•°æ®ï¼Œå› æ­¤linuxå†…æ ¸ä¸å¿…ä¸ºè¿™ç§æƒ…å†µå•ç‹¬åˆ†é…ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯ä½¿ç”¨ç³»ç»Ÿé›¶é¡µï¼Œå½“ç¨‹åºéœ€è¦å†™å…¥è¿™ä¸ªé¡µé¢æ—¶å°±ä¼šè§¦å‘ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼Œäºæ˜¯ç¼ºé¡µå¼‚å¸¸å˜æˆå†™æ—¶å¤åˆ¶çš„ç¼ºé¡µå¼‚å¸¸ã€‚mallocåˆ†é…è™šæ‹Ÿå†…å­˜ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µã€‚ - mallocåˆ†é…åï¼Œç›´æ¥è¯»å†…å­˜ï¼Œè¿™æ—¶ç¼ºé¡µå¼‚å¸¸ï¼Œåˆ†é…åˆ°çš„æ˜¯zero pageï¼ŒPTEçš„å±æ€§æ˜¯read onlyã€‚ - mallocåˆ†é…åï¼Œå…ˆè¯»åå†™ï¼Œå…ˆè¯»çš„æ—¶å€™ç¼ºé¡µå¼‚å¸¸åˆ†é…çš„æ˜¯ç³»ç»Ÿé›¶é¡µï¼Œå†å†™å†è§¦å‘ç¼ºé¡µå¼‚å¸¸è§¦å‘å†™æ—¶å¤åˆ¶ã€‚ - mallocåˆ†é…åï¼Œç›´æ¥å†™å†…å­˜ï¼Œè§¦å‘ç¼ºé¡µå¼‚å¸¸ï¼Œä½¿ç”¨alloc_zerod_user_highpage_movableåˆ†é…æ–°é¡µé¢ã€‚</p>
<h3 id="_9">æ–‡ä»¶é¡µé¢</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_d411bc5c6f9229a3116dd61850b582d4.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_d411bc5c6f9229a3116dd61850b582d4.jpg"/></a> â€ƒâ€ƒæ–‡ä»¶é¡µé¢å¼‚å¸¸åˆ†ä¸ºè¯»æ–‡ä»¶å¼‚å¸¸ï¼Œå†™ç§æœ‰æ–‡ä»¶å¼‚å¸¸ï¼Œå†™å…±äº«æ–‡ä»¶å¼‚å¸¸ã€‚æ€»ä½“çš„æ€è·¯æ˜¯æ²¡æœ‰åˆ†é…ç‰©ç†é¡µé¢ï¼Œå°±è¿›è¡Œåˆ†é…ç‰©ç†é¡µé¢ï¼Œç„¶åå°†å†…å®¹ä»æ–‡ä»¶ä¸­æ‹·è´åˆ°ç‰©ç†é¡µé¢ä¸­ï¼Œå†å»ºç«‹å¥½é¡µè¡¨ã€‚ - è¯»æ–‡ä»¶å¼‚å¸¸ï¼šä¼šå°è¯•å¤šæ˜ å°„æ•°æ®å‘¨å›´çš„å†…å®¹ï¼Œå› ä¸ºå‘¨å›´æ•°æ®å†æ¬¡è¢«å‘½ä¸­çš„æ¦‚ç‡æ¯”è¾ƒé«˜ï¼Œè¿™æ ·å‡å°‘ç¼ºé¡µå¼‚å¸¸æ¬¡æ•°ã€‚ - å†™ç§æœ‰æ–‡ä»¶ï¼šå†™ç§æœ‰æ–‡ä»¶ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ï¼Œä¼šå…ˆåˆ†é…ä¸€å—ç‰©ç†é¡µé¢cow_pageï¼Œå…ˆå°†æ–‡ä»¶å†…å®¹è¯»å–æ–‡ä»¶ç¼“å­˜é¡µï¼ˆpage cacheï¼‰ï¼Œç„¶åå†å°†å…¶å†…å®¹å¤åˆ¶åˆ°cow_pageä¸­ã€‚ - å†™å…±äº«æ–‡ä»¶ï¼šå†™å…±äº«æ–‡ä»¶ä¸ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ï¼Œå¦‚æœmkwriteå‡½æ•°ä¸ä¸ºç©ºï¼Œå°†ä¼šé€šçŸ¥è¿›ç¨‹é¡µé¢å˜æˆå¯å†™ã€‚åŒæ—¶ä¼šå°†é¡µè®¾ç½®ä¸ºè„é¡µã€‚</p>
<h3 id="swap">swapé¡µé¢æ¢å…¥</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_0d0a88f43c5e72ed8292ba98fe15017a.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_0d0a88f43c5e72ed8292ba98fe15017a.jpg"/></a> â€ƒâ€ƒå½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šæŠŠé¡µé¢äº¤æ¢åˆ°ç£ç›˜swapåˆ†åŒºä¸­ï¼Œå½“å†æ¬¡è®¿é—®è¿™å—å†…å­˜æ—¶ä¼šå‘ç”Ÿç¼ºé¡µå¼‚å¸¸ï¼Œå¤§è‡´çš„æµç¨‹å°±æ˜¯æœç´¢swap cacheçœ‹é¡µé¢æ˜¯å¦åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœä¸åœ¨è¯´æ˜è¢«äº¤æ¢å‡ºå»äº†ï¼Œé‚£å°±éœ€è¦ä»ç£ç›˜é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶åé‡æ–°åˆ·æ–°é¡µè¡¨ï¼Œé‡æ–°å»ºç«‹è™šæ‹Ÿåœ°å€å’Œç‰©ç†é¡µé¢çš„æ˜ å°„å…³ç³»ã€‚</p>
<h3 id="cow">é¡µé¢å†™æ—¶å¤åˆ¶COW</h3>
<p>é€šå¸¸æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¼šè§¦å‘å†™æ—¶å¤åˆ¶ï¼ˆCopy on writeï¼ŒCoWï¼‰ã€‚ ï¼ˆ1ï¼‰çˆ¶è¿›ç¨‹åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œä¸ºäº†é¿å…å¤åˆ¶ç‰©ç†é¡µï¼Œå­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ä»¥åªè¯»æ–¹å¼å…±äº«çš„åŒ¿åé¡µå’Œæ–‡ä»¶é¡µï¼Œå½“æœ‰ä¸€ä¸ªè¿›ç¨‹éœ€è¦å†™åªè¯»é¡µæ—¶ï¼Œå°†ä¼šè§¦å‘é¡µé”™è¯¯å¼‚å¸¸ï¼Œè¿›ç¨‹ä¼šæ‹·è´ä¸€ä»½æ–°çš„ç‰©ç†é¡µè¿›è¡Œå†™ã€‚ ï¼ˆ2ï¼‰è¿›ç¨‹åˆ›å»ºäº†ä¸€ä¸ªç§æœ‰æ–‡ä»¶æ˜ å°„ï¼Œå½“è¿›è¡Œè¯»è®¿é—®æ—¶ï¼Œç¼ºé¡µå¼‚å¸¸å°†æ–‡ä»¶å†…å®¹è¯»å–åˆ°page cacheä¸­ï¼Œå¹¶å°†ä»¥åªè¯»æ–¹å¼è·Ÿè™šæ‹Ÿé¡µå»ºç«‹æ˜ å°„å…³ç³»ã€‚å½“è¿›ç¨‹å†å¯¹æ”¹å†…å®¹è¿›è¡Œå†™æ—¶ï¼Œç¼ºé¡µå¼‚å¸¸ä¼šè§¦å‘å†™æ—¶å¤åˆ¶ï¼Œä¸ºpage cacheåˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œæ–°å»ºä¸€ä¸ªè™šæ‹Ÿé¡µä¸å¤åˆ¶çš„ç‰©ç†é¡µå»ºç«‹è”ç³»ã€‚ <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_84171174ccd68f84c7c3875b62adcc06.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_84171174ccd68f84c7c3875b62adcc06.jpg"/></a> vm_normal_pageä»é¡µè¡¨é¡¹å¾—åˆ°é¡µå¸§å·,å¦‚æœè¿”å›å€¼ä¸ºNULLï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é¡µæ˜ å°„ï¼Œè¿™ç§ç‰¹æ®Šçš„é¡µæ˜ å°„åªæœ‰é¡µå¸§å·ï¼Œæ²¡æœ‰å¯¹åº”å®é™…çš„ç‰©ç†é¡µï¼Œå…·ä½“æ˜¯ä»€ä¹ˆç”¨é€”ï¼Œéœ€è¦å†ç ”ç©¶ï¼Ÿ å¦‚ä¸Šå›¾ï¼Œå†™æ—¶å¤åˆ¶ä¸€å…±æœ‰å››ç§æƒ…å½¢ã€‚ - å†™æ—¶å¤åˆ¶ï¼šwp_page_copy - å¯å†™ä¸”å…±äº«çš„ç‰¹æ®Šæ˜ å°„é¡µé¢ï¼šwp_pfn_shared - å¯å†™ä¸”å…±äº«çš„æ™®é€šé¡µé¢ï¼šwp_page_shared - KSMåŒ¿åé¡µé¢ï¼ˆå¤ç”¨çš„é¡µé¢ï¼‰ï¼šwp_page_reuse ä¸‹é¢é‡ç‚¹çœ‹çœ‹wp_page_copyçš„æµç¨‹ï¼š <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_35c342abdc67f0593add42e69bf94c3e.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_35c342abdc67f0593add42e69bf94c3e.jpg"/></a> â€ƒâ€ƒ1.ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿpage faultï¼Ÿ Page faultæ˜¯ç¡¬ä»¶æä¾›çš„ç‰¹æ€§ï¼Œç”±ç¡¬ä»¶è§¦å‘ï¼Œè§¦å‘æ¡ä»¶ä¸ºCPUè®¿é—®æŸçº¿æ€§åœ°å€æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”å¯è®¿é—®é¡µè¡¨é¡¹ï¼Œåˆ™ç”±ç¡¬ä»¶ç›´æ¥è§¦å‘page faultã€‚ â€ƒâ€ƒ2.å‘ç”Ÿç¼ºé¡µçš„åœ°å€æ˜¯å¦å¯ä»¥ä½äºå†…æ ¸æ€åœ°å€ç©ºé—´ï¼Ÿ æœ‰å¯èƒ½ï¼Œå†…æ ¸åœ°å€ç©ºé—´å‘ç”Ÿç¼ºé¡µå¼‚å¸¸ä»…å¯èƒ½åœ¨vmallocåŒºï¼Œçº¿æ€§æ˜ å°„åŒºåŸŸå¯¹åº”çš„é¡µè¡¨åœ¨å†…æ ¸åˆå§‹åŒ–å°±å·²ç»å»ºç«‹å¥½äº†ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å†…å­˜å¯¹åº”çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸å¯èƒ½äº§ç”Ÿpage faultã€‚</p>
<h2 id="rmap">RMAP</h2>
<p>åå‘æ˜ å°„æ˜¯ç‰©ç†é¡µé¢pageå¯ä»¥å¯»æ‰¾åˆ°å…¶å¯¹åº”çš„è™šæ‹Ÿåœ°å€ç©ºé—´VMAã€‚å½“è¿›è¡Œé¡µé¢å›æ”¶çš„æ—¶å€™ï¼Œå°±éœ€è¦åˆ©ç”¨åå‘æ˜ å°„æŠ€æœ¯æ‰¾åˆ°å…¶å¯¹åº”çš„è¿›ç¨‹VMAï¼Œç„¶åå°†VMAä¸å½“å‰é¡µé¢æ–­å¼€æ˜ å°„å…³ç³»ï¼Œå³å¯è¿›è¡Œå›æ”¶å½“å‰é¡µé¢ã€‚ â€ƒâ€ƒä¸€ä¸ªç‰©ç†é¡µé¢æ˜¯å¯ä»¥åŒæ—¶è¢«å¤šä¸ªè¿›ç¨‹çš„è™šæ‹Ÿé¡µé¢æ˜ å°„çš„ï¼Œä½†æ˜¯ä¸€ä¸ªè™šæ‹Ÿé¡µé¢åªèƒ½æ˜ å°„ä¸€ä¸ªç‰©ç†é¡µé¢ã€‚ä¸åŒè™šæ‹Ÿé¡µé¢æ˜ å°„åˆ°åŒä¸€ç‰©ç†é¡µé¢çš„åœºæ™¯ä¸»è¦æœ‰å­è¿›ç¨‹å¤åˆ¶äº†çˆ¶è¿›ç¨‹çš„VMAä»¥åŠKSMæœºåˆ¶çš„å­˜åœ¨ã€‚</p>
<h3 id="_10">å…³é”®æ•°æ®ç»“æ„</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_e4e008eade507e84b99c1c805f91075b.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_e4e008eade507e84b99c1c805f91075b.jpg"/></a></p>
<h3 id="_11">åŸºæœ¬åŸç†</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_dd6c2685f14c0c162aaf0bea21188b5d.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_dd6c2685f14c0c162aaf0bea21188b5d.jpg"/></a></p>
<h3 id="_12">æ˜ å°„åˆ°ä¸€ä¸ªè¿›ç¨‹çš„åå‘æ˜ å°„</h3>
<div class="codehilite"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="n">vm_fault_t</span><span class="w"> </span><span class="nf">do_anonymous_page</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">vm_fault</span><span class="w"> </span><span class="o">*</span><span class="n">vmf</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">......</span>
<span class="w">    </span><span class="n">__anon_vma_prepare</span><span class="p">(</span><span class="n">vma</span><span class="p">)</span>
<span class="w">    </span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloc_zeroed_user_highpage_movable</span><span class="p">(</span><span class="n">vma</span><span class="p">,</span><span class="w"> </span><span class="n">vmf</span><span class="o">-&gt;</span><span class="n">address</span><span class="p">);</span>
<span class="w">    </span><span class="n">page_add_new_anon_rmap</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">vma</span><span class="p">,</span><span class="w"> </span><span class="n">vmf</span><span class="o">-&gt;</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">......</span>
<span class="p">}</span>
</code></pre></div>
<p>ä»¥åŒ¿åæ˜ å°„ä¸ºä¾‹è¯´æ˜ï¼š â€ƒâ€ƒåœ¨ç¼ºé¡µå¼‚å¸¸åˆ†é…ç‰©ç†é¡µæ—¶ï¼Œä¼šè°ƒç”¨ä¸¤ä¸ªå‡½æ•°åšRAMPç›¸å…³çš„å¤„ç†ï¼š__anon_vma_prepareï¼Œä»¥åŠpage_add_new_anon_rmapã€‚ <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_0e475cb2b8676c6ad7a54f59acbecf9a.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_0e475cb2b8676c6ad7a54f59acbecf9a.jpg"/></a></p>
<p>åˆ›å»ºè¿‡ç¨‹ï¼š ï¼ˆ1ï¼‰åˆ†é…é¡µé¢çš„æ—¶å€™ï¼Œä¸ºæ¯ä¸ªVMAåˆ›å»ºä¸€ä¸ªAVCï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªAVã€‚ ï¼ˆ2ï¼‰AVC-&gt;vmaæŒ‡å‘VMAï¼ŒAVC-&gt;AVæŒ‡å‘AVã€‚ ï¼ˆ3ï¼‰å°†AVCæ·»åŠ åˆ°VMA-&gt;anon_vma_chainé“¾è¡¨ä¸­ã€‚ ï¼ˆ4ï¼‰å°†AVCæ·»åŠ åˆ°AV-&gt;rb_rootçº¢é»‘æ ‘ä¸­ã€‚ ï¼ˆ5ï¼‰å°†page-&gt;mappingæŒ‡å‘avã€‚ â€ƒâ€ƒåå‘æ˜ å°„è¿‡ç¨‹ï¼š ï¼ˆ1ï¼‰é€šè¿‡page-&gt;mappingæ‰¾åˆ°avã€‚ ï¼ˆ2ï¼‰åœ¨av-&gt;rb_rootçº¢é»‘æ ‘ä¸­ä»æ ¹èŠ‚ç‚¹è¿›è¡Œéå†avcã€‚ ï¼ˆ3ï¼‰ä»avcä¸­avc-&gt;vmaæ‰¾åˆ°vmaã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">page_add_new_anon_rmap</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">page</span><span class="w"> </span><span class="o">*</span><span class="n">page</span><span class="p">,</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">vm_area_struct</span><span class="w"> </span><span class="o">*</span><span class="n">vma</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">compound</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compound</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">thp_nr_pages</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="n">VM_BUG_ON_VMA</span><span class="p">(</span><span class="n">address</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">vm_start</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">vm_end</span><span class="p">,</span><span class="w"> </span><span class="n">vma</span><span class="p">);</span>
<span class="n">__SetPageSwapBacked</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
<span class="n">è®¾ç½®pageçš„æ ‡å¿—ä½ä½PG_swapbacked</span><span class="err">ï¼Œ</span><span class="n">è¡¨ç¤ºé¡µé¢å¯ä»¥äº¤æ¢åˆ°ç£ç›˜</span><span class="err">ã€‚</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">compound</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">VM_BUG_ON_PAGE</span><span class="p">(</span><span class="o">!</span><span class="n">PageTransHuge</span><span class="p">(</span><span class="n">page</span><span class="p">),</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>
<span class="w">        </span><span class="cm">/* increment count (starts at -1) */</span>
<span class="w">        </span><span class="n">atomic_set</span><span class="p">(</span><span class="n">compound_mapcount_ptr</span><span class="p">(</span><span class="n">page</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hpage_pincount_available</span><span class="p">(</span><span class="n">page</span><span class="p">))</span>
<span class="w">            </span><span class="n">atomic_set</span><span class="p">(</span><span class="n">compound_pincount_ptr</span><span class="p">(</span><span class="n">page</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">        </span><span class="n">__mod_lruvec_page_state</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">NR_ANON_THPS</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* Anon THP always mapped first with PMD */</span>
<span class="w">        </span><span class="n">VM_BUG_ON_PAGE</span><span class="p">(</span><span class="n">PageTransCompound</span><span class="p">(</span><span class="n">page</span><span class="p">),</span><span class="w"> </span><span class="n">page</span><span class="p">);</span>
<span class="w">        </span><span class="cm">/* increment count (starts at -1) */</span>
<span class="w">        </span><span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">page</span><span class="o">-&gt;</span><span class="n">_mapcount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">__mod_lruvec_page_state</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">NR_ANON_MAPPED</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">);</span>
<span class="n">__page_set_anon_rmap</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">vma</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">è®¾ç½®é¡µé¢ä½åŒ¿åæ˜ å°„</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">__page_set_anon_rmap</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">page</span><span class="w"> </span><span class="o">*</span><span class="n">page</span><span class="p">,</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">vm_area_struct</span><span class="w"> </span><span class="o">*</span><span class="n">vma</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">exclusive</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">anon_vma</span><span class="w"> </span><span class="o">*</span><span class="n">anon_vma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">anon_vma</span><span class="p">;</span>
<span class="n">anon_vma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">anon_vma</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">PAGE_MAPPING_ANON</span><span class="p">;</span>
<span class="n">WRITE_ONCE</span><span class="p">(</span><span class="n">page</span><span class="o">-&gt;</span><span class="n">mapping</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">address_space</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">anon_vma</span><span class="p">);</span>
<span class="n">Pageä¸­çš„mappingæŒ‡å‘anon_vma</span>
<span class="w">    </span><span class="n">page</span><span class="o">-&gt;</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linear_page_index</span><span class="p">(</span><span class="n">vma</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_13">æ˜ å°„åˆ°å¤šä¸ªè¿›ç¨‹çš„åå‘æ˜ å°„</h3>
<h4 id="_14">æœªå‘ç”Ÿå†™æ—¶å¤åˆ¶</h4>
<p>çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¿˜æ²¡æœ‰è¿›è¡Œå†™æ“ä½œåªæœ‰è¯»æ“ä½œï¼Œä¸ºäº†èŠ‚çœå†…å­˜ï¼Œçˆ¶å­æ˜¯å…±äº«ç‰©ç†é¡µé¢çš„ï¼Œåªæœ‰å½“çˆ¶å­è¿›ç¨‹éœ€è¦ä¿®æ”¹é¡µé¢å†…å®¹æ˜¯ï¼Œæ‰ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ä¸€ä»½ã€‚ <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_7a65ba08a7451b8e47ff5651fbe7abe8.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_7a65ba08a7451b8e47ff5651fbe7abe8.jpg"/></a> - éå†çˆ¶è¿›ç¨‹çš„VMAï¼Œå­è¿›ç¨‹è¿›è¡Œå¤åˆ¶ä¸€ä»½VMAã€‚ - æ¯å¤åˆ¶ä¸€ä»½VMAï¼Œå°±åˆ›å»ºä¸€ä¸ªAVCï¼ˆä¸‹å›¾çš„AVC_cï¼‰ï¼Œç”¨äºå»ºç«‹çˆ¶å­ä¹‹é—´çš„æ¡¥æ¢è”ç³»ã€‚AVC_cï¼ˆAVC_c-&gt;anon_vmaï¼‰æŒ‡å‘çˆ¶AVå¹¶æ·»åŠ åˆ°çˆ¶AVï¼ˆAV-&gt;rb_rootï¼‰çº¢é»‘æ ‘ä¸­ï¼ŒåŒæ—¶AVC_cï¼ˆAVC_c-&gt;vmaï¼‰åˆæŒ‡å‘å­è¿›ç¨‹çš„VMAã€‚è¿™æ ·åœ¨éå†çˆ¶AVçš„çº¢é»‘æ ‘ï¼Œå°±èƒ½é€šè¿‡AVC_cæ‰¾åˆ°å­è¿›ç¨‹çš„VMAã€‚ - å­è¿›ç¨‹åˆ›å»ºå±äºè‡ªå·±çš„AVC/AVï¼Œå¹¶å»ºç«‹VMA,AVC,AVçš„è”ç³»ã€‚ - å­è¿›ç¨‹å¤åˆ¶äº†çˆ¶è¿›ç¨‹çš„pteï¼Œæ‰€ä»¥å­è¿›ç¨‹çš„vmaå¯¹åº”è™šæ‹Ÿé¡µé¢ä¹Ÿçˆ¶è¿›ç¨‹çš„è™šæ‹Ÿé¡µé¢åŒæ—¶æŒ‡å‘ç‰©ç†é¡µé¢pageï¼ˆäºŒå¯¹ä¸€çš„æƒ…å†µï¼‰ã€‚ <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_04ce4257a5067ca7f04a211bb8c63640.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_04ce4257a5067ca7f04a211bb8c63640.jpg"/></a> â€ƒâ€ƒç‰©ç†é¡µé¢pageå¯»æ‰¾è™šæ‹Ÿé¡µé¢è¿‡ç¨‹ï¼š - é€šè¿‡page-&gt;mappingæ‰¾åˆ°çˆ¶è¿›ç¨‹çš„AVï¼Œå¦‚ä¸Šå›¾AV0ã€‚ - éå†AV0çš„çº¢é»‘æ ‘ï¼Œè¿™é‡Œæ‰¾åˆ°ä¸¤ä¸ªAVCèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯çˆ¶AVC0èŠ‚ç‚¹ä»¥åŠçˆ¶å­è¿›ç¨‹æ¡¥æ¢èŠ‚ç‚¹AVC_cã€‚ - é€šè¿‡çˆ¶AVC0æ‰¾åˆ°çˆ¶è¿›ç¨‹çš„VMA0ï¼ˆAVC0-&gt;vmaæŒ‡å‘çˆ¶VMA0ï¼‰ã€‚ - é€šè¿‡æ¡¥æ¢AVC_cæ‰¾åˆ°å­è¿›ç¨‹çš„VMA1ï¼ˆAVC_c-vmaæŒ‡å‘å­VMA1ï¼‰ â€ƒâ€ƒç»è¿‡ä¸Šè¿°è¿‡ç¨‹ï¼Œç‰©ç†é¡µé¢pageå°±å¯ä»¥æ‰¾åˆ°ä¸å…¶å¯¹åº”çš„ä¸¤ä¸ªè™šæ‹Ÿé¡µé¢äº†ã€‚</p>
<h4 id="_15">å‘ç”Ÿå†™æ—¶å¤åˆ¶</h4>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_f2b79044880e2a52ea4d0c2b33955dda.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_f2b79044880e2a52ea4d0c2b33955dda.jpg"/></a> â€ƒâ€ƒå½“çˆ¶å­è¿›ç¨‹çš„æŸä¸€æ–¹å‡ºç°å†™é¡µé¢æ“ä½œæ—¶ï¼Œå°†ä¼šè§¦å‘å†™æ—¶å¤åˆ¶å¤åˆ¶ä¸€ä»½è‡ªå·±çš„ç‰©ç†é¡µé¢ï¼Œå¦‚ä¸Šå›¾ï¼ŒVMA1çš„pteæŒ‡å‘å¤åˆ¶çš„æ–°ç‰©ç†é¡µï¼ŒåŒæ—¶ç‰©ç†é¡µpage-&gt;mappingæŒ‡å‘AV1ï¼Œè¿™æ ·copy pageå°±èƒ½å¤Ÿé€šè¿‡AV1éå†å…¶çº¢é»‘æ ‘æ‰¾åˆ°AVC1ï¼Œè¿›è€Œé€šè¿‡AVC1æ‰¾åˆ°VMA1ã€‚ â€ƒâ€ƒç–‘é—®ï¼šä¸Šå›¾ä¸­AVC_cä¾æ—§åœ¨AV0çš„çº¢é»‘æ ‘ä¸­ï¼Œæ‰€ä»¥çˆ¶è¿›ç¨‹çš„ç‰©ç†é¡µpageä¾æ—§é€šè¿‡AV0æ‰¾åˆ°å­è¿›ç¨‹çš„VMA1ï¼Œä½†æ˜¯å­è¿›ç¨‹å®é™…çš„pteå·²ç»æŒ‡å‘copy pageäº†ï¼Œè·Ÿçˆ¶è¿›ç¨‹çš„pageæ²¡æœ‰å…³ç³»äº†ã€‚ç½‘ä¸Šçœ‹åˆ°çš„è¯´æ³•æ˜¯ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå³ä½¿pageæ‰¾åˆ°äº†å¯¹åº”çš„VMAï¼Œä¼šæ£€æŸ¥vmaçš„é¡µè¡¨æ˜¯å¦ç¡®å®æ˜ å°„åˆ°äº†æ­¤é¡µï¼Œè¿›è€Œè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥ç ”ç©¶ä»£ç æ±‚è¯ã€‚</p>
<h3 id="_16">åå‘æ˜ å°„çš„åº”ç”¨</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_b1756eab66e402777cb13520ae84b778.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/è¿›ç¨‹è™šæ‹Ÿå†…å­˜-2/images/wp_editor_md_b1756eab66e402777cb13520ae84b778.jpg"/></a> â€ƒâ€ƒåå‘æ˜ å°„ä¸»è¦çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹ï¼š - Kswapdå›æ”¶é¡µé¢æ˜¯ï¼Œéœ€è¦æ–­å¼€æ˜ å°„åˆ°ç‰©ç†é¡µé¢çš„PTEã€‚ - é¡µé¢è¿ç§»æ—¶ï¼Œéœ€è¦æ–­å¼€æ‰€æœ‰æ˜ å°„åˆ°é¡µé¢çš„PTEã€‚</p></div>
  <div class="post-nav">
    <a class="prev" href="wordpressè®¾å®šå›ºå®šé“¾æ¥.html">â† wordpressè®¾å®šå›ºå®šé“¾æ¥</a>
    <a class="next" href="dmaä¸cacheä¸€è‡´æ€§.html">DMAä¸cacheä¸€è‡´æ€§ â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

