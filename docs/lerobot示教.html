<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>lerobot示教 - Laumy的技术栈</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJax支持LaTeX数学公式 -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="">Laumy的技术栈</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="输入关键词回车搜索">
        </div>
        <div class="theme-toggle" title="切换主题" id="theme-toggle">☾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="">首页</a></div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">文章目录</div>
          <nav id="toc"><ul><li><a href="#_1">启动</a><ul></ul></li><li><a href="#_2">配置解析</a><ul></ul></li><li><a href="#_3">初始化可视化工具</a><ul></ul></li><li><a href="#_4">创建主从臂实例</a><ul></ul></li><li><a href="#_5">连接设备</a><ul></ul></li><li><a href="#_6">跟随控制</a><ul></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>lerobot示教</h1>
  <div class="meta">2025-07-28 · ai</div>
  <div class="post-content"><h2 id="_1">启动</h2>
<p>示教的功能主要是主臂控制，从臂跟随，在数据采集是非常的一环。下面是模块启动的执行命令：</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">lerobot</span><span class="o">.</span><span class="n">teleoperate</span> \
  <span class="o">--</span><span class="n">robot</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">so101_follower</span> \
  <span class="o">--</span><span class="n">robot</span><span class="o">.</span><span class="n">port</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyACM0</span> \
  <span class="o">--</span><span class="n">robot</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">R12252801</span> \
  <span class="o">--</span><span class="n">teleop</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">so101_leader</span> \
  <span class="o">--</span><span class="n">teleop</span><span class="o">.</span><span class="n">port</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyACM1</span> \
  <span class="o">--</span><span class="n">teleop</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="n">R07252608</span>
</code></pre></div>
<p>python解释器回安装sys.path查找lerobot.teleoperate模块，找到执行lerobot/src/lerobot/teleoperate.py文件，调用teleoperate函数。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">## 配置解析</span>
<span class="nd">@draccus</span><span class="o">.</span><span class="n">wrap</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">teleoperate</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">TeleoperateConfig</span><span class="p">):</span>
    <span class="n">init_logging</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">asdict</span><span class="p">(</span><span class="n">cfg</span><span class="p">)))</span>
<span class="c1">## 初始化可视化工具</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">display_data</span><span class="p">:</span>
        <span class="n">_init_rerun</span><span class="p">(</span><span class="n">session_name</span><span class="o">=</span><span class="s2">"teleoperation"</span><span class="p">)</span>
<span class="c1">##创建操作设备和机器人实例</span>
    <span class="n">teleop</span> <span class="o">=</span> <span class="n">make_teleoperator_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">teleop</span><span class="p">)</span>
    <span class="n">robot</span> <span class="o">=</span> <span class="n">make_robot_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">robot</span><span class="p">)</span>
<span class="c1">## 连接设备</span>
    <span class="n">teleop</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="c1">##示教循环</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">teleop_loop</span><span class="p">(</span><span class="n">teleop</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> <span class="n">display_data</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">display_data</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">teleop_time_s</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">display_data</span><span class="p">:</span>
            <span class="n">rr</span><span class="o">.</span><span class="n">rerun_shutdown</span><span class="p">()</span>
<span class="c1">## 断开连接</span>
        <span class="n">teleop</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="n">robot</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">teleoperate</span><span class="p">()</span>
</code></pre></div>
<p>下面展开来说明一下。</p>
<h2 id="_2">配置解析</h2>
<div class="codehilite"><pre><span></span><code><span class="nd">@draccus</span><span class="o">.</span><span class="n">wrap</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">teleoperate</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">TeleoperateConfig</span><span class="p">):</span>
    <span class="c1"># 初始化日志记录</span>
    <span class="n">init_logging</span><span class="p">()</span>
    <span class="c1"># 打印配置信息</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">draccus</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">cfg</span><span class="p">)))</span>
</code></pre></div>
<p>在teleoperate.py中teleoperate函数使用@draccus.wrap()装饰器解析命令行参数，将参数转换为TeleoperateConfig类型的配置对象。dracus是用于配置解析的库，类型与argparse。</p>
<p>这里的TeleoperateConfig是一个自定义的配置类，定义如下：</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RobotConfig</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TeleopConfig</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TeleoperateConfig</span><span class="p">:</span>
    <span class="n">teleop</span><span class="p">:</span> <span class="n">TeleoperatorConfig</span>
    <span class="n">robot</span><span class="p">:</span> <span class="n">RobotConfig</span>
    <span class="c1"># Limit the maximum frames per second.</span>
    <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">teleop_time_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Display all cameras on screen</span>
    <span class="n">display_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>
<p>可以看到TeleoperateConfig类中属性定义了robot，teleop两个对象，命令行的参数将会映射到，如：</p>
<ul>
<li>--robot.type=so101_follower：对应cfg.robot.type</li>
<li>--teleop.port=/dev/ttyACM1:对应cfg.teleop.port</li>
</ul>
<h2 id="_3">初始化可视化工具</h2>
<div class="codehilite"><pre><span></span><code>    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">display_data</span><span class="p">:</span>
        <span class="n">_init_rerun</span><span class="p">(</span><span class="n">session_name</span><span class="o">=</span><span class="s2">"teleoperation"</span><span class="p">)</span>
</code></pre></div>
<p>当参数--display_data=true，即cfg.display_data 为 True，则调用 _init_rerun 函数初始化 rerun 可视化工具。rerun 是一个用于记录和可视化科学数据的工具。</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">_init_rerun</span><span class="p">(</span><span class="n">session_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"lerobot_control_loop"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Initializes the Rerun SDK for visualizing the control loop."""</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"RERUN_FLUSH_NUM_BYTES"</span><span class="p">,</span> <span class="s2">"8000"</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"RERUN_FLUSH_NUM_BYTES"</span><span class="p">]</span> <span class="o">=</span> <span class="n">batch_size</span>
    <span class="n">rr</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">session_name</span><span class="p">)</span>
    <span class="n">memory_limit</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"LEROBOT_RERUN_MEMORY_LIMIT"</span><span class="p">,</span> <span class="s2">"10%"</span><span class="p">)</span>
    <span class="n">rr</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">memory_limit</span><span class="o">=</span><span class="n">memory_limit</span><span class="p">)</span>
</code></pre></div>
<p>_init_rerun函数的主要功能是初始化Rerun SDK,设置数据刷新的字节数和内存使用限制，然后启动Rerun会话，为后续的控制循环可视化工作做准备。</p>
<p>其中有两个参数是从环境变量中获取，分别是RERUN_FLUSH_NUM_BYTES和LEROBOT_RERUN_MEMORY_LIMIT，用于控制每次刷新是处理数据的字节数和限制使用的内存量。</p>
<h2 id="_4">创建主从臂实例</h2>
<div class="codehilite"><pre><span></span><code><span class="n">teleop</span> <span class="o">=</span> <span class="n">make_teleoperator_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">teleop</span><span class="p">)</span>
<span class="n">robot</span> <span class="o">=</span> <span class="n">make_robot_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">robot</span><span class="p">)</span>
</code></pre></div>
<p>调用调用 make_teleoperator_from_config 和make_robot_from_config 函数，根据配置对象创建 SO101Leader遥操作设备实例和 SO101Follower 机器人实例。</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">make_teleoperator_from_config</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">TeleoperatorConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Teleoperator</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"keyboard"</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.keyboard</span> <span class="kn">import</span> <span class="n">KeyboardTeleop</span>

        <span class="k">return</span> <span class="n">KeyboardTeleop</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"koch_leader"</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.koch_leader</span> <span class="kn">import</span> <span class="n">KochLeader</span>

        <span class="k">return</span> <span class="n">KochLeader</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"so100_leader"</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.so100_leader</span> <span class="kn">import</span> <span class="n">SO100Leader</span>

        <span class="k">return</span> <span class="n">SO100Leader</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"so101_leader"</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.so101_leader</span> <span class="kn">import</span> <span class="n">SO101Leader</span>

        <span class="k">return</span> <span class="n">SO101Leader</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="o">......</span>
</code></pre></div>
<p>以leader为例，最终调用SO101Leader对象实例。</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SO101Leader</span><span class="p">(</span><span class="n">Teleoperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    SO-101 Leader Arm designed by TheRobotStudio and Hugging Face.</span>
<span class="sd">    """</span>

    <span class="n">config_class</span> <span class="o">=</span> <span class="n">SO101LeaderConfig</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"so101_leader"</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">SO101LeaderConfig</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="c1">#调用父类Teleoperator够着函数初始化属性，包括</span>
        <span class="c1">#self.id：设备的唯一标识符，从配置对象中获取。</span>
        <span class="c1">#self.calibration_dir：校准文件的存储目录。</span>
        <span class="c1">#self.calibration_fpath：校准文件的完整路径。</span>
        <span class="c1">#self.calibration：存储电机校准信息的字典。</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="c1">#类型为 SO101LeaderConfig，存储传入的配置对象，方便在类的其他方法中访问配置信息。</span>
        <span class="n">norm_mode_body</span> <span class="o">=</span> <span class="n">MotorNormMode</span><span class="o">.</span><span class="n">DEGREES</span> <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">use_degrees</span> <span class="k">else</span> <span class="n">MotorNormMode</span><span class="o">.</span><span class="n">RANGE_M100_100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span> <span class="o">=</span> <span class="n">FeetechMotorsBus</span><span class="p">(</span>
            <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
            <span class="n">motors</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"shoulder_pan"</span><span class="p">:</span> <span class="n">Motor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"sts3215"</span><span class="p">,</span> <span class="n">norm_mode_body</span><span class="p">),</span>
                <span class="s2">"shoulder_lift"</span><span class="p">:</span> <span class="n">Motor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"sts3215"</span><span class="p">,</span> <span class="n">norm_mode_body</span><span class="p">),</span>
                <span class="s2">"elbow_flex"</span><span class="p">:</span> <span class="n">Motor</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"sts3215"</span><span class="p">,</span> <span class="n">norm_mode_body</span><span class="p">),</span>
                <span class="s2">"wrist_flex"</span><span class="p">:</span> <span class="n">Motor</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"sts3215"</span><span class="p">,</span> <span class="n">norm_mode_body</span><span class="p">),</span>
                <span class="s2">"wrist_roll"</span><span class="p">:</span> <span class="n">Motor</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">"sts3215"</span><span class="p">,</span> <span class="n">norm_mode_body</span><span class="p">),</span>
                <span class="s2">"gripper"</span><span class="p">:</span> <span class="n">Motor</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">"sts3215"</span><span class="p">,</span> <span class="n">MotorNormMode</span><span class="o">.</span><span class="n">RANGE_0_100</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="n">calibration</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">,</span>
        <span class="p">)</span>
       <span class="c1">#类型为 FeetechMotorsBus，用于与 Feetech 电机进行通信，初始化时传入端口、电机信息和校准信息。</span>
</code></pre></div>
<p>SO101Leader类继承了Teleoperator，super().<strong>init</strong>(config) 调用父类 Teleoperator 的构造函数初始化的属性。</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Teleoperator</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">TeleoperatorConfig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">id</span>
        <span class="c1">#设备的id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration_dir</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">calibration_dir</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">calibration_dir</span>
            <span class="k">else</span> <span class="n">HF_LEROBOT_CALIBRATION</span> <span class="o">/</span> <span class="n">TELEOPERATORS</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>
        <span class="c1">#校准文件的存储目录</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#创建校准目录</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration_fpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.json"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MotorCalibration</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># 初始化一个字典，键为字符串，值为MotorCalibration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration_fpath</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_calibration</span><span class="p">()</span>
        <span class="c1">#检查校准文件是否存在，存在调用加载校准信息的方法。</span>
</code></pre></div>
<p>Teleoperator定义了一个遥控的基类，其构造函数中接受一个TeleoperatorConfig类型的参数config，主要有以下属性。</p>
<ul>
<li>self.id：设备的唯一标识符，从传入的配置对象 config 里获取，用于在系统中唯一标识该 SO101Leader 设备实例。</li>
<li>self.calibration_dir：校准文件的存储目录。若 config.calibration_dir 有值则使用该值，否则使用默认路径。此目录用于存放设备的校准文件。</li>
<li>self.calibration_fpath：校准文件的完整路径，由 self.calibration_dir 和设备 id 组合而成，文件格式为 JSON。</li>
<li>self.calibration：存储电机校准信息的字典，键为电机名称，值为 MotorCalibration 类型的对象，用于保存电机的校准参数。</li>
</ul>
<p>而SO101Leader类中自己定义的实力属性有 - self.config：类型为 SO101LeaderConfig，存储传入的配置对象。借助这个属性，类的其他方法可以访问配置信息，如端口号、是否使用角度单位等。 - self.bus：类型为 FeetechMotorsBus，用于和 Feetech 电机进行通信。初始化时传入端口、电机信息和校准信息，后续可以通过该对象实现电机的读写操作、校准等功能。</p>
<p>总结下就是SO101Leader 类包含 2 个类属性和多个实例属性，这些属性从不同层面描述了 SO101 领导者手臂设备的类型、配置、校准信息以及与电机的通信对象等。而SO101Follower也是同理这里就不过多阐述。</p>
<h2 id="_5">连接设备</h2>
<div class="codehilite"><pre><span></span><code>    <span class="n">teleop</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</code></pre></div>
<p>连接设备就是各自调用此前创建实例的connect方法，建立与硬件设备的连接。以teleop为例，最总调用到self.bus.connect发起连接并进行配置。</p>
<div class="codehilite"><pre><span></span><code>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calibrate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DeviceAlreadyConnectedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> already connected"</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span> <span class="ow">and</span> <span class="n">calibrate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> connected."</span><span class="p">)</span>
</code></pre></div>
<h2 id="_6">跟随控制</h2>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">teleop_loop</span><span class="p">(</span>
    <span class="n">teleop</span><span class="p">:</span> <span class="n">Teleoperator</span><span class="p">,</span> <span class="n">robot</span><span class="p">:</span> <span class="n">Robot</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">display_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
    <span class="n">display_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">robot</span><span class="o">.</span><span class="n">action_features</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">loop_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="c1">#从主臂获取动作位置数据</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">teleop</span><span class="o">.</span><span class="n">get_action</span><span class="p">()</span>
        <span class="c1">#如果启动了实时显示，进行显示</span>
        <span class="k">if</span> <span class="n">display_data</span><span class="p">:</span>
            <span class="n">observation</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">get_observation</span><span class="p">()</span>
            <span class="n">log_rerun_data</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
        <span class="c1">#将主臂的动作位置数据发送给从臂</span>
        <span class="n">robot</span><span class="o">.</span><span class="n">send_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="c1">#计算循环执行时间</span>
        <span class="n">dt_s</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">loop_start</span>
        <span class="n">busy_wait</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">fps</span> <span class="o">-</span> <span class="n">dt_s</span><span class="p">)</span>
        <span class="n">loop_s</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">loop_start</span>

        <span class="c1">#打印动作的信息，每个舵机的位置。</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="s2">"-"</span> <span class="o">*</span> <span class="p">(</span><span class="n">display_len</span> <span class="o">+</span> <span class="mi">10</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'NAME'</span><span class="si">:</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">display_len</span><span class="si">}}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">'NORM'</span><span class="si">:</span><span class="s2">&gt;7</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">motor</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">motor</span><span class="si">:</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">display_len</span><span class="si">}}</span><span class="s2"> | </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">&gt;7.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">time: </span><span class="si">{</span><span class="n">loop_s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">ms (</span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">loop_s</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> Hz)"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="n">duration</span><span class="p">:</span>
            <span class="k">return</span>
         <span class="c1"># 将终端的文本光标向上移动一定的行数，以此实现覆盖上一次输出内容的效果，从而在终端里模拟实时更新的显示</span>
        <span class="n">move_cursor_up</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>
  <div class="post-nav">
    <a class="prev" href="python补习.html">← python补习</a>
    <a class="next" href="lerobot设备标定.html">lerobot设备标定 →</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright ©2022-2025 laumy 版权所有</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

