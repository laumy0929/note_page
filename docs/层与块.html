<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>å±‚ä¸å— - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#_1">å±‚</a><ul><li><a href="#_2">å…¨è¿æ¥å±‚</a></li><li><a href="#_3">æ¿€æ´»å‡½æ•°å±‚</a></li><li><a href="#_4">è‡ªå®šä¹‰å±‚</a></li></ul></li><li><a href="#_7">å—</a><ul><li><a href="#sequential">Sequentialå®¹å™¨</a></li><li><a href="#_8">è‡ªå®šä¹‰å—</a></li><li><a href="#_9">å¤æ‚å—</a></li></ul></li><li><a href="#_10">å‚æ•°ç®¡ç†</a><ul><li><a href="#_11">å‚æ•°è®¿é—®</a></li><li><a href="#_12">å‚æ•°åˆå§‹åŒ–</a></li><li><a href="#_13">å‚æ•°ç»‘å®š</a></li><li><a href="#_14">å‚æ•°å­˜å‚¨</a></li></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>å±‚ä¸å—</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2025-05-03
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      ai
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><p>ç®€å•æ¥è¯´ï¼Œå¦‚ä¸‹å›¾ï¼Œç¬¬ä¸€ä¸ªå›¾ä¸­é—´5ä¸ªç¥ç»å…ƒç»„æˆäº†ä¸€ä¸ªå±‚ã€‚ç¬¬äºŒå›¾3ä¸ªå±‚ç»„æˆäº†å—ã€‚ç¬¬ä¸‰ä¸ªå›¾ä¸­3ä¸ªå—ç»„æˆäº†æ•´ä¸ªæ¨¡å‹ã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/05/wp_editor_md_63a09ff6fb21e747545f4d7ca1343104.jpg"><img alt="" src="assets/doc/04-ai/æ·±åº¦å­¦ä¹ /å±‚ä¸å—/images/wp_editor_md_63a09ff6fb21e747545f4d7ca1343104.jpg"/></a></p>
<h2 id="_1">å±‚</h2>
<p>å±‚æ˜¯ç¥ç»ç½‘ç»œçš„åŸºæœ¬è®¡ç®—å•å…ƒï¼Œè´Ÿè´£å¯¹è¾“å…¥æ•°æ®è¿›è¡Œç‰¹å®šå½¢å¼çš„å˜æ¢ï¼Œå¦‚çº¿æ€§æ˜ å°„ã€éçº¿æ€§æ¿€æ´»ç­‰ã€‚å…¶ä¸»è¦çš„åŠŸèƒ½æ˜¯æ¥æ”¶è¾“å…¥æ•°æ®ï¼Œç”Ÿæˆè¾“å‡ºç»“æœã€‚å…¶ä¸­åŒ…å«å­¦ä¹ å‚æ•°ï¼ˆå¦‚å…¨è¿æ¥å±‚çš„æƒé‡å’Œåç½®ï¼‰æˆ–æ— å‚æ•°æ“ä½œï¼ˆå¦‚æ¿€æ´»å‡½æ•°ï¼‰ï¼Œè¾“å‡ºå½¢çŠ¶å¯èƒ½ä¸è¾“å…¥ä¸åŒï¼Œä¾‹å¦‚å…¨è¿æ¥å±‚å°†ç»´åº¦dinæ˜ å°„åˆ°doutã€‚</p>
<h3 id="_2">å…¨è¿æ¥å±‚</h3>
<div class="codehilite"><pre><span></span><code><span class="n">layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># è¾“å…¥ç»´åº¦4ï¼Œè¾“å‡ºç»´åº¦5</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>    <span class="c1"># è¾“å…¥å½¢çŠ¶(3,4)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>        <span class="c1"># è¾“å‡ºå½¢çŠ¶(3,5) :ml-citation{ref="1,3" data="citationList"}</span>
</code></pre></div>
<p>nn.Linerar(4, 5)ï¼šè¿™é‡Œä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºè¾“å…¥æ•°æ®ç‰¹å¾ç»´åº¦ï¼ˆç¤ºä¾‹æ˜¯4ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºè¾“å‡ºç‰¹å¾ç»´åº¦(ç¤ºä¾‹æ˜¯5)ã€‚æ³¨æ„è¿™é‡Œæ˜¯ç‰¹å¾ç»´åº¦ï¼Œè€Œä¸æ˜¯æ ·æœ¬ä¸ªæ•°,æ¯”å¦‚è¿™é‡Œçš„ç‰¹å¾ç»´åº¦æ˜¯4ï¼Œå¯ä»¥è¾“å…¥[2,4],[6,4]å³2è¡Œ4åˆ—æˆ–6è¡Œ4åˆ—çš„æ•°æ®æ ·æœ¬ã€‚</p>
<h3 id="_3">æ¿€æ´»å‡½æ•°å±‚</h3>
<div class="codehilite"><pre><span></span><code><span class="n">layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>        <span class="c1"># æ— å‚æ•°æ“ä½œ</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]))</span>  <span class="c1"># è¾“å‡º[0, 2, 0] :ml-citation{ref="3,5" data="citationList"}</span>
</code></pre></div>
<p>æ¿€æ´»å‡½æ•°å±‚ä¹Ÿæ˜¯å•ç‹¬çš„ä¸€å±‚ã€‚æ¿€æ´»å‡½æ•°å±‚æ˜¯ç¥ç»ç½‘ç»œä¸­ç”¨äºå¼•å…¥éçº¿æ€§çš„éƒ¨åˆ†ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¸®åŠ©ç½‘ç»œå­¦ä¹ åˆ°æ›´åŠ å¤æ‚çš„å‡½æ•°æ˜ å°„ã€‚æ²¡æœ‰æ¿€æ´»å‡½æ•°ï¼Œç¥ç»ç½‘ç»œåªèƒ½è¡¨ç¤ºçº¿æ€§å‡½æ•°ï¼Œè€Œå¼•å…¥éçº¿æ€§åï¼Œç¥ç»ç½‘ç»œå¯ä»¥è¡¨ç¤ºæ›´å¤æ‚çš„æ¨¡å¼ï¼Œä»è€Œåœ¨å„ç§ä»»åŠ¡ï¼ˆå¦‚åˆ†ç±»ã€å›å½’ç­‰ï¼‰ä¸­è¡¨ç°å¾—æ›´å¥½ã€‚</p>
<h3 id="_4">è‡ªå®šä¹‰å±‚</h3>
<p>åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œè‡ªå®šä¹‰å±‚æ˜¯ç”¨æˆ·æ ¹æ®å…·ä½“ä»»åŠ¡éœ€æ±‚è‡ªå®šä¹‰å®ç°çš„å±‚ã€‚ä¸å†…ç½®å±‚ï¼ˆå…¨è¿æ¥å±‚ã€å·ç§¯å±‚ï¼‰ä¸åŒï¼Œè‡ªå®šä¹‰å±‚å¯ä»¥æ ¹æ®ç‰¹å®šçš„é€»è¾‘æˆ–è¡Œä¸ºæ¥æ‰©å±•æ¨¡å‹ã€‚å®ƒå…è®¸ä½ åœ¨è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ä¸­æ‰§è¡Œç‰¹æ®Šçš„æ“ä½œæˆ–æ”¹å˜æ ‡å‡†å±‚çš„è¡Œä¸ºã€‚ä½¿ç”¨è‡ªå®šä¹‰å±‚å¯ä»¥ä½¿æŸäº›æ¨¡å‹è¿›è¡Œç‰¹æ®Šè®¡ç®—ï¼Œæ¯”å¦‚è‡ªå®šä¹‰æ­£åˆ™åŒ–ã€æŸå¤±å‡½æ•°æˆ–ç‰¹æ®Šçš„æ¿€æ´»å‡½æ•°ç­‰ã€‚</p>
<p>åœ¨pytorchä¸­å¦‚ä½•å®ç°è‡ªå®šä¹‰å±‚ï¼Œé€šå¸¸æ˜¯é€šè¿‡ç»§æ‰¿torch.nn.Moduleç±»æ¥å®ç°çš„ï¼Œéœ€è¦å®šä¹‰çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>init</strong>:å®šä¹‰å±‚éœ€è¦çš„å‚æ•°æˆ–å­å±‚ã€‚</li>
<li>forward:å®šä¹‰æ•°æ®å¦‚ä½•é€šè¿‡è¯¥å±‚ä¼ é€’å¹¶æ‰§è¡Œç›¸åº”çš„è®¡ç®—ã€‚</li>
</ul>
<h4 id="_5">æ— å‚æ•°å±‚</h4>
<p>æ— å‚æ•°å±‚ä¸åŒ…å«ä»»ä½•éœ€è¦è®­ç»ƒçš„å‚æ•°ï¼Œé€šå¸¸ç”¨äºæ‰§è¡ŒæŸäº›å›ºå®šçš„æ“ä½œæˆ–è®¡ç®—ã€‚æ¯”å¦‚æ¿€æ´»å‡½æ•°ã€å½’ä¸€åŒ–æ“ä½œã€æ•°å­¦å˜æ¢ç­‰ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>

<span class="c1">#ç»§æ‰¿nn.Module</span>
<span class="k">class</span> <span class="nc">custom_relu</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>

<span class="n">layer</span> <span class="o">=</span> <span class="n">custom_relu</span><span class="p">()</span>
<span class="n">input_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>

<span class="n">output_data</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output_data</span><span class="p">)</span>
</code></pre></div>
<p>ä»£ç è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">tensor</span><span class="p">([[</span> <span class="mf">0.9986</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8549</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2031</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.8380</span><span class="p">,</span>  <span class="mf">0.6925</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9164</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.5807</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5719</span><span class="p">,</span>  <span class="mf">1.1864</span><span class="p">]])</span>
<span class="n">tensor</span><span class="p">([[</span><span class="mf">0.9986</span><span class="p">,</span> <span class="mf">0.0000</span><span class="p">,</span> <span class="mf">0.0000</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.8380</span><span class="p">,</span> <span class="mf">0.6925</span><span class="p">,</span> <span class="mf">0.0000</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.5807</span><span class="p">,</span> <span class="mf">0.0000</span><span class="p">,</span> <span class="mf">1.1864</span><span class="p">]])</span>
</code></pre></div>
<h4 id="_6">å¸¦å‚æ•°çš„å±‚</h4>
<p>å‚æ•°å±‚åŒ…å«å¯å­¦ä¹ çš„æŒ‰æ—¶ï¼Œé€šå¸¸æ‰§è¡Œä¸€äº›ä¾èµ–äºæƒé‡æˆ–åç½®çš„è®¡ç®—ï¼Œæ¯”å¦‚çº¿æ€§å˜æ¢ã€å·ç§¯ç­‰ã€‚å‚æ•°å±‚é€šå¸¸ä¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼˜åŒ–è¿™äº›å‚æ•°ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>

<span class="k">class</span> <span class="nc">custom_linear_layer</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">output_dim</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bias</span>

<span class="n">layer</span> <span class="o">=</span> <span class="n">custom_linear_layer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">input_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<span class="n">output_data</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output_data</span><span class="p">)</span>
</code></pre></div>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.7047</span><span class="p">,</span>  <span class="mf">1.8763</span><span class="p">,</span>  <span class="mf">1.8934</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.1341</span><span class="p">,</span>  <span class="mf">0.4411</span><span class="p">,</span>  <span class="mf">0.2252</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">1.0531</span><span class="p">,</span>  <span class="mf">0.2556</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0045</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.9485</span><span class="p">,</span>  <span class="mf">1.9396</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3373</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.4364</span><span class="p">,</span>  <span class="mf">0.4522</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3176</span><span class="p">]])</span>

<span class="n">tensor</span><span class="p">([[</span> <span class="mf">2.2790</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5707</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.0157</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3939</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.7449</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6362</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.1973</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3335</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.3929</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5201</span><span class="p">]],</span> <span class="n">grad_fn</span><span class="o">=&lt;</span><span class="n">AddBackward0</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div>
<h2 id="_7">å—</h2>
<p>å—æ˜¯ç”±å¤šä¸ªå±‚ç»„æˆçš„å¤åˆæ¨¡å—ï¼Œç”¨äºå°è£…é‡å¤æˆ–å¤æ‚åŠŸèƒ½çš„ä»£ç é€»è¾‘ï¼Œå®ç°æ¨¡å‹ç»“æ„çš„æ¨¡å—åŒ–ã€‚åŒ…å«å‰å‘ä¼ æ’­é€»è¾‘forwardçš„æ–¹æ³•ã€å¯åµŒå¥—å…¶ä»–å—æˆ–å±‚å½¢æˆå±‚æ¬¡åŒ–çš„ç»“æ„ï¼Œç»§æ‰¿è‡ªnn.Moduleï¼Œæ”¯æŒå‚æ•°ç®¡ç†å’Œè‡ªåŠ¨æ¢¯åº¦è®¡ç®—ã€‚</p>
<h3 id="sequential">Sequentialå®¹å™¨</h3>
<div class="codehilite"><pre><span></span><code><span class="n">block</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># åŒ…å«3ä¸ªå­å±‚ï¼šçº¿æ€§â†’æ¿€æ´»â†’çº¿æ€§ :ml-citation{ref="6,7" data="citationList"}</span>
</code></pre></div>
<p>Sequentialå®¹å™¨ç”¨äºæŒ‰é¡ºåºå®šä¹‰ä¸€ä¸ªç¥ç»ç½‘ç»œæ¨¡å—ï¼Œå®ƒå°†å„ä¸ªå­æ¨¡å—æŒ‰ç…§å®šä¹‰é¡ºåºç»„åˆåœ¨ä¸€èµ·ï¼Œä»è€Œå®ç°å‰å‘ä¼ æ’­ã€‚</p>
<ul>
<li>è¾“å…¥ï¼šå‡è®¾è¾“å…¥æ—¶ä¸€ä¸ªå½¢çŠ¶ä¸º(batch_size, 4)çš„å¼ é‡ï¼Œè¡¨ç¤ºbatch_sizeä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬æœ‰4ä¸ªç‰¹å¾ã€‚</li>
<li>ç¬¬ä¸€ä¸ªçº¿æ€§å±‚ï¼šè¾“å…¥é€šè¿‡ç¬¬ä¸€ä¸ªnn.Linear(4, 5), è¾“å‡ºå½¢çŠ¶å˜ä¸º(batch_size, 5)ã€‚</li>
<li>ReLuæ¿€æ´»å‡½æ•°ï¼šè¾“å‡ºç»è¿‡ç¬¬ä¸€ä¸ªnn.ReLU,æ‰€æœ‰è´Ÿæ•°å˜ä¸º0ï¼Œæ­£æ•°ä¿æŒä¸å˜ï¼Œè¾“å‡ºä»ä¸ºå½¢çŠ¶(batch_size, 5)ã€‚</li>
<li>ç¬¬äºŒä¸ªçº¿æ€§å±‚ï¼šç»è¿‡ç¬¬äºŒä¸ªnn.Linear(5, 3)ï¼Œè¾“å‡ºå½¢çŠ¶å˜ä¸º(batch_sizeï¼Œ 3)ã€‚</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>

<span class="n">block</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>  <span class="c1"># è¾“å…¥æ ·æœ¬æ˜¯4ä¸ªç‰¹å¾ï¼Œ è½¬æ¢ä¸º5ä¸ªç‰¹å¾</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">#è¾“å‡º3ä¸ªç‰¹å¾</span>

<span class="n">input_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>

<span class="n">output_data</span> <span class="o">=</span> <span class="n">block</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output_data</span><span class="p">)</span>
</code></pre></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">tensor</span><span class="p">([[</span> <span class="mf">0.3054</span><span class="p">,</span>  <span class="mf">1.0160</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7137</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3744</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.6882</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3049</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2769</span><span class="p">,</span>  <span class="mf">0.2835</span><span class="p">]])</span>
<span class="n">tensor</span><span class="p">([[</span> <span class="mf">0.4485</span><span class="p">,</span>  <span class="mf">0.6298</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1949</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.1992</span><span class="p">,</span>  <span class="mf">0.1609</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2480</span><span class="p">]],</span> <span class="n">grad_fn</span><span class="o">=&lt;</span><span class="n">AddmmBackward0</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div>
<h3 id="_8">è‡ªå®šä¹‰å—</h3>
<p>åœ¨pytorchä¸­ï¼Œè‡ªå®šä¹‰å—é€šå¸¸æ˜¯é€šè¿‡ç»§æ‰¿nn.Moduleåˆ›å»ºçš„è‡ªå®šä¹‰æˆ–æ¨¡å‹å—ã€‚å¯ä»¥æ ¹æ®éœ€è¦ç»„åˆå¤šä¸ªæ“ä½œæˆ–å®ç°ä¸€äº›ç‰¹å®šåŠŸèƒ½ï¼Œåˆ›å»ºå±äºè‡ªå·±çš„ç½‘ç»œæ¨¡å—ã€‚</p>
<p>å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰å—äº†ï¼Ÿ</p>
<ul>
<li>åŸºå±‚nn.Module: éœ€è¦å…ˆç»§æ‰¿nn.Moduleï¼Œè¿™æ˜¯pytorchä¸­æ‰€æœ‰ç¥ç»ç½‘ç»œæ¨¡å—çš„åŸºç±»ã€‚</li>
<li>å®šä¹‰<strong>init</strong>æ–¹æ³•ï¼šåœ¨<strong>init</strong>æ–¹æ³•ä¸­å®šä¹‰å±‚ï¼Œä¾‹å¦‚nn.Linearã€nn.Conv2dç­‰æ“ä½œå¹¶åˆå§‹åŒ–ä»–ä»¬ã€‚</li>
<li>å®šä¹‰forwardæ–¹æ³•ï¼šåœ¨forwardæ–¹æ³•ä¸­å®šä¹‰è¾“å…¥æ•°æ®å¦‚ä½•é€šè¿‡è‡ªå®šä¹‰å±‚è¿›è¡Œå¤„ç†ã€‚</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>

<span class="k">class</span> <span class="nc">custom_block</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="n">custom_block</span> <span class="o">=</span> <span class="n">custom_block</span><span class="p">()</span>
<span class="n">input_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<span class="n">output_data</span> <span class="o">=</span> <span class="n">custom_block</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output_data</span><span class="p">)</span>
</code></pre></div>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.4663</span><span class="p">,</span>  <span class="mf">0.9429</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2072</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7672</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.6028</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2563</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3493</span><span class="p">,</span>  <span class="mf">1.2657</span><span class="p">]])</span>
<span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0273</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1265</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2595</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.1276</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0837</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4265</span><span class="p">]],</span> <span class="n">grad_fn</span><span class="o">=&lt;</span><span class="n">AddmmBackward0</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div>
<h3 id="_9">å¤æ‚å—</h3>
<p>å¾…è¡¥å……</p>
<h2 id="_10">å‚æ•°ç®¡ç†</h2>
<p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œå‚æ•°ç®¡ç†é€šå¸¸æŒ‡çš„æ˜¯å¦‚ä½•ç®¡ç†æ¨¡å—ä¸­çš„å‚æ•°ï¼Œç¡®ä¿å®ƒä»¬åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¾—åˆ°é€‚å½“çš„æ›´æ–°ï¼Œæˆ–è€…åœ¨ä¸åŒé˜¶æ®µ(å¦‚è®­ç»ƒã€éªŒè¯ã€æµ‹è¯•)è¿›è¡Œé€‚å½“çš„æ“ä½œã€‚æœ‰æ•ˆçš„å‚æ•°ç®¡ç†æœ‰åŠ©äºæé«˜æ¨¡å‹è®­ç»ƒçš„æ•ˆç‡å’Œç¨³å®šæ€§ã€‚</p>
<h3 id="_11">å‚æ•°è®¿é—®</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">net</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>
</code></pre></div>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.1428</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.1919</span><span class="p">]],</span> <span class="n">grad_fn</span><span class="o">=&lt;</span><span class="n">AddmmBackward0</span><span class="o">&gt;</span><span class="p">)</span>

<span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">'weight'</span><span class="p">,</span> <span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.3178</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2009</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1120</span><span class="p">,</span>  <span class="mf">0.1502</span><span class="p">,</span>  <span class="mf">0.0054</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0864</span><span class="p">,</span>  <span class="mf">0.2142</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0564</span><span class="p">]])),</span> <span class="p">(</span><span class="s1">'bias'</span><span class="p">,</span> <span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mf">0.0326</span><span class="p">]))])</span>  <span class="c1">#æ‰“å°.state_dirct()</span>

<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">parameter</span><span class="o">.</span><span class="n">Parameter</span><span class="s1">'&gt; #-æ‰“å°.bias</span>
<span class="n">Parameter</span> <span class="n">containing</span><span class="p">:</span>
<span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mf">0.0326</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mf">0.0326</span><span class="p">])</span> <span class="c1">#æ‰“å°.bias.data</span>

<span class="kc">None</span>   <span class="c1">#æ‰“å°.weight.grad</span>
</code></pre></div>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä¸€æ¬¡æ€§è®¿é—®æ‰€æœ‰å‚æ•°</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">net</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">()])</span>
<span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">()])</span>
</code></pre></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="s1">'weight'</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]))</span> <span class="p">(</span><span class="s1">'bias'</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">8</span><span class="p">]))</span>
<span class="p">(</span><span class="s1">'0.weight'</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]))</span> <span class="p">(</span><span class="s1">'0.bias'</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">8</span><span class="p">]))</span> <span class="p">(</span><span class="s1">'2.weight'</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">]))</span> <span class="p">(</span><span class="s1">'2.bias'</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1</span><span class="p">]))</span>
</code></pre></div>
<p>å¦å¤–å¯ä»¥ä½¿ç”¨printæ‰“å°æ¨¡å‹çš„ç»“æ„</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="n">è¿è¡Œå¦‚ä¸‹</span><span class="err">ï¼š</span>
<span class="n">Sequential</span><span class="p">(</span>
  <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="_12">å‚æ•°åˆå§‹åŒ–</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">init_normal</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">==</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">:</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">normal_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">zeros_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span>

<span class="n">net</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init_normal</span><span class="p">)</span>
<span class="n">net</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">net</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.9942</span><span class="p">,</span> <span class="mf">0.9995</span><span class="p">,</span> <span class="mf">0.9971</span><span class="p">,</span> <span class="mf">0.9903</span><span class="p">]),</span> <span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">))</span>
</code></pre></div>
<p>ä¸Šé¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªinit_normalå‡½æ•°ï¼Œæ”¹å˜äº†weightå’Œbiasï¼Œåˆå§‹åŒ–ä¸ºæ ‡å‡†å·®0.01çš„é«˜æ–¯éšæœºå˜é‡ä¸”å°†å‚æ•°è®¾ç½®ä¸º0ã€‚</p>
<h3 id="_13">å‚æ•°ç»‘å®š</h3>
<p>æ‰€è°“å‚æ•°ç»‘å®šï¼Œå°±æ˜¯å°†å¤šä¸ªå±‚é—´ä½¿ç”¨å…±äº«å‚æ•°ï¼Œä¸‹é¢çœ‹ç¤ºä¾‹ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">shared</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">shared</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">shared</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">net</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">net</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">net</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">net</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">Sequential</span><span class="p">(</span>
  <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
  <span class="p">(</span><span class="mi">2</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
  <span class="p">(</span><span class="mi">4</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="n">ReLU</span><span class="p">()</span>
  <span class="p">(</span><span class="mi">6</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">tensor</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="n">tensor</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
</code></pre></div>
<p>å¯ä»¥çœ‹åˆ°ç¬¬2å±‚å’Œç¬¬4å±‚çš„å‚æ•°æ˜¯ä¸€æ ·çš„ï¼Œä»–ä»¬ä¸ä»…å€¼ç›¸ç­‰ï¼Œå½“æ”¹å˜å…¶ä¸­ä¸€ä¸ªå‚æ•°ï¼Œå¦ä¸€ä¸ªå‚æ•°ä¹Ÿä¼šä¸€èµ·æ”¹å˜ä¸ºä¸€æ ·çš„å€¼ã€‚</p>
<h3 id="_14">å‚æ•°å­˜å‚¨</h3>
<p>åœ¨pytorchä¸­å¯ä»¥è°ƒç”¨saveå’Œloadä¿å­˜å’Œè¯»å–æ–‡ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">import</span> <span class="n">functional</span> <span class="k">as</span> <span class="n">F</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">'x-file'</span><span class="p">)</span>

<span class="n">x2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'x-file'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>

<span class="n">æ‰“å°å¦‚ä¸‹</span><span class="err">ï¼š</span>
<span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</code></pre></div>
<p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å°†å‚æ•°è¿›è¡Œä¿å­˜ï¼Œä¸‹é¢æ˜¯ç¤ºä¾‹ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">nlp</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>

<span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s1">'nlp.params'</span><span class="p">)</span>

<span class="n">clone</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">()</span>
<span class="n">clone</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'nlp.params'</span><span class="p">))</span>
<span class="n">clone</span><span class="o">.</span><span class="n">eval</span>

<span class="n">Y_clone</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">Y_clone</span> <span class="o">==</span> <span class="n">Y</span>

<span class="n">æ‰“å°ç»“æœ</span><span class="err">ï¼š</span>

<span class="n">nlp</span><span class="p">(</span>
  <span class="p">(</span><span class="n">hidden</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="p">(</span><span class="n">output</span><span class="p">):</span> <span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.3927</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9475</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6044</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5835</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5661</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4240</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4481</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0627</span><span class="p">,</span>
          <span class="mf">0.7437</span><span class="p">,</span>  <span class="mf">1.0465</span><span class="p">,</span>  <span class="mf">0.1806</span><span class="p">,</span>  <span class="mf">0.1096</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2199</span><span class="p">,</span>  <span class="mf">1.1642</span><span class="p">,</span>  <span class="mf">1.0633</span><span class="p">,</span>  <span class="mf">1.3925</span><span class="p">,</span>
          <span class="mf">0.3849</span><span class="p">,</span>  <span class="mf">0.9443</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4781</span><span class="p">,</span>  <span class="mf">0.6522</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">1.2506</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7369</span><span class="p">,</span>  <span class="mf">0.7148</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3734</span><span class="p">,</span>  <span class="mf">1.3801</span><span class="p">,</span>  <span class="mf">0.4163</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3707</span><span class="p">,</span>  <span class="mf">0.5407</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">0.1734</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1068</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1630</span><span class="p">,</span>  <span class="mf">1.2899</span><span class="p">,</span>  <span class="mf">0.4753</span><span class="p">,</span>  <span class="mf">0.7332</span><span class="p">,</span>  <span class="mf">0.5401</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4011</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">0.5356</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5833</span><span class="p">,</span>  <span class="mf">0.8288</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5439</span><span class="p">]])</span>

<span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.6972</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0666</span><span class="p">,</span>  <span class="mf">0.5621</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4620</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1545</span><span class="p">,</span>  <span class="mf">0.2283</span><span class="p">,</span>  <span class="mf">0.1647</span><span class="p">,</span>  <span class="mf">0.1879</span><span class="p">,</span>
          <span class="mf">0.1907</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1658</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.2174</span><span class="p">,</span>  <span class="mf">0.2586</span><span class="p">,</span>  <span class="mf">0.2867</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2213</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0090</span><span class="p">,</span>  <span class="mf">0.0687</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0382</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0477</span><span class="p">,</span>
         <span class="o">-</span><span class="mf">0.3194</span><span class="p">,</span>  <span class="mf">0.1438</span><span class="p">]],</span> <span class="n">grad_fn</span><span class="o">=&lt;</span><span class="n">AddmmBackward0</span><span class="o">&gt;</span><span class="p">)</span>

<span class="n">tensor</span><span class="p">([[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
        <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]])</span>
</code></pre></div>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå…ˆè°ƒç”¨torch.save(net.state_dirc(), 'npl.params')å°†å‚æ•°ä¿å­˜èµ·æ¥ï¼Œç„¶åæ¥ç€é€šè¿‡load_state_dict(torch.load('npl.params'))ï¼Œå°†å‚æ•°è¯»å–å‡ºæ¥ã€‚é€šè¿‡ä¿å­˜å‚æ•°çš„æ–¹æ³•ï¼Œå¯ä»¥å°†è®­ç»ƒçš„å®ä¾‹åŒ–è¿›è¡Œå¤‡ä»½ï¼Œä»ä¸Šä¸€æ¬¡ä¿å­˜çš„å‚æ•°æ¥ç€è®­ç»ƒã€‚</p>
<p>æœ¬æ–‡æ¥è‡ªï¼š <a href="https://zh.d2l.ai/" title="&lt;åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  V2&gt;">&lt;åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  V2&gt;</a> çš„å­¦ä¹ ç¬”è®°</p></div>
  <div class="post-nav">
    <a class="prev" href="éæš´åŠ›æ²Ÿé€š.html">â† éæš´åŠ›æ²Ÿé€š</a>
    <a class="next" href="æ¢¯åº¦è®¡ç®—.html">æ¢¯åº¦è®¡ç®— â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

