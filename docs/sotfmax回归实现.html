<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>sotfmaxå›å½’å®ç° - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#sotfmax">ä»€ä¹ˆæ˜¯sotfmaxå›å½’</a><ul><li><a href="#softmax">softmaxå‡½æ•°</a></li><li><a href="#_1">äº¤å‰ç†µæŸå¤±å‡½æ•°</a></li></ul></li><li><a href="#softmax_1">softmaxå®ç°ç¤ºä¾‹</a><ul><li><a href="#_2">æ•°æ®è¯»å–</a></li><li><a href="#_3">å®šä¹‰æ¨¡å‹</a></li><li><a href="#_5">å®šä¹‰æŸå¤±å‡½æ•°</a></li><li><a href="#_6">åˆ†ç±»ç²¾åº¦</a></li><li><a href="#_7">è®­ç»ƒ</a></li><li><a href="#_8">é¢„æµ‹</a></li></ul></li><li><a href="#_9">æ€»ç»“</a><ul></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>sotfmaxå›å½’å®ç°</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2025-04-27
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      ai
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><h2 id="sotfmax">ä»€ä¹ˆæ˜¯sotfmaxå›å½’</h2>
<p>Softmaxå›å½’ï¼ˆSoftmax Regressionï¼‰ï¼Œä¹Ÿå«å¤šé¡¹é€»è¾‘å›å½’ï¼Œæ˜¯ä¸€ç§ç”¨äºå¤šåˆ†ç±»é—®é¢˜çš„åˆ†ç±»ç®—æ³•ã€‚å®ƒæ˜¯å¯¹é€»è¾‘å›å½’ï¼ˆLogistic Regressionï¼‰çš„ä¸€ç§æ‰©å±•ï¼Œé€‚ç”¨äºå¤„ç†è¾“å‡ºç±»åˆ«æ•°å¤§äº2çš„æƒ…å†µã€‚Softmaxå›å½’é€šè¿‡ä½¿ç”¨Softmaxå‡½æ•°æ¥å°†æ¯ä¸ªç±»åˆ«çš„è¾“å‡ºè½¬åŒ–ä¸ºä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œä½¿å¾—è¾“å‡ºå€¼èƒ½å¤Ÿè¡¨ç¤ºæ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ï¼Œå¹¶ä¸”æ‰€æœ‰ç±»åˆ«çš„æ¦‚ç‡ä¹‹å’Œä¸º1ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾æœ‰ä¸€ä¸ªåŒ…å«3ä¸ªç±»åˆ«çš„å¤šåˆ†ç±»é—®é¢˜ï¼šè‹¹æœã€é¦™è•‰ã€æ©™å­ã€‚å¯¹äºæ¯ä¸ªè¾“å…¥æ ·æœ¬ï¼ˆä¾‹å¦‚ä¸€å¼ å›¾ç‰‡ï¼‰ï¼ŒSoftmaxå›å½’æ¨¡å‹ä¼šè¾“å‡ºä¸‰ä¸ªå€¼ï¼ˆæ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ¦‚ç‡åˆ†å¸ƒã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>è‹¹æœçš„æ¦‚ç‡ï¼š0.6</li>
<li>é¦™è•‰çš„æ¦‚ç‡ï¼š0.3</li>
<li>æ©™å­çš„æ¦‚ç‡ï¼š0.1</li>
</ul>
<p>è¿™äº›æ¦‚ç‡åŠ èµ·æ¥ç­‰äº1ï¼Œæ¨¡å‹ä¼šå°†è¾“å…¥æ ·æœ¬åˆ†ç±»ä¸ºè‹¹æœï¼ˆå› ä¸ºæ¦‚ç‡æœ€å¤§ï¼‰ã€‚</p>
<h3 id="softmax">softmaxå‡½æ•°</h3>
<p>å¯¹äºæ¯ä¸ªç±»åˆ«$ k $ ï¼Œæˆ‘ä»¬ä¼šè®¡ç®—ä¸€ä¸ªå¾—åˆ†$ z_k $ï¼Œç„¶åå°†è¿™ä¸ªå¾—åˆ†è½¬åŒ–ä¸ºæ¦‚ç‡ã€‚å¾—åˆ†é€šå¸¸æ˜¯ç”±è¾“å…¥æ•°æ®$ \mathbf{x} $ä¸å¯¹åº”ç±»åˆ«çš„æƒé‡å‘é‡$ \mathbf{w}_k $ çš„çº¿æ€§ç»„åˆç»™å‡ºçš„ï¼š$ z_k = \mathbf{w}_k^T \mathbf{x} + b_k $, å…¶ä¸­ï¼Œ$ \mathbf{w}_k $ æ˜¯ç¬¬$ k$ ä¸ªç±»åˆ«çš„æƒé‡ï¼Œ$ b_k$ æ˜¯åç½®é¡¹ï¼Œ$ \mathbf{x} $ æ˜¯è¾“å…¥ç‰¹å¾å‘é‡ã€‚Softmaxå‡½æ•°ç”¨äºå°†è¿™äº›å¾—åˆ†$ z_k $è½¬æ¢æˆæ¦‚ç‡ã€‚</p>
<p>Softmaxå‡½æ•°çš„å½¢å¼å¦‚ä¸‹ï¼š$ P(y = k | \mathbf{x}) = \frac{e^{z_k}}{\sum_{j=1}^K e^{z_j}} $ ã€‚</p>
<ul>
<li>$ P(y = k | \mathbf{x}) ) æ˜¯è¾“å…¥ ( \mathbf{x} $ å±äºç±»åˆ«kçš„æ¦‚ç‡ã€‚</li>
<li>$ z_k $ æ˜¯ç±»åˆ« $ k $ çš„å¾—åˆ†ã€‚</li>
<li>$ \sum_{j=1}^K e^{z_j} $ æ˜¯æ‰€æœ‰ç±»åˆ«å¾—åˆ†çš„æŒ‡æ•°å‡½æ•°çš„å’Œï¼Œç¡®ä¿æ¦‚ç‡å’Œä¸º1ã€‚</li>
</ul>
<h3 id="_1">äº¤å‰ç†µæŸå¤±å‡½æ•°</h3>
<p>ä¸ºäº†è®­ç»ƒSoftmaxå›å½’æ¨¡å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°æ¥è¯„ä¼°æ¨¡å‹é¢„æµ‹ä¸çœŸå®æ ‡ç­¾ä¹‹é—´çš„å·®å¼‚ã€‚äº¤å‰ç†µæŸå¤±å‡½æ•°çš„å…¬å¼å¦‚ä¸‹ï¼š$ L(\theta) = - \sum_{i=1}^N \sum_{k=1}^K y_{ik} \log P(y_k = 1 | \mathbf{x}_i) $</p>
<p>å…¶ä¸­ï¼š - $ N $ æ˜¯è®­ç»ƒé›†ä¸­çš„æ ·æœ¬æ•°ã€‚ - $ y_{ik} $ æ˜¯æ ·æœ¬ $ i $æ˜¯å¦å±äºç±»åˆ« $ k $ çš„æ ‡ç­¾ï¼ˆé€šå¸¸æ˜¯1æˆ–0ï¼‰ã€‚ - $ P(y_k = 1 | \mathbf{x}_i) $ æ˜¯è¾“å…¥ $ \mathbf{x}_i $ å±äºç±»åˆ« $ k $ çš„æ¦‚ç‡ã€‚</p>
<h2 id="softmax_1">softmaxå®ç°ç¤ºä¾‹</h2>
<h3 id="_2">æ•°æ®è¯»å–</h3>
<div class="codehilite"><pre><span></span><code><span class="n">pip</span> <span class="n">install</span> <span class="n">d2l</span><span class="o">==</span><span class="mf">0.16</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">d2l</span> <span class="kn">import</span> <span class="n">torch</span> <span class="k">as</span> <span class="n">d2l</span>

<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">train_iter</span><span class="p">,</span> <span class="n">test_iter</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">load_data_fashion_mnist</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
</code></pre></div>
<p>è¿™é‡Œç›´æ¥ä½¿ç”¨äº†d2l.load_data_fashion_mnist() å‡½æ•°åŠ è½½ Fashion-MNIST æ•°æ®é›†ã€‚load_data_fashion_mnist æ˜¯ d2l åº“ä¸­çš„ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œç”¨äºåŠ è½½ Fashion-MNIST æ•°æ®é›†å¹¶è¿”å›è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ•°æ®è¿­ä»£å™¨ã€‚train_iter æ˜¯è®­ç»ƒé›†çš„è¿­ä»£å™¨ã€‚test_iter æ˜¯æµ‹è¯•é›†çš„è¿­ä»£å™¨ã€‚æ•°æ®è¿­ä»£å™¨æ˜¯ç”¨äºåœ¨æ¨¡å‹è®­ç»ƒå’Œè¯„ä¼°è¿‡ç¨‹ä¸­æ‰¹é‡åŠ è½½æ•°æ®çš„å¯¹è±¡ã€‚batch_size å‚æ•°æŒ‡å®šäº†æ¯ä¸ªæ‰¹æ¬¡åŒ…å«å¤šå°‘ä¸ªæ ·æœ¬ã€‚</p>
<p>å¯ä»¥ç”¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ‰“å°è¾“å…¥çš„æ•°æ®</p>
<div class="codehilite"><pre><span></span><code><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">train_iter</span><span class="p">:</span>
    <span class="k">break</span>
<span class="n">X_selected</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">))</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">'Label: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]]</span>
<span class="n">d2l</span><span class="o">.</span><span class="n">show_images</span><span class="p">(</span><span class="n">X_selected</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">)</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/04/wp_editor_md_c498a5a2f4ecdcf9c2c6979444cfe20b.jpg"><img alt="" src="assets/doc/04-ai/æ·±åº¦å­¦ä¹ /sotfmaxå›å½’å®ç°/images/wp_editor_md_c498a5a2f4ecdcf9c2c6979444cfe20b.jpg"/></a></p>
<h3 id="_3">å®šä¹‰æ¨¡å‹</h3>
<h4 id="sotfmax_1">sotfmaxå‡½æ•°</h4>
<p>è®¡ç®—softmaxçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¯¹æ¯ä¸ªé¡¹æ±‚å¹‚ï¼ˆä½¿ç”¨expï¼‰</li>
<li>å¯¹æ¯ä¸€è¡Œæ±‚å’Œï¼ˆå°æ‰¹é‡ä¸­æ¯ä¸ªæ ·æœ¬æ˜¯ä¸€è¡Œï¼‰ï¼Œå¾—åˆ°æ¯ä¸ªæ ·æœ¬çš„è§„èŒƒåŒ–å¸¸æ•°</li>
<li>å°†æ¯ä¸€è¡Œé™¤ä»¥å…¶è§„èŒƒåŒ–å¸¸æ•°ï¼Œç¡®ä¿ç»“æœçš„å’Œä¸º1</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">softmax</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">X_exp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">X_exp</span><span class="p">)</span>
    <span class="n">partition</span> <span class="o">=</span> <span class="n">X_exp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_exp</span> <span class="o">/</span> <span class="n">partition</span>
</code></pre></div>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c1">#ä½¿ç”¨æ­£æ€åˆ†å¸ƒç”Ÿæˆ2è¡Œ5åˆ—çš„çŸ©é˜µ</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_prob</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_prob</span><span class="p">,</span> <span class="n">X_prob</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#ç”Ÿæˆçš„æ•°æ®</span>
<span class="n">tensor</span><span class="p">([[</span> <span class="mf">0.3141</span><span class="p">,</span>  <span class="mf">0.5186</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6949</span><span class="p">,</span>  <span class="mf">0.5918</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2370</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.3814</span><span class="p">,</span>  <span class="mf">0.8092</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1959</span><span class="p">,</span>  <span class="mf">0.7489</span><span class="p">,</span>  <span class="mf">1.8790</span><span class="p">]])</span>

<span class="c1">#torch.exp(X)ï¼šå¯¹çŸ©é˜µä¸­æ¯ä¸ªæ•°æ®æ±‚e^xæŒ‡æ•°è¿ç®—åçš„ç»“æœ</span>
<span class="n">tensor</span><span class="p">([[</span><span class="mf">1.3690</span><span class="p">,</span> <span class="mf">1.6797</span><span class="p">,</span> <span class="mf">0.4991</span><span class="p">,</span> <span class="mf">1.8072</span><span class="p">,</span> <span class="mf">0.1068</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.6829</span><span class="p">,</span> <span class="mf">2.2460</span><span class="p">,</span> <span class="mf">0.8221</span><span class="p">,</span> <span class="mf">2.1146</span><span class="p">,</span> <span class="mf">6.5472</span><span class="p">]])</span>

<span class="c1">#X_exp.sum(1, keepdim=True)ï¼š å¯¹æ¯ä¸€è¡Œæ±‚å’Œ</span>
<span class="n">tensor</span><span class="p">([[</span> <span class="mf">5.4618</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">12.4129</span><span class="p">]])</span>

<span class="c1">#å°†æ¯ä¸€è¡Œé™¤ä»¥å…¶è§„èŒƒåŒ–å¸¸æ•°ï¼Œç¡®ä¿ç»“æœçš„å’Œä¸º1</span>
<span class="p">(</span><span class="n">tensor</span><span class="p">([[</span><span class="mf">0.2506</span><span class="p">,</span> <span class="mf">0.3075</span><span class="p">,</span> <span class="mf">0.0914</span><span class="p">,</span> <span class="mf">0.3309</span><span class="p">,</span> <span class="mf">0.0196</span><span class="p">],</span>
         <span class="p">[</span><span class="mf">0.0550</span><span class="p">,</span> <span class="mf">0.1809</span><span class="p">,</span> <span class="mf">0.0662</span><span class="p">,</span> <span class="mf">0.1704</span><span class="p">,</span> <span class="mf">0.5275</span><span class="p">]]),</span>

<span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]))</span>
</code></pre></div>
<h4 id="_4">æ¨¡å‹å’Œå‚æ•°</h4>
<div class="codehilite"><pre><span></span><code><span class="n">num_inputs</span> <span class="o">=</span> <span class="mi">784</span>
<span class="n">num_outputs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">num_inputs</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="n">b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_outputs</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">net</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">softmax</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div>
<p>æ¨¡å‹è¿˜æ˜¯ä½¿ç”¨çš„æ˜¯çº¿æ€§æ¨¡å¼ï¼Œåªæ˜¯åœ¨çº¿æ€§æ¨¡å‹çš„åŸºç¡€ä¸Šå†åŠ äº†ä¸€ä¸ªsoftmaxå‡½æ•°ã€‚æ¨¡å‹çš„æ•°å­¦è¡¨ç¤ºä¸ºï¼š$ \hat{y} = \text{softmax}(X W + b) $</p>
<ul>
<li>$ X \in \mathbb{R}^{n \times 784} $ æ˜¯è¾“å…¥æ ·æœ¬çŸ©é˜µï¼Œ$ n $ æ˜¯æ ·æœ¬æ•°é‡ã€‚</li>
<li>$ W \in \mathbb{R}^{784 \times 10} $ æ˜¯æƒé‡çŸ©é˜µã€‚</li>
<li>$ b \in \mathbb{R}^{10} $ æ˜¯åç½®å‘é‡ã€‚</li>
<li>$ \hat{y} \in \mathbb{R}^{n \times 10} $ æ˜¯è¾“å‡ºçŸ©é˜µï¼Œå…¶ä¸­æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªæ ·æœ¬çš„é¢„æµ‹ç±»åˆ«æ¦‚ç‡ã€‚</li>
</ul>
<p><code>softmax</code> å‡½æ•°çš„å…¬å¼ä¸ºï¼š$ \text{softmax}(z_i) = \frac{e^{z_i}}{\sum_{j} e^{z_j}} $</p>
<p>å…¶ä¸­ $ z_i $ æ˜¯æŸä¸€ç±»åˆ«çš„å¾—åˆ†ï¼Œ$ j $ éå†æ‰€æœ‰ç±»åˆ«ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ 10 ä¸ªç±»åˆ«ï¼‰ã€‚é€šè¿‡ <code>softmax</code> å‡½æ•°ï¼Œæ¯ä¸ªè¾“å‡ºéƒ½ä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªæ¦‚ç‡ï¼Œæ‰€æœ‰ç±»åˆ«çš„æ¦‚ç‡åŠ èµ·æ¥ä¸º 1ã€‚</p>
<h3 id="_5">å®šä¹‰æŸå¤±å‡½æ•°</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">cross_entropy</span><span class="p">(</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y_hat</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_hat</span><span class="p">)),</span> <span class="n">y</span><span class="p">])</span>
</code></pre></div>
<ul>
<li>y_hatï¼šè¿™æ˜¯æ¨¡å‹çš„é¢„æµ‹è¾“å‡ºï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç»è¿‡ softmax å‡½æ•°å¤„ç†çš„æ¦‚ç‡åˆ†å¸ƒã€‚y_hat çš„å½¢çŠ¶é€šå¸¸æ˜¯ (batch_size, num_classes)ï¼Œå…¶ä¸­ batch_size æ˜¯æ ·æœ¬æ•°é‡ï¼Œnum_classes æ˜¯ç±»åˆ«æ•°é‡ã€‚æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªæ ·æœ¬å¯¹å„ä¸ªç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡ã€‚</li>
<li>yï¼šè¿™æ˜¯å®é™…æ ‡ç­¾çš„ç´¢å¼•ï¼Œå½¢çŠ¶ä¸º (batch_size,)ï¼Œè¡¨ç¤ºæ¯ä¸ªæ ·æœ¬çš„çœŸå®ç±»åˆ«çš„ç´¢å¼•ã€‚</li>
<li>y_hat[range(len(y_hat)), y]ï¼šè¿™æ˜¯é€šè¿‡ y ä¸­çš„ç±»åˆ«ç´¢å¼•æå– y_hat ä¸­å¯¹åº”ç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡ã€‚range(len(y_hat)) ç”Ÿæˆä¸€ä¸ªä» 0 åˆ° batch_size-1 çš„ç´¢å¼•åºåˆ—ï¼Œè¡¨ç¤ºæ¯ä¸ªæ ·æœ¬ã€‚é€šè¿‡ y ç´¢å¼•ï¼Œè·å–æ¯ä¸ªæ ·æœ¬å¯¹åº”ç±»åˆ«çš„æ¦‚ç‡å€¼ã€‚</li>
<li>torch.log(...)ï¼šå¯¹æå–çš„é¢„æµ‹æ¦‚ç‡å–å¯¹æ•°ã€‚äº¤å‰ç†µæŸå¤±å‡½æ•°ä¸­æœ‰ä¸€ä¸ª log æ“ä½œï¼Œå®ƒè¡¡é‡äº†é¢„æµ‹æ¦‚ç‡å’ŒçœŸå®æ ‡ç­¾ä¹‹é—´çš„å·®å¼‚ã€‚</li>
<li>è´Ÿå·ï¼šäº¤å‰ç†µæ˜¯é€šè¿‡è´Ÿå¯¹æ•°ä¼¼ç„¶ï¼ˆnegative log-likelihoodï¼‰è®¡ç®—çš„ï¼Œå› æ­¤éœ€è¦å¯¹ç»“æœå–è´Ÿã€‚</li>
</ul>
<p>æŸå¤±å‡½æ•°çš„å…¬å¼ä¸ºï¼š$ L = - \frac{1}{n} \sum_{i=1}^{n} \log(\hat{y}_{i, y_i}) $, é€šè¿‡å¯¹æ¯ä¸ªæ ·æœ¬çš„é¢„æµ‹æ¦‚ç‡å–å¯¹æ•°ï¼Œå¹¶å¯¹æ‰€æœ‰æ ·æœ¬çš„å¯¹æ•°æŸå¤±æ±‚å’Œå†å–è´Ÿå€¼ã€‚</p>
<h3 id="_6">åˆ†ç±»ç²¾åº¦</h3>
<p>åˆ†ç±»ç²¾åº¦= æ ·æœ¬é¢„æµ‹æ­£ç¡®æ•°é‡é™¤ä»¥æ ·æœ¬æ€»æ•°ï¼ˆlen(y)ï¼‰ã€‚ ä¹Ÿå¯ä»¥ç†è§£æ˜¯é¢„æµ‹å¯¹çš„æ¦‚ç‡ï¼Œæ¯”å¦‚è¾“å…¥æ ·æœ¬å›¾ç‰‡è¯†åˆ«æ­£ç¡®æ•°ä¸º1ï¼Œæ€»æ ·æœ¬æ•°2æ—¶ï¼Œç²¾åº¦ä¸º 1/2 = 0.5ã€‚</p>
<p>å…ˆçœ‹çœ‹ä¾‹å­ï¼Œy_hatæ¨¡å‹çš„é¢„æµ‹è¾“å‡ºï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªäºŒç»´çŸ©é˜µï¼Œå½¢çŠ¶ä¸º (æ ·æœ¬æ•°, ç±»åˆ«æ•°)ã€‚ä¾‹å¦‚ï¼Œ2ä¸ªæ ·æœ¬ï¼ˆè¾“å…¥çš„å›¾ç‰‡ï¼‰3ä¸ªç±»åˆ«(çŒ«ã€ç‹—ã€çŒª)çš„è¾“å‡ºå¯èƒ½æ˜¯ [[0.1, 0.2, 0.7], [0.3, 0.4, 0.3]]ï¼Œå³æ¯ä¸ªæ ·æœ¬å¯¹åº”è¾“å‡ºçš„ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œæ ·æœ¬1å¯¹åº”çš„æ¦‚ç‡åˆ†å¸ƒ[0.1, 0.2, 0.7]ï¼Œæ ·æœ¬2å¯¹åº”çš„æ¦‚ç‡åˆ†å¸ƒæ˜¯[0.3, 0.4, 0.3]ï¼Œè€ŒçœŸå®çš„æ ‡ç­¾yæ˜¯ä¸€ä¸ªä¸€ç»´å‘é‡ï¼Œæ¯ä¸ªå…ƒç´ è¡¨ç¤ºå¯¹åº”æ ·æœ¬çš„æ­£ç¡®ç±»åˆ«ç´¢å¼•ï¼Œå¦‚[2, 1]ï¼Œå…¶ä¸­2ä»£è¡¨çš„æ˜¯ç‹—ï¼Œ1ä»£è¡¨çŒ«ã€‚</p>
<p>é‚£y_hatå’Œyæ€ä¹ˆåšæ¯”è¾ƒå’Œè½¬æ¢äº†ï¼Ÿ è§£å†³çš„åŠæ³•å°±æ˜¯ï¼Œæˆ‘ä»¬å–æ¯ä¸ªæ ·æœ¬æ¦‚ç‡åˆ†å¸ƒä¸­æœ€å¤§æ¦‚ç‡çš„ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ argmax(axis=1) æ²¿ç€è¡Œæ–¹å‘ï¼ˆå³æ¯ä¸ªæ ·æœ¬ï¼‰æ‰¾åˆ°æ¦‚ç‡æœ€å¤§çš„ç±»åˆ«ç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œ[[0.1, 0.2, 0.7], [0.3, 0.4, 0.3]] ä¼šå¾—åˆ° [2, 1]ï¼Œ å³ç¬¬ä¸€è¡Œæœ€å¤§æ˜¯0.7ï¼Œç´¢å¼•ä½ç½®æ˜¯2ï¼Œç¬¬äºŒè¡Œæœ€å¤§æ˜¯0.4ï¼Œçº§ç´¢å¼•æ˜¯1ã€‚æœ‰äº†è¿™æ ·çš„ç»“æœï¼Œå°±å¯ä»¥y_hatå’Œyåšæ¯”è¾ƒäº†ï¼Œæ¯”å¦‚y=[2,1], é‚£ä¹ˆy_hatè¾“å‡ºç»“æœæ˜¯[2,1]ï¼Œé‚£ä¹ˆè¡¨ç¤ºå…¨éƒ¨é¢„æµ‹å¯¹ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_hat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">y_hat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y_hat</span> <span class="o">=</span> <span class="n">y_hat</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">#y_hatå°†è¾“å‡ºç´¢å¼•å¦‚[2,1],ä¸‹é¢ç»“ç®—çš„æ˜¯y_hatå’Œyè¿›è¡Œæ¯”è¾ƒï¼Œè¿”å›æ­£ç¡®çš„ä¸ªæ•°ã€‚</span>
    <span class="n">cmp</span> <span class="o">=</span> <span class="n">y_hat</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="n">y</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">cmp</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</code></pre></div>
<p>å› æ­¤ä¸Šé¢è¿™ä¸ªå‡½æ•°ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯æ­£ç¡®çš„ä¸ªæ•°ï¼Œæ¯”å¦‚y_hat = [[0.1, 0.2, 0.7], [0.3, 0.4, 0.3]],yæ˜¯[2,2]ç»è¿‡accuracyå‡½æ•°å¤„ç†åï¼Œè¿”å›çš„æ˜¯ç»“æœæ˜¯1ï¼Œ å› ä¸ºy_hat = y_hat.argmax(axis=1)è®¡ç®—åï¼Œè¿”å›çš„æ˜¯[2,1]ï¼Œä¸å®é™…çš„æ ‡ç­¾[2,2]æœ‰ä¸€ä¸ªä¸å¯¹ï¼Œå³ç¬¬äºŒä¸ªæ ·æœ¬é¢„æµ‹é”™äº†ã€‚é‚£ä¹ˆæœ€ç»ˆçš„åˆ†ç±»ç²¾åº¦å°±ç­‰äº1/2 = 0.5ã€‚</p>
<h3 id="_7">è®­ç»ƒ</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">train_epoch_ch3</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">train_iter</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">updater</span><span class="p">):</span>
    <span class="c1"># å°†æ¨¡å‹è®¾ç½®ä¸ºè®­ç»ƒæ¨¡å¼</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
        <span class="n">net</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="c1"># è®­ç»ƒæŸå¤±æ€»å’Œã€è®­ç»ƒå‡†ç¡®åº¦æ€»å’Œã€æ ·æœ¬æ•°</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">Accumulator</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">train_iter</span><span class="p">:</span>
        <span class="c1"># è®¡ç®—æ¢¯åº¦å¹¶æ›´æ–°å‚æ•°</span>
        <span class="n">y_hat</span> <span class="o">=</span> <span class="n">net</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">loss</span><span class="p">(</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">updater</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">):</span>
            <span class="c1"># ä½¿ç”¨PyTorchå†…ç½®çš„ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•°</span>
            <span class="n">updater</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">l</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="n">updater</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ä½¿ç”¨å®šåˆ¶çš„ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•°</span>
            <span class="n">l</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="n">updater</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">metric</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">y_hat</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">y</span><span class="o">.</span><span class="n">numel</span><span class="p">())</span>
    <span class="c1"># è¿”å›è®­ç»ƒæŸå¤±å’Œè®­ç»ƒç²¾åº¦</span>
    <span class="k">return</span> <span class="n">metric</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">metric</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">metric</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">metric</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">train_ch3</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">train_iter</span><span class="p">,</span> <span class="n">test_iter</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">,</span> <span class="n">updater</span><span class="p">):</span>
    <span class="n">animator</span> <span class="o">=</span> <span class="n">Animator</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'epoch'</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span>
                        <span class="n">legend</span><span class="o">=</span><span class="p">[</span><span class="s1">'train loss'</span><span class="p">,</span> <span class="s1">'train acc'</span><span class="p">,</span> <span class="s1">'test acc'</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
        <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">train_epoch_ch3</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">train_iter</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">updater</span><span class="p">)</span>
        <span class="o">//</span><span class="n">è¿”å›è®­ç»ƒæŸå¤±å’Œè®­ç»ƒç²¾åº¦</span>
        <span class="n">test_acc</span> <span class="o">=</span> <span class="n">evaluate_accuracy</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">test_iter</span><span class="p">)</span>
        <span class="o">//</span><span class="n">è¿”å›çš„æ˜¯æµ‹è¯•ç²¾åº¦</span>
        <span class="n">animator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">train_metrics</span> <span class="o">+</span> <span class="p">(</span><span class="n">test_acc</span><span class="p">,))</span>
        <span class="o">//</span><span class="n">å°†å…¶ç»˜åˆ¶åˆ°å›¾åƒä¸Š</span><span class="err">ã€‚</span>
    <span class="n">train_loss</span><span class="p">,</span> <span class="n">train_acc</span> <span class="o">=</span> <span class="n">train_metrics</span>
    <span class="k">assert</span> <span class="n">train_loss</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">train_loss</span>
    <span class="k">assert</span> <span class="n">train_acc</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">train_acc</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">train_acc</span>
    <span class="k">assert</span> <span class="n">test_acc</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">test_acc</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">test_acc</span>

<span class="n">lr</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="k">def</span> <span class="nf">updater</span><span class="p">(</span><span class="n">batch_size</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">d2l</span><span class="o">.</span><span class="n">sgd</span><span class="p">([</span><span class="n">W</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="n">lr</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>

<span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">train_ch3</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">train_iter</span><span class="p">,</span> <span class="n">test_iter</span><span class="p">,</span> <span class="n">cross_entropy</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">,</span> <span class="n">updater</span><span class="p">)</span>
</code></pre></div>
<p>ä¸‹é¢æ˜¯è®­ç»ƒçš„è¿‡ç¨‹æ˜¾ç¤ºï¼š</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/04/wp_editor_md_3a3c450df8d8bfcc93b0654e2265e52c.jpg"><img alt="" src="assets/doc/04-ai/æ·±åº¦å­¦ä¹ /sotfmaxå›å½’å®ç°/images/wp_editor_md_3a3c450df8d8bfcc93b0654e2265e52c.jpg"/></a></p>
<ul>
<li>train loss: è®­ç»ƒæŸå¤±ï¼Œä¹Ÿå°±æ˜¯æŸå¤±å‡½æ•°çš„ç»“æœã€‚æ˜¯æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„å¹³å‡æŸå¤±å€¼ï¼Œé€šå¸¸ä½¿ç”¨æŸå¤±å‡½æ•°æ¥è¡¡é‡ã€‚ä¾‹å¦‚ï¼Œå¸¸ç”¨çš„äº¤å‰ç†µæŸå¤±ï¼ˆcross-entropy lossï¼‰æˆ–å‡æ–¹è¯¯å·®ï¼ˆmean squared errorï¼‰ã€‚æŸå¤±è¶Šå°ï¼Œè¯´æ˜æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„è¡¨ç°è¶Šå¥½ã€‚å®ƒåæ˜ äº†æ¨¡å‹é¢„æµ‹å€¼ä¸çœŸå®æ ‡ç­¾ä¹‹é—´çš„å·®è·ã€‚</li>
<li>train acc: Training Accuracy, è®­ç»ƒç²¾åº¦ã€‚æ˜¯æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„æ­£ç¡®é¢„æµ‹çš„æ¯”ä¾‹ã€‚å®ƒé€šè¿‡æ¯”è¾ƒæ¨¡å‹çš„é¢„æµ‹ç»“æœå’ŒçœŸå®æ ‡ç­¾æ¥è®¡ç®—ã€‚è®­ç»ƒç²¾åº¦=æ­£ç¡®é¢„æµ‹çš„æ ·æœ¬æ•°é‡/æ€»æ ·æœ¬æ•°é‡ã€‚è®­ç»ƒå‡†ç¡®åº¦è¶Šé«˜ï¼Œè¯´æ˜æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„æ‹Ÿåˆç¨‹åº¦è¶Šå¥½ã€‚è®­ç»ƒå‡†ç¡®åº¦åæ˜ äº†æ¨¡å‹å¯¹è®­ç»ƒé›†çš„å­¦ä¹ èƒ½åŠ›ã€‚</li>
<li>test acc: Test Accuracy,æµ‹è¯•ç²¾åº¦ã€‚æ˜¯æŒ‡æ¨¡å‹åœ¨æœªè§è¿‡çš„æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®åº¦ã€‚å®ƒä¸è®­ç»ƒå‡†ç¡®åº¦ä¸åŒï¼Œæµ‹è¯•é›†ç”¨æ¥è¯„ä¼°æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚æµ‹è¯•å‡†ç¡®åº¦åæ˜ äº†æ¨¡å‹å¯¹æ–°æ•°æ®çš„é¢„æµ‹èƒ½åŠ›ã€‚å¦‚æœæµ‹è¯•å‡†ç¡®åº¦é«˜ï¼Œè¯´æ˜æ¨¡å‹ä¸ä»…åœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°å¥½ï¼Œè€Œä¸”å…·æœ‰è¾ƒå¼ºçš„æ³›åŒ–èƒ½åŠ›ï¼Œèƒ½å¤Ÿé€‚åº”æœªè§è¿‡çš„æ•°æ®ã€‚</li>
</ul>
<h3 id="_8">é¢„æµ‹</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">predict_ch3</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">test_iter</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">test_iter</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">trues</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">get_fashion_mnist_labels</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">d2l</span><span class="o">.</span><span class="n">get_fashion_mnist_labels</span><span class="p">(</span><span class="n">net</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">true</span> <span class="o">+</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span> <span class="o">+</span> <span class="n">pred</span> <span class="k">for</span> <span class="n">true</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">trues</span><span class="p">,</span> <span class="n">preds</span><span class="p">)]</span>
    <span class="n">d2l</span><span class="o">.</span><span class="n">show_images</span><span class="p">(</span>
        <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">])</span>

<span class="n">predict_ch3</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">test_iter</span><span class="p">)</span>
</code></pre></div>
<p>ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œæ¥é¢„æµ‹å®é™…çš„æ•ˆæœï¼š</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/04/wp_editor_md_613f320a2cdf3039cec189d756c20eb9.jpg"><img alt="" src="assets/doc/04-ai/æ·±åº¦å­¦ä¹ /sotfmaxå›å½’å®ç°/images/wp_editor_md_613f320a2cdf3039cec189d756c20eb9.jpg"/></a></p>
<h2 id="_9">æ€»ç»“</h2>
<div class="codehilite"><pre><span></span><code><span class="n">ä¸€</span><span class="err">ã€</span><span class="n">å…¬å¼å’Œä»£ç </span>

<span class="n">å…¬å¼</span><span class="err">ï¼š</span><span class="n">y</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">WX</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
<span class="n">ä»£ç å®ç°</span><span class="err">ï¼š</span><span class="n">y</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>

<span class="n">äºŒ</span><span class="err">ã€</span><span class="n">è¾“å…¥å’Œè¾“å‡ºç¤ºä¾‹</span>

<span class="n">è¾“å…¥</span><span class="err">ï¼š</span>
<span class="n">X</span><span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">])</span><span class="o">--&gt;</span><span class="n">X</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">256</span><span class="p">,</span> <span class="mi">784</span><span class="p">])</span>
<span class="n">ç”±äºWXè¦æ»¡è¶³çŸ©é˜µä¹˜</span><span class="err">ï¼Œ</span><span class="n">æ‰€ä»¥è¦æŠŠXåšå¤„ç†X</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="n">W</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">784</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">b</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">10</span><span class="p">])</span>

<span class="n">è¾“å‡º</span><span class="p">:</span>

<span class="n">y_hat</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">256</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>   <span class="o">--&gt;</span><span class="p">([</span><span class="mi">256</span><span class="p">,</span><span class="mi">784</span><span class="p">])</span><span class="o">*</span><span class="p">([</span><span class="mi">784</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span> <span class="o">=</span> <span class="p">([</span><span class="mi">256</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span><span class="n">çŸ©é˜µç›¸ä¹˜</span>

<span class="n">ä¸‹é¢æ˜¯æ‰“å°ç¬¬ä¸€è¡Œçš„ç»“æœ</span><span class="err">ï¼Œ</span><span class="n">ä¹Ÿå°±æ˜¯å¯¹åº”è¾“å…¥ç¬¬ä¸€ä¸ªæ ·æœ¬çš„é¢„æµ‹ç»“æœ</span><span class="err">ã€‚</span> <span class="n">æœ€åä¸º0</span><span class="mf">.99613</span><span class="err">ï¼Œ</span><span class="n">å¦‚æœæœ€åä¸€é¡¹æ˜¯ä»£è¡¨æ˜¯shirt</span><span class="err">ï¼Œ</span><span class="n">ä½†æ˜¯è¡¨ç¤ºç¬¬ä¸€ä¸ªæ ·æœ¬å°±æ˜¯shirt</span><span class="err">ã€‚</span>
<span class="n">tensor</span><span class="p">([</span><span class="mf">4.8291e-06</span><span class="p">,</span> <span class="mf">1.2489e-07</span><span class="p">,</span> <span class="mf">3.7127e-06</span><span class="p">,</span> <span class="mf">2.1127e-07</span><span class="p">,</span> <span class="mf">1.3334e-06</span><span class="p">,</span> <span class="mf">2.6440e-03</span><span class="p">,</span>
        <span class="mf">1.9091e-05</span><span class="p">,</span> <span class="mf">8.7211e-04</span><span class="p">,</span> <span class="mf">3.2460e-04</span><span class="p">,</span> <span class="mf">9.9613e-01</span><span class="p">])</span>
</code></pre></div>
<p>æœ¬æ–‡æ¥è‡ªï¼š <a href="https://zh.d2l.ai/" title="&lt;åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  V2&gt;">&lt;åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  V2&gt;</a> çš„å­¦ä¹ ç¬”è®°</p></div>
  <div class="post-nav">
    <a class="prev" href="æ¿€æ´»å‡½æ•°.html">â† æ¿€æ´»å‡½æ•°</a>
    <a class="next" href="çº¿æ€§å›å½’å®ç°.html">çº¿æ€§å›å½’å®ç° â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

