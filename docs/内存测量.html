<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>å†…å­˜æµ‹é‡ - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#_1">ç³»ç»Ÿå ç”¨å†…å­˜</a><ul><li><a href="#free">free</a></li><li><a href="#procmeminfo">/proc/meminfo</a></li><li><a href="#proczoneinfo">/proc/zoneinfo</a></li></ul></li><li><a href="#_2">ç”¨æˆ·è¿›ç¨‹å ç”¨å†…å­˜</a><ul><li><a href="#procpidstatus">/proc/pid/status</a></li><li><a href="#procpidsmaps">/proc/pid/smaps</a></li><li><a href="#pmap-x-pid">pmap -x [pid]</a></li></ul></li><li><a href="#_3">å†…æ ¸å ç”¨å†…å­˜</a><ul><li><a href="#procmeminfo_1">/proc/meminfo</a></li><li><a href="#procpagetypeinfo">/proc/pagetypeinfo</a></li></ul></li><li><a href="#_4">å°ç»“</a><ul><li><a href="#_5">å†…å­˜ç»Ÿè®¡</a></li><li><a href="#_6">æŸ¥è¯¢å ç”¨è¾ƒå¤šå†…å­˜çš„è¿›ç¨‹</a></li><li><a href="#_7">è¿›ç¨‹å†…å­˜ç›‘æµ‹</a></li></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>å†…å­˜æµ‹é‡</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2023-08-27
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      linux
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><h2 id="_1">ç³»ç»Ÿå ç”¨å†…å­˜</h2>
<h3 id="free">free</h3>
<h4 id="free_1">æ—§ç‰ˆæœ¬free</h4>
<div class="codehilite"><pre><span></span><code><span class="n">$</span><span class="w"> </span><span class="n">free</span>
<span class="w">             </span><span class="n">total</span><span class="w">       </span><span class="n">used</span><span class="w">       </span><span class="n">free</span><span class="w">     </span><span class="n">shared</span><span class="w">    </span><span class="n">buffers</span><span class="w">     </span><span class="n">cached</span>
<span class="nl">Mem</span><span class="p">:</span><span class="w">      </span><span class="mi">65960636</span><span class="w">   </span><span class="mi">63933576</span><span class="w">   </span><span class="mi">2027060</span><span class="w">   </span><span class="mi">73392</span><span class="w">    </span><span class="mi">1602076</span><span class="w">   </span><span class="mi">32628548</span>
<span class="o">-/+</span><span class="w"> </span><span class="n">buffers</span><span class="o">/</span><span class="n">cache</span><span class="o">:</span><span class="w">       </span><span class="mi">29702952</span><span class="w">   </span><span class="mi">36257684</span>
<span class="nl">Swap</span><span class="p">:</span><span class="w">            </span><span class="mi">0</span><span class="w">          </span><span class="mi">0</span><span class="w">          </span><span class="mi">0</span>
</code></pre></div>
<p>ï¼ˆ1ï¼‰ç¬¬ä¸€è¡ŒMemï¼šå†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œé»˜è®¤å•ä½æ˜¯Kbã€‚ - total:ç³»ç»Ÿæ€»å…±çš„å†…å­˜ã€‚total=used+free - usedï¼šå·²ç»è¢«ä½¿ç”¨çš„å†…å­˜ã€‚ - freeï¼šå‰©ä½™è¿˜æ²¡æœ‰è¢«ä½¿ç”¨çš„ç‰©ç†å†…å­˜ã€‚ - shared: å¤šä¸ªè¿›ç¨‹å…±äº«çš„å†…å­˜ã€‚ - buffers:å—è®¾å¤‡æ‰€å çš„ç¼“å­˜é¡µï¼ŒåŒ…æ‹¬ç›´æ¥è¯»å†™å—è®¾å¤‡ã€æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®ï¼ˆmetadataï¼‰ã€SupperBlockæ‰€ä½¿ç”¨çš„ç¼“å­˜é¡µç­‰ã€‚ - cachedï¼šæ™®é€šæ–‡ä»¶æ•°æ®æ‰€å ç”¨çš„ç¼“å­˜é¡µã€‚ ï¼ˆ2ï¼‰ç¬¬äºŒè¡Œ-/+ buffers/cache:ç‰©ç†å†…å­˜ç¼“å­˜ç»Ÿè®¡ã€‚ -buffers/cache(usedåˆ—):29702952ï¼Œè¢«ç¨‹åºæ­£åœ¨ä½¿ç”¨çš„ç¼“å­˜å†…å­˜ï¼Œç­‰äºused-buffers-cached +buffers/cache(usedåˆ—):36257684ï¼Œè¿˜å¯ä»¥æŒªç”¨ä½¿ç”¨çš„ç¼“å­˜å†…å­˜ï¼Œç­‰äºfree+buffers+cached ï¼ˆ3ï¼‰ç¬¬ä¸‰è¡Œï¼šäº¤æ¢åŒºç©ºé—´çš„ç»Ÿè®¡ã€‚</p>
<h4 id="free_2">æ–°ç‰ˆæœ¬free</h4>
<div class="codehilite"><pre><span></span><code><span class="n">root</span><span class="err">@</span><span class="n">TinaLinux</span><span class="o">:/</span><span class="err">#</span><span class="w"> </span><span class="n">free</span>
<span class="w">              </span><span class="n">total</span><span class="w">        </span><span class="n">used</span><span class="w">        </span><span class="n">free</span><span class="w">      </span><span class="n">shared</span><span class="w">  </span><span class="n">buff</span><span class="o">/</span><span class="n">cache</span><span class="w">   </span><span class="n">available</span>
<span class="nl">Mem</span><span class="p">:</span><span class="w">        </span><span class="mi">2022788</span><span class="w">      </span><span class="mi">98876</span><span class="w">     </span><span class="mi">1818264</span><span class="w">    </span><span class="mi">84</span><span class="w">      </span><span class="mi">105648</span><span class="w">     </span><span class="mi">1898696</span>
<span class="nl">Swap</span><span class="p">:</span><span class="w">           </span><span class="mi">0</span><span class="w">           </span><span class="mi">0</span><span class="w">           </span><span class="mi">0</span>
</code></pre></div>
<p>ç¬¬ä¸€è¡ŒMemï¼šå†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œé»˜è®¤å•ä½æ˜¯Kbã€‚ ç¬¬äºŒè¡ŒSwapï¼šäº¤æ¢ç©ºé—´çš„ä½¿ç”¨æƒ…å†µã€‚ - total:ç³»ç»Ÿæ€»å…±çš„å†…å­˜ã€‚total = used+free+buff/cache - usedï¼šå·²ç»è¢«ä½¿ç”¨çš„å†…å­˜ã€‚ - freeï¼šå‰©ä½™è¿˜æ²¡æœ‰è¢«ä½¿ç”¨çš„ç‰©ç†å†…å­˜ã€‚ - shared: å¤šä¸ªè¿›ç¨‹å…±äº«çš„å†…å­˜ã€‚ - buff:å—è®¾å¤‡æ‰€å çš„ç¼“å­˜é¡µã€‚ - cacheï¼šæ™®é€šæ–‡ä»¶æ•°æ®æ‰€å ç”¨çš„ç¼“å­˜é¡µã€‚ - availableï¼šè¿˜å¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ã€‚available=free+å¯å›æ”¶åˆ©ç”¨çš„buff/cache åœ¨ç³»ç»Ÿä¸­availableæ‰æ˜¯ç³»ç»ŸçœŸæ­£å¯è¿˜èƒ½ç”³è¯·åˆ°çš„å†…å­˜ã€‚</p>
<h3 id="procmeminfo">/proc/meminfo</h3>
<div class="codehilite"><pre><span></span><code><span class="cp"># cat /proc/meminfo </span>
<span class="nl">MemTotal</span><span class="p">:</span><span class="w">        </span><span class="mi">2022788</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">MemFree</span><span class="p">:</span><span class="w">         </span><span class="mi">1818376</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">MemAvailable</span><span class="p">:</span><span class="w">    </span><span class="mi">1898700</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Buffers</span><span class="p">:</span><span class="w">             </span><span class="mi">436</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Cached</span><span class="p">:</span><span class="w">            </span><span class="mi">20352</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">SwapCached</span><span class="p">:</span><span class="w">            </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Active</span><span class="p">:</span><span class="w">             </span><span class="mi">5104</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Inactive</span><span class="p">:</span><span class="w">          </span><span class="mi">31432</span><span class="w"> </span><span class="n">kB</span>
<span class="n">Active</span><span class="p">(</span><span class="n">anon</span><span class="p">)</span><span class="o">:</span><span class="w">        </span><span class="mi">116</span><span class="w"> </span><span class="n">kB</span>
<span class="n">Inactive</span><span class="p">(</span><span class="n">anon</span><span class="p">)</span><span class="o">:</span><span class="w">    </span><span class="mi">15716</span><span class="w"> </span><span class="n">kB</span>
<span class="n">Active</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">:</span><span class="w">       </span><span class="mi">4988</span><span class="w"> </span><span class="n">kB</span>
<span class="n">Inactive</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">:</span><span class="w">    </span><span class="mi">15716</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Unevictable</span><span class="p">:</span><span class="w">           </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Mlocked</span><span class="p">:</span><span class="w">               </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">SwapTotal</span><span class="p">:</span><span class="w">             </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">SwapFree</span><span class="p">:</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Dirty</span><span class="p">:</span><span class="w">                 </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Writeback</span><span class="p">:</span><span class="w">             </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">AnonPages</span><span class="p">:</span><span class="w">         </span><span class="mi">15792</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Mapped</span><span class="p">:</span><span class="w">             </span><span class="mi">5156</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Shmem</span><span class="p">:</span><span class="w">                </span><span class="mi">84</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">KReclaimable</span><span class="p">:</span><span class="w">      </span><span class="mi">84752</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Slab</span><span class="p">:</span><span class="w">             </span><span class="mi">148640</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">SReclaimable</span><span class="p">:</span><span class="w">      </span><span class="mi">84752</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">SUnreclaim</span><span class="p">:</span><span class="w">        </span><span class="mi">63888</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">KernelStack</span><span class="p">:</span><span class="w">        </span><span class="mi">2144</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">PageTables</span><span class="p">:</span><span class="w">          </span><span class="mi">620</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">NFS_Unstable</span><span class="p">:</span><span class="w">          </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Bounce</span><span class="p">:</span><span class="w">                </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">WritebackTmp</span><span class="p">:</span><span class="w">          </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">CommitLimit</span><span class="p">:</span><span class="w">     </span><span class="mi">1011392</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Committed_AS</span><span class="p">:</span><span class="w">      </span><span class="mi">93972</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmallocTotal</span><span class="p">:</span><span class="w">   </span><span class="mi">259653632</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmallocUsed</span><span class="p">:</span><span class="w">        </span><span class="mi">4820</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmallocChunk</span><span class="p">:</span><span class="w">          </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Percpu</span><span class="p">:</span><span class="w">              </span><span class="mi">768</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">CmaTotal</span><span class="p">:</span><span class="w">          </span><span class="mi">65536</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">CmaFree</span><span class="p">:</span><span class="w">           </span><span class="mi">48764</span><span class="w"> </span><span class="n">kB</span>
</code></pre></div>
<ul>
<li>MemTotal: ç³»ç»Ÿå½“å‰å¯ç”¨ç‰©ç†å†…å­˜æ€»é‡ï¼Œé™¤å»äº†reservedçš„å†…å­˜ã€‚</li>
<li>MemFree:ç³»ç»Ÿå½“å‰å‰©ä½™ç©ºé—²ç‰©ç†å†…å­˜ã€‚</li>
<li>MemAvailable:ç³»ç»Ÿä¸­å¯ä½¿ç”¨çš„ç‰©ç†å†…å­˜ï¼ŒåŒ…å«äº†å¯ä»¥å›æ”¶çš„å†…å­˜ã€‚</li>
<li>Buffers:å—è®¾å¤‡ç¼“å­˜ã€‚</li>
<li>Cached:æ™®é€šæ–‡ä»¶é¡µçš„ç¼“å­˜ã€‚</li>
<li>SwapCached:ç³»ç»Ÿæœ‰å¤šå°‘åŒ¿åé¡µé¢æ›¾ç»è¢«äº¤æ¢åˆ°äº¤æ¢åŒºè¿‡ã€‚</li>
<li>Active:æ´»åŠ¨çš„åŒ¿åé¡µé¢å’Œæ´»åŠ¨çš„æ–‡ä»¶æ˜ å°„é¡µé¢å†…å­˜ï¼Œ=Active(anon)+Active(file)ã€‚</li>
<li>Inactive:ä¸æ´»è·ƒçš„åŒ¿åé¡µé¢å’Œæ–‡ä»¶é¡µé¢ã€‚=Inactive(anon)+Inactive(file)ã€‚</li>
<li>Active(anon):æ´»è·ƒçš„åŒ¿åé¡µé¢ã€‚</li>
<li>Inactive(anon): ä¸æ´»è·ƒçš„åŒ¿åé¡µé¢ã€‚</li>
<li>Active(file):æ´»è·ƒçš„æ–‡ä»¶é¡µé¢ã€‚</li>
<li>Inactive(file): ä¸æ´»è·ƒçš„æ–‡ä»¶é¡µé¢ã€‚</li>
<li>Unevictable: ä¸èƒ½å›æ”¶çš„é¡µé¢ï¼ˆLRU_UNEVICTABLEï¼‰ã€‚</li>
<li>Mlocked: ä¸èƒ½è¢«äº¤æ¢ï¼ˆswapï¼‰å‡ºå»çš„é¡µé¢ã€‚</li>
<li>SwapTotal:äº¤æ¢åˆ†åŒºçš„å¤§å°ã€‚</li>
<li>SwapFree: äº¤æ¢åˆ†åŒºç©ºé—²çš„å¤§å°ã€‚</li>
<li>Dirty: è„é¡µçš„æ•°é‡ã€‚</li>
<li>Writeback: æ­£åœ¨å›å†™çš„ä¹Ÿä¹°ä½ æ•°é‡ã€‚</li>
<li>AnonPages:æœ‰åå‘æ˜ å°„çš„é¡µé¢ï¼Œé€šå¸¸æ˜¯åŒ¿åé¡µé¢å¹¶ä¸”è¢«æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´çš„ã€‚</li>
<li>Mapped:æ‰€æœ‰æ˜ å°„åˆ°ç”¨æˆ·åœ°å€ç©ºé—´çš„å†…å®¹ç¼“å­˜é¡µé¢ã€‚</li>
<li>Shmem: å…±äº«å†…å­˜ï¼ˆtmpfsäº‹å…ˆçš„shmem/devtmpfsç­‰ï¼‰ã€‚</li>
<li>KReclaimable: å†…æ ¸å¯å›æ”¶å†…å­˜ï¼ŒåŒ…æ‹¬å¯å›æ”¶çš„slabå’Œå…¶ä»–å¯å›æ”¶çš„å†…æ ¸é¡µé¢ã€‚</li>
<li>Slab:æ‰€æœ‰slabé¡µé¢ï¼ŒåŒ…æ‹¬å¯å›æ”¶å’Œä¸å¯å›æ”¶ã€‚</li>
<li>SReclaimable:å¯å›æ”¶çš„slabé¡µé¢ã€‚</li>
<li>SUnreclaim: ä¸å¯å›æ”¶çš„slabé¡µé¢ã€‚</li>
<li>KernelStack: æ‰€æœ‰è¿›ç¨‹çš„å†…æ ¸æ ˆæ€»å¤§å°ã€‚</li>
<li>PageTables: ç”¨äºå­˜å‚¨é¡µè¡¨çš„é¡µé¢æ•°é‡ã€‚</li>
<li>NFS_Unstable:NFSä¸­ï¼Œå‘ç»™æœåŠ¡å™¨ä½†æ˜¯è¿˜æ²¡æœ‰å†™å…¥ç£ç›˜çš„é¡µé¢ã€‚</li>
<li>Bounce: é’ˆå¯¹æ™ºèƒ½è®¿é—®ä½ç«¯å†…å­˜çš„è®¾å¤‡ï¼Œå½“DMAåˆ†é…åˆ°é«˜ç«¯å†…å­˜æ—¶ï¼Œåˆ†é…è¦ç»™ä½ç«¯ä¸´æ—¶bufferç”¨äºå¤åˆ¶å¤„ç†ã€‚</li>
<li>WritebackTmp:å›å†™è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸´æ—¶ç¼“å­˜</li>
<li>CommitLimit:</li>
<li>Committed_AS:</li>
<li>VmallocTotal:vmallocåŒºåŸŸæ€»å¤§å°ã€‚</li>
<li>VmallocUsed:vmallocåŒºåŸŸä½¿ç”¨çš„å†…å­˜å¤§å°ã€‚</li>
<li>VmallocChunk:vmallocå¯ç”¨çš„è¿ç»­æœ€å¤§å—å¤§å°ã€‚</li>
<li>Percpu:percpuæœºåˆ¶ä½¿ç”¨çš„é¡µé¢ã€‚</li>
<li>CmaTotal:CMAæœºåˆ¶ä½¿ç”¨çš„æ€»å†…å­˜ã€‚</li>
<li>CmaFree:CMAæœºåˆ¶å‰©ä½™ç©ºç”¨å†…å­˜ã€‚</li>
</ul>
<p>1.Linuxå†…æ ¸çš„å†…å­˜ç”¨äº†å¤šå°‘ï¼ŸSlab+VmallocUsed+PageTables+KernelStack+Bounceã€‚ 2.ç”¨æˆ·å†…å­˜ç”¨äº†å¤šå°‘å†…å­˜ï¼Ÿ ï¼ˆ1ï¼‰LRUè§†è§’ï¼šactive+inactive+unevicatable = 5104+31432+0= 36536KB ï¼ˆ2ï¼‰ç¼“å­˜è§†è§’ï¼ˆswapcache=0ï¼‰ï¼šCached+Buffers +AnonPages= 20352+436+15792=36580KBï¼Œcachedå’Œbufferså†…å­˜å¹¶ä¸æ˜¯éƒ½ä½¿ç”¨å®Œæˆäº†ï¼Œè¿™ç§ç»Ÿè®¡æ–¹å¼å¾€å¾€å¤§äºå®é™…ä½¿ç”¨å†…å­˜ã€‚ è§‚å¯Ÿå†…å­˜æ³„éœ²çš„æ—¶å€™é‡ç‚¹çœ‹ï¼šMemfreeã€Slabçš„å˜åŒ–ã€‚</p>
<h3 id="proczoneinfo">/proc/zoneinfo</h3>
<p>zoneinfoæ˜¾ç¤ºäº†å½“å‰ç³»ç»Ÿæ‰€æœ‰å†…å­˜ç®¡ç†åŒºçš„ä¿¡æ¯ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ã€‚ 1.å½“å‰å†…å­˜èŠ‚ç‚¹çš„å†…å­˜ç»Ÿè®¡ä¿¡æ¯ Node 0ï¼Œzone DMAï¼šç¬¬0ä¸ªèŠ‚ç‚¹ï¼ŒDMAåŒºåŸŸçš„æ€»ä½“ä¿¡æ¯ã€‚ <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_e4093f7be650c02635a1db87f9cb821f.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/å†…å­˜æµ‹é‡/images/wp_editor_md_e4093f7be650c02635a1db87f9cb821f.jpg"/></a> 2.å½“å‰å†…å­˜ç®¡ç†åŒºçš„æ€»ä¿¡æ¯ <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_7086f7e9582157646fe22151d4b36a02.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/å†…å­˜æµ‹é‡/images/wp_editor_md_7086f7e9582157646fe22151d4b36a02.jpg"/></a> èŠ‚ç‚¹0ï¼ŒzoneåŒºåŸŸã€‚ - pages free:å†…å­˜ç®¡ç†åŒºä¸­ç©ºé—²çš„é¡µé¢æ•°é‡ã€‚ - minï¼šè­¦æˆ’æ°´ä½çš„é¡µé¢æ•°é‡ã€‚ - lowï¼šä½æ°´ä½çš„é¡µé¢æ•°é‡ã€‚ - highï¼šé«˜æ°´ä½çš„é¡µé¢æ•°é‡ã€‚ - spanned:å†…å­˜ç®¡ç†åŒºæ€»çš„é¡µé¢æ•°é‡ï¼ŒåŒ…å«ç©ºæ´ã€‚ - presentï¼šå†…å­˜ç®¡ç†åŒºæ€»çš„å¯ç”¨é¡µé¢æ•°é‡ï¼Œä¸åŒ…å«ç©ºæ´ã€‚ - managedï¼šè¢«ä¼™ä¼´ç³»ç»Ÿç®¡ç†çš„é¡µé¢æ•°é‡ã€‚ - protectionï¼šç®¡ç†åŒºä¸­é¢„ç•™å†…å­˜çš„é¡µé¢æ•°é‡ã€‚åˆ†åˆ«æ˜¯é¢„ç•™ç»™DMA,DMA32,NORMAL,HIGHã€‚ 3.æ¯ä¸ªCPUå†…å­˜åˆ†é…å™¨çš„ä¿¡æ¯per_cpu_pageset <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_92cb8ef1cf54c7f446dc36d976f71b5b.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/å†…å­˜æµ‹é‡/images/wp_editor_md_92cb8ef1cf54c7f446dc36d976f71b5b.jpg"/></a> pagesets:è¡¨ç¤ºæ¯ä¸ªCPUå†…å­˜åˆ†é…å™¨ä¸­æ¯ä¸ªCPUç¼“å­˜çš„é¡µé¢ä¿¡æ¯ã€‚ - count: åœ¨è¯¥CPUå†…å­˜åŒºåŸŸä¸Šå·²ç»åˆ†é…çš„é¡µé¢æ•°é‡ã€‚ - high:é¡µé¢å›æ”¶çš„ç©ºé—²é¡µé¢æ•°é‡çš„æ°´ä½çº¿ï¼Œå¦‚æœcpuä¸Šçš„é¡µé¢æ•°é‡è¶…è¿‡è¯¥å€¼ï¼Œéœ€è¦é€€è¿˜ç»™zoneã€‚ - batch:å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰é¡µé¢äº†ï¼Œä¸€æ¬¡æ€§ä¸­zoneä¸­è·å–batchä¸ªé¡µé¢ã€‚ã€‚ - vm stats threshold: æŸä¸ªè¿›ç¨‹è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡è¶…è¿‡è¯¥é˜ˆå€¼æ—¶ï¼Œå†…æ ¸å°†åœ¨/proc/PID/smapsæ‰“å°è¿›ç¨‹çš„è¯¦ç»†å†…å­˜æ˜ å°„ä¿¡æ¯ã€‚ zoneinfoèŠ‚ç‚¹é‡ç‚¹å¯ä»¥çœ‹ä¸€ä¸‹å„åŒºåŸŸmin/low/highçš„æ°´ä½å€¼ï¼Œå¯ä»¥é€šè¿‡/proc/sys/vm/min_free_kbytesè°ƒæ•´minå€¼ã€‚</p>
<h2 id="_2">ç”¨æˆ·è¿›ç¨‹å ç”¨å†…å­˜</h2>
<h3 id="procpidstatus">/proc/pid/status</h3>
<div class="codehilite"><pre><span></span><code><span class="cp"># cat /proc/1151/status </span>
<span class="nl">Name</span><span class="p">:</span><span class="w">   </span><span class="n">wifi_daemon</span>
<span class="nl">Umask</span><span class="p">:</span><span class="w">  </span><span class="mo">0022</span>
<span class="nl">State</span><span class="p">:</span><span class="w">  </span><span class="n">S</span><span class="w"> </span><span class="p">(</span><span class="n">sleeping</span><span class="p">)</span>
<span class="nl">Tgid</span><span class="p">:</span><span class="w">   </span><span class="mi">1151</span>
<span class="nl">Ngid</span><span class="p">:</span><span class="w">   </span><span class="mi">0</span>
<span class="nl">Pid</span><span class="p">:</span><span class="w">    </span><span class="mi">1151</span>
<span class="nl">PPid</span><span class="p">:</span><span class="w">   </span><span class="mi">1</span>
<span class="nl">TracerPid</span><span class="p">:</span><span class="w">      </span><span class="mi">0</span>
<span class="nl">Uid</span><span class="p">:</span><span class="w">    </span><span class="mi">0</span><span class="w">       </span><span class="mi">0</span><span class="w">       </span><span class="mi">0</span><span class="w">       </span><span class="mi">0</span>
<span class="nl">Gid</span><span class="p">:</span><span class="w">    </span><span class="mi">0</span><span class="w">       </span><span class="mi">0</span><span class="w">       </span><span class="mi">0</span><span class="w">       </span><span class="mi">0</span>
<span class="nl">FDSize</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span>
<span class="nl">Groups</span><span class="p">:</span><span class="w">  </span>
<span class="nl">VmPeak</span><span class="p">:</span><span class="w">   </span><span class="mi">239316</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmSize</span><span class="p">:</span><span class="w">   </span><span class="mi">239316</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmLck</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmPin</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmHWM</span><span class="p">:</span><span class="w">      </span><span class="mi">1172</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmRSS</span><span class="p">:</span><span class="w">      </span><span class="mi">1172</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">RssAnon</span><span class="p">:</span><span class="w">             </span><span class="mi">532</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">RssFile</span><span class="p">:</span><span class="w">             </span><span class="mi">640</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">RssShmem</span><span class="p">:</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmData</span><span class="p">:</span><span class="w">    </span><span class="mi">33540</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmStk</span><span class="p">:</span><span class="w">       </span><span class="mi">132</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmExe</span><span class="p">:</span><span class="w">        </span><span class="mi">36</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmLib</span><span class="p">:</span><span class="w">      </span><span class="mi">7560</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmPTE</span><span class="p">:</span><span class="w">        </span><span class="mi">76</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">VmSwap</span><span class="p">:</span><span class="w">        </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">CoreDumping</span><span class="p">:</span><span class="w">    </span><span class="mi">0</span>
<span class="nl">THP_enabled</span><span class="p">:</span><span class="w">    </span><span class="mi">0</span>
<span class="nl">Threads</span><span class="p">:</span><span class="w">        </span><span class="mi">3</span>
<span class="nl">SigQ</span><span class="p">:</span><span class="w">   </span><span class="mi">0</span><span class="o">/</span><span class="mi">7639</span>
<span class="nl">SigPnd</span><span class="p">:</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="nl">ShdPnd</span><span class="p">:</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="nl">SigBlk</span><span class="p">:</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="nl">SigIgn</span><span class="p">:</span><span class="w"> </span><span class="mo">0000000000001000</span>
<span class="nl">SigCgt</span><span class="p">:</span><span class="w"> </span><span class="mo">00000001</span><span class="mi">80000000</span>
<span class="nl">CapInh</span><span class="p">:</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="nl">CapPrm</span><span class="p">:</span><span class="w"> </span><span class="mf">000001f</span><span class="n">fffffffff</span>
<span class="nl">CapEff</span><span class="p">:</span><span class="w"> </span><span class="mf">000001f</span><span class="n">fffffffff</span>
<span class="nl">CapBnd</span><span class="p">:</span><span class="w"> </span><span class="mf">000001f</span><span class="n">fffffffff</span>
<span class="nl">CapAmb</span><span class="p">:</span><span class="w"> </span><span class="mo">0000000000000000</span>
<span class="nl">NoNewPrivs</span><span class="p">:</span><span class="w">     </span><span class="mi">0</span>
<span class="nl">Seccomp</span><span class="p">:</span><span class="w">        </span><span class="mi">0</span>
<span class="nl">Seccomp_filters</span><span class="p">:</span><span class="w">        </span><span class="mi">0</span>
<span class="nl">Speculation_Store_Bypass</span><span class="p">:</span><span class="w">       </span><span class="n">not</span><span class="w"> </span><span class="n">vulnerable</span>
<span class="nl">SpeculationIndirectBranch</span><span class="p">:</span><span class="w">      </span><span class="n">unknown</span>
<span class="nl">Cpus_allowed</span><span class="p">:</span><span class="w">   </span><span class="n">ff</span>
<span class="nl">Cpus_allowed_list</span><span class="p">:</span><span class="w">      </span><span class="mi">0-7</span>
<span class="nl">voluntary_ctxt_switches</span><span class="p">:</span><span class="w">        </span><span class="mi">12</span>
<span class="nl">nonvoluntary_ctxt_switches</span><span class="p">:</span><span class="w">     </span><span class="mi">0</span>
</code></pre></div>
<ul>
<li>VmPeak: è¿›ç¨‹ä½¿ç”¨çš„æœ€å¤§è™šæ‹Ÿå†…å­˜ï¼Œé€šå¸¸ç­‰äºè¿›ç¨‹å†…å­˜æè¿°ç¬¦å·mm-&gt;total_vmã€‚</li>
<li>VmSize:è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ï¼Œç­‰äºmm-&gt;total_vmã€‚</li>
<li>VmLck:è®°å½•æ‰€æœ‰ç”¨æˆ·æˆ–å†…æ ¸é”å®šçš„å†…å­˜ï¼Œä¸»è¦æ˜¯mlockçš„å†…å­˜ï¼Œç³»ç»Ÿå›æ”¶å†…å­˜æ—¶ï¼Œä¸ä¼šä¼˜å…ˆå›æ”¶è¿™éƒ¨åˆ†å†…å­˜ã€‚</li>
<li>VmPin:è¿›ç¨‹å›ºå®šåœ¨å†…å­˜çš„è™šæ‹Ÿåœ°å€ç©ºé—´å¤§å°ï¼Œè®°å½•äº†æ— æ³•è¢«æ¢å‡ºåˆ°ç£ç›˜çš„é¡µé¢æ•°é‡ã€‚</li>
<li>VmHWM:è¿›ç¨‹ä½¿ç”¨çš„æœ€å¤§ç‰©ç†å†…å­˜ï¼ŒåŒ…æ‹¬è¿›ç¨‹ä½¿ç”¨çš„åŒ¿åé¡µé¢ã€æ–‡ä»¶æ˜ å°„é¡µé¢ä»¥åŠå…±äº«å†…å­˜é¡µé¢å¤§å°æ€»å’Œã€‚</li>
<li>VmRSS: è¿›ç¨‹ä½¿ç”¨çš„æœ€å¤§ç‰©ç†å†…å­˜ï¼Œé€šå¸¸ç­‰äºVmHMMã€‚</li>
<li>RssAnon: è¿›ç¨‹ä½¿ç”¨çš„åŒ¿åé¡µé¢å¤§å°ã€‚</li>
<li>RssFile: è¿›ç¨‹ä½¿ç”¨çš„æ–‡ä»¶é¡µé¢å¤§å°ã€‚</li>
<li>RssShmem: è¿›ç¨‹ä½¿ç”¨çš„å…±äº«å†…å­˜é¡µé¢å¤§å°ã€‚</li>
<li>VmData:è¿›ç¨‹ç§æœ‰æ•°æ®æ®µå ç”¨å†…å­˜å¤§å°ã€‚</li>
<li>VmStk:è¿›ç¨‹ç”¨æˆ·æ ˆå ç”¨å†…å­˜å¤§å°ã€‚</li>
<li>VmExe:è¿›ç¨‹ä»£ç æ®µå ç”¨å¤§å°ã€‚</li>
<li>VmLib:è¿›ç¨‹å…±äº«åº“å ç”¨å¤§å°ã€‚</li>
<li>VmPTE:è¿›ç¨‹å ç”¨çš„é¡µè¡¨å¤§å°ã€‚</li>
<li>VmSwap: è¿›ç¨‹ä½¿ç”¨å·¨å‹é¡µçš„å¤§å°ã€‚</li>
</ul>
<h3 id="procpidsmaps">/proc/pid/smaps</h3>
<div class="codehilite"><pre><span></span><code><span class="mf">7f</span><span class="n">ac964000</span><span class="mi">-7</span><span class="n">fac9b8000</span><span class="w"> </span><span class="n">r</span><span class="o">-</span><span class="n">xp</span><span class="w"> </span><span class="mo">00000000</span><span class="w"> </span><span class="n">b3</span><span class="o">:</span><span class="mo">07</span><span class="w"> </span><span class="mi">403</span><span class="w">    </span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libwifimg</span><span class="o">-</span><span class="n">v2</span><span class="mf">.0</span><span class="p">.</span><span class="n">so</span>
<span class="nl">Size</span><span class="p">:</span><span class="w">                </span><span class="mi">336</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">KernelPageSize</span><span class="p">:</span><span class="w">        </span><span class="mi">4</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">MMUPageSize</span><span class="p">:</span><span class="w">           </span><span class="mi">4</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Rss</span><span class="p">:</span><span class="w">                 </span><span class="mi">240</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Pss</span><span class="p">:</span><span class="w">                 </span><span class="mi">240</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Shared_Clean</span><span class="p">:</span><span class="w">          </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Shared_Dirty</span><span class="p">:</span><span class="w">          </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Private_Clean</span><span class="p">:</span><span class="w">       </span><span class="mi">240</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Private_Dirty</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Referenced</span><span class="p">:</span><span class="w">          </span><span class="mi">136</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Anonymous</span><span class="p">:</span><span class="w">             </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">LazyFree</span><span class="p">:</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">AnonHugePages</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">ShmemPmdMapped</span><span class="p">:</span><span class="w">        </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">FilePmdMapped</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Shared_Hugetlb</span><span class="p">:</span><span class="w">        </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Private_Hugetlb</span><span class="p">:</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Swap</span><span class="p">:</span><span class="w">                  </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">SwapPss</span><span class="p">:</span><span class="w">               </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">Locked</span><span class="p">:</span><span class="w">                </span><span class="mi">0</span><span class="w"> </span><span class="n">kB</span>
<span class="nl">THPeligible</span><span class="p">:</span><span class="w">    </span><span class="mi">0</span>
<span class="nl">VmFlags</span><span class="p">:</span><span class="w"> </span><span class="n">rd</span><span class="w"> </span><span class="n">ex</span><span class="w"> </span><span class="n">mr</span><span class="w"> </span><span class="n">mw</span><span class="w"> </span><span class="n">me</span><span class="w"> </span>
</code></pre></div>
<ul>
<li>7fac964000-7fac9b8000 r-xp 00000000 b3:07 403 /lib/libwifimg-v2.0.so: 7fac964000-7fac9b8000è™šæ‹Ÿå†…å­˜æ®µçš„å¼€å§‹å’Œç»“æŸä½ç½®ï¼Œè¡¨ç¤ºä¸€ä¸ªVMAã€‚ r-xpè¡¨ç¤ºè¯¥VMAæ˜¯å¯è¯»ã€å¯æ‰§è¡Œã€ç§æœ‰ã€‚00000000è™šæ‹Ÿå†…å­˜æ®µå…¶å®åœ°å€å¯¹åº”æ˜ å°„æ–‡ä»¶ä¸­ä»¥é¡µä¸ºå•ä½çš„åç§»é‡ã€‚</li>
<li>size:è™šæ‹Ÿå†…å­˜ç©ºé—´å¤§å°ã€‚ä¸æ˜¯å®é™…ç‰©ç†å†…å­˜çš„åˆ†é…å¤§å°ï¼Œå¯¹åº”çš„æ˜¯VMAçš„å†…å­˜å¤§å°ï¼Œå†…å­˜æ€»æ˜¯ä¼šå»¶è¿Ÿåˆ†é…ã€‚</li>
<li>Rss:å®é™…åˆ†é…çš„å†…å­˜ï¼ŒåŒ…æ‹¬å…¶ä»–è¿›ç¨‹çš„å…±äº«å†…å­˜Rss=Shared_Clean+Shared_Dirty+Private_Clean+Private_Dirtyã€‚</li>
<li>Pss:å¹³æ‘Šè®¡ç®—åçš„å®é™…ç‰©ç†å†…å­˜ä½¿ç”¨ã€‚å…±äº«éƒ¨åˆ†æŒ‰æ¯”ä¾‹å‡åˆ†+Private_xxéƒ¨åˆ†ã€‚</li>
<li>Private_Dirty:è¿›ç¨‹ç‹¬å çš„è„é¡µé¢å¤§å°ã€‚</li>
<li>Private_Clean:è¿›ç¨‹ç‹¬å å¹²å‡€é¡µé¢å¤§å°ã€‚</li>
<li>USS:ç­‰äºPrivate_Dirty+Private_Cleanï¼Œé€šå¸¸ç”¨æ¥è¡¨ç¤ºè¿›ç¨‹ç‹¬å çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå»æ‰ä¸å…¶ä»–å…±äº«å†…å­˜éƒ¨åˆ†ã€‚</li>
</ul>
<p>Rssè®¡ç®—ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">pid</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Rss</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span>
</code></pre></div>
<p>Pssè®¡ç®—</p>
<div class="codehilite"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">pid</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Pss</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span>
</code></pre></div>
<p>Ussè®¡ç®—</p>
<div class="codehilite"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">pid</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Pss</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_57788f1634a7a135b1ab45d81a474592.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/å†…å­˜æµ‹é‡/images/wp_editor_md_57788f1634a7a135b1ab45d81a474592.jpg"/></a></p>
<p>è¿›ç¨‹1001ï¼š VSS=1+2+3 RSS=4+5+6 PSS=4/2+5+6 USS=5+6 çœ‹è¿›ç¨‹æ˜¯å¦æœ‰å†…å­˜æ³„éœ²ï¼Œå¯ä»¥ä¼˜å…ˆçœ‹USSï¼ˆPrivate_Dirty+Private_Cleanï¼‰æ˜¯å¦æœ‰å¢é•¿ã€‚</p>
<h3 id="pmap-x-pid">pmap -x [pid]</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_12fdb61a59ab6537474379cf65f79c9c.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/å†…å­˜æµ‹é‡/images/wp_editor_md_12fdb61a59ab6537474379cf65f79c9c.jpg"/></a> <a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_dc7517b988862316e20005e18c16e1e9.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/å†…å­˜æµ‹é‡/images/wp_editor_md_dc7517b988862316e20005e18c16e1e9.jpg"/></a> - Addressï¼šè™šæ‹Ÿåœ°å€èµ·å§‹åœ°å€ - Kbytesï¼šå†…å­˜å—å ç”¨è™šæ‹Ÿå†…å­˜å¤§å°ï¼Œå•ä½KBã€‚ - PSSï¼šè¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼ˆè´¡çŒ®å†…å­˜æŒ‰æ¯”ä¾‹åˆ†é…çš„å¤§å°ï¼‰ï¼Œå•ä½KBã€‚ - Dirty:è„å†…å­˜å¤§å°ï¼ŒæŒ‡è¿›ç¨‹ä¿®æ”¹è¿‡çš„é¡µé¢å¤§å°ï¼Œå•ä½KBã€‚ - Swapï¼šè¢«äº¤æ¢åˆ°ç£ç›˜ä¸Šçš„å†…å­˜å¤§å°ï¼Œå•ä½KBã€‚ - Modeï¼šæ˜¾ç¤ºå†…å­˜æ®µçš„æƒé™å±æ€§ã€‚ - Mappingï¼šæ˜¾ç¤ºå†…å­˜æ®µå¯¹åº”çš„æ–‡ä»¶æˆ–åº“åã€‚ - Totalï¼šæ±‡æ€»å†…å­˜åŒºåŸŸçš„è™šæ‹Ÿå†…å­˜å¤§å°ï¼Œå•ä½KBã€‚ åœ¨linuxç‰©ç†å†…å­˜ä¸­ï¼Œæ¯ä¸ªé¡µé¢æœ‰ä¸€ä¸ªdirtyçš„æ ‡å¿—ï¼Œå¦‚æœè¯¥é¡µé¢è¢«æ”¹å†™äº†ï¼Œæˆ‘ä»¬ç§°ä¹‹ä½dirty pageã€‚æ€»çš„æ¥è¯´ï¼Œæ‰€æœ‰édirty pageçš„ç‰©ç†é¡µé¢éƒ½å¯ä»¥è¢«å›æ”¶ã€‚è¿›ç¨‹ä¸­å„ä¸ªæ®µçš„dirty pageæƒ…å†µã€‚</p>
<h2 id="_3">å†…æ ¸å ç”¨å†…å­˜</h2>
<h3 id="procmeminfo_1">/proc/meminfo</h3>
<p>å†…æ ¸å ç”¨å†…å­˜ï¼šSlab+VmallocUsed+PageTables+KernelStack+Bounceã€‚</p>
<h3 id="procpagetypeinfo">/proc/pagetypeinfo</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2023/12/wp_editor_md_72f1c23fd6cae037995b2cdb4670063a.jpg"><img alt="" src="assets/doc/01-linux/å†…å­˜ç®¡ç†/å†…å­˜æµ‹é‡/images/wp_editor_md_72f1c23fd6cae037995b2cdb4670063a.jpg"/></a></p>
<p>Page block orderï¼š10ï¼Œæ”¯æŒæœ€é«˜é˜¶orderï¼Œè¿™é‡Œæ˜¯10ï¼Œè¡¨ç¤ºå†…å­˜å¤§å°ä¸€å—ä¸º2^10é¡µé¢ã€‚ Pages per blockï¼šæœ€é«˜é˜¶ä¸€å—å†…å­˜éœ€è¦çš„é¡µé¢æ•°é‡ï¼Œç­‰äº2^10=1024ï¼Œå³page blockå¤§å°ä¸º1024*4K=4MBã€‚ Unmovable order=1çš„æ•°é‡æœ‰87ä¸ªï¼Œä¹Ÿå°±æ˜¯2^1ä¸ªé¡µé¢ç»„æˆçš„å†…å­˜å—æœ‰87ä¸ªã€‚ Movable 454ï¼šè¡¨ç¤ºåœ¨DMAåŒºåŸŸï¼Œmovableç±»å‹çš„page blockçš„æ•°é‡ä¸º454ã€‚ï¼ˆæŒ‰ç…§æœ€é«˜é˜¶è®¡ç®—oder = 2^10çš„é¡µé¢ç»„æˆçš„å†…å­˜å—ï¼‰ã€‚</p>
<h2 id="_4">å°ç»“</h2>
<h3 id="_5">å†…å­˜ç»Ÿè®¡</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">#!/bin/sh</span>

<span class="k">while</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="cp">#1è®¡ç®—ç³»ç»Ÿæ€»å…±å†…å­˜åŠå‰©ä½™å†…å­˜</span>
<span class="w">    </span><span class="n">TOTAL_MEM</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">grep</span><span class="w"> </span><span class="n">MemTotal</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">meminfo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w">    </span><span class="n">FREE_MEM</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">grep</span><span class="w"> </span><span class="n">MemFree</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">meminfo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>

<span class="w">    </span><span class="cp">#2è®¡ç®—å†…æ ¸å ç”¨å†…å­˜</span>
<span class="w">    </span><span class="n">SLAB</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">grep</span><span class="w"> </span><span class="n">Slab</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">meminfo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w">    </span><span class="n">VMALLOC</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">grep</span><span class="w"> </span><span class="n">VmallocUsed</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">meminfo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w">    </span><span class="n">PAGETABLE</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">grep</span><span class="w"> </span><span class="n">PageTables</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">meminfo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w">    </span><span class="n">KERNELSTACK</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">grep</span><span class="w"> </span><span class="n">KernelStack</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">meminfo</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w">    </span><span class="n">KERNEL_MEM</span><span class="o">=</span><span class="n">$</span><span class="p">((</span><span class="n">SLAB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">VMALLOC</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">PAGETABLE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">KERNELSTACK</span><span class="p">))</span>

<span class="cp">#3è®¡ç®—ç”¨æˆ·USS/PSS/RSSå ç”¨å†…å­˜</span>
<span class="w">    </span><span class="n">CURRENT_USER</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="p">)</span>
<span class="w">    </span><span class="n">TOTAL_USS</span><span class="o">=</span><span class="mi">0</span>
<span class="w">    </span><span class="n">TOTAL_PSS</span><span class="o">=</span><span class="mi">0</span>
<span class="w">    </span><span class="n">TOTAL_RSS</span><span class="o">=</span><span class="mi">0</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="n">ls</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="s">"^[0-9]*$"</span><span class="p">);</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="s">"/proc/${pid}/status"</span><span class="w"> </span><span class="p">];</span><span class="w"> </span><span class="n">then</span>
<span class="w">            </span><span class="n">username</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Uid</span><span class="o">:/</span><span class="p">{</span><span class="n">printf</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="err">'</span><span class="w"> </span><span class="s">"/proc/${pid}/status"</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">"$username"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"$CURRENT_USER"</span><span class="w"> </span><span class="p">];</span><span class="w"> </span><span class="n">then</span>
<span class="w">                </span><span class="n">name</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Name</span><span class="o">:/</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="err">'</span><span class="w"> </span><span class="s">"/proc/${pid}/status"</span><span class="p">)</span>
<span class="w">                </span><span class="n">mem1</span><span class="o">=</span><span class="mi">0</span>
<span class="w">                </span><span class="n">mem1</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$</span><span class="p">{</span><span class="n">pid</span><span class="p">}</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Private</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w">                </span><span class="n">mem2</span><span class="o">=</span><span class="mi">0</span>
<span class="w">                </span><span class="n">mem2</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$</span><span class="p">{</span><span class="n">pid</span><span class="p">}</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Pss</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w">                </span><span class="n">mem3</span><span class="o">=</span><span class="mi">0</span>
<span class="w">                </span><span class="n">mem3</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$</span><span class="p">{</span><span class="n">pid</span><span class="p">}</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Rss</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w">            </span><span class="n">fi</span>
<span class="w">            </span><span class="n">TOTAL_USS</span><span class="o">=</span><span class="n">$</span><span class="p">((</span><span class="n">TOTAL_USS</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mem1</span><span class="p">))</span>
<span class="w">            </span><span class="n">TOTAL_PSS</span><span class="o">=</span><span class="n">$</span><span class="p">((</span><span class="n">TOTAL_PSS</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mem2</span><span class="p">))</span>
<span class="w">            </span><span class="n">TOTAL_RSS</span><span class="o">=</span><span class="n">$</span><span class="p">((</span><span class="n">TOTAL_RSS</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mem3</span><span class="p">))</span>
<span class="w">        </span><span class="n">fi</span>
<span class="w">    </span><span class="n">done</span>

<span class="w">    </span><span class="n">echo</span><span class="w"> </span><span class="s">"total_mem:$TOTAL_MEM KB, free_mem:$FREE_MEM KB"</span>
<span class="w">    </span><span class="n">echo</span><span class="w"> </span><span class="s">"slab:$SLAB KB, vmalloc:$VMALLOC KB, pagetable:$PAGETABLE KB, kernel_stack:$KERNELSTACK KB"</span>
<span class="w">    </span><span class="n">echo</span><span class="w">  </span><span class="s">"Kernel_mem:$KERNEL_MEM KB, USS:$TOTAL_USS KB, PSS:$TOTAL_PSS KB, RSS:$TOTAL_RSS KB"</span>
<span class="w">    </span><span class="n">sleep</span><span class="w"> </span><span class="mi">1</span>
<span class="n">done</span>
</code></pre></div>
<h3 id="_6">æŸ¥è¯¢å ç”¨è¾ƒå¤šå†…å­˜çš„è¿›ç¨‹</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">#!/bin/sh</span>
<span class="n">CURRENT_USER</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="p">)</span>
<span class="n">TOTAL_USS</span><span class="o">=</span><span class="mi">0</span>
<span class="n">TOTAL_PSS</span><span class="o">=</span><span class="mi">0</span>
<span class="n">TOTAL_RSS</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="n">ls</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="s">"^[0-9]*$"</span><span class="p">);</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="s">"/proc/${pid}/status"</span><span class="w"> </span><span class="p">];</span><span class="w"> </span><span class="n">then</span>
<span class="w">        </span><span class="n">username</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Uid</span><span class="o">:/</span><span class="p">{</span><span class="n">printf</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="err">'</span><span class="w"> </span><span class="s">"/proc/${pid}/status"</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">"$username"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"$CURRENT_USER"</span><span class="w"> </span><span class="p">];</span><span class="w"> </span><span class="n">then</span>
<span class="w">            </span><span class="n">name</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Name</span><span class="o">:/</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="err">'</span><span class="w"> </span><span class="s">"/proc/${pid}/status"</span><span class="p">)</span>
<span class="w">            </span><span class="n">mem1</span><span class="o">=</span><span class="mi">0</span>
<span class="w">            </span><span class="n">mem1</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$</span><span class="p">{</span><span class="n">pid</span><span class="p">}</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Private</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w">            </span><span class="n">mem2</span><span class="o">=</span><span class="mi">0</span>
<span class="w">            </span><span class="n">mem2</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$</span><span class="p">{</span><span class="n">pid</span><span class="p">}</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Pss</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w">          </span><span class="n">mem3</span><span class="o">=</span><span class="mi">0</span>
<span class="w">            </span><span class="n">mem3</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$</span><span class="p">{</span><span class="n">pid</span><span class="p">}</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Rss</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w">            </span><span class="n">echo</span><span class="w"> </span><span class="s">"$pid USS:$mem1, PSS:$mem2, RSS:$mem3"</span>
<span class="w">         </span><span class="n">fi</span>
<span class="n">fi</span>
<span class="n">done</span>
</code></pre></div>
<h3 id="_7">è¿›ç¨‹å†…å­˜ç›‘æµ‹</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">#!/bin/sh</span>

<span class="n">count</span><span class="o">=</span><span class="mi">0</span>
<span class="n">pid</span><span class="o">=</span><span class="n">$1</span>
<span class="k">while</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w"> </span><span class="n">let</span><span class="w"> </span><span class="s">"count++"</span>
<span class="w"> </span><span class="cp">#è®¡ç®—USS,RSS,PSS</span>
<span class="w"> </span><span class="n">mem1</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$pid</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Private</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w"> </span><span class="n">mem2</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$pid</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Rss</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w"> </span><span class="n">mem3</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$pid</span><span class="o">/</span><span class="n">smaps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Pss</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">$2</span><span class="p">}</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">sum</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w"> </span><span class="cp">#è®¡ç®—Dirtyï¼Œè¿›ç¨‹è™šæ‹Ÿå†…å­˜</span>
<span class="w"> </span><span class="n">Dirty</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">pmap</span><span class="w"> </span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="n">$pid</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">total</span><span class="o">/</span><span class="p">{</span><span class="n">dirty</span><span class="o">=</span><span class="n">$4</span><span class="p">}</span><span class="n">END</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">dirty</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w"> </span><span class="n">VSS</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">pmap</span><span class="w"> </span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="n">$pid</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">total</span><span class="o">/</span><span class="p">{</span><span class="n">VSS</span><span class="o">=</span><span class="n">$2</span><span class="p">}</span><span class="n">END</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">VSS</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w"> </span><span class="cp">#è®¡ç®—ç³»ç»Ÿä½¿ç”¨å†…å­˜ï¼Œå‰©ä½™å†…å­˜</span>
<span class="w"> </span><span class="n">used</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">free</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Mem</span><span class="o">/</span><span class="p">{</span><span class="n">used</span><span class="o">=</span><span class="n">$3</span><span class="p">}</span><span class="n">END</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">used</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w"> </span><span class="n">free</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">free</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="o">/^</span><span class="n">Mem</span><span class="o">/</span><span class="p">{</span><span class="n">free</span><span class="o">=</span><span class="n">$4</span><span class="p">}</span><span class="n">END</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">free</span><span class="p">}</span><span class="err">'</span><span class="p">)</span>
<span class="w"> </span><span class="cp">#è®¡ç®—å †ç©ºé—´è™šæ‹Ÿå†…å­˜</span>
<span class="n">start_addr</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$pid</span><span class="o">/</span><span class="n">maps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="s">"</span><span class="se">\\</span><span class="s">[heap</span><span class="se">\\</span><span class="s">]"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$1</span><span class="p">}</span><span class="err">'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cut</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="sc">'-'</span><span class="w"> </span><span class="o">-</span><span class="n">f1</span><span class="p">)</span>
<span class="n">end_addr</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$pid</span><span class="o">/</span><span class="n">maps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="s">"</span><span class="se">\\</span><span class="s">[heap</span><span class="se">\\</span><span class="s">]"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$1</span><span class="p">}</span><span class="err">'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cut</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="sc">'-'</span><span class="w"> </span><span class="o">-</span><span class="n">f2</span><span class="p">)</span>
<span class="n">start_addr</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">printf</span><span class="w"> </span><span class="s">"%d"</span><span class="w"> </span><span class="s">"0x$start_addr"</span><span class="p">)</span>
<span class="n">end_addr</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">printf</span><span class="w"> </span><span class="s">"%d"</span><span class="w"> </span><span class="s">"0x$end_addr"</span><span class="p">)</span>
<span class="n">heap_vs</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">expr</span><span class="w"> </span><span class="n">$end_addr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">$start_addr</span><span class="p">)</span>
<span class="n">heap_vs</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">expr</span><span class="w"> </span><span class="n">$heap_vs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span>

<span class="w"> </span><span class="cp">#è®¡ç®—æ ˆç©ºé—´è™šæ‹Ÿå†…å­˜</span>
<span class="n">start_addr</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$pid</span><span class="o">/</span><span class="n">maps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="s">"</span><span class="se">\\</span><span class="s">[stack</span><span class="se">\\</span><span class="s">]"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$1</span><span class="p">}</span><span class="err">'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cut</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="sc">'-'</span><span class="w"> </span><span class="o">-</span><span class="n">f1</span><span class="p">)</span>
<span class="n">end_addr</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">$pid</span><span class="o">/</span><span class="n">maps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="s">"</span><span class="se">\\</span><span class="s">[stack</span><span class="se">\\</span><span class="s">]"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="err">'</span><span class="p">{</span><span class="n">print</span><span class="w"> </span><span class="n">$1</span><span class="p">}</span><span class="err">'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cut</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="sc">'-'</span><span class="w"> </span><span class="o">-</span><span class="n">f2</span><span class="p">)</span>
<span class="n">start_addr</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">printf</span><span class="w"> </span><span class="s">"%d"</span><span class="w"> </span><span class="s">"0x$start_addr"</span><span class="p">)</span>
<span class="n">end_addr</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">printf</span><span class="w"> </span><span class="s">"%d"</span><span class="w"> </span><span class="s">"0x$end_addr"</span><span class="p">)</span>
<span class="n">stack_vs</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">expr</span><span class="w"> </span><span class="n">$end_addr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">$start_addr</span><span class="p">)</span>
<span class="n">stack_vs</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">expr</span><span class="w"> </span><span class="n">$stack_vs</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span>

<span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="s">"count:$count,USS:$mem1 KB,VSS:$VSS KB, RSS:$mem2 KB,PSS:$mem3 KB,Dirty:$Dirty KB,heapvs:$heap_vs KB,stackvs:$stack_vs KB,used:$used KB,free:$free KB"</span>
<span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="mi">1</span>
<span class="n">done</span>
</code></pre></div>
<p>æµ‹è¯•ä»£ç ï¼Œå¯é…åˆè„šæœ¬è§‚å¯Ÿ</p>
<div class="codehilite"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ptr1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ptr2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ptr3</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ptr4</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ptr5</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">mallinfo</span><span class="w"> </span><span class="n">m_info</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">size_kb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65</span><span class="p">;</span>

<span class="w">    </span><span class="n">getchar</span><span class="p">();</span>

<span class="w">    </span><span class="n">mallopt</span><span class="p">(</span><span class="n">M_TRIM_THRESHOLD</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">128</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"malloc ptr[0] %dkb</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="n">ptr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">1048</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//memset(ptr1,24,1048 * size_kb); //memsetä¸ä¼šå¯¼è‡´USSå¢åŠ ,å¯èƒ½æ˜¯ç”±äºå€¼æ˜¯ä¸€æ ·çš„.</span>
<span class="w">    </span><span class="c1">//memset(ptr1,25,1048 * size_kb); å³ä½¿ç”¨ä¸¤æ¬¡memsetè®¾ç½®ä¸åŒå€¼ä¹Ÿä¸ä¼šå¢åŠ USS</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1048</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size_kb</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ptr1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">255</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">getchar</span><span class="p">();</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"malloc ptr[1] %dkb</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="n">ptr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">1048</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//memset(ptr2,25,1048 * size_kb);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1048</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size_kb</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ptr2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">255</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">getchar</span><span class="p">();</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"malloc ptr[2] %dkb</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="n">ptr3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">1048</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//memset(ptr3,26,1048 * size_kb);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1048</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size_kb</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ptr3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">255</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="n">getchar</span><span class="p">();</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"malloc ptr[3] %dkb</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="n">ptr4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">1048</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//memset(ptr4,27,1048 * size_kb);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1048</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size_kb</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ptr4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">255</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">getchar</span><span class="p">();</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"malloc ptr[4] %dkb</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="n">ptr5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">1048</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//memset(ptr5,28,1048 * size_kb);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1048</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size_kb</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ptr5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">255</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">getchar</span><span class="p">();</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"free ptr[0] %dkb</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">ptr1</span><span class="p">);</span>

<span class="w">    </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"free ptr[1] %dkb</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">ptr2</span><span class="p">);</span>

<span class="w">    </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"free ptr[2] %dkb</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">ptr3</span><span class="p">);</span>

<span class="w">    </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"free ptr[3] %dkb</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">ptr4</span><span class="p">);</span>

<span class="w">    </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"free ptr[4] %dkb</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="w"> </span><span class="n">size_kb</span><span class="p">);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">ptr5</span><span class="p">);</span>

<span class="w">    </span><span class="n">getchar</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>æ“ä½œç³»ç»Ÿå¯¹äºå°å—å†…å­˜çš„ç®¡ç†æ–¹å¼ï¼Œå¦‚ Linux å†…æ ¸ä¸­çš„å»¶è¿Ÿæ˜ å°„ï¼ˆLazy Mappingï¼‰æˆ–é›¶é¡µå¤åˆ¶ï¼ˆZero Page COWï¼‰ç­‰æŠ€æœ¯æ‰€å¯¼è‡´çš„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šæ¨è¿Ÿå®é™…çš„ç‰©ç†é¡µé¢æ˜ å°„ï¼Œç›´åˆ°é¦–æ¬¡è®¿é—®ç›¸åº”çš„å†…å­˜ä½ç½®ã€‚è¿™æ„å‘³ç€å³ä½¿æ‚¨è®¿é—®å’Œä¿®æ”¹äº†åˆ†é…çš„å†…å­˜ï¼Œå®é™…çš„ç‰©ç†é¡µé¢æ˜ å°„å¯èƒ½ä»ç„¶è¢«æ¨è¿Ÿã€‚å³ä½¿ä½¿ç”¨memsetä¿®æ”¹äº†å†…å­˜ï¼Œä½†æ˜¯å¯èƒ½ä¹Ÿä¸ä¼šè¿›è¡Œæ˜ å°„ï¼Œé€šå¸¸å¯èƒ½åªæœ‰åœ¨å†…å­˜è¢«ä¿®æ”¹ä¸ºä¸åŒå†…å®¹æ—¶ï¼Œæ‰ä¼šè¿›è¡Œå®é™…ç‰©ç†é¡µé¢æ˜ å°„ã€‚è€Œåªæœ‰åšäº†ç‰©ç†é¡µé¢æ˜ å°„ï¼Œè¿›ç¨‹çš„USSæ‰ä¼šå¢åŠ ã€‚</p></div>
  <div class="post-nav">
    <a class="prev" href="wordpressæ€ä¹ˆè¢«google-ç™¾åº¦æœç´¢åˆ°.html">â† wordpressæ€ä¹ˆè¢«googleï¼Œç™¾åº¦æœç´¢åˆ°ã€‚</a>
    <a class="next" href="wordpressè®¾å®šå›ºå®šé“¾æ¥.html">wordpressè®¾å®šå›ºå®šé“¾æ¥ â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

