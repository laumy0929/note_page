<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#initramfs">initramfsæ–¹å¼</a><ul></ul></li><li><a href="#ramdisk">ramdiskæ–¹å¼</a><ul></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2024-07-07
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      risc-v
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><p>æ ¹æ–‡ä»¶ç³»ç»Ÿæ˜¯æ§åˆ¶æƒä»linuxå†…æ ¸è½¬ç§»åˆ°ç”¨æˆ·ç©ºé—´çš„ä¸€ä¸ªæ¡¥æ¢ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½éœ€è¦æä¾›æŒ‚è½½ç‚¹ï¼Œlinuxå†…æ ¸åœ¨åˆå§‹åŒ–æ—¶æ±‡åˆå§‹åŒ–ä¸€ä¸ªè™šæ‹Ÿçš„â€œ/â€ç›®å½•ç”¨äºæ ¹æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">start_kernel</span>
<span class="w">    </span><span class="n">vfs_caches_init</span><span class="p">()</span>
<span class="w">    </span><span class="n">mnt_init</span><span class="p">()</span>
<span class="w">    </span><span class="n">init_rootfs</span><span class="p">()</span>
<span class="w">        </span><span class="n">init_mount_tree</span><span class="p">()</span>
<span class="w">            </span><span class="n">vfs_kern_mount</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootfs_fs_type</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">"rootfs"</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>
<p>æ ¹æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½å¾…æ—¥åè¿›ä¸€æ­¥ç ”ç©¶ï¼Œæœ¬å°ç»“å…ˆç®€å•ä»‹ç»ä¸€ä¸‹initrdï¼Œinitramfsï¼Œramdiskã€‚</p>
<p>å†…æ ¸å¯åŠ¨æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªåº”ç”¨è¿›ç¨‹ï¼Œéœ€è¦å…ˆè¯»å–æ–‡ä»¶ç³»ç»Ÿæ‰§è¡Œ/initæˆ–/sbin/initï¼Œå› æ­¤éœ€è¦å…ˆåˆå§‹åŒ–æ–‡ä»¶ç³»ç»Ÿã€‚è€Œæ–‡ä»¶ç³»ç»Ÿä¸€èˆ¬å­˜å‚¨åœ¨å­˜å‚¨ä»‹è´¨ï¼ˆflash,IDE,SCSIï¼‰ä¸Šï¼Œè®¿é—®è¿™äº›å­˜å‚¨ä»‹è´¨éœ€è¦æœ‰é©±åŠ¨ç¨‹åºã€‚é‚£ä¹ˆæ˜¯å¦æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜äº†ï¼Ÿä»¥ä¸‹æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³ï¼š ï¼ˆ1ï¼‰å­˜å‚¨ä»‹è´¨é©±åŠ¨ç¼–è¯‘è¿›å†…æ ¸ï¼šæ˜¯å°†å­˜å‚¨ä»‹è´¨çš„é©±åŠ¨ç¨‹åºç¼–è¯‘è¿›å†…æ ¸ï¼Œå†…æ ¸å¯åŠ¨é˜¶æ®µå°±å¯ä»¥è®¿é—®å­˜å‚¨ä»‹è´¨ã€‚è¿™ç§æ–¹æ³•å¯¹äºå›ºå®šå­˜å‚¨ä»‹è´¨å‹å·å€’ä¹Ÿè¿˜å¥½ï¼Œåªéœ€è¦ç¼–è¯‘å°‘æ•°é©±åŠ¨ç¨‹åºå³å¯ã€‚è€Œå¯¹äºå‘è¡Œç‰ˆæœ¬çš„linuxï¼Œå¦‚æœè¦æ”¯æŒå¾ˆå¤šä¸ªå­˜å‚¨ä»‹è´¨ï¼Œå°±éœ€è¦å°†å¾ˆå¤šé©±åŠ¨ç¼–è¯‘è¿›å†…æ ¸ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´linuxå†…æ ¸é•œåƒéå¸¸åºå¤§ã€‚ ï¼ˆ2ï¼‰åŸºäºramdiskçš„æ–‡ä»¶ç³»ç»Ÿï¼šramdiskä¸æ˜¯ä¸€ä¸ªå®é™…çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œæ˜¯ä¸€ç§å®é™…æ–‡ä»¶ç³»ç»Ÿè£…å…¥å†…å­˜çš„æœºåˆ¶ï¼Œå¹¶ä¸”å¯ä»¥åšä¸ºæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œæ¢å¥è¯è¯´ramdiskå®é™…ä¸Šæ˜¯ä»å†…å­˜åˆ’åˆ†ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œå½“ä½œç£ç›˜æ¥ä½¿ç”¨ï¼Œå¯ä»¥å¾€é‡Œé¢å­˜å‚¨ä»»ä½•ä¸œè¥¿ã€‚å› æ­¤å½“å­˜å‚¨ä»‹è´¨é©±åŠ¨ç¨‹åºæ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå†…å­˜æ¨¡æ‹Ÿæˆä¸€ä¸ªå­˜å‚¨ä»‹è´¨ï¼Œå†…æ ¸é…ç½®ä¸ŠCONFIG_BLK_DEV_RAMï¼Œå°±æ”¯æŒäº†ramdiskï¼Œä¸€èˆ¬ä¼šç”Ÿæˆ/dev/ramxèŠ‚ç‚¹ã€‚åŸºäºè¯¥èŠ‚ç‚¹æˆ‘ä»¬å¯ä»¥æ ¼å¼åŒ–æƒ³è¦çš„æ–‡ä»¶ç³»ç»Ÿã€‚ ï¼ˆ3ï¼‰åŸºäºramdiskçš„initrdï¼ˆbootloader initialized RAM Diskï¼‰ï¼šæ˜¯é’ˆå¯¹æ–¹æ³•ï¼ˆ1ï¼‰çš„æ”¹è¿›ï¼ŒæŠŠå†…å­˜å½“ä½œå­˜å‚¨ä»‹è´¨ï¼Œè¿™æ–¹æ–¹å¼æˆ‘ä»¬ç§°ä¸ºramdiskï¼Œè®¾å¤‡èŠ‚ç‚¹ä¸º/dev/ramXã€‚initrdæ˜¯ä¸€ä¸ªè¢«å‹ç¼©è¿‡çš„å°å‹æ ¹ç›®å½•ï¼ŒåŒ…å«äº†å¯åŠ¨é˜¶æ®µä¸­å¿…é¡»çš„é©±åŠ¨æ¨¡å—ï¼Œè¿™ä¸ªç›®å½•ä¸­åŒ…å«äº†å¯åŠ¨é˜¶æ®µä¸­å¿…é¡»çš„é©±åŠ¨æ¨¡å—ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å’Œå¯åŠ¨è„šæœ¬ã€‚å½“ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œbootloaderä¼šæŠŠinitrdæ–‡ä»¶è¯»åˆ°å†…å­˜ä¸­ï¼Œç„¶åæŠŠinitrdæ–‡ä»¶åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€å’Œå¤§å°ä¼ é€’ç»™å†…æ ¸ã€‚å†…æ ¸åœ¨å¯åŠ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¼šè§£å‹ç¼©initrdæ–‡ä»¶ï¼Œç„¶åå°†è§£å‹åçš„initrdæŒ‚è½½ä¸ºæ ¹ç›®å½•ï¼Œç„¶åæ‰§è¡Œæ ¹ç›®å½•ä¸­çš„/linuxrcè„šæœ¬ï¼ˆcpioæ ¼å¼çš„initrdä¸º/init,è€Œimageæ ¼å¼çš„initrd&lt;ä¹Ÿç§°è€å¼å—è®¾å¤‡çš„initrdæˆ–ä¼ ç»Ÿçš„æ–‡ä»¶é•œåƒæ ¼å¼çš„initrd&gt;ä¸º/initrcï¼‰ï¼Œå°±å¯ä»¥åœ¨è¿™ä¸ªè„šæœ¬ä¸­åŠ è½½realfsï¼ˆçœŸå®æ–‡ä»¶ç³»ç»Ÿï¼‰å­˜æ”¾è®¾å¤‡çš„é©±åŠ¨ç¨‹åºä»¥åŠåœ¨/devç›®å½•ä¸‹å»ºç«‹å¿…è¦çš„è®¾å¤‡èŠ‚ç‚¹ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥mountçœŸæ­£çš„æ ¹ç›®å½•ï¼Œå¹¶åˆ‡æ¢åˆ°è¿™ä¸ªæ ¹ç›®å½•ä¸­æ¥ã€‚initrdå¹¶ä¸æ˜¯ä¸€ä¸ªå®é™…çš„æ–‡ä»¶ç³»ç»Ÿï¼Œåªèƒ½è¯´ç®—æ˜¯ä¸€ä¸ªæ‰“åŒ…çš„æ ¹ç›®å½•ã€‚ ï¼ˆ4ï¼‰åŸºäºå†…å­˜çš„initramfsï¼šæ–¹å¼ï¼ˆ3ï¼‰æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œå°±æ˜¯å¿…é¡»è¦äº‹å…ˆæ”¯æŒramdiskï¼Œåˆ†é…å›ºå®šçš„å¤§å°ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤§å°åˆ°åº•åˆ†é…å¤šå°‘äº†ï¼Ÿåˆ†å¤šäº†æµªè´¹ï¼Œåˆ†å°‘äº†å¯èƒ½ä¸å¤Ÿï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œåœ¨linux2.5å†…æ ¸ä¹‹åå‡ºç°äº†initramfsã€‚å®ƒçš„ä½œç”¨å’Œinitrdç±»ä¼¼ï¼Œåªæ˜¯å’Œå†…æ ¸ç¼–è¯‘æˆä¸€ä¸ªæ–‡ä»¶ã€‚initramfsæ˜¯ç»è¿‡gzipå‹ç¼©åçš„cpioæ ¼å¼å’Œæ•°æ®æ–‡ä»¶ï¼Œè¯¥cpioæ ¼å¼æ–‡ä»¶è¢«é“¾æ¥è¿›äº†å†…æ ¸ä¸­ç‰¹æ®Šçš„æ•°æ®ç«¯.init.ramfsä¸Šï¼Œå…¶ä¸­å…¨å±€å˜é‡__initramfs_startå’Œ__initramfs_endåˆ†åˆ«æŒ‡å‘è¿™ä¸ªæ•°æ®æ®µçš„èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€ã€‚å†…æ ¸å¯åŠ¨æ—¶ä¼šå¯¹.init.ramfsæ®µä¸­çš„æ•°æ®è¿›è¡Œè§£å‹ï¼Œç„¶åä½¿ç”¨å®ƒä½œä¸ºä¸´æ—¶çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚è¿™ç§æ–¹å¼ä¾æ—§ä¼šå¯¼è‡´å†…æ ¸é•œåƒå˜å¤§ã€‚æ³¨æ„ï¼šinitramfsæœ¬èº«æ˜¯ä¸€ä¸ªramfsæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®ƒå¯ä»¥å†…åµŒåˆ°å†…æ ¸ä¸­ï¼Œä¹Ÿå¯ä»¥å•ç‹¬å­˜åœ¨ Initrdå’Œinitramfsçš„åŒºåˆ«ï¼Ÿ ï¼ˆ1ï¼‰ Linuxå†…æ ¸åªè®¤cpioæ ¼å¼çš„initramfsæ–‡ä»¶åŒ…(å› ä¸ºunpack_to_rootfsåªèƒ½è§£æcpioæ ¼å¼æ–‡ä»¶)ï¼Œécpioæ ¼å¼çš„ initramfsæ–‡ä»¶åŒ…å°†è¢«ç³»ç»ŸæŠ›å¼ƒï¼Œè€Œinitrdå¯ä»¥æ˜¯cpioåŒ…ä¹Ÿå¯ä»¥æ˜¯ä¼ ç»Ÿçš„é•œåƒ(image)æ–‡ä»¶ï¼Œå®é™…ä½¿ç”¨ä¸­initrdéƒ½æ˜¯ä¼ ç»Ÿé•œåƒæ–‡ä»¶ã€‚ ï¼ˆ2ï¼‰initramfsåœ¨ç¼–è¯‘å†…æ ¸çš„åŒæ—¶è¢«ç¼–è¯‘å¹¶ä¸å†…æ ¸è¿æ¥æˆä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒè¢«é“¾æ¥åˆ°åœ°å€__initramfs_startå¤„ï¼Œä¸å†…æ ¸åŒæ—¶è¢« bootloaderåŠ è½½åˆ°ramä¸­ï¼Œè€Œinitrdæ˜¯å¦å¤–å•ç‹¬ç¼–è¯‘ç”Ÿæˆçš„ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œå®ƒç”±bootloaderå•ç‹¬åŠ è½½åˆ°ramä¸­å†…æ ¸ç©ºé—´å¤–çš„åœ°å€ï¼Œæ¯”å¦‚åŠ è½½çš„åœ°å€ä¸ºaddr(æ˜¯ç‰©ç†åœ°å€è€Œéè™šæ‹Ÿåœ°å€)ï¼Œå¤§å°ä¸º8MBï¼Œé‚£ä¹ˆåªè¦åœ¨å‘½ä»¤è¡ŒåŠ å…¥\"initrd=addr,8M\"å‘½ä»¤ï¼Œç³»ç»Ÿå°±å¯ä»¥æ‰¾åˆ° initrd(å½“ç„¶é€šè¿‡é€‚å½“ä¿®æ”¹Linuxçš„ç›®å½•ç»“æ„ï¼Œmakefileæ–‡ä»¶å’Œç›¸å…³ä»£ç ï¼Œä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½æ˜¯å¯ä»¥ç›¸é€šçš„)ã€‚ ï¼ˆ3ï¼‰initramfsè¢«è§£æå¤„ç†ååŸå§‹çš„cpioåŒ…(å‹ç¼©æˆ–éå‹ç¼©)æ‰€å çš„ç©ºé—´(&amp;__initramfs_start - &amp;__initramfs_end)æ˜¯ä½œä¸ºç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ç›´æ¥ä¿ç•™åœ¨ç³»ç»Ÿä¸­ï¼Œä¸ä¼šè¢«é‡Šæ”¾æ‰ï¼Œè€Œå¯¹äºinitrdé•œåƒæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰åœ¨å‘½ä»¤è¡Œä¸­è®¾ç½®\"keepinitd\"å‘½ä»¤ï¼Œé‚£ä¹ˆinitrdé•œåƒæ–‡ä»¶è¢«å¤„ç†åå…¶åŸå§‹æ–‡ä»¶æ‰€å çš„ç©ºé—´(initrd_end - initrd_start)å°†è¢«é‡Šæ”¾æ‰ã€‚ ï¼ˆ4ï¼‰initramfså¯ä»¥ç‹¬ç«‹ram diskå•ç‹¬å­˜åœ¨ï¼Œè€Œè¦æ”¯æŒinitrdå¿…é¡»è¦å…ˆæ”¯æŒram diskï¼Œå³è¦é…ç½®CONFIG_BLK_DEV_INITRDé€‰é¡¹ -- æ”¯æŒinitrdï¼Œå¿…é¡»å…ˆè¦é…ç½®CONFIG_BLK_DEV_RAM -- æ”¯æŒram disk ï¼Œå› ä¸ºinitrd imageå®é™…å°±æ˜¯åˆå§‹åŒ–å¥½äº†çš„ramdiské•œåƒæ–‡ä»¶ï¼Œæœ€åéƒ½è¦è§£æã€å†™å…¥åˆ°ram diskè®¾å¤‡/dev/ramæˆ–/dev/ram0ä¸­ã€‚æ³¨: ä½¿ç”¨initramfsï¼Œå‘½ä»¤è¡Œå‚æ•°å°†ä¸éœ€è¦\"initrd=\"å’Œ\"root=\"å‘½ä»¤ åœ¨linux2.5ä¹‹åï¼Œå‡ºç°äº†initramfsï¼Œinitrdæœ‰å…¶å›ºæœ‰çš„ç¼ºé™·ï¼ˆéœ€è¦ramdiskï¼Œå›ºå®šå¤§å°å†…å­˜ç­‰ï¼‰ï¼Œæœ¬ç« èŠ‚å°±é‡ç‚¹ä»‹ç»ä¸€ä¸‹initramfså’ŒåŸºäºramdiskçš„æ–‡ä»¶ç³»ç»Ÿæ–¹å¼ã€‚</p>
<h2 id="initramfs">initramfsæ–¹å¼</h2>
<p>æ—©æœŸä½¿ç”¨çš„æ˜¯initrdï¼Œä½†æ˜¯åœ¨linux2.5ä¹‹åå°±å‡çº§ä¸ºinitramfsï¼Œå› æ­¤æœ¬ç« èŠ‚é‡ç‚¹æè¿°initramfsã€‚ initramfså¯ä»¥ç›´æ¥é›†æˆåˆ°kernelé‡Œé¢ï¼Œä¹Ÿå¯ä»¥å•ç‹¬åŠ è½½initramfsã€‚ å†…æ ¸é…ç½®é€‰æ‹©</p>
<div class="codehilite"><pre><span></span><code><span class="n">General</span><span class="w"> </span><span class="n">setup</span>
<span class="w"> </span><span class="o">----&gt;</span><span class="w"> </span><span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Initial</span><span class="w"> </span><span class="n">RAM</span><span class="w"> </span><span class="n">filesystem</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">RAM</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="p">(</span><span class="n">initramfs</span><span class="o">/</span><span class="n">initrd</span><span class="p">)</span><span class="w"> </span><span class="n">support</span>

<span class="n">ä»¥ä¸‹æ˜¯è¦æ”¯æŒå‹ç¼©çš„æ ¼å¼</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Support</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">ramdisk</span><span class="o">/</span><span class="n">ramfs</span><span class="w"> </span><span class="n">compressed</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">gzip</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Support</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">ramdisk</span><span class="o">/</span><span class="n">ramfs</span><span class="w"> </span><span class="n">compressed</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">bzip2</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Support</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">ramdisk</span><span class="o">/</span><span class="n">ramfs</span><span class="w"> </span><span class="n">compressed</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">LZMA</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Support</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">ramdisk</span><span class="o">/</span><span class="n">ramfs</span><span class="w"> </span><span class="n">compressed</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">XZ</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Support</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">ramdisk</span><span class="o">/</span><span class="n">ramfs</span><span class="w"> </span><span class="n">compressed</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">LZO</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Support</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">ramdisk</span><span class="o">/</span><span class="n">ramfs</span><span class="w"> </span><span class="n">compressed</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">LZ4</span>
</code></pre></div>
<p>åˆ¶ä½œinitramfs</p>
<div class="codehilite"><pre><span></span><code><span class="n">cp</span><span class="w"> </span><span class="n">busybox</span><span class="o">/</span><span class="n">_install</span><span class="o">/</span><span class="w">  </span><span class="n">rootfs</span>
<span class="n">cd</span><span class="w"> </span><span class="n">rootfs</span>
<span class="n">find</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cpio</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="n">newc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">rootfs</span><span class="p">.</span><span class="n">cpio</span><span class="w">   </span><span class="c1">//å°†æ–‡ä»¶å¤åˆ¶æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶</span>
<span class="n">gzip</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="n">rootfs</span><span class="p">.</span><span class="n">cpio</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">rootfs</span><span class="p">.</span><span class="n">cpio</span><span class="p">.</span><span class="n">gz</span><span class="w">     </span><span class="c1">//å°†æ–‡ä»¶è¿›è¡Œå‹ç¼©ä¸ºgzæ ¼å¼</span>
</code></pre></div>
<p>å…¶ä¸­è®¾ç½®-append \"rdinit=/linuxrc\"æ˜¯Linuxå†…æ ¸å‘½ä»¤è¡Œã€å¯åŠ¨å‚æ•°ï¼Œ-initrd initramfs/rootfs/rootfs.cpio.gz æŒ‡å®šæ–‡ä»¶é•œåƒã€‚Rootfs.cpio.gzæ˜¯è¦å’Œå†…æ ¸ç¼–è¯‘è¿›ä¸€ä¸ªæ–‡ä»¶çš„ï¼Œä½†æ˜¯qemuæ”¯æŒé€šè¿‡-initrdæŒ‡å®šæ–‡ä»¶é•œåƒã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">qemu</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">riscv64</span><span class="w"> </span><span class="o">-</span><span class="n">M</span><span class="w"> </span><span class="n">virt</span><span class="w"> </span><span class="o">-</span><span class="n">cpu</span><span class="w"> </span><span class="n">c910v</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="mi">256</span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="n">nographic</span><span class="w"> </span><span class="err">\</span>\
<span class="w"> </span><span class="o">-</span><span class="n">bios</span><span class="w"> </span><span class="n">qemu</span><span class="o">-</span><span class="n">opensbi</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">generic</span><span class="o">/</span><span class="n">firmware</span><span class="o">/</span><span class="n">fw_jump</span><span class="p">.</span><span class="n">bin</span><span class="w"> </span><span class="err">\</span>\
<span class="w"> </span><span class="o">-</span><span class="n">kernel</span><span class="w"> </span><span class="n">linux</span><span class="mf">-5.4</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">riscv</span><span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">Image</span><span class="w"> </span><span class="err">\</span>\
<span class="w"> </span><span class="o">-</span><span class="n">initrd</span><span class="w"> </span><span class="n">initramfs</span><span class="o">/</span><span class="n">rootfs</span><span class="o">/</span><span class="n">rootfs</span><span class="p">.</span><span class="n">cpio</span><span class="p">.</span><span class="n">gz</span><span class="w"> </span><span class="err">\</span>\
<span class="w"> </span><span class="o">-</span><span class="n">append</span><span class="w"> </span><span class="s">"rdinit=/linuxrc"</span>
</code></pre></div>
<p>å…¶ä¸­è®¾ç½®-append \"rdinit=/linuxrc\"æ˜¯Linuxå†…æ ¸å‘½ä»¤è¡Œã€å¯åŠ¨å‚æ•°ï¼Œ-initrd initramfs/rootfs/rootfs.cpio.gz æŒ‡å®šæ–‡ä»¶é•œåƒã€‚Rootfs.cpio.gzæ˜¯è¦å’Œå†…æ ¸ç¼–è¯‘è¿›ä¸€ä¸ªæ–‡ä»¶çš„ï¼Œä½†æ˜¯qemuæ”¯æŒé€šè¿‡-initrdæŒ‡å®šæ–‡ä»¶é•œåƒã€‚ å¦‚æœè¦å°†æ ¹æ–‡ä»¶ç³»ç»Ÿå†…åµŒå¦‚å†…æ ¸</p>
<div class="codehilite"><pre><span></span><code><span class="n">General</span><span class="w"> </span><span class="n">setup</span>
<span class="w"> </span><span class="o">----&gt;</span><span class="w"> </span><span class="p">(..</span><span class="o">/</span><span class="n">initramfs</span><span class="o">/</span><span class="n">rootfs</span><span class="o">/</span><span class="n">rootfs</span><span class="p">.</span><span class="n">cpio</span><span class="p">.</span><span class="n">gz</span><span class="p">)</span><span class="w"> </span><span class="n">Initramfs</span><span class="w"> </span><span class="n">sourc</span>
</code></pre></div>
<h2 id="ramdisk">ramdiskæ–¹å¼</h2>
<p>ramdiskçš„æ–¹å¼æ˜¯å°†å†…å­˜ä½œä¸ºå­˜å‚¨ç›˜ï¼Œç”Ÿæˆä¸€ä¸ª/dev/ramxçš„èŠ‚ç‚¹ã€‚ä½œä¸ºå­˜å‚¨ä»‹è´¨ä¸ä¸€å®šä½¿ç”¨ramfsæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ext2ï¼Œext4ç­‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ramfsã€‚æœ¬å°ç»“æˆ‘ä»¬æ¼”ç¤ºåŸºäºramdiskæŒ‚è½½ext4çš„æ–¹å¼å¯åŠ¨ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="n">Drivers</span>
<span class="w">  </span><span class="o">----&gt;</span><span class="w"> </span><span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="n">devices</span>
<span class="w">   </span><span class="o">----&gt;</span><span class="w"> </span><span class="o">&lt;*&gt;</span><span class="w"> </span><span class="n">RAM</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">support</span>
<span class="w">    </span><span class="o">----&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">65535</span><span class="p">)</span><span class="w"> </span><span class="n">Default</span><span class="w"> </span><span class="n">RAM</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="p">(</span><span class="n">kbytes</span><span class="p">)</span>
</code></pre></div>
<p>Ramdiskæ˜¯åœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿç£ç›˜ï¼Œä½¿ç”¨ramdiskæ¯”Initramfsçµæ´»ä¸€äº›ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½å»ç¼–è¯‘å†…æ ¸ã€‚ä¸è¿‡åœ¨qemuä¸­ï¼Œéƒ½æ”¯æŒé€šè¿‡-initrdæŒ‡å®šæ–‡ä»¶é•œåƒã€‚æ³¨æ„ramdiskå¤§å°ä¸€å®šè¦è¶³å¤Ÿå¤§ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">qemu</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">riscv64</span><span class="w"> </span><span class="o">-</span><span class="n">M</span><span class="w"> </span><span class="n">virt</span><span class="w"> </span><span class="o">-</span><span class="n">cpu</span><span class="w"> </span><span class="n">c910v</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="mi">2</span><span class="n">G</span><span class="w"> </span><span class="o">-</span><span class="n">nographic</span><span class="w"> </span><span class="err">\</span>\
<span class="w"> </span><span class="o">-</span><span class="n">bios</span><span class="w"> </span><span class="n">qemu</span><span class="o">-</span><span class="n">opensbi</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">generic</span><span class="o">/</span><span class="n">firmware</span><span class="o">/</span><span class="n">fw_jump</span><span class="p">.</span><span class="n">bin</span><span class="w"> </span><span class="err">\</span>\
<span class="w"> </span><span class="o">-</span><span class="n">kernel</span><span class="w"> </span><span class="n">linux</span><span class="mf">-5.4</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">riscv</span><span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">Image</span><span class="w"> </span><span class="err">\</span>\
<span class="w"> </span><span class="o">-</span><span class="n">initrd</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">rootfs_7_4</span><span class="p">.</span><span class="n">img</span><span class="w"> </span><span class="err">\</span>\
<span class="w"> </span><span class="o">-</span><span class="n">append</span><span class="w"> </span><span class="s">"root=/dev/ram0 ramdisk_size=268435456 rw console=ttyS0"</span>
</code></pre></div>
<p>æ ¹æ–‡ä»¶ç³»ç»Ÿåˆ¶ä½œæ–¹æ³•</p>
<div class="codehilite"><pre><span></span><code><span class="n">qemu</span><span class="o">-</span><span class="n">img</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">rootfs</span><span class="p">.</span><span class="n">img</span><span class="w"> </span><span class="mi">256</span><span class="n">M</span><span class="w">   </span><span class="err">#</span><span class="o">---</span><span class="n">åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</span>
<span class="n">mkfs</span><span class="p">.</span><span class="n">ext4</span><span class="w"> </span><span class="n">rootfs</span><span class="p">.</span><span class="n">img</span><span class="w">            </span><span class="err">#</span><span class="o">---</span><span class="n">å°†æ–‡ä»¶æ ¼å¼ä¸ºext4æ ¼å¼</span>
<span class="n">mkdir</span><span class="w"> </span><span class="n">rootfs</span>
<span class="n">sudo</span><span class="w"> </span><span class="n">mount</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="n">rootfs</span><span class="p">.</span><span class="n">img</span><span class="w"> </span><span class="n">rootfs</span><span class="w">  </span><span class="err">#</span><span class="o">---</span><span class="n">æŒ‚åœ¨æ–‡ä»¶åˆ°rootfsä¸‹</span><span class="err">ï¼Œ</span><span class="n">å°†å‘½ä»¤ç­‰æ‹·è´è¿›å»</span>
<span class="n">cd</span><span class="w"> </span><span class="n">rootfs</span>
<span class="n">sudo</span><span class="w"> </span><span class="n">mkdir</span><span class="w"> </span><span class="n">dev</span>
<span class="n">sudo</span><span class="w"> </span><span class="n">mkdir</span><span class="w"> </span><span class="n">proc</span>
<span class="n">sudo</span><span class="w"> </span><span class="n">mkdir</span><span class="w"> </span><span class="n">sys</span>
<span class="n">sudo</span><span class="w"> </span><span class="n">cp</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="n">busyboxsource</span><span class="o">/</span><span class="n">_install</span><span class="cm">/* .</span>
<span class="cm">sudo mkdir proc sys dev etc etc/init.d</span>
<span class="cm">cd etc/init.d/</span>
<span class="cm">sudo touch rcS</span>
<span class="cm">sudo vi rcS</span>

<span class="cm">#!/bin/sh</span>
<span class="cm">mount -t proc none /proc</span>
<span class="cm">mount -t sysfs none /sys</span>
<span class="cm">/sbin/mdev -s</span>
</code></pre></div></div>
  <div class="post-nav">
    <a class="prev" href="å¼‚å¸¸åˆå§‹åŒ–.html">â† å¼‚å¸¸åˆå§‹åŒ–</a>
    <a class="next" href="linuxç³»ç»Ÿrisc-væ¶æ„å¯åŠ¨æµç¨‹åˆ†æä¹‹æ¦‚è¿°.html">Linuxç³»ç»ŸRISC-Væ¶æ„å¯åŠ¨æµç¨‹åˆ†æä¹‹æ¦‚è¿° â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

