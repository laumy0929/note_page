<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RISC-VåŠ¨æ€é“¾æ¥å®éªŒ - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#_1">å‡†å¤‡</a><ul><li><a href="#_2">å®éªŒç¯å¢ƒ</a></li><li><a href="#_3">ä»£ç </a></li><li><a href="#_4">ç¼–è¯‘</a></li><li><a href="#qemu-gdb">qemu gdb</a></li></ul></li><li><a href="#plt">ç¬¬ä¸€æ¬¡è·³è½¬åˆ°PLTè¡¨</a><ul></ul></li><li><a href="#procedure-linkage-table">procedure linkage table</a><ul></ul></li><li><a href="#swap">å†æ¬¡è°ƒç”¨swapå‡½æ•°</a><ul></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>RISC-VåŠ¨æ€é“¾æ¥å®éªŒ</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2024-05-18
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      risc-v
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><h2 id="_1">å‡†å¤‡</h2>
<h3 id="_2">å®éªŒç¯å¢ƒ</h3>
<p>qemu linuxå¯åŠ¨ç¯å¢ƒï¼š <a href="https://www.laumy.tech/1186.html">https://www.laumy.tech/1186.html</a></p>
<h3 id="_3">ä»£ç </h3>
<p>åŠ¨æ€åº“</p>
<div class="codehilite"><pre><span></span><code><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">swap</span><span class="p">.</span><span class="n">c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">shared</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">swap</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"%s,%d</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="n">__func__</span><span class="p">,</span><span class="n">__LINE__</span><span class="p">);</span>
<span class="w">        </span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="o">*</span><span class="n">b</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>ä¸»ç¨‹åº</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="k">extern</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">shared</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">300</span><span class="p">;</span>

<span class="w">        </span><span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">shared</span><span class="p">);</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"a:%d,b:%d,c:%d</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
<span class="w">        </span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="w">        </span><span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"a:%d,b:%d,c:%d</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_4">ç¼–è¯‘</h3>
<div class="codehilite"><pre><span></span><code><span class="n">ç”ŸæˆåŠ¨æ€åº“</span><span class="err">ï¼š</span><span class="n">riscv64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">-</span><span class="n">gcc</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="o">-</span><span class="n">fPIC</span><span class="w"> </span><span class="o">-</span><span class="n">shared</span><span class="w"> </span><span class="n">swap</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">libswap</span><span class="p">.</span><span class="n">so</span>
<span class="n">ç”Ÿæˆå¯æ‰§è¡Œç¨‹åº</span><span class="err">ï¼š</span><span class="n">riscv64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">-</span><span class="n">gcc</span><span class="w"> </span><span class="o">-</span><span class="n">g</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">libswap</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>å°†ç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºé€šè¿‡é€šè¿‡mountæ–¹å¼æŒ‚è½½åˆ°qemu linuxä¸­ã€‚</p>
<h3 id="qemu-gdb">qemu gdb</h3>
<div class="codehilite"><pre><span></span><code><span class="n">å¯åŠ¨gdb</span><span class="err">ï¼š</span><span class="w"> </span><span class="n">riscv64</span><span class="o">-</span><span class="n">unknown</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">-</span><span class="n">gdb</span>
<span class="n">è¿æ¥</span><span class="err">ï¼š</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">remote</span><span class="err">ï¼š</span><span class="mi">1234</span>
<span class="n">åŠ è½½ç¬¦å·</span><span class="err">ï¼š</span><span class="n">file</span><span class="w"> </span><span class="n">xxx</span><span class="o">/</span><span class="n">a</span><span class="p">.</span><span class="n">out</span>
<span class="n">æ‰“æ–­ç‚¹</span><span class="err">ï¼š</span><span class="n">b</span><span class="w"> </span><span class="n">main</span>
<span class="n">æ‰§è¡Œæ˜¾ç¤ºä¿¡æ¯</span><span class="err">ï¼šï¼ˆ</span><span class="n">å¯å®ç°åœ¨gdbinitä¸­å†™å¥½</span><span class="err">ï¼‰</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$ra</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$sp</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s0</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s1</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s2</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s3</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s4</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s5</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a0</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a1</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a2</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a3</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a4</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a5</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a6</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a7</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t0</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t1</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t2</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t3</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t4</span>
<span class="w">    </span><span class="n">display</span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t5</span>
<span class="w">    </span><span class="n">set</span><span class="w"> </span><span class="n">disassemble</span><span class="o">-</span><span class="n">next</span><span class="o">-</span><span class="n">line</span><span class="w"> </span><span class="n">on</span>
<span class="n">åœ¨qemu</span><span class="w"> </span><span class="n">linuxä¸­</span><span class="err">ï¼š</span><span class="p">.</span><span class="o">/</span><span class="n">a</span><span class="p">.</span><span class="n">out</span>
</code></pre></div>
<h2 id="plt">ç¬¬ä¸€æ¬¡è·³è½¬åˆ°PLTè¡¨</h2>
<p>å‡†å¤‡è·³è½¬åˆ°swap@pltè¡¨</p>
<div class="codehilite"><pre><span></span><code><span class="mh">0x00000000000105d0</span><span class="w">      </span><span class="mi">7</span><span class="w">               </span><span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">shared</span><span class="p">);</span>
<span class="w">   </span><span class="mh">0x00000000000105c6</span><span class="w"> </span><span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">16</span><span class="o">&gt;:</span><span class="w">        </span><span class="n">fec40713</span><span class="w">        </span><span class="n">addi</span><span class="w">    </span><span class="n">a4</span><span class="p">,</span><span class="n">s0</span><span class="p">,</span><span class="mi">-20</span>
<span class="w">   </span><span class="mh">0x00000000000105ca</span><span class="w"> </span><span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">20</span><span class="o">&gt;:</span><span class="w">        </span><span class="mi">83818593</span><span class="w">        </span><span class="n">addi</span><span class="w">    </span><span class="n">a1</span><span class="p">,</span><span class="n">gp</span><span class="p">,</span><span class="mi">-1992</span>
<span class="w">   </span><span class="mh">0x00000000000105ce</span><span class="w"> </span><span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">24</span><span class="o">&gt;:</span><span class="w">        </span><span class="mi">853</span><span class="n">a</span><span class="w">            </span><span class="n">mv</span><span class="w">      </span><span class="n">a0</span><span class="p">,</span><span class="n">a4</span>
<span class="o">=&gt;</span><span class="w"> </span><span class="mh">0x00000000000105d0</span><span class="w"> </span><span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">26</span><span class="o">&gt;:</span><span class="w">        </span><span class="n">f11ff0ef</span><span class="w">        </span><span class="n">jal</span><span class="w">     </span><span class="n">ra</span><span class="p">,</span><span class="mh">0x104e0</span><span class="w"> </span><span class="o">&lt;</span><span class="n">swap</span><span class="err">@</span><span class="n">plt</span><span class="o">&gt;</span>

<span class="n">å¯„å­˜å™¨ä¿¡æ¯å¦‚ä¸‹</span><span class="err">ï¼š</span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$ra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000000000105d4</span>
<span class="mi">11</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000003fd23d4bf0</span>
<span class="mi">12</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000003fd23d4c10</span>
<span class="mi">13</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000000000000000</span>
<span class="mi">14</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000000000145f60</span>
<span class="mi">15</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000000000000000</span>
<span class="mi">16</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000000001a2828</span>
<span class="mi">17</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$s5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000000000000000</span>
<span class="mi">18</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000003fd23d4bfc</span>
<span class="mi">19</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000000000012038</span>
<span class="mi">20</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000003fd23d4d98</span>
<span class="mi">21</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000000000000000</span>
<span class="mi">22</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000003fd23d4bfc</span>
<span class="mi">23</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000000000000064</span>
<span class="mi">24</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000003f81c60d90</span>
<span class="mi">25</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$a7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7a2f5b5a40014e00</span>
<span class="mi">26</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000003f81b61e18</span>
<span class="mi">27</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000003f81b7e6d2</span>
<span class="mi">28</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xffffffffffffffff</span>
<span class="mi">29</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000000000206d2</span>
<span class="mi">30</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000003f81c86a8c</span>
<span class="mi">31</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">z</span><span class="w"> </span><span class="n">$t5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000000000000004</span>
</code></pre></div>
<p>ä¸‹é¢æ˜¯.pltçš„ä»£ç ï¼Œå…ˆå…³æ³¨swap@plt</p>
<div class="codehilite"><pre><span></span><code><span class="n">Disassembly</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="p">.</span><span class="n">plt</span><span class="o">:</span>

<span class="mo">00000000000104</span><span class="n">a0</span><span class="w"> </span><span class="o">&lt;</span><span class="n">_PROCEDURE_LINKAGE_TABLE_</span><span class="o">&gt;:</span>
<span class="w">   </span><span class="mi">104</span><span class="n">a0</span><span class="o">:</span><span class="w">   </span><span class="mo">000023</span><span class="mi">97</span><span class="w">            </span><span class="n">auipc</span><span class="w">   </span><span class="n">t2</span><span class="p">,</span><span class="mh">0x2</span>
<span class="w">   </span><span class="mi">104</span><span class="n">a4</span><span class="o">:</span><span class="w">   </span><span class="mi">41</span><span class="n">c30333</span><span class="w">            </span><span class="n">sub</span><span class="w"> </span><span class="n">t1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t3</span>
<span class="w">   </span><span class="mi">104</span><span class="n">a8</span><span class="o">:</span><span class="w">   </span><span class="n">b683be03</span><span class="w">            </span><span class="n">ld</span><span class="w">  </span><span class="n">t3</span><span class="p">,</span><span class="mi">-1176</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">12008</span><span class="w"> </span><span class="o">&lt;</span><span class="n">__TMC_END__</span><span class="o">&gt;</span>
<span class="w">   </span><span class="mi">104</span><span class="n">ac</span><span class="o">:</span><span class="w">   </span><span class="n">fd430313</span><span class="w">            </span><span class="n">addi</span><span class="w">    </span><span class="n">t1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="mi">-44</span>
<span class="w">   </span><span class="mi">104</span><span class="n">b0</span><span class="o">:</span><span class="w">   </span><span class="n">b6838293</span><span class="w">            </span><span class="n">addi</span><span class="w">    </span><span class="n">t0</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="mi">-1176</span>
<span class="w">   </span><span class="mi">104</span><span class="n">b4</span><span class="o">:</span><span class="w">   </span><span class="mo">00135313</span><span class="w">            </span><span class="n">srli</span><span class="w">    </span><span class="n">t1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="mh">0x1</span>
<span class="w">   </span><span class="mi">104</span><span class="n">b8</span><span class="o">:</span><span class="w">   </span><span class="mo">00</span><span class="mi">82</span><span class="n">b283</span><span class="w">            </span><span class="n">ld</span><span class="w">  </span><span class="n">t0</span><span class="p">,</span><span class="mi">8</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>
<span class="w">   </span><span class="mi">104</span><span class="n">bc</span><span class="o">:</span><span class="w">   </span><span class="mf">000e0067</span><span class="w">            </span><span class="n">jr</span><span class="w">  </span><span class="n">t3</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">1</span><span class="n">a000</span><span class="w"> </span><span class="o">&lt;</span><span class="n">__global_pointer$</span><span class="o">+</span><span class="mh">0x7800</span><span class="o">&gt;</span>

<span class="mo">00000000000104</span><span class="n">c0</span><span class="w"> </span><span class="o">&lt;</span><span class="n">__libc_start_main</span><span class="err">@</span><span class="n">plt</span><span class="o">&gt;:</span>
<span class="w">   </span><span class="mi">104</span><span class="n">c0</span><span class="o">:</span><span class="w">   </span><span class="mf">00002e17</span><span class="w">            </span><span class="n">auipc</span><span class="w">   </span><span class="n">t3</span><span class="p">,</span><span class="mh">0x2</span>
<span class="w">   </span><span class="mi">104</span><span class="n">c4</span><span class="o">:</span><span class="w">   </span><span class="n">b58e3e03</span><span class="w">            </span><span class="n">ld</span><span class="w">  </span><span class="n">t3</span><span class="p">,</span><span class="mi">-1192</span><span class="p">(</span><span class="n">t3</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">12018</span><span class="w"> </span><span class="o">&lt;</span><span class="n">__libc_start_main</span><span class="err">@</span><span class="n">GLIBC_2</span><span class="mf">.27</span><span class="o">&gt;</span>
<span class="w">   </span><span class="mi">104</span><span class="n">c8</span><span class="o">:</span><span class="w">   </span><span class="mf">000e0367</span><span class="w">            </span><span class="n">jalr</span><span class="w">    </span><span class="n">t1</span><span class="p">,</span><span class="n">t3</span>
<span class="w">   </span><span class="mi">104</span><span class="n">cc</span><span class="o">:</span><span class="w">   </span><span class="mo">00000013</span><span class="w">            </span><span class="n">nop</span>

<span class="mo">00000000000104</span><span class="n">d0</span><span class="w"> </span><span class="o">&lt;</span><span class="n">sleep</span><span class="err">@</span><span class="n">plt</span><span class="o">&gt;:</span>
<span class="w">   </span><span class="mi">104</span><span class="n">d0</span><span class="o">:</span><span class="w">   </span><span class="mf">00002e17</span><span class="w">            </span><span class="n">auipc</span><span class="w">   </span><span class="n">t3</span><span class="p">,</span><span class="mh">0x2</span>
<span class="w">   </span><span class="mi">104</span><span class="n">d4</span><span class="o">:</span><span class="w">   </span><span class="n">b50e3e03</span><span class="w">            </span><span class="n">ld</span><span class="w">  </span><span class="n">t3</span><span class="p">,</span><span class="mi">-1200</span><span class="p">(</span><span class="n">t3</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">12020</span><span class="w"> </span><span class="o">&lt;</span><span class="n">sleep</span><span class="err">@</span><span class="n">GLIBC_2</span><span class="mf">.27</span><span class="o">&gt;</span>
<span class="w">   </span><span class="mi">104</span><span class="n">d8</span><span class="o">:</span><span class="w">   </span><span class="mf">000e0367</span><span class="w">            </span><span class="n">jalr</span><span class="w">    </span><span class="n">t1</span><span class="p">,</span><span class="n">t3</span>
<span class="w">   </span><span class="mi">104</span><span class="n">dc</span><span class="o">:</span><span class="w">   </span><span class="mo">00000013</span><span class="w">            </span><span class="n">nop</span>

<span class="mf">00000000000104e0</span><span class="w"> </span><span class="o">&lt;</span><span class="n">swap</span><span class="err">@</span><span class="n">plt</span><span class="o">&gt;:</span>
<span class="w">   </span><span class="mf">104e0</span><span class="o">:</span><span class="w">   </span><span class="mf">00002e17</span><span class="w">            </span><span class="n">auipc</span><span class="w">   </span><span class="n">t3</span><span class="p">,</span><span class="mh">0x2</span>
<span class="w">   </span><span class="mf">104e4</span><span class="o">:</span><span class="w">   </span><span class="n">b48e3e03</span><span class="w">            </span><span class="n">ld</span><span class="w">  </span><span class="n">t3</span><span class="p">,</span><span class="mi">-1208</span><span class="p">(</span><span class="n">t3</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">12028</span><span class="w"> </span><span class="o">&lt;</span><span class="n">swap</span><span class="o">&gt;</span>
<span class="w">   </span><span class="mf">104e8</span><span class="o">:</span><span class="w">   </span><span class="mf">000e0367</span><span class="w">            </span><span class="n">jalr</span><span class="w">    </span><span class="n">t1</span><span class="p">,</span><span class="n">t3</span>
<span class="w">   </span><span class="mi">104</span><span class="n">ec</span><span class="o">:</span><span class="w">   </span><span class="mo">00000013</span><span class="w">            </span><span class="n">nop</span>
</code></pre></div>
<p>ä»ä¸Šé¢å‘ç°ï¼Œswap@pltï¼Œæ˜¯ä»12028å¤„åŠ è½½ä¸€ä¸ªåœ°å€ï¼Œç„¶åè·³è½¬è¿è¡Œã€‚ä¸‹é¢åˆ™æ˜¯12028çš„åœ°å€ï¼Œå‘ç°æ˜¯.gotè¡¨ã€‚æ³¨æ„12028: 04a0 addi s0,sp,584ï¼Œä¸è¦è¢«è¿™ä¸ªè¯¯å¯¼ï¼Œæ­£å¥½åæ±‡ç¼–ç¿»è¯‘2å­—èŠ‚å¯¹åº”æ˜¯addi s0,sp,584ã€‚å®é™…ä¸Š0x12028å¤„å­˜å‚¨çš„åœ°å€æ˜¯ï¼š0x104a0,å› æ­¤ä¸Šé¢åŠ è½½çš„t3å€¼å°±æ˜¯0x104a0ï¼Œå³jalrå°†è·³è½¬åˆ°è¯¥å€¼è¿è¡Œã€‚è€Œ0x104a0æ­£å¥½æ˜¯_PROCEDURE_LINKAGE_TABLE_ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">Disassembly</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="p">.</span><span class="n">got</span><span class="o">:</span>

<span class="mo">000000000001200</span><span class="mi">8</span><span class="w"> </span><span class="o">&lt;</span><span class="n">__TMC_END__</span><span class="o">&gt;:</span>
<span class="w">   </span><span class="mi">12008</span><span class="o">:</span><span class="w">   </span><span class="n">ffffffff</span><span class="w">            </span><span class="mh">0xffffffff</span>
<span class="w">   </span><span class="mi">1200</span><span class="n">c</span><span class="o">:</span><span class="w">   </span><span class="n">ffffffff</span><span class="w">            </span><span class="mh">0xffffffff</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">   </span><span class="mi">12018</span><span class="o">:</span><span class="w">   </span><span class="mo">04</span><span class="n">a0</span><span class="w">                    </span><span class="n">addi</span><span class="w">    </span><span class="n">s0</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="mi">584</span>
<span class="w">   </span><span class="mi">1201</span><span class="n">a</span><span class="o">:</span><span class="w">   </span><span class="mo">0001</span><span class="w">                    </span><span class="n">nop</span>
<span class="w">   </span><span class="mi">1201</span><span class="n">c</span><span class="o">:</span><span class="w">   </span><span class="mo">0000</span><span class="w">                    </span><span class="n">unimp</span>
<span class="w">   </span><span class="mi">1201</span><span class="n">e</span><span class="o">:</span><span class="w">   </span><span class="mo">0000</span><span class="w">                    </span><span class="n">unimp</span>
<span class="w">   </span><span class="mi">12020</span><span class="o">:</span><span class="w">   </span><span class="mo">04</span><span class="n">a0</span><span class="w">                    </span><span class="n">addi</span><span class="w">    </span><span class="n">s0</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="mi">584</span>
<span class="w">   </span><span class="mi">12022</span><span class="o">:</span><span class="w">   </span><span class="mo">0001</span><span class="w">                    </span><span class="n">nop</span>
<span class="w">   </span><span class="mi">12024</span><span class="o">:</span><span class="w">   </span><span class="mo">0000</span><span class="w">                    </span><span class="n">unimp</span>
<span class="w">   </span><span class="mi">12026</span><span class="o">:</span><span class="w">   </span><span class="mo">0000</span><span class="w">                    </span><span class="n">unimp</span>
<span class="w">   </span><span class="mi">12028</span><span class="o">:</span><span class="w">   </span><span class="mo">04</span><span class="n">a0</span><span class="w">                    </span><span class="n">addi</span><span class="w">    </span><span class="n">s0</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="mi">584</span>
<span class="w">   </span><span class="mi">1202</span><span class="n">a</span><span class="o">:</span><span class="w">   </span><span class="mo">0001</span><span class="w">                    </span><span class="n">nop</span>
<span class="w">   </span><span class="mi">1202</span><span class="n">c</span><span class="o">:</span><span class="w">   </span><span class="mo">0000</span><span class="w">                    </span><span class="n">unimp</span>
<span class="w">    </span><span class="p">...</span>
</code></pre></div>
<p>ä»ä¸Šé¢åˆ†æå¯çŸ¥ï¼Œswapå‡½æ•°åœ°å€å­˜å‚¨åœ¨.gotè¡¨0x12028å¤„ï¼Œè€Œè¯¥å€¼åˆå€¼æ˜¯_PROCEDURE_LINKAGE_TABLE_ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ç¼–è¯‘å®Œè¿˜æ²¡æœ‰è¿è¡Œå‰ï¼Œswapåœ¨åŠ¨æ€åº“ä¸­åœ°å€å¹¶æ²¡æœ‰ç¡®å®šï¼Œå®é™…çš„åœ°å€éœ€è¦ç¨‹åºè¿è¡ŒåŠ è½½æ‰ä¼šç¡®å®šï¼Œæ‰€ä»¥äº†é»˜è®¤å…ˆå¡«_PROCEDURE_LINKAGE_TABLE_ï¼Œè€Œè¯¥æ ‡ç­¾ä¸­çš„ä»£ç ï¼Œæ­£å¥½å°±æ˜¯å¤„ç†å¯»å€swapåœ°å€çš„åŠŸèƒ½ã€‚</p>
<p>ä¸‹é¢æ˜¯gdbå•æ­¥è°ƒè¯•çš„ä¿¡æ¯ï¼Œä¸‹é¢çš„è·³è½¬è·Ÿæˆ‘ä»¬åˆ†æçš„ä¸€è‡´ã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_37f368d5fce10c18a29432289ae7c530.jpg"><img alt="" src="assets/doc/02-risc-v/risc-våŠ¨æ€é“¾æ¥å®éªŒ/images/wp_editor_md_37f368d5fce10c18a29432289ae7c530.jpg"/></a></p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡xå‘½ä»¤æŸ¥è¯¢.gotè¡¨çš„ä¿¡æ¯ <a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_26aefb61cc01ad30e21489a341dce805.jpg"><img alt="" src="assets/doc/02-risc-v/risc-våŠ¨æ€é“¾æ¥å®éªŒ/images/wp_editor_md_26aefb61cc01ad30e21489a341dce805.jpg"/></a></p>
<p>å°ç»“ï¼šè·³è½¬åˆ°.pltè¡¨ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œå¯¹åº”çš„.gotè¡¨ä¸­æ²¡æœ‰å­˜å‚¨swapçš„åœ°å€ï¼Œå°†å…ˆè·³è½¬åˆ°_PROCEDURE_LINKAGE_TABLE_ï¼Œå³.pltçš„ç¬¬ä¸€è¡¨é¡¹ã€‚</p>
<h2 id="procedure-linkage-table">procedure linkage table</h2>
<p>.pltçš„åœ°å€ä¸€è¡¨é¡¹å­˜å‚¨çš„æ˜¯é“¾æ¥å™¨è¡¨ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">Disassembly</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="p">.</span><span class="n">plt</span><span class="o">:</span>

<span class="mo">00000000000104</span><span class="n">a0</span><span class="w"> </span><span class="o">&lt;</span><span class="n">_PROCEDURE_LINKAGE_TABLE_</span><span class="o">&gt;:</span>
<span class="w">   </span><span class="mi">104</span><span class="n">a0</span><span class="o">:</span><span class="w">   </span><span class="mo">000023</span><span class="mi">97</span><span class="w">            </span><span class="n">auipc</span><span class="w">   </span><span class="n">t2</span><span class="p">,</span><span class="mh">0x2</span>
<span class="w">   </span><span class="mi">104</span><span class="n">a4</span><span class="o">:</span><span class="w">   </span><span class="mi">41</span><span class="n">c30333</span><span class="w">            </span><span class="n">sub</span><span class="w"> </span><span class="n">t1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t3</span>
<span class="w">   </span><span class="mi">104</span><span class="n">a8</span><span class="o">:</span><span class="w">   </span><span class="n">b683be03</span><span class="w">            </span><span class="n">ld</span><span class="w">  </span><span class="n">t3</span><span class="p">,</span><span class="mi">-1176</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">12008</span><span class="w"> </span><span class="o">&lt;</span><span class="n">__TMC_END__</span><span class="o">&gt;</span>
<span class="w">   </span><span class="mi">104</span><span class="n">ac</span><span class="o">:</span><span class="w">   </span><span class="n">fd430313</span><span class="w">            </span><span class="n">addi</span><span class="w">    </span><span class="n">t1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="mi">-44</span>
<span class="w">   </span><span class="mi">104</span><span class="n">b0</span><span class="o">:</span><span class="w">   </span><span class="n">b6838293</span><span class="w">            </span><span class="n">addi</span><span class="w">    </span><span class="n">t0</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="mi">-1176</span>
<span class="w">   </span><span class="mi">104</span><span class="n">b4</span><span class="o">:</span><span class="w">   </span><span class="mo">00135313</span><span class="w">            </span><span class="n">srli</span><span class="w">    </span><span class="n">t1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="mh">0x1</span>
<span class="w">   </span><span class="mi">104</span><span class="n">b8</span><span class="o">:</span><span class="w">   </span><span class="mo">00</span><span class="mi">82</span><span class="n">b283</span><span class="w">            </span><span class="n">ld</span><span class="w">  </span><span class="n">t0</span><span class="p">,</span><span class="mi">8</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>
<span class="w">   </span><span class="mi">104</span><span class="n">bc</span><span class="o">:</span><span class="w">   </span><span class="mf">000e0067</span><span class="w">            </span><span class="n">jr</span><span class="w">  </span><span class="n">t3</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">1</span><span class="n">a000</span><span class="w"> </span><span class="o">&lt;</span><span class="n">__global_pointer$</span><span class="o">+</span><span class="mh">0x7800</span><span class="o">&gt;</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_0e265ddce2c26dd3b9dc7c7485c872db.jpg"><img alt="" src="assets/doc/02-risc-v/risc-våŠ¨æ€é“¾æ¥å®éªŒ/images/wp_editor_md_0e265ddce2c26dd3b9dc7c7485c872db.jpg"/></a></p>
<p>ä¸Šé¢çš„æ±‡ç¼–æœ€ç»ˆä¼šè·³è½¬åˆ°é“¾æ¥å™¨é‡Œé¢ï¼Œæ‰€åšçš„å·¥ä½œå°±æ˜¯é€šè¿‡é“¾æ¥å™¨æŸ¥è¯¢swapçš„åœ°å€ï¼Œç„¶åå¡«å……åˆ°.gotä¸­ï¼Œç„¶åè¿›è¡Œè·³è½¬swapï¼Œè¿™é‡Œå°±ä¸å†åˆ†æï¼Œç›´æ¥çœ‹æœ€åçš„ç»“æœã€‚å½“æ‰§è¡Œå®Œé“¾æ¥å™¨çš„å¤„ç†åï¼Œä¼šæ›´æ–°.gotè¡¨ã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_20bfcc0baef3046a41cb61db33b1ba68.jpg"><img alt="" src="assets/doc/02-risc-v/risc-våŠ¨æ€é“¾æ¥å®éªŒ/images/wp_editor_md_20bfcc0baef3046a41cb61db33b1ba68.jpg"/></a></p>
<p>ä»ä¸Šé¢å¯çŸ¥swapå‡½æ•°åœ¨gotè¡¨ä¸­ï¼Œåœ°å€è¢«æ›´æ–°ä¸º0x3f9a69f4c2ã€‚</p>
<h2 id="swap">å†æ¬¡è°ƒç”¨swapå‡½æ•°</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_e06e8b04edb2d3c652b2138483b7bed3.jpg"><img alt="" src="assets/doc/02-risc-v/risc-våŠ¨æ€é“¾æ¥å®éªŒ/images/wp_editor_md_e06e8b04edb2d3c652b2138483b7bed3.jpg"/></a></p>
<p>å½“å†æ¬¡è°ƒç”¨swapå‡½æ•°çš„æ—¶å€™ï¼Œld t3,-1208(t3)ï¼Œè¿™é‡Œçš„t3å°±å˜æˆäº†0x3f9a69f4c2ï¼Œè¿™æ ·å°±ä¸ä¼šå†æ‰§è¡Œ_PROCEDURE_LINKAGE_TABLE_ï¼Œç›´æ¥è·³è½¬åˆ°swapçš„åœ°å€ã€‚</p>
<p>è¿˜å¯ä»¥ä½¿ç”¨cat /proc/xx/mapsç¡®å®šsoè½åœ¨çš„èŒƒå›´ï¼Œä¸‹é¢çš„åœ°å€ä¸ä¸€å®šåŒ¹é…äº†ï¼Œ é‡æ–°è¿è¡Œäº†ä¸€æ¬¡a.out,åªæ˜¯ç»™ä¸ªç¤ºä¾‹ã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/05/wp_editor_md_ca610d8932d06d8923344a1c46ab0239.jpg"><img alt="" src="assets/doc/02-risc-v/risc-våŠ¨æ€é“¾æ¥å®éªŒ/images/wp_editor_md_ca610d8932d06d8923344a1c46ab0239.jpg"/></a></p></div>
  <div class="post-nav">
    <a class="prev" href="risc-v-backtraceå®ç°åŸç†.html">â† RISC-V backtraceå®ç°åŸç†</a>
    <a class="next" href="opensbiåˆ†æ-äºŒ.html">opensbiåˆ†æï¼ˆäºŒï¼‰ â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

