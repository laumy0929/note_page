<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ROS2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢+å‚æ•° - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#_1">ç®€ä»‹</a><ul></ul></li><li><a href="#_2">è¯é¢˜</a><ul><li><a href="#python">pythonç¤ºä¾‹</a></li><li><a href="#c">C++ç¤ºä¾‹</a></li></ul></li><li><a href="#_3">æœåŠ¡</a><ul><li><a href="#python_1">pythonç¤ºä¾‹</a></li><li><a href="#c_1">C++ç¤ºä¾‹</a></li></ul></li><li><a href="#_4">åŠ¨ä½œ</a><ul><li><a href="#python_2">pythonç¤ºä¾‹</a></li><li><a href="#c_2">C++ç¤ºä¾‹</a></li></ul></li><li><a href="#_5">é€šä¿¡æ¥å£</a><ul></ul></li><li><a href="#_6">å‚æ•°</a><ul><li><a href="#_7">å®šä¹‰å‚æ•°</a></li><li><a href="#_8">æŸ¥è¯¢ä¸è®¾ç½®</a></li></ul></li><li><a href="#dds">DDS</a><ul></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>ROS2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢+å‚æ•°</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2025-09-16
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      rosç³»ç»Ÿ
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><h2 id="_1">ç®€ä»‹</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_3c3bec242569835edd283fe7661154bd_1757990015.png"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_3c3bec242569835edd283fe7661154bd_1757990015.png"/></a></p>
<p>åœ¨ROSç³»ç»Ÿæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè¿›ç¨‹ï¼Œæ›´å‡†ç¡®çš„è¯´æ³•å®ƒæ˜¯ä¸€ä¸ªåŒ…å«äº†ç‰¹å®šåŠŸèƒ½çš„ç‹¬ç«‹æ‰§è¡Œå•å…ƒã€‚èŠ‚ç‚¹åœ¨ROS2ä¸­é€šå¸¸æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè´Ÿè´£æ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ï¼Œå¦‚æ§åˆ¶æœºå™¨äººã€ä¼ æ„Ÿå™¨æ•°æ®å¤„ç†ç­‰ã€‚æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥é€šè¿‡ROS2çš„é€šä¿¡æœºåˆ¶ä¸å…¶ä»–èŠ‚ç‚¹è¿›è¡Œæ•°æ®äº¤æ¢ã€‚</p>
<p>åœ¨å…·ä½“çš„å·¥ç¨‹åº”ç”¨ä¸­ï¼Œéœ€è¦å¤šä¸ªèŠ‚ç‚¹è¿›è¡Œé…åˆå®Œæˆä¸€ä¸ªå…·ä½“çš„äº§å“ã€‚é‚£ä¹ˆå¤šä¸ªèŠ‚ç‚¹ç›´æ¥å¦‚ä½•è¿›è¡Œé€šä¿¡äº†ï¼ŒROSç³»ç»Ÿæä¾›äº†è¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œè¿™å‡ ç§æ–¹å¼ï¼Œå½“ç„¶é™¤äº†ä¸Šé¢3ä¸­ä¹‹å¤–è¿˜æœ‰ä¸€ç§<strong>å‚æ•°</strong>çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼æ˜¯ä¸€ç§å…±äº«çš„<strong>å…¨å±€å˜é‡</strong>ï¼Œè®©å„ä¸ªèŠ‚ç‚¹å¯ä»¥è¿›è¡Œ<strong>æŸ¥è¯¢/è®¾ç½®</strong>å‚æ•°ä»¥è¾¾åˆ°ä¿¡æ¯ä¼ è¾“çš„ç›®çš„ã€‚</p>
<h2 id="_2">è¯é¢˜</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_6d53a0f8565494f55fa91277732d19b2_1757990813.gif"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_6d53a0f8565494f55fa91277732d19b2_1757990813.gif"/></a></p>
<p>æè¿‡ç½‘ç»œMQTTçš„å¯¹ROS2ä¸­çš„è¯é¢˜é€šä¿¡ç†è§£å°±ç®€å•äº†ï¼Œå¯ä»¥è¯´ROS2ä¸­çš„è¯é¢˜é€šä¿¡ä¸MQTTæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚è¯é¢˜é€šä¿¡åˆ†ä¸ºå‘å¸ƒè€…å’Œè®¢é˜…è€…ã€‚å‘å¸ƒè€…é€šè¿‡è¯é¢˜ï¼ˆtopicï¼‰å‘å¸ƒæ¶ˆæ¯ï¼Œè®¢é˜…è€…é€šè¿‡è®¢é˜…è¯¥è¯é¢˜åå¯æ¥å—åˆ°è¯¥æ¶ˆæ¯ã€‚è¯é¢˜çš„é€šä¿¡æ˜¯å¼‚æ­¥é€šä¿¡çš„æ–¹å¼ï¼Œç»“æ„ä¸Šæ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚</p>
<h3 id="python">pythonç¤ºä¾‹</h3>
<p>å…ˆåˆ›å»ºä¸€ä¸ªåŒ…</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~/dev_ws/src/
ros2<span class="w"> </span>pkg<span class="w"> </span>create<span class="w"> </span>--build-type<span class="w"> </span>ament_python<span class="w"> </span>learning_topic_python
</code></pre></div>
<p>åˆ›å»ºä¸€ä¸ªå‘å¸ƒè€…èŠ‚ç‚¹ç¨‹åºtopic_hello_pub.py</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">PublisherNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">publish_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s2">"Hello, ROS2!"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Published: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">PublisherNode</span><span class="p">(</span><span class="s2">"publisher_node"</span><span class="p">)</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">node</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</code></pre></div>
<p>åˆ›å»ºè®¢é˜…è€…èŠ‚ç‚¹ç¨‹åºtopic_hello_sub.py</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">SubscriberNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Received: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">SubscriberNode</span><span class="p">(</span><span class="s2">"subscriber_node"</span><span class="p">)</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">node</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</code></pre></div>
<p>ç¨‹åºè¿è¡Œå‘å¸ƒè€…</p>
<div class="codehilite"><pre><span></span><code><span class="n">ros2</span> <span class="n">run</span> <span class="n">learning_topic_python</span> <span class="n">topic_hello_pub</span>
</code></pre></div>
<p>ç¨‹åºè¿è¡Œè®¢é˜…è€…</p>
<div class="codehilite"><pre><span></span><code><span class="n">ros2</span> <span class="n">run</span> <span class="n">learning_topic_python</span> <span class="n">topic_hello_sub</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_8fc372622d11e30cfbc899f1893ebbd8_1758004323.png"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_8fc372622d11e30cfbc899f1893ebbd8_1758004323.png"/></a></p>
<p>æ ¸å¿ƒç‚¹å°±æ˜¯å‘å¸ƒè°ƒç”¨self.create_publisherï¼Œè®¢é˜…è°ƒç”¨self.create_subscriptionã€‚</p>
<h3 id="c">C++ç¤ºä¾‹</h3>
<p>åˆ›å»ºä¸€ä¸ªåŒ…</p>
<div class="codehilite"><pre><span></span><code><span class="n">ros2</span> <span class="n">pkg</span> <span class="n">create</span> <span class="o">--</span><span class="n">build</span><span class="o">-</span><span class="nb">type</span> <span class="n">ament_cmake</span> <span class="n">learn_topic_cpp</span>
</code></pre></div>
<p>ç¼–å†™å‘å¸ƒè€…èŠ‚ç‚¹</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#include &lt;chrono&gt;</span>
<span class="c1">#include &lt;functional&gt;</span>
<span class="c1">#include &lt;memory&gt;</span>
<span class="c1">#include &lt;string&gt;</span>

<span class="c1">#include "rclcpp/rclcpp.hpp"</span>
<span class="c1">#include "std_msgs/msg/string.hpp"</span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">::</span><span class="n">chrono_literals</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PublisherNode</span> <span class="p">:</span> <span class="n">public</span> <span class="n">rclcpp</span><span class="p">::</span><span class="n">Node</span>
<span class="p">{</span>
    <span class="n">public</span><span class="p">:</span>
        <span class="n">PublisherNode</span><span class="p">()</span>
        <span class="p">:</span> <span class="n">Node</span><span class="p">(</span><span class="s2">"topic_hello"</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">publisher_</span> <span class="o">=</span> <span class="n">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">std_msgs</span><span class="p">::</span><span class="n">msg</span><span class="p">::</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
            <span class="n">timer_</span> <span class="o">=</span> <span class="n">this</span><span class="o">-&gt;</span><span class="n">create_wall_timer</span><span class="p">(</span><span class="mi">1</span><span class="n">s</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">PublisherNode</span><span class="p">::</span><span class="n">timer_callback</span><span class="p">,</span> <span class="n">this</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="n">private</span><span class="p">:</span>
        <span class="n">void</span> <span class="n">timer_callback</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">auto</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">std_msgs</span><span class="p">::</span><span class="n">msg</span><span class="p">::</span><span class="n">String</span><span class="p">();</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="s2">"Hello, ROS2!"</span><span class="p">;</span>
            <span class="n">publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
            <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s2">"Published: </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">c_str</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="n">rclcpp</span><span class="p">::</span><span class="n">TimerBase</span><span class="p">::</span><span class="n">SharedPtr</span> <span class="n">timer_</span><span class="p">;</span>
        <span class="n">rclcpp</span><span class="p">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">std_msgs</span><span class="p">::</span><span class="n">msg</span><span class="p">::</span><span class="n">String</span><span class="o">&gt;</span><span class="p">::</span><span class="n">SharedPtr</span> <span class="n">publisher_</span><span class="p">;</span>
<span class="p">};</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">rclcpp</span><span class="p">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="n">rclcpp</span><span class="p">::</span><span class="n">spin</span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">PublisherNode</span><span class="o">&gt;</span><span class="p">());</span>
    <span class="n">rclcpp</span><span class="p">::</span><span class="n">shutdown</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>ç¼–å†™è®¢é˜…è€…èŠ‚ç‚¹</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#include &lt;memory&gt;</span>

<span class="c1">#include "rclcpp/rclcpp.hpp"</span>
<span class="c1">#include "std_msgs/msg/string.hpp"</span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">::</span><span class="n">chrono_literals</span><span class="p">;</span>
<span class="n">using</span> <span class="n">std</span><span class="p">::</span><span class="n">placeholders</span><span class="p">::</span><span class="n">_1</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">SubscriberNode</span> <span class="p">:</span> <span class="n">public</span> <span class="n">rclcpp</span><span class="p">::</span><span class="n">Node</span>
<span class="p">{</span>
    <span class="n">public</span><span class="p">:</span>
        <span class="n">SubscriberNode</span><span class="p">()</span>
        <span class="p">:</span> <span class="n">Node</span><span class="p">(</span><span class="s2">"topic_hello"</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">subscription_</span> <span class="o">=</span> <span class="n">this</span><span class="o">-&gt;</span><span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">std_msgs</span><span class="p">::</span><span class="n">msg</span><span class="p">::</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">SubscriberNode</span><span class="p">::</span><span class="n">topic_callback</span><span class="p">,</span> <span class="n">this</span><span class="p">,</span> <span class="n">_1</span><span class="p">));</span>
            <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s2">"SubscriberNode initialized"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="n">private</span><span class="p">:</span>
        <span class="n">void</span> <span class="n">topic_callback</span><span class="p">(</span><span class="n">const</span> <span class="n">std_msgs</span><span class="p">::</span><span class="n">msg</span><span class="p">::</span><span class="n">String</span><span class="p">::</span><span class="n">SharedPtr</span> <span class="n">msg</span><span class="p">)</span> <span class="n">const</span>
        <span class="p">{</span>
            <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s2">"I heard: '</span><span class="si">%s</span><span class="s2">'"</span><span class="p">,</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="o">.</span><span class="n">c_str</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="n">rclcpp</span><span class="p">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">std_msgs</span><span class="p">::</span><span class="n">msg</span><span class="p">::</span><span class="n">String</span><span class="o">&gt;</span><span class="p">::</span><span class="n">SharedPtr</span> <span class="n">subscription_</span><span class="p">;</span>
<span class="p">};</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">rclcpp</span><span class="p">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="n">rclcpp</span><span class="p">::</span><span class="n">spin</span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">SubscriberNode</span><span class="o">&gt;</span><span class="p">());</span>
    <span class="n">rclcpp</span><span class="p">::</span><span class="n">shutdown</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>è¿è¡Œæµ‹è¯•</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_451579abcfdfa6b4234bfceebdcda921_1758005475.png"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_451579abcfdfa6b4234bfceebdcda921_1758005475.png"/></a></p>
<p>åˆ°è¿™é‡Œè¯é¢˜çš„pythonå’Œcppç¤ºä¾‹éƒ½å®è·µäº†ï¼Œè¯é¢˜ä¸»è¦ä½¿ç”¨çš„æ˜¯å¼‚æ­¥çš„æ–¹å¼ã€‚</p>
<h2 id="_3">æœåŠ¡</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_71dead860a7dfe16a03add3641be8625_1758006085.gif"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_71dead860a7dfe16a03add3641be8625_1758006085.gif"/></a></p>
<p>åœ¨ ROS 2 ä¸­ï¼ŒæœåŠ¡ï¼ˆServiceï¼‰é€šä¿¡æ˜¯ä¸€ç§ è¯·æ±‚-å“åº”æ¨¡å¼ï¼Œå…è®¸å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚è¿™ç§æ–¹å¼é€šå¸¸ç”¨äºéœ€è¦åŒæ­¥äº¤äº’çš„æƒ…å†µï¼Œå¦‚è¿œç¨‹è°ƒç”¨ã€æ§åˆ¶è¯·æ±‚æˆ–è®¡ç®—ä»»åŠ¡ç­‰ã€‚è¿™ç§é€šä¿¡æ–¹å¼ä¸HTTPçš„é€šä¿¡æ–¹å¼ç±»ä¼¼ï¼Œåªæœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç”±å®¢æˆ·ç«¯å‘èµ·getï¼Œç„¶åæœåŠ¡ç«¯å“åº”æ•°æ®ã€‚</p>
<h3 id="python_1">pythonç¤ºä¾‹</h3>
<p>åˆ›å»ºä¸€ä¸ªåŒ…</p>
<div class="codehilite"><pre><span></span><code><span class="n">ros2</span> <span class="n">pkg</span> <span class="n">create</span> <span class="o">--</span><span class="n">build</span><span class="o">-</span><span class="nb">type</span> <span class="n">ament_python</span> <span class="n">learn_srv_python</span>
</code></pre></div>
<p>åˆ›å»ºä¸€ä¸ªadd_server.pyèŠ‚ç‚¹</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">rclpy</span>

<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">learning_interface.srv</span> <span class="kn">import</span> <span class="n">AddTwoInts</span>

<span class="k">class</span> <span class="nc">adderServer</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">srv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_service</span><span class="p">(</span><span class="n">AddTwoInts</span><span class="p">,</span> <span class="s1">'add_two_int'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adder_callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">adder_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">response</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">b</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Incoming request</span><span class="se">\n</span><span class="s1">a: </span><span class="si">%d</span><span class="s1"> b: </span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">b</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">adderServer</span><span class="p">(</span><span class="s2">"Service_adder_server"</span><span class="p">)</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</code></pre></div>
<p>å†åˆ›å»ºä¸€ä¸ªadd_client.pyèŠ‚ç‚¹</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="n">timeout</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">learning_interface.srv</span> <span class="kn">import</span> <span class="n">AddTwoInts</span>

<span class="k">class</span> <span class="nc">adderClient</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">AddTwoInts</span><span class="p">,</span> <span class="s1">'add_two_int'</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="n">timeout_sec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'server not available, waiting again...'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">AddTwoInts</span><span class="o">.</span><span class="n">Request</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">send_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">adderClient</span><span class="p">(</span><span class="s2">"Service_adder_client"</span><span class="p">)</span>
    <span class="n">node</span><span class="o">.</span><span class="n">send_request</span><span class="p">()</span>

    <span class="k">while</span> <span class="n">rclpy</span><span class="o">.</span><span class="n">ok</span><span class="p">():</span>
        <span class="n">rclpy</span><span class="o">.</span><span class="n">spin_once</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">future</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">'Service call failed </span><span class="si">%r</span><span class="s1">'</span> <span class="o">%</span><span class="p">(</span><span class="n">e</span><span class="p">,))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">'Result of add_two_ints: for </span><span class="si">%d</span><span class="s1"> + </span><span class="si">%d</span><span class="s1"> = </span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span>
                        <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">sum</span><span class="p">))</span>
            <span class="k">break</span>
    <span class="n">node</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</code></pre></div>
<p>è¿è¡Œç»“æœå¦‚ä¸‹</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_fb8ea62974b7f14a592caf26cf820829_1758010165.png"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_fb8ea62974b7f14a592caf26cf820829_1758010165.png"/></a></p>
<p>ç¤ºä¾‹æ¼”ç¤ºäº†å®¢æˆ·ç«¯è¯·æ±‚ä¸¤ä¸ªæ•°ç»™æœåŠ¡å™¨è®¡ç®—æ±‚å’Œï¼ŒæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„æ•°æ®åï¼Œè®¡ç®—åè¿”å›ç»“æœã€‚</p>
<p>åœ¨åˆ›å»ºclientå’Œserverçš„æ—¶å€™ï¼Œè¦èƒ½å¤ŸåŒ¹é…ä¸Šéœ€è¦æœ‰å…±åŒçš„åœ°å€å¦‚create_serviceå‚æ•°ä¸º"add_two_int"å’Œcreate_clientçš„å‚æ•°åœ°å€ä¸€æ ·ã€‚åœ¨æœåŠ¡ç«¯éœ€è¦æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°adder_callbackï¼Œå½“æ”¶åˆ°å®¢æˆ·ç«¯çš„æ•°æ®æ—¶è°ƒç”¨å›è°ƒå‡½æ•°è¿”å›ç»“æœã€‚</p>
<h3 id="c_1">C++ç¤ºä¾‹</h3>
<p>åˆ›å»ºä¸€ä¸ªC++çš„åŒ…</p>
<div class="codehilite"><pre><span></span><code><span class="n">ros2</span> <span class="n">pkg</span> <span class="n">create</span> <span class="o">--</span><span class="n">build</span><span class="o">-</span><span class="nb">type</span> <span class="n">ament_cmake</span> <span class="n">learn_srv_cpp</span>
</code></pre></div>
<p>åˆ›å»ºadd_server.cppèŠ‚ç‚¹ä»£ç </p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">"rclcpp/rclcpp.hpp"</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"learning_interface/srv/add_two_ints.hpp"</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">adderServer</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">learning_interface</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">AddTwoInts</span><span class="o">::</span><span class="n">Request</span><span class="o">&gt;</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span>
<span class="w">          </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">learning_interface</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">AddTwoInts</span><span class="o">::</span><span class="n">Response</span><span class="o">&gt;</span><span class="w">      </span><span class="n">response</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">response</span><span class="o">-&gt;</span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">get_logger</span><span class="p">(</span><span class="s">"rclcpp"</span><span class="p">),</span><span class="w"> </span><span class="s">"Incoming request</span><span class="se">\n</span><span class="s">a: %ld b: %ld"</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">get_logger</span><span class="p">(</span><span class="s">"rclcpp"</span><span class="p">),</span><span class="w"> </span><span class="s">"sending back response: [%ld]"</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="o">-&gt;</span><span class="n">sum</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span><span class="o">::</span><span class="n">make_shared</span><span class="p">(</span><span class="s">"service_adder_server"</span><span class="p">);</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Service</span><span class="o">&lt;</span><span class="n">learning_interface</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">AddTwoInts</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">create_service</span><span class="o">&lt;</span><span class="n">learning_interface</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">AddTwoInts</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"add_two_int"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">adderServer</span><span class="p">);</span>
<span class="w">    </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">get_logger</span><span class="p">(</span><span class="s">"rclcpp"</span><span class="p">),</span><span class="w"> </span><span class="s">"Ready to add two ints."</span><span class="p">);</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>åˆ›å»ºä¸€ä¸ªadd_client.cppèŠ‚ç‚¹ä»£ç </p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">"rclcpp/rclcpp.hpp"</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"learning_interface/srv/add_two_ints.hpp"</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdlib&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">chrono_literals</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">get_logger</span><span class="p">(</span><span class="s">"rclcpp"</span><span class="p">),</span><span class="w"> </span><span class="s">"usage: service_adder_client X Y"</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span><span class="o">::</span><span class="n">make_shared</span><span class="p">(</span><span class="s">"service_adder_client"</span><span class="p">);</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Client</span><span class="o">&lt;</span><span class="n">learning_interface</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">AddTwoInts</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">create_client</span><span class="o">&lt;</span><span class="n">learning_interface</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">AddTwoInts</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"add_two_int"</span><span class="p">);</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">learning_interface</span><span class="o">::</span><span class="n">srv</span><span class="o">::</span><span class="n">AddTwoInts</span><span class="o">::</span><span class="n">Request</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoll</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoll</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">wait_for_service</span><span class="p">(</span><span class="mi">1</span><span class="n">s</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">get_logger</span><span class="p">(</span><span class="s">"rclcpp"</span><span class="p">),</span><span class="w"> </span><span class="s">"Interrupted while waiting for the service. Exiting."</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">get_logger</span><span class="p">(</span><span class="s">"rclcpp"</span><span class="p">),</span><span class="w"> </span><span class="s">"service not available, waiting again..."</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="o">-&gt;</span><span class="n">async_send_request</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Wait for the result</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">spin_until_future_complete</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">FutureReturnCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">get_logger</span><span class="p">(</span><span class="s">"rclcpp"</span><span class="p">),</span><span class="w"> </span><span class="s">"Result of add_two_ints: for %ld + %ld = %ld"</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">sum</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">get_logger</span><span class="p">(</span><span class="s">"rclcpp"</span><span class="p">),</span><span class="w"> </span><span class="s">"Failed to call service add_two_ints"</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>ç»“æœè¿è¡Œå¦‚ä¸‹ï¼š</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_c1473d5b6b628901619492dfca7e4b51_1758011284.png"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_c1473d5b6b628901619492dfca7e4b51_1758011284.png"/></a></p>
<p>æ€»ç»“ä¸€ä¸‹æœåŠ¡çš„é€šä¿¡æ–¹å¼å¯ä»¥ç†è§£ä¸ºè·Ÿhttpçš„ç±»ä¼¼ï¼ŒåŸºäºè¯·æ±‚å’Œå“åº”çš„æ–¹å¼è¿›è¡Œï¼Œåªæœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªä¸€å¯¹å¤šçš„é€šä¿¡ç»“æ„ã€‚æ•°æ®çš„é€šä¿¡è·Ÿè¯é¢˜ç›¸æ¯”å…¶æ˜¯åŒæ­¥ä¼ è¾“ï¼Œè€Œè¯é¢˜æ˜¯å¼‚æ­¥ä¼ è¾“ã€‚</p>
<h2 id="_4">åŠ¨ä½œ</h2>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_98cf621036421c1be7dee81bc44ea0f5_1758011487.gif"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_98cf621036421c1be7dee81bc44ea0f5_1758011487.gif"/></a></p>
<p>ROS 2 çš„ Action æ˜¯ä¸€ç§ç”¨äºå®ç°å¼‚æ­¥ã€é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡çš„é€šä¿¡æœºåˆ¶ï¼Œå¸¸ç”¨äºé‚£äº›éœ€è¦åé¦ˆæˆ–ç»“æœçš„ä»»åŠ¡ã€‚ç›¸æ¯” ROS 2 çš„ Serviceï¼ˆåŒæ­¥è¯·æ±‚-å“åº”æ¨¡å¼ï¼‰ï¼ŒAction å…è®¸å®¢æˆ·ç«¯è¯·æ±‚ä»»åŠ¡å¹¶åœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ¥æ”¶åé¦ˆï¼Œæœ€ç»ˆè·å–ä»»åŠ¡çš„ç»“æœã€‚å®ƒé€šå¸¸é€‚ç”¨äºéœ€è¦è¾ƒé•¿æ—¶é—´å¤„ç†çš„ä»»åŠ¡ï¼Œå¦‚æœºå™¨äººè¿åŠ¨æ§åˆ¶ã€è·¯å¾„è§„åˆ’ã€æŠ“å–ä»»åŠ¡ç­‰ã€‚</p>
<p>å…·ä½“çš„é€šä¿¡æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_0ead2b22d39c11bc697f7c671fcde02d_1758013706.png"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_0ead2b22d39c11bc697f7c671fcde02d_1758013706.png"/></a></p>
<p>å¯ä»¥åˆ†ä¸º3ä¸ªé˜¶æ®µ</p>
<ul>
<li>é˜¶æ®µ1ï¼šå®¢æˆ·ç«¯å¼‚æ­¥çš„æ–¹å¼å‘é€ç›®æ ‡ã€‚</li>
<li>é˜¶æ®µ2ï¼šæœåŠ¡ç«¯å®šæœŸåé¦ˆå®æ—¶ç»“æœã€‚</li>
<li>é˜¶æ®µ3ï¼šæœåŠ¡ç«¯åé¦ˆæœ€ç»ˆçš„ç»“æœã€‚</li>
</ul>
<h3 id="python_2">pythonç¤ºä¾‹</h3>
<p>åˆ›å»ºä¸€ä¸ªåŒ…</p>
<div class="codehilite"><pre><span></span><code>ros2<span class="w"> </span>pkg<span class="w"> </span>create<span class="w"> </span>--build-type<span class="w"> </span>ament_python<span class="w"> </span>learn_action_python
</code></pre></div>
<p>åˆ›å»ºä¸€ä¸ªæœåŠ¡ç«¯èŠ‚ç‚¹ç¨‹åºaction_server.py</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">rclpy</span>                                      <span class="c1"># ROS2 Pythonæ¥å£åº“</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span>   <span class="kn">import</span> <span class="n">Node</span>                     <span class="c1"># ROS2 èŠ‚ç‚¹ç±»</span>
<span class="kn">from</span> <span class="nn">rclpy.action</span> <span class="kn">import</span> <span class="n">ActionServer</span>             <span class="c1"># ROS2 åŠ¨ä½œæœåŠ¡å™¨ç±»</span>
<span class="kn">from</span> <span class="nn">learning_interface.action</span> <span class="kn">import</span> <span class="n">MoveCircle</span>  <span class="c1"># è‡ªå®šä¹‰çš„åœ†å‘¨è¿åŠ¨æ¥å£</span>

<span class="k">class</span> <span class="nc">MoveCircleActionServer</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>                   <span class="c1"># ROS2èŠ‚ç‚¹çˆ¶ç±»åˆå§‹åŒ–</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_server</span> <span class="o">=</span> <span class="n">ActionServer</span><span class="p">(</span>      <span class="c1"># åˆ›å»ºåŠ¨ä½œæœåŠ¡å™¨ï¼ˆæ¥å£ç±»å‹ã€åŠ¨ä½œåã€å›è°ƒå‡½æ•°ï¼‰</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">MoveCircle</span><span class="p">,</span>
            <span class="s1">'move_circle'</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute_callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal_handle</span><span class="p">):</span>            <span class="c1"># æ‰§è¡Œæ”¶åˆ°åŠ¨ä½œç›®æ ‡ä¹‹åçš„å¤„ç†å‡½æ•°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Moving circle...'</span><span class="p">)</span>
        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="n">MoveCircle</span><span class="o">.</span><span class="n">Feedback</span><span class="p">()</span>            <span class="c1"># åˆ›å»ºä¸€ä¸ªåŠ¨ä½œåé¦ˆä¿¡æ¯çš„æ¶ˆæ¯</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>                     <span class="c1"># ä»0åˆ°360åº¦ï¼Œæ‰§è¡Œåœ†å‘¨è¿åŠ¨ï¼Œå¹¶å‘¨æœŸåé¦ˆä¿¡æ¯</span>
            <span class="n">feedback_msg</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">i</span>                      <span class="c1"># åˆ›å»ºåé¦ˆä¿¡æ¯ï¼Œè¡¨ç¤ºå½“å‰æ‰§è¡Œåˆ°çš„è§’åº¦</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Publishing feedback: </span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span> <span class="n">feedback_msg</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
            <span class="n">goal_handle</span><span class="o">.</span><span class="n">publish_feedback</span><span class="p">(</span><span class="n">feedback_msg</span><span class="p">)</span>  <span class="c1"># å‘å¸ƒåé¦ˆä¿¡æ¯</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Goal succeeded'</span><span class="p">)</span>
        <span class="n">goal_handle</span><span class="o">.</span><span class="n">succeed</span><span class="p">()</span>                           <span class="c1"># åŠ¨ä½œæ‰§è¡ŒæˆåŠŸ</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">MoveCircle</span><span class="o">.</span><span class="n">Result</span><span class="p">()</span>                    <span class="c1"># åˆ›å»ºç»“æœæ¶ˆæ¯</span>
        <span class="n">result</span><span class="o">.</span><span class="n">finish</span> <span class="o">=</span> <span class="kc">True</span>                            
        <span class="k">return</span> <span class="n">result</span>                                   <span class="c1"># åé¦ˆæœ€ç»ˆåŠ¨ä½œæ‰§è¡Œçš„ç»“æœ</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                                       <span class="c1"># ROS2èŠ‚ç‚¹ä¸»å…¥å£mainå‡½æ•°</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>                                  <span class="c1"># ROS2 Pythonæ¥å£åˆå§‹åŒ–</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">MoveCircleActionServer</span><span class="p">(</span><span class="s2">"action_move_server"</span><span class="p">)</span>    <span class="c1"># åˆ›å»ºROS2èŠ‚ç‚¹å¯¹è±¡å¹¶è¿›è¡Œåˆå§‹åŒ–</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>                                       <span class="c1"># å¾ªç¯ç­‰å¾…ROS2é€€å‡º</span>
    <span class="n">node</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>                                    <span class="c1"># é”€æ¯èŠ‚ç‚¹å¯¹è±¡</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>                                       <span class="c1"># å…³é—­ROS2 Pythonæ¥å£</span>
</code></pre></div>
<p>åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯é˜¶æ®µç¨‹åºaction_client.py</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">rclpy</span>                                      <span class="c1"># ROS2 Pythonæ¥å£åº“</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span>   <span class="kn">import</span> <span class="n">Node</span>                     <span class="c1"># ROS2 èŠ‚ç‚¹ç±»</span>
<span class="kn">from</span> <span class="nn">rclpy.action</span> <span class="kn">import</span> <span class="n">ActionClient</span>             <span class="c1"># ROS2 åŠ¨ä½œå®¢æˆ·ç«¯ç±»</span>

<span class="kn">from</span> <span class="nn">learning_interface.action</span> <span class="kn">import</span> <span class="n">MoveCircle</span>  <span class="c1"># è‡ªå®šä¹‰çš„åœ†å‘¨è¿åŠ¨æ¥å£</span>

<span class="k">class</span> <span class="nc">MoveCircleActionClient</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>                   <span class="c1"># ROS2èŠ‚ç‚¹çˆ¶ç±»åˆå§‹åŒ–</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span> <span class="o">=</span> <span class="n">ActionClient</span><span class="p">(</span>      <span class="c1"># åˆ›å»ºåŠ¨ä½œå®¢æˆ·ç«¯ï¼ˆæ¥å£ç±»å‹ã€åŠ¨ä½œåï¼‰</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">MoveCircle</span><span class="p">,</span> <span class="s1">'move_circle'</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">send_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>                 <span class="c1"># åˆ›å»ºä¸€ä¸ªå‘é€åŠ¨ä½œç›®æ ‡çš„å‡½æ•°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Waiting for action server...'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>    <span class="c1"># ç­‰å¾…åŠ¨ä½œçš„æœåŠ¡å™¨ç«¯å¯åŠ¨</span>

        <span class="n">goal_msg</span> <span class="o">=</span> <span class="n">MoveCircle</span><span class="o">.</span><span class="n">Goal</span><span class="p">()</span>             <span class="c1"># åˆ›å»ºä¸€ä¸ªåŠ¨ä½œç›®æ ‡çš„æ¶ˆæ¯</span>
        <span class="n">goal_msg</span><span class="o">.</span><span class="n">enable</span> <span class="o">=</span> <span class="n">enable</span>                 <span class="c1"># è®¾ç½®åŠ¨ä½œç›®æ ‡ä¸ºä½¿èƒ½ï¼Œå¸Œæœ›æœºå™¨äººå¼€å§‹è¿åŠ¨</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Sending goal request...'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal_future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="o">.</span><span class="n">send_goal_async</span><span class="p">(</span>   <span class="c1"># å¼‚æ­¥æ–¹å¼å‘é€åŠ¨ä½œçš„ç›®æ ‡</span>
            <span class="n">goal_msg</span><span class="p">,</span>                                                   <span class="c1"># åŠ¨ä½œç›®æ ‡</span>
            <span class="n">feedback_callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">)</span>                   <span class="c1"># å¤„ç†å‘¨æœŸåé¦ˆæ¶ˆæ¯çš„å›è°ƒå‡½æ•°</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal_future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goal_response_callback</span><span class="p">)</span> <span class="c1"># è®¾ç½®ä¸€ä¸ªæœåŠ¡å™¨æ”¶åˆ°ç›®æ ‡ä¹‹ååé¦ˆæ—¶çš„å›è°ƒå‡½æ•°</span>

    <span class="k">def</span> <span class="nf">goal_response_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">future</span><span class="p">):</span>           <span class="c1"># åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨æ”¶åˆ°ç›®æ ‡ä¹‹ååé¦ˆæ—¶çš„å›è°ƒå‡½æ•°</span>
        <span class="n">goal_handle</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>                   <span class="c1"># æ¥æ”¶åŠ¨ä½œçš„ç»“æœ</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">goal_handle</span><span class="o">.</span><span class="n">accepted</span><span class="p">:</span>                    <span class="c1"># å¦‚æœåŠ¨ä½œè¢«æ‹’ç»æ‰§è¡Œ</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Goal rejected :('</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Goal accepted :)'</span><span class="p">)</span>                            <span class="c1"># åŠ¨ä½œè¢«é¡ºåˆ©æ‰§è¡Œ</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_get_result_future</span> <span class="o">=</span> <span class="n">goal_handle</span><span class="o">.</span><span class="n">get_result_async</span><span class="p">()</span>              <span class="c1"># å¼‚æ­¥è·å–åŠ¨ä½œæœ€ç»ˆæ‰§è¡Œçš„ç»“æœåé¦ˆ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_result_future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_result_callback</span><span class="p">)</span>   <span class="c1"># è®¾ç½®ä¸€ä¸ªæ”¶åˆ°æœ€ç»ˆç»“æœçš„å›è°ƒå‡½æ•° </span>

    <span class="k">def</span> <span class="nf">get_result_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">future</span><span class="p">):</span>                                    <span class="c1"># åˆ›å»ºä¸€ä¸ªæ”¶åˆ°æœ€ç»ˆç»“æœçš„å›è°ƒå‡½æ•°</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">result</span>                                       <span class="c1"># è¯»å–åŠ¨ä½œæ‰§è¡Œçš„ç»“æœ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Result: {</span><span class="si">%d</span><span class="s1">}'</span> <span class="o">%</span> <span class="n">result</span><span class="o">.</span><span class="n">finish</span><span class="p">)</span>                <span class="c1"># æ—¥å¿—è¾“å‡ºæ‰§è¡Œç»“æœ</span>

    <span class="k">def</span> <span class="nf">feedback_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feedback_msg</span><span class="p">):</span>                                <span class="c1"># åˆ›å»ºå¤„ç†å‘¨æœŸåé¦ˆæ¶ˆæ¯çš„å›è°ƒå‡½æ•°</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="n">feedback_msg</span><span class="o">.</span><span class="n">feedback</span>                                      <span class="c1"># è¯»å–åé¦ˆçš„æ•°æ®</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Received feedback: {</span><span class="si">%d</span><span class="s1">}'</span> <span class="o">%</span> <span class="n">feedback</span><span class="o">.</span><span class="n">state</span><span class="p">)</span> 

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                                       <span class="c1"># ROS2èŠ‚ç‚¹ä¸»å…¥å£mainå‡½æ•°</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>                                  <span class="c1"># ROS2 Pythonæ¥å£åˆå§‹åŒ–</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">MoveCircleActionClient</span><span class="p">(</span><span class="s2">"action_move_client"</span><span class="p">)</span>    <span class="c1"># åˆ›å»ºROS2èŠ‚ç‚¹å¯¹è±¡å¹¶è¿›è¡Œåˆå§‹åŒ–</span>
    <span class="n">node</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>                                   <span class="c1"># å‘é€åŠ¨ä½œç›®æ ‡</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>                                       <span class="c1"># å¾ªç¯ç­‰å¾…ROS2é€€å‡º</span>
    <span class="n">node</span><span class="o">.</span><span class="n">destroy_node</span><span class="p">()</span>                                    <span class="c1"># é”€æ¯èŠ‚ç‚¹å¯¹è±¡</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>                                       <span class="c1"># å…³é—­ROS2 Pythonæ¥å£</span>
</code></pre></div>
<p>è¿è¡Œ <a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_241083bf25e5e6c8ac862eaf333210c4_1758014688.png"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_241083bf25e5e6c8ac862eaf333210c4_1758014688.png"/></a></p>
<p>æ€»ç»“ä¸€ä¸‹æµç¨‹ï¼š</p>
<div class="codehilite"><pre><span></span><code>å®¢æˆ·ç«¯<span class="w">                    </span>æœåŠ¡ç«¯
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>å‘é€ç›®æ ‡<span class="w"> </span>-----------&gt;<span class="p">|</span>
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>--<span class="w"> </span>execute_callback<span class="o">()</span><span class="w"> </span>è¢«è°ƒç”¨
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span><span class="w">   </span><span class="o">(</span>å¼€å§‹æ‰§è¡ŒåŠ¨ä½œ<span class="o">)</span>
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>&lt;--<span class="w"> </span>ç›®æ ‡æ¥å—/æ‹’ç»<span class="w"> </span>------<span class="p">|</span>--<span class="w"> </span>ç«‹å³å“åº”ç›®æ ‡è¯·æ±‚
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>goal_response_callback<span class="w"> </span>è¢«è°ƒç”¨
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>--<span class="w"> </span>å¼€å§‹å¾ªç¯æ‰§è¡Œ
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span><span class="w">   </span><span class="o">(</span><span class="m">0</span>Â°,<span class="w"> </span><span class="m">30</span>Â°,<span class="w"> </span><span class="m">60</span>Â°...<span class="o">)</span>
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>&lt;--<span class="w"> </span>åé¦ˆæ¶ˆæ¯<span class="w"> </span>----------<span class="p">|</span>--<span class="w"> </span>publish_feedback<span class="o">(</span><span class="m">0</span>Â°<span class="o">)</span>
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>feedback_callback<span class="w"> </span>è¢«è°ƒç”¨
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>&lt;--<span class="w"> </span>åé¦ˆæ¶ˆæ¯<span class="w"> </span>----------<span class="p">|</span>--<span class="w"> </span>publish_feedback<span class="o">(</span><span class="m">30</span>Â°<span class="o">)</span>
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>feedback_callback<span class="w"> </span>è¢«è°ƒç”¨
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>&lt;--<span class="w"> </span>åé¦ˆæ¶ˆæ¯<span class="w"> </span>----------<span class="p">|</span>--<span class="w"> </span>publish_feedback<span class="o">(</span><span class="m">60</span>Â°<span class="o">)</span>
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>feedback_callback<span class="w"> </span>è¢«è°ƒç”¨
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span><span class="w">     </span>...<span class="w"> </span><span class="o">(</span>ç»§ç»­å¾ªç¯<span class="o">)</span><span class="w"> </span>...<span class="w"> </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>&lt;--<span class="w"> </span>åé¦ˆæ¶ˆæ¯<span class="w"> </span>----------<span class="p">|</span>--<span class="w"> </span>publish_feedback<span class="o">(</span><span class="m">330</span>Â°<span class="o">)</span>
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>feedback_callback<span class="w"> </span>è¢«è°ƒç”¨
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>--<span class="w"> </span>åŠ¨ä½œæ‰§è¡Œå®Œæˆ
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>--<span class="w"> </span>goal_handle.succeed<span class="o">()</span>
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>--<span class="w"> </span>è¿”å›ç»“æœ
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>&lt;--<span class="w"> </span>æœ€ç»ˆç»“æœ<span class="w"> </span>----------<span class="p">|</span>--<span class="w"> </span>å‘é€ç»“æœæ¶ˆæ¯
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>get_result_callback<span class="w"> </span>è¢«è°ƒç”¨
<span class="w">  </span><span class="p">|</span><span class="w">                        </span><span class="p">|</span>
<span class="w">  </span><span class="p">|</span>--<span class="w"> </span>åŠ¨ä½œå®Œæˆ<span class="w"> </span>-----------<span class="p">|</span>
</code></pre></div>
<p>å®¢æˆ·ç«¯ä¸€å…±æ³¨å†Œäº†3ä¸ªå›è°ƒï¼š</p>
<ul>
<li>goal_response_callbackï¼šæœåŠ¡å™¨ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°ç›®æ ‡è¯·æ±‚åçš„å›è°ƒå‡½æ•°ï¼Œè°ƒç”¨self._send_goal_future.add_done_callbackè®¾ç½®ã€‚</li>
<li>feedback_callbackï¼šè°ƒç”¨send_goal_asyncæ—¶æ³¨å†Œï¼Œè¿™ä¸ªå›è°ƒæ˜¯æœåŠ¡å™¨å®æ—¶åé¦ˆçš„å›è°ƒå‡½æ•°ã€‚</li>
<li>get_result_callbackï¼šæœåŠ¡å™¨æœ€åè¿”å›çš„ç»“æœå›è°ƒã€‚è°ƒç”¨self._get_result_future.add_done_callbackæ³¨å†Œã€‚</li>
</ul>
<p>æœåŠ¡ç«¯å°±ä»…ä»…åªæœ‰execute_callbackä¸€ä¸ªå›è°ƒï¼Œå³å¯¹åº”å®¢æˆ·ç«¯çš„feedbackå›è°ƒï¼Œå¦å¤–ä¸¤ä¸ªéƒ½æ˜¯éšå¼çš„ã€‚</p>
<h3 id="c_2">C++ç¤ºä¾‹</h3>
<p>åˆ›å»ºä¸€ä¸ªåŒ…</p>
<div class="codehilite"><pre><span></span><code>ros2<span class="w"> </span>pkg<span class="w"> </span>create<span class="w"> </span>--build-type<span class="w"> </span>ament_cmake<span class="w"> </span>learn_action_cpp
</code></pre></div>
<p>åˆ›å»ºå®¢æˆ·ç«¯èŠ‚ç‚¹ç¨‹åºaction_client.cpp</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#include &lt;iostream&gt;</span>

<span class="c1">#include "rclcpp/rclcpp.hpp"                          // ROS2 C++æ¥å£åº“</span>
<span class="c1">#include "rclcpp_action/rclcpp_action.hpp"            // ROS2 åŠ¨ä½œç±»</span>
<span class="c1">#include "learning_interface/action/move_circle.hpp"  // è‡ªå®šä¹‰çš„åœ†å‘¨è¿åŠ¨æ¥å£</span>

using<span class="w"> </span>namespace<span class="w"> </span>std<span class="p">;</span>

class<span class="w"> </span>MoveCircleActionClient<span class="w"> </span>:<span class="w"> </span>public<span class="w"> </span>rclcpp::Node
<span class="o">{</span>
<span class="w">    </span>public:
<span class="w">        </span>//<span class="w"> </span>å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„åŠ¨ä½œæ¥å£ç±»ï¼Œä¾¿äºåç»­ä½¿ç”¨
<span class="w">        </span>using<span class="w"> </span><span class="nv">CustomAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>learning_interface::action::MoveCircle<span class="p">;</span>
<span class="w">        </span>//<span class="w"> </span>å®šä¹‰ä¸€ä¸ªå¤„ç†åŠ¨ä½œè¯·æ±‚ã€å–æ¶ˆã€æ‰§è¡Œçš„å®¢æˆ·ç«¯ç±»
<span class="w">        </span>using<span class="w"> </span><span class="nv">GoalHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rclcpp_action::ClientGoalHandle&lt;CustomAction&gt;<span class="p">;</span>

<span class="w">        </span>explicit<span class="w"> </span>MoveCircleActionClient<span class="o">(</span>const<span class="w"> </span>rclcpp::NodeOptions<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span><span class="nv">node_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rclcpp::NodeOptions<span class="o">())</span>
<span class="w">        </span>:<span class="w"> </span>Node<span class="o">(</span><span class="s2">"action_move_client"</span>,<span class="w"> </span>node_options<span class="o">)</span><span class="w">                            </span>//<span class="w"> </span>ROS2èŠ‚ç‚¹çˆ¶ç±»åˆå§‹åŒ–
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>this-&gt;client_ptr_<span class="w"> </span><span class="o">=</span><span class="w"> </span>rclcpp_action::create_client&lt;CustomAction&gt;<span class="o">(</span><span class="w">   </span>//<span class="w"> </span>åˆ›å»ºåŠ¨ä½œå®¢æˆ·ç«¯ï¼ˆæ¥å£ç±»å‹ã€åŠ¨ä½œåï¼‰
<span class="w">                </span>this-&gt;get_node_base_interface<span class="o">()</span>,
<span class="w">                </span>this-&gt;get_node_graph_interface<span class="o">()</span>,
<span class="w">                </span>this-&gt;get_node_logging_interface<span class="o">()</span>,
<span class="w">                </span>this-&gt;get_node_waitables_interface<span class="o">()</span>,
<span class="w">                </span><span class="s2">"move_circle"</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>//<span class="w"> </span>åˆ›å»ºä¸€ä¸ªå‘é€åŠ¨ä½œç›®æ ‡çš„å‡½æ•°
<span class="w">        </span>void<span class="w"> </span>send_goal<span class="o">(</span>bool<span class="w"> </span><span class="nb">enable</span><span class="o">)</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>//<span class="w"> </span>æ£€æŸ¥åŠ¨ä½œæœåŠ¡å™¨æ˜¯å¦å¯ä»¥ä½¿ç”¨
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>!this-&gt;client_ptr_-&gt;wait_for_action_server<span class="o">(</span>std::chrono::seconds<span class="o">(</span><span class="m">10</span><span class="o">)))</span><span class="w"> </span>
<span class="w">            </span><span class="o">{</span>
<span class="w">                </span>RCLCPP_ERROR<span class="o">(</span>this-&gt;get_logger<span class="o">()</span>,<span class="w"> </span><span class="s2">"Client: Action server not available after waiting"</span><span class="o">)</span><span class="p">;</span>
<span class="w">                </span>rclcpp::shutdown<span class="o">()</span><span class="p">;</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="o">}</span>

<span class="w">            </span>//<span class="w"> </span>ç»‘å®šåŠ¨ä½œè¯·æ±‚ã€å–æ¶ˆã€æ‰§è¡Œçš„å›è°ƒå‡½æ•°
<span class="w">            </span>auto<span class="w"> </span><span class="nv">send_goal_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rclcpp_action::Client&lt;CustomAction&gt;::SendGoalOptions<span class="o">()</span><span class="p">;</span>
<span class="w">            </span>using<span class="w"> </span>namespace<span class="w"> </span>std::placeholders<span class="p">;</span>
<span class="w">            </span>send_goal_options.goal_response_callback<span class="w"> </span><span class="o">=</span>
<span class="w">                </span>std::bind<span class="o">(</span><span class="p">&amp;</span>MoveCircleActionClient::goal_response_callback,<span class="w"> </span>this,<span class="w"> </span>_1<span class="o">)</span><span class="p">;</span>
<span class="w">            </span>send_goal_options.feedback_callback<span class="w"> </span><span class="o">=</span>
<span class="w">                </span>std::bind<span class="o">(</span><span class="p">&amp;</span>MoveCircleActionClient::feedback_callback,<span class="w"> </span>this,<span class="w"> </span>_1,<span class="w"> </span>_2<span class="o">)</span><span class="p">;</span>
<span class="w">            </span>send_goal_options.result_callback<span class="w"> </span><span class="o">=</span>
<span class="w">                </span>std::bind<span class="o">(</span><span class="p">&amp;</span>MoveCircleActionClient::result_callback,<span class="w"> </span>this,<span class="w"> </span>_1<span class="o">)</span><span class="p">;</span>

<span class="w">            </span>//<span class="w"> </span>åˆ›å»ºä¸€ä¸ªåŠ¨ä½œç›®æ ‡çš„æ¶ˆæ¯
<span class="w">            </span>auto<span class="w"> </span><span class="nv">goal_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CustomAction::Goal<span class="o">()</span><span class="p">;</span>
<span class="w">            </span>goal_msg.enable<span class="w"> </span><span class="o">=</span><span class="w"> </span>enable<span class="p">;</span>
<span class="w">            </span>//<span class="w"> </span>å¼‚æ­¥æ–¹å¼å‘é€åŠ¨ä½œçš„ç›®æ ‡
<span class="w">            </span>RCLCPP_INFO<span class="o">(</span>this-&gt;get_logger<span class="o">()</span>,<span class="w"> </span><span class="s2">"Client: Sending goal"</span><span class="o">)</span><span class="p">;</span>
<span class="w">            </span>this-&gt;client_ptr_-&gt;async_send_goal<span class="o">(</span>goal_msg,<span class="w"> </span>send_goal_options<span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">    </span>private:
<span class="w">        </span>rclcpp_action::Client&lt;CustomAction&gt;::SharedPtr<span class="w"> </span>client_ptr_<span class="p">;</span>

<span class="w">        </span>//<span class="w"> </span>åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨æ”¶åˆ°ç›®æ ‡ä¹‹ååé¦ˆæ—¶çš„å›è°ƒå‡½æ•°
<span class="w">        </span>void<span class="w"> </span>goal_response_callback<span class="o">(</span>GoalHandle::SharedPtr<span class="w"> </span>goal_message<span class="o">)</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>!goal_message<span class="o">)</span>
<span class="w">            </span><span class="o">{</span>
<span class="w">                </span>RCLCPP_ERROR<span class="o">(</span>this-&gt;get_logger<span class="o">()</span>,<span class="w"> </span><span class="s2">"Client: Goal was rejected by server"</span><span class="o">)</span><span class="p">;</span>
<span class="w">                </span>rclcpp::shutdown<span class="o">()</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>Shut<span class="w"> </span>down<span class="w"> </span>client<span class="w"> </span>node
<span class="w">            </span><span class="o">}</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">            </span><span class="o">{</span>
<span class="w">                </span>RCLCPP_INFO<span class="o">(</span>this-&gt;get_logger<span class="o">()</span>,<span class="w"> </span><span class="s2">"Client: Goal accepted by server, waiting for result"</span><span class="o">)</span><span class="p">;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>//<span class="w"> </span>åˆ›å»ºå¤„ç†å‘¨æœŸåé¦ˆæ¶ˆæ¯çš„å›è°ƒå‡½æ•°
<span class="w">        </span>void<span class="w"> </span>feedback_callback<span class="o">(</span>
<span class="w">            </span>GoalHandle::SharedPtr,
<span class="w">            </span>const<span class="w"> </span>std::shared_ptr&lt;const<span class="w"> </span>CustomAction::Feedback&gt;<span class="w"> </span>feedback_message<span class="o">)</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>std::stringstream<span class="w"> </span>ss<span class="p">;</span>
<span class="w">            </span>ss<span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="s2">"Client: Received feedback: "</span><span class="s">&lt;&lt; feedback_message-&gt;state;</span>
<span class="s">            RCLCPP_INFO(this-&gt;get_logger(), "%s", ss.str().c_str());</span>
<span class="s">        }</span>

<span class="s">        // åˆ›å»ºä¸€ä¸ªæ”¶åˆ°æœ€ç»ˆç»“æœçš„å›è°ƒå‡½æ•°</span>
<span class="s">        void result_callback(const GoalHandle::WrappedResult &amp; result_message)</span>
<span class="s">        {</span>
<span class="s">            switch (result_message.code)</span>
<span class="s">            {</span>
<span class="s">                case rclcpp_action::ResultCode::SUCCEEDED:</span>
<span class="s">                    break;</span>
<span class="s">                case rclcpp_action::ResultCode::ABORTED:</span>
<span class="s">                    RCLCPP_ERROR(this-&gt;get_logger(), "Client: Goal was aborted");</span>
<span class="s">                    rclcpp::shutdown(); // å…³é—­å®¢æˆ·ç«¯èŠ‚ç‚¹</span>
<span class="s">                    return;</span>
<span class="s">                case rclcpp_action::ResultCode::CANCELED:</span>
<span class="s">                    RCLCPP_ERROR(this-&gt;get_logger(), "Client: Goal was canceled");</span>
<span class="s">                    rclcpp::shutdown(); // å…³é—­å®¢æˆ·ç«¯èŠ‚ç‚¹</span>
<span class="s">                    return;</span>
<span class="s">                def</span>ault:
<span class="w">                    </span>RCLCPP_ERROR<span class="o">(</span>this-&gt;get_logger<span class="o">()</span>,<span class="w"> </span><span class="s2">"Client: Unknown result code"</span><span class="o">)</span><span class="p">;</span>
<span class="w">                    </span>rclcpp::shutdown<span class="o">()</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>å…³é—­å®¢æˆ·ç«¯èŠ‚ç‚¹
<span class="w">                    </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="o">}</span>
<span class="w">            </span>RCLCPP_INFO<span class="o">(</span>this-&gt;get_logger<span class="o">()</span>,<span class="w"> </span><span class="s2">"Client: Result received: %s"</span>,<span class="w"> </span><span class="o">(</span>result_message.result-&gt;finish<span class="w"> </span>?<span class="w"> </span><span class="s2">"true"</span><span class="w"> </span>:<span class="w"> </span><span class="s2">"false"</span><span class="o">))</span><span class="p">;</span>
<span class="w">            </span>rclcpp::shutdown<span class="o">()</span><span class="p">;</span><span class="w">         </span>//<span class="w"> </span>å…³é—­å®¢æˆ·ç«¯èŠ‚ç‚¹
<span class="w">        </span><span class="o">}</span>
<span class="o">}</span><span class="p">;</span>

//<span class="w"> </span>ROS2èŠ‚ç‚¹ä¸»å…¥å£mainå‡½æ•°
int<span class="w"> </span>main<span class="o">(</span>int<span class="w"> </span>argc,<span class="w"> </span>char<span class="w"> </span>*<span class="w"> </span>argv<span class="o">[])</span>
<span class="o">{</span>
<span class="w">    </span>//<span class="w"> </span>ROS2<span class="w"> </span>C++æ¥å£åˆå§‹åŒ–
<span class="w">    </span>rclcpp::init<span class="o">(</span>argc,<span class="w"> </span>argv<span class="o">)</span><span class="p">;</span>

<span class="w">    </span>//<span class="w"> </span>åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯æŒ‡é’ˆ
<span class="w">    </span>auto<span class="w"> </span><span class="nv">action_client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>std::make_shared&lt;MoveCircleActionClient&gt;<span class="o">()</span><span class="p">;</span><span class="w"> </span>

<span class="w">    </span>//<span class="w"> </span>å‘é€åŠ¨ä½œç›®æ ‡
<span class="w">    </span>action_client-&gt;send_goal<span class="o">(</span><span class="nb">true</span><span class="o">)</span><span class="p">;</span>

<span class="w">    </span>//<span class="w"> </span>åˆ›å»ºROS2èŠ‚ç‚¹å¯¹è±¡å¹¶è¿›è¡Œåˆå§‹åŒ–
<span class="w">    </span>rclcpp::spin<span class="o">(</span>action_client<span class="o">)</span><span class="p">;</span><span class="w">  </span>

<span class="w">    </span>//<span class="w"> </span>å…³é—­ROS2<span class="w"> </span>C++æ¥å£
<span class="w">    </span>rclcpp::shutdown<span class="o">()</span><span class="p">;</span><span class="w"> </span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="o">}</span>
</code></pre></div>
<p>åˆ›å»ºæœåŠ¡ç«¯èŠ‚ç‚¹ç¨‹åºaction_server.cpp</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">"rclcpp/rclcpp.hpp"</span><span class="c1">                          // ROS2 C++æ¥å£åº“</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"rclcpp_action/rclcpp_action.hpp"</span><span class="c1">            // ROS2 åŠ¨ä½œç±»</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"learning_interface/action/move_circle.hpp"</span><span class="c1">  // è‡ªå®šä¹‰çš„åœ†å‘¨è¿åŠ¨æ¥å£</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MoveCircleActionServer</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„åŠ¨ä½œæ¥å£ç±»ï¼Œä¾¿äºåç»­ä½¿ç”¨</span>
<span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="n">CustomAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">learning_interface</span><span class="o">::</span><span class="n">action</span><span class="o">::</span><span class="n">MoveCircle</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// å®šä¹‰ä¸€ä¸ªå¤„ç†åŠ¨ä½œè¯·æ±‚ã€å–æ¶ˆã€æ‰§è¡Œçš„æœåŠ¡å™¨ç«¯</span>
<span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="n">GoalHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rclcpp_action</span><span class="o">::</span><span class="n">ServerGoalHandle</span><span class="o">&lt;</span><span class="n">CustomAction</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">        </span><span class="k">explicit</span><span class="w"> </span><span class="n">MoveCircleActionServer</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">NodeOptions</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">action_server_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">NodeOptions</span><span class="p">())</span>
<span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">Node</span><span class="p">(</span><span class="s">"action_move_server"</span><span class="p">,</span><span class="w"> </span><span class="n">action_server_options</span><span class="p">)</span><span class="w">                                     </span><span class="c1">// ROS2èŠ‚ç‚¹çˆ¶ç±»åˆå§‹åŒ–</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">placeholders</span><span class="p">;</span>

<span class="w">            </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">action_server_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rclcpp_action</span><span class="o">::</span><span class="n">create_server</span><span class="o">&lt;</span><span class="n">CustomAction</span><span class="o">&gt;</span><span class="p">(</span><span class="w">                  </span><span class="c1">// åˆ›å»ºåŠ¨ä½œæœåŠ¡å™¨ï¼ˆæ¥å£ç±»å‹ã€åŠ¨ä½œåã€å›è°ƒå‡½æ•°ï¼‰</span>
<span class="w">                </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_node_base_interface</span><span class="p">(),</span>
<span class="w">                </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_node_clock_interface</span><span class="p">(),</span>
<span class="w">                </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_node_logging_interface</span><span class="p">(),</span>
<span class="w">                </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_node_waitables_interface</span><span class="p">(),</span>
<span class="w">                </span><span class="s">"move_circle"</span><span class="p">,</span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MoveCircleActionServer</span><span class="o">::</span><span class="n">handle_goal</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">),</span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MoveCircleActionServer</span><span class="o">::</span><span class="n">handle_cancel</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">),</span>
<span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MoveCircleActionServer</span><span class="o">::</span><span class="n">handle_accepted</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="n">rclcpp_action</span><span class="o">::</span><span class="n">Server</span><span class="o">&lt;</span><span class="n">CustomAction</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">action_server_</span><span class="p">;</span><span class="w">  </span><span class="c1">// åŠ¨ä½œæœåŠ¡å™¨</span>

<span class="w">        </span><span class="c1">// å“åº”åŠ¨ä½œç›®æ ‡çš„è¯·æ±‚</span>
<span class="w">        </span><span class="n">rclcpp_action</span><span class="o">::</span><span class="n">GoalResponse</span><span class="w"> </span><span class="nf">handle_goal</span><span class="p">(</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">rclcpp_action</span><span class="o">::</span><span class="n">GoalUUID</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">CustomAction</span><span class="o">::</span><span class="n">Goal</span><span class="o">&gt;</span><span class="w"> </span><span class="n">goal_request</span><span class="p">)</span><span class="w">                             </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">"Server: Received goal request: %d"</span><span class="p">,</span><span class="w"> </span><span class="n">goal_request</span><span class="o">-&gt;</span><span class="n">enable</span><span class="p">);</span>
<span class="w">            </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">uuid</span><span class="p">;</span>

<span class="w">            </span><span class="c1">// å¦‚è¯·æ±‚ä¸ºenableåˆ™æ¥å—è¿åŠ¨è¯·æ±‚ï¼Œå¦åˆ™å°±æ‹’ç»</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">goal_request</span><span class="o">-&gt;</span><span class="n">enable</span><span class="p">)</span><span class="w">                                                           </span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">rclcpp_action</span><span class="o">::</span><span class="n">GoalResponse</span><span class="o">::</span><span class="n">ACCEPT_AND_EXECUTE</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">rclcpp_action</span><span class="o">::</span><span class="n">GoalResponse</span><span class="o">::</span><span class="n">REJECT</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// å“åº”åŠ¨ä½œå–æ¶ˆçš„è¯·æ±‚</span>
<span class="w">        </span><span class="n">rclcpp_action</span><span class="o">::</span><span class="n">CancelResponse</span><span class="w"> </span><span class="nf">handle_cancel</span><span class="p">(</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">GoalHandle</span><span class="o">&gt;</span><span class="w"> </span><span class="n">goal_handle_canceled_</span><span class="p">)</span><span class="w">                            </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">"Server: Received request to cancel action"</span><span class="p">);</span>
<span class="w">            </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">goal_handle_canceled_</span><span class="p">;</span><span class="w"> </span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">rclcpp_action</span><span class="o">::</span><span class="n">CancelResponse</span><span class="o">::</span><span class="n">ACCEPT</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// å¤„ç†åŠ¨ä½œæ¥å—åå…·ä½“æ‰§è¡Œçš„è¿‡ç¨‹</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle_accepted</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">GoalHandle</span><span class="o">&gt;</span><span class="w"> </span><span class="n">goal_handle_accepted_</span><span class="p">)</span><span class="w">          </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">placeholders</span><span class="p">;</span>
<span class="w">            </span><span class="c1">// åœ¨çº¿ç¨‹ä¸­æ‰§è¡ŒåŠ¨ä½œè¿‡ç¨‹</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MoveCircleActionServer</span><span class="o">::</span><span class="n">execute</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">),</span><span class="w"> </span><span class="n">goal_handle_accepted_</span><span class="p">}.</span><span class="n">detach</span><span class="p">();</span><span class="w"> </span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">execute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">GoalHandle</span><span class="o">&gt;</span><span class="w"> </span><span class="n">goal_handle_</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">requested_goal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">goal_handle_</span><span class="o">-&gt;</span><span class="n">get_goal</span><span class="p">();</span><span class="w">       </span><span class="c1">// åŠ¨ä½œç›®æ ‡</span>
<span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">feedback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">CustomAction</span><span class="o">::</span><span class="n">Feedback</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// åŠ¨ä½œåé¦ˆ</span>
<span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">CustomAction</span><span class="o">::</span><span class="n">Result</span><span class="o">&gt;</span><span class="p">();</span><span class="w">     </span><span class="c1">// åŠ¨ä½œç»“æœ</span>

<span class="w">            </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">"Server: Executing goal"</span><span class="p">);</span>
<span class="w">            </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Rate</span><span class="w"> </span><span class="nf">loop_rate</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// åŠ¨ä½œæ‰§è¡Œçš„è¿‡ç¨‹</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">361</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">ok</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">30</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// æ£€æŸ¥æ˜¯å¦å–æ¶ˆåŠ¨ä½œ</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">goal_handle_</span><span class="o">-&gt;</span><span class="n">is_canceling</span><span class="p">())</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">result</span><span class="o">-&gt;</span><span class="n">finish</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                    </span><span class="n">goal_handle_</span><span class="o">-&gt;</span><span class="n">canceled</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="w">                    </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">"Server: Goal canceled"</span><span class="p">);</span>
<span class="w">                    </span><span class="k">return</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="c1">// æ›´æ–°åé¦ˆçŠ¶æ€</span>
<span class="w">                </span><span class="n">feedback</span><span class="o">-&gt;</span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">                </span><span class="c1">// å‘å¸ƒåé¦ˆçŠ¶æ€</span>
<span class="w">                </span><span class="n">goal_handle_</span><span class="o">-&gt;</span><span class="n">publish_feedback</span><span class="p">(</span><span class="n">feedback</span><span class="p">);</span>
<span class="w">                </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">"Server: Publish feedback"</span><span class="p">);</span>

<span class="w">                </span><span class="n">loop_rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// åŠ¨ä½œæ‰§è¡Œå®Œæˆ</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">result</span><span class="o">-&gt;</span><span class="n">finish</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                </span><span class="n">goal_handle_</span><span class="o">-&gt;</span><span class="n">succeed</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="w">                </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">"Server: Goal succeeded"</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// ROS2èŠ‚ç‚¹ä¸»å…¥å£mainå‡½æ•°</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// ROS2 C++æ¥å£åˆå§‹åŒ–</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span><span class="w"> </span>

<span class="w">    </span><span class="c1">// åˆ›å»ºROS2èŠ‚ç‚¹å¯¹è±¡å¹¶è¿›è¡Œåˆå§‹åŒ–</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">MoveCircleActionServer</span><span class="o">&gt;</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// å…³é—­ROS2 C++æ¥å£</span>
<span class="w">    </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>å®¢æˆ·ç«¯åŒæ ·ä¹Ÿæ˜¯æ³¨å†Œäº†3ä¸ªå›è°ƒï¼š</p>
<ul>
<li>ç›®æ ‡çš„å›è°ƒï¼šgoal_response_callback</li>
<li>åé¦ˆçš„å›è°ƒï¼šfeedback_callback</li>
<li>ç»“æœçš„å›è°ƒï¼šresult_callback</li>
</ul>
<p>è¿è¡Œä»£ç </p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_bb090a868cc78da6c443dc872146fdcb_1758015574.png"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_bb090a868cc78da6c443dc872146fdcb_1758015574.png"/></a></p>
<h2 id="_5">é€šä¿¡æ¥å£</h2>
<p>åœ¨ ROS 2 ä¸­ï¼Œé€šä¿¡æ¥å£ï¼ˆCommunication Interfaceï¼‰æ˜¯æŒ‡èŠ‚ç‚¹ä¹‹é—´ç”¨äºäº¤æ¢ä¿¡æ¯çš„æœºåˆ¶å’Œå®šä¹‰ã€‚è¿™äº›æ¥å£å¯ä»¥é€šè¿‡ä¸åŒçš„é€šä¿¡æ–¹å¼ï¼ˆå¦‚å‘å¸ƒ/è®¢é˜…ã€æœåŠ¡ã€åŠ¨ä½œç­‰ï¼‰å®ç°ï¼Œä¸”æ¯ç§æ–¹å¼éƒ½æœ‰å…¶ç‰¹å®šçš„é€šä¿¡åè®®å’Œæ•°æ®ç»“æ„ã€‚</p>
<p>åœ¨ROS 2ç³»ç»Ÿä¸­æä¾›äº†å¤šç§é€šä¿¡æ¥å£ï¼Œæ¯ç§æ¥å£éƒ½æœ‰ä¸åŒçš„ç”¨é€”å’Œè¡Œä¸ºã€‚å¸¸è§çš„é€šä¿¡æ¥å£ç±»å‹åŒ…æ‹¬ï¼š</p>
<ul>
<li>è¯é¢˜ï¼ˆTopicï¼‰ï¼šä½¿ç”¨.msgæ–‡ä»¶æ ¼å¼å®šä¹‰æ¶ˆæ¯ç±»å‹ã€‚</li>
<li>æœåŠ¡ï¼ˆServiceï¼‰ï¼šä½¿ç”¨.srvæ–‡ä»¶æ ¼å¼å®šä¹‰æ¶ˆæ¯ç±»å‹</li>
<li>åŠ¨ä½œï¼ˆActionï¼‰ï¼šä½¿ç”¨.actionæ–‡ä»¶æ ¼å¼å®šä¹‰æ¶ˆæ¯ç±»å‹ã€‚</li>
</ul>
<p>å¯¹äºé€šä¿¡æ¥å£æœ‰ä¸€äº›æŸ¥æ˜å‘½ä»¤</p>
<ul>
<li>æŸ¥è¯¢é€šä¿¡æ¥å£ï¼šros2 interface list</li>
<li>æŸ¥è¯¢æŸä¸ªé€šä¿¡æ¥å£å®šä¹‰ï¼šros2 interface show &lt;æ¥å£å&gt;</li>
<li>æŸ¥è¯¢æŸä¸ªåŠŸèƒ½åŒ…ä¸­çš„é€šä¿¡æ¥å£å®šä¹‰ï¼šros2 interface package &lt;åŒ…å&gt;</li>
</ul>
<p>å¦‚ä¸‹ç¤ºä¾‹</p>
<div class="codehilite"><pre><span></span><code><span class="n">laumy</span><span class="nd">@ThinkBook</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="n">G7</span><span class="o">-</span><span class="n">IAH</span><span class="p">:</span><span class="o">~/</span><span class="n">dev_ws</span><span class="err">$</span> <span class="n">ros2</span> <span class="n">interface</span> <span class="n">package</span> <span class="n">learn_action_cpp</span>
<span class="n">laumy</span><span class="nd">@ThinkBook</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="n">G7</span><span class="o">-</span><span class="n">IAH</span><span class="p">:</span><span class="o">~/</span><span class="n">dev_ws</span><span class="err">$</span> <span class="n">ros2</span> <span class="n">interface</span> <span class="n">show</span> <span class="n">learning_interface</span><span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">AddTwoInts</span> 
<span class="n">int64</span> <span class="n">a</span>        <span class="c1"># ç¬¬ä¸€ä¸ªåŠ æ•°</span>
<span class="n">int64</span> <span class="n">b</span>        <span class="c1"># ç¬¬äºŒä¸ªåŠ æ•°</span>
<span class="o">---</span>
<span class="n">int64</span> <span class="nb">sum</span>      <span class="c1"># æ±‚å’Œç»“æœ</span>
</code></pre></div>
<p>ä¸‹é¢ä¸¾ä¾‹åˆ›å»ºé€šä¿¡æ¥å£çš„ç¤ºä¾‹ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ç›´æ¥åœ¨ä¸€ä¸ªåŒ…é‡Œé¢åˆ›å»º3ä¸ªä¸åŒç±»å‹çš„é€šä¿¡æ¥å£ï¼Œåˆ†åˆ«å¯¹åº”.msgï¼Œ.actionï¼Œ.srvã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p><strong>ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªåŒ…</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">ros2</span> <span class="n">pkg</span> <span class="n">create</span> <span class="n">my_interfaces</span> <span class="o">--</span><span class="n">build</span><span class="o">-</span><span class="nb">type</span> <span class="n">ament_cmake</span>
</code></pre></div>
<p><strong>ï¼ˆ2ï¼‰åˆ›å»ºæ–‡ä»¶ä¸‹å­˜æ”¾.msgã€.srvã€.actionæ–‡ä»¶</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">mkdir</span> <span class="n">msg</span> <span class="n">srv</span> <span class="n">action</span>
</code></pre></div>
<p><strong>ï¼ˆ3ï¼‰å®šä¹‰.msgæ–‡ä»¶</strong> åœ¨ msg æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª .msg æ–‡ä»¶ã€‚æ¯”å¦‚åˆ›å»ºä¸€ä¸ª MyMessage.msg æ–‡ä»¶ï¼Œå®šä¹‰æ¶ˆæ¯æ ¼å¼ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">int32</span> <span class="nb">id</span>
<span class="n">string</span> <span class="n">name</span>
<span class="n">float64</span> <span class="n">value</span>
</code></pre></div>
<p><strong>ï¼ˆ4ï¼‰å®šä¹‰.srvæ–‡ä»¶</strong> åœ¨ srv æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª .srv æ–‡ä»¶ã€‚æ¯”å¦‚åˆ›å»ºä¸€ä¸ª AddTwoInts.srv æ–‡ä»¶ï¼Œå®šä¹‰æœåŠ¡è¯·æ±‚å’Œå“åº”æ ¼å¼ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">int64</span> <span class="n">a</span>
<span class="n">int64</span> <span class="n">b</span>
<span class="o">---</span>
<span class="n">int64</span> <span class="nb">sum</span>
</code></pre></div>
<p><strong>ï¼ˆ5ï¼‰å®šä¹‰.actionæ–‡ä»¶</strong></p>
<p>åœ¨ action æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª .action æ–‡ä»¶ã€‚æ¯”å¦‚åˆ›å»ºä¸€ä¸ª MoveTo.action æ–‡ä»¶ï¼Œå®šä¹‰åŠ¨ä½œçš„ç›®æ ‡ã€ç»“æœå’Œåé¦ˆæ ¼å¼ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Goal</span>
<span class="n">float64</span> <span class="n">x</span>
<span class="n">float64</span> <span class="n">y</span>
<span class="o">---</span>
<span class="c1"># Result</span>
<span class="nb">bool</span> <span class="n">success</span>
<span class="n">string</span> <span class="n">message</span>
<span class="o">---</span>
<span class="c1"># Feedback</span>
<span class="n">float64</span> <span class="n">distance_remaining</span>
</code></pre></div>
<p><strong>ï¼ˆ6ï¼‰ä¿®æ”¹CMakeList.txt</strong></p>
<p>æ·»åŠ ä¾èµ–ï¼šåœ¨ find_package éƒ¨åˆ†ï¼Œæ·»åŠ å¯¹ ROS 2 ç”Ÿæˆæ¥å£å·¥å…·çš„ä¾èµ–</p>
<div class="codehilite"><pre><span></span><code><span class="n">find_package</span><span class="p">(</span><span class="n">rosidl_default_generators</span> <span class="n">REQUIRED</span><span class="p">)</span>
</code></pre></div>
<p>æ·»åŠ æ¥å£æ–‡ä»¶çš„ç”Ÿæˆï¼šä½¿ç”¨ rosidl_generate_interfaces å‘½ä»¤ç”Ÿæˆæ¶ˆæ¯ã€æœåŠ¡å’ŒåŠ¨ä½œçš„ä»£ç ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">rosidl_generate_interfaces</span><span class="p">(</span><span class="err">$</span><span class="p">{</span><span class="n">PROJECT_NAME</span><span class="p">}</span>
  <span class="s2">"msg/MyMessage.msg"</span>
  <span class="s2">"srv/AddTwoInts.srv"</span>
  <span class="s2">"action/MoveTo.action"</span>
<span class="p">)</span>
</code></pre></div>
<p>å®‰è£…ç”Ÿæˆçš„æ¥å£æ–‡ä»¶ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">install</span><span class="p">(</span><span class="n">DIRECTORY</span>
  <span class="n">msg</span>
  <span class="n">srv</span>
  <span class="n">action</span>
  <span class="n">DESTINATION</span> <span class="n">share</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">PROJECT_NAME</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p><strong>ï¼ˆ7ï¼‰ä¿®æ”¹packge.xmlæ–‡ä»¶</strong></p>
<p>åœ¨ package.xml ä¸­ï¼Œæ·»åŠ å¯¹ rosidl_default_runtime å’Œ rclpy ç­‰ä¾èµ–çš„å£°æ˜ï¼Œç¡®ä¿èƒ½å¤Ÿç”Ÿæˆå¹¶ä½¿ç”¨è¿™äº›æ¥å£ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="o">&lt;</span><span class="n">depend</span><span class="o">&gt;</span><span class="n">rosidl_default_runtime</span><span class="o">&lt;/</span><span class="n">depend</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">depend</span><span class="o">&gt;</span><span class="n">rclpy</span><span class="o">&lt;/</span><span class="n">depend</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">depend</span><span class="o">&gt;</span><span class="n">example_interfaces</span><span class="o">&lt;/</span><span class="n">depend</span><span class="o">&gt;</span>
</code></pre></div>
<p><strong>ï¼ˆ8ï¼‰ç¼–è¯‘</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">colcon</span> <span class="n">build</span>
</code></pre></div>
<p><strong>ï¼ˆ9ï¼‰ä½¿ç”¨å®šä¹‰çš„æ¥å£</strong></p>
<p>è¯é¢˜é€šä¿¡</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">my_interfaces.msg</span> <span class="kn">import</span> <span class="n">MyMessage</span>
</code></pre></div>
<p>æœåŠ¡é€šä¿¡</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">my_interfaces.srv</span> <span class="kn">import</span> <span class="n">AddTwoInts</span>
</code></pre></div>
<p>åŠ¨ä½œé€šä¿¡</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">my_interfaces.action</span> <span class="kn">import</span> <span class="n">MoveTo</span>
</code></pre></div>
<h2 id="_6">å‚æ•°</h2>
<p>åœ¨ROS2ç³»ç»Ÿä¸­ï¼Œæƒ³è¦è·å–ä¸€äº›ç¡¬ä»¶è®¾å¤‡å¦‚æ‘„åƒå¤´çš„åˆ†è¾¨ç‡ç­‰æ€ä¹ˆè¡¨ç¤ºäº†ï¼Œè¿™å°±ç”¨åˆ°äº†ROSç³»ç»Ÿä¸­çš„å‚æ•°ã€‚åœ¨ ROS 2 ä¸­ï¼Œç³»ç»Ÿå‚æ•°ï¼ˆSystem Parametersï¼‰ç”¨äºå­˜å‚¨å’Œé…ç½®èŠ‚ç‚¹çš„è¿è¡Œæ—¶è®¾ç½®ã€‚é€šè¿‡å‚æ•°ï¼Œç”¨æˆ·å¯ä»¥çµæ´»åœ°è°ƒæ•´èŠ‚ç‚¹çš„è¡Œä¸ºï¼Œè€Œæ— éœ€ä¿®æ”¹æºä»£ç ã€‚ROS 2 çš„å‚æ•°æœºåˆ¶éå¸¸å¼ºå¤§ï¼Œæ”¯æŒåŠ¨æ€æ›´æ”¹å‚æ•°å€¼ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨èŠ‚ç‚¹å¯åŠ¨æ—¶é€šè¿‡å‘½ä»¤è¡Œæˆ– YAML é…ç½®æ–‡ä»¶è¿›è¡Œé¢„è®¾ã€‚</p>
<p>å‚æ•°å¯ä»¥è®¤ä¸ºæ˜¯å¤šä¸ªèŠ‚ç‚¹å¯ä»¥äº’ç›¸è®¿é—®çš„å…¨å±€å˜é‡ã€‚</p>
<h3 id="_7">å®šä¹‰å‚æ•°</h3>
<p><strong>ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªROS2 åŒ…</strong></p>
<p>å‚æ•°çš„å®šä¹‰å¯ä»¥åŒ…å«åœ¨å…¶ä»–åŠŸèƒ½çš„åŒ…ä¸­ï¼Œä¹Ÿå¯ä»¥å•ç‹¬çš„å®šä¹‰ä¸€ä¸ªåŒ…ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">ros2</span> <span class="n">pkg</span> <span class="n">create</span> <span class="n">my_param_pkg</span> <span class="o">--</span><span class="n">build</span><span class="o">-</span><span class="nb">type</span> <span class="n">ament_python</span>
<span class="n">cd</span> <span class="n">my_param_pkg</span>
</code></pre></div>
<p><strong>ï¼ˆ2ï¼‰å£°æ˜å‚æ•°</strong></p>
<p>åœ¨ ROS 2 ä¸­ï¼ŒèŠ‚ç‚¹éœ€è¦åœ¨åˆå§‹åŒ–æ—¶å£°æ˜å‚æ•°ã€‚ä½ å¯ä»¥ä¸ºæ¯ä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼å’Œç±»å‹ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="k">class</span> <span class="nc">ParamExampleNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">'param_example_node'</span><span class="p">)</span>

        <span class="c1"># å£°æ˜å‚æ•°ï¼Œå¹¶ä¸ºå…¶è®¾å®šé»˜è®¤å€¼</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s1">'param_name'</span><span class="p">,</span> <span class="s1">'default_value'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s1">'param_int'</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s1">'param_bool'</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">ParamExampleNode</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<p>ä½¿ç”¨ declare_parameter() æ–¹æ³•å£°æ˜ä¸€ä¸ªå‚æ•°ã€‚</p>
<h3 id="_8">æŸ¥è¯¢ä¸è®¾ç½®</h3>
<p>ä»£ç çš„æ–¹å¼æŸ¥è¯¢ä¸è®¾ç½®ï¼Œè°ƒç”¨get_parameterå’Œset_parametersè¿›è¡Œè·å–å’Œè®¾ç½®å‚æ•°</p>
<div class="codehilite"><pre><span></span><code><span class="n">è·å–å‚æ•°</span>
<span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">'param_name'</span><span class="p">)</span><span class="o">.</span><span class="n">get_parameter_value</span><span class="p">()</span><span class="o">.</span><span class="n">string_value</span>
<span class="n">param_int_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">'param_int'</span><span class="p">)</span><span class="o">.</span><span class="n">get_parameter_value</span><span class="p">()</span><span class="o">.</span><span class="n">integer_value</span>
<span class="n">param_bool_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s1">'param_bool'</span><span class="p">)</span><span class="o">.</span><span class="n">get_parameter_value</span><span class="p">()</span><span class="o">.</span><span class="n">bool_value</span>

<span class="n">è®¾ç½®å‚æ•°</span>
<span class="bp">self</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">([</span><span class="n">Parameter</span><span class="p">(</span><span class="s1">'param_name'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">'new_value'</span><span class="p">)])</span>
</code></pre></div>
<p>ä¹Ÿå¯ä»¥é€šè¿‡YAMLæ–‡ä»¶çš„æ–¹å¼è®¾ç½®</p>
<div class="codehilite"><pre><span></span><code><span class="n">param_example_node</span><span class="p">:</span>
  <span class="n">ros__parameters</span><span class="p">:</span>
    <span class="n">param_name</span><span class="p">:</span> <span class="s2">"new_value"</span>
    <span class="n">param_int</span><span class="p">:</span> <span class="mi">20</span>
    <span class="n">param_bool</span><span class="p">:</span> <span class="n">false</span>
</code></pre></div>
<p>é€šè¿‡ YAML æ–‡ä»¶æ¥ä¸ºèŠ‚ç‚¹æä¾›å‚æ•°é…ç½®ï¼Œè¿™å¯¹äºå¯åŠ¨æ—¶è®¾ç½®å¤šä¸ªå‚æ•°éå¸¸æœ‰ç”¨ã€‚ä½¿ç”¨ --params-file å‚æ•°å¯åŠ¨èŠ‚ç‚¹å¹¶åŠ è½½è¯¥é…ç½®æ–‡ä»¶ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">ros2</span> <span class="n">run</span> <span class="n">my_param_pkg</span> <span class="n">my_node</span> <span class="o">--</span><span class="n">params</span><span class="o">-</span><span class="n">file</span> <span class="n">params</span><span class="o">.</span><span class="n">yaml</span>
</code></pre></div>
<p>è¿˜å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼è®¾ç½®å’ŒæŸ¥è¯¢ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">åˆ—å‡ºèŠ‚ç‚¹å‚æ•°</span>
<span class="n">ros2</span> <span class="n">param</span> <span class="nb">list</span> <span class="o">/</span><span class="n">param_example_node</span>

<span class="n">è·å–å‚æ•°çš„å€¼</span>
<span class="n">ros2</span> <span class="n">param</span> <span class="n">get</span> <span class="o">/</span><span class="n">param_example_node</span> <span class="n">param_name</span>

<span class="n">è®¾ç½®å‚æ•°çš„å€¼</span>
<span class="n">ros2</span> <span class="n">param</span> <span class="nb">set</span> <span class="o">/</span><span class="n">param_example_node</span> <span class="n">param_name</span> <span class="s2">"new_value"</span>
</code></pre></div>
<p>è¿˜å¯ä»¥é€šè¿‡æ³¨å†Œå‚æ•°å›è°ƒæ¥å¤„ç†å‚æ•°çš„åŠ¨æ€æ›´æ–°ã€‚å½“å‚æ•°å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚å¯ä»¥é€šè¿‡ add_on_set_parameters_callback() æ³¨å†Œè¿™ä¸ªå›è°ƒã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">parameter_callback</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Parameter '</span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' has been updated to </span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rclpy</span><span class="o">.</span><span class="n">parameter</span><span class="o">.</span><span class="n">SetParametersResult</span><span class="p">(</span><span class="n">successful</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="bp">self</span><span class="o">.</span><span class="n">add_on_set_parameters_callback</span><span class="p">(</span><span class="n">parameter_callback</span><span class="p">)</span>
</code></pre></div>
<h2 id="dds">DDS</h2>
<p>DDSï¼ˆData Distribution Serviceï¼‰æ˜¯ ROS 2 çš„æ ¸å¿ƒé€šä¿¡åè®®ï¼Œè¯é¢˜ã€æœåŠ¡å’ŒåŠ¨ä½œéƒ½æ˜¯åŸºäºåº•å±‚çš„DDSå®ç°ã€‚DDS æ˜¯ä¸€ä¸ªä¸­é—´ä»¶æ ‡å‡†ï¼Œå®ƒå®šä¹‰äº†æ•°æ®äº¤æ¢ã€é€šä¿¡æ¨¡å¼å’Œå¯é æ€§ä¿è¯çš„æ–¹å¼ã€‚ROS 2 é‡‡ç”¨ DDS æ¥å®ç°èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ï¼Œæä¾›äº†é«˜æ•ˆã€çµæ´»çš„å®æ—¶æ•°æ®ä¼ è¾“æœºåˆ¶ã€‚</p>
<p>DDS æä¾›äº†ä¸€äº›å¼ºå¤§çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬é«˜å¯ç”¨æ€§ã€çµæ´»çš„ QoSï¼ˆQuality of Serviceï¼‰é…ç½®ã€ä½å»¶è¿Ÿå’Œé«˜ååé‡ã€‚å®ƒæ˜¯é¢å‘æ•°æ®çš„ï¼Œé€‚åˆç”¨äºéœ€è¦æ•°æ®æµçš„åœºæ™¯ï¼Œå¦‚æœºå™¨äººã€ç‰©è”ç½‘ã€è‡ªåŠ¨é©¾é©¶ç­‰é¢†åŸŸã€‚</p>
<p>ROS2ç³»ç»Ÿä¸­å¯¹DDSå®ç°åšäº†è§£è€¦ï¼Œå¯ä»¥æœ‰ä¸åŒçš„ DDS å®ç°ï¼ˆä¾‹å¦‚ï¼ŒFast DDSã€Cyclone DDSã€RTI Connext DDSï¼‰æä¾›äº†ä¸åŒçš„åŠŸèƒ½å’Œç‰¹æ€§ï¼Œä½†å®ƒä»¬éµå¾ªç›¸åŒçš„ DDS æ ‡å‡†ã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2025/09/wp_editor_md_670554578afb0f7215030bd54df7e718_1758018506.png"><img alt="" src="assets/doc/05-rosç³»ç»Ÿ/ros2èŠ‚ç‚¹é€šä¿¡ï¼šè¯é¢˜ã€æœåŠ¡ã€åŠ¨ä½œä¸‰å‰‘å®¢å‚æ•°/images/wp_editor_md_670554578afb0f7215030bd54df7e718_1758018506.png"/></a></p>
<p>DDSé€šä¿¡ç»“æ„ä¸­ï¼Œåªæœ‰åœ¨ä¸€ä¸ªdomainåŸŸä¸­æ‰èƒ½é€šä¿¡ï¼Œå¯ä»¥ç†è§£åœ¨ä¸€ä¸ªç½‘æ®µä¸­ï¼Œæ‰€ä»¥äº†è¦èƒ½å¤Ÿä½¿åº”ç”¨äº’ç›¸é€šä¿¡ï¼Œéœ€è¦å°†å„ä¸ªåº”ç”¨ç»‘å®šåˆ°ä¸€ä¸ªdomainä¸­ã€‚</p>
<p>DDSä¸­è¿˜æœ‰å¦å¤–ä¸€ä¸ªç‰¹æ€§å°±æ˜¯æœåŠ¡ç‰¹æ€§QoSï¼Œå¯ä»¥è®¾ç½®é€šä¿¡çš„ä¼ è¾“è´¨é‡ï¼Œä¼˜å…ˆçº§ç­‰ã€‚</p>
<p>åœ¨ ROS 2 ä¸­ï¼Œå¯ä»¥é€šè¿‡ rclcpp æˆ– rclpy ä¸­çš„æ¥å£æ¥è®¾ç½® QoSï¼Œä¸‹é¢ç®€å•ä¸¾ä¾‹ã€‚ä¾‹å¦‚ï¼Œè®¾ç½®è¯é¢˜çš„ QoSï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">rclpy.qos</span> <span class="kn">import</span> <span class="n">QoSProfile</span><span class="p">,</span> <span class="n">QoSReliabilityPolicy</span><span class="p">,</span> <span class="n">QoSHistoryPolicy</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="n">qos_profile</span> <span class="o">=</span> <span class="n">QoSProfile</span><span class="p">(</span>
    <span class="n">reliability</span><span class="o">=</span><span class="n">QoSReliabilityPolicy</span><span class="o">.</span><span class="n">RELIABLE</span><span class="p">,</span>
    <span class="n">history</span><span class="o">=</span><span class="n">QoSHistoryPolicy</span><span class="o">.</span><span class="n">KEEP_LAST</span><span class="p">,</span>
    <span class="n">depth</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">publisher</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s1">'topic_name'</span><span class="p">,</span> <span class="n">qos_profile</span><span class="p">)</span>
</code></pre></div>
<p>æœ¬æ–‡å…³äºROS2çš„é€šä¿¡è®°å½•åˆ°æ­¤ï¼Œå…·ä½“åœ¨æ ¹æ®å®è·µä¸­æŸ¥è¯¢å§ã€‚</p>
<p>é™„å½•ï¼šæœ¬æ–‡æ¥è‡ªã€ŠROS2æ™ºèƒ½æœºå™¨äººå¼€å‘å®è·µã€‹ç¬”è®°</p></div>
  <div class="post-nav">
    <a class="prev" href="ros2æœºå™¨äººä»¿çœŸ-urdfæ¨¡å‹-gaezboä»¿çœŸ.html">â† ROS2æœºå™¨äººä»¿çœŸï¼šurdfæ¨¡å‹ã€gaezboä»¿çœŸ</a>
    <a class="next" href="ubuntuç³»ç»Ÿå¼‚å¸¸-æ— æ³•è¿›å…¥ç™»å½•æ¡Œé¢.html">ubuntuç³»ç»Ÿå¼‚å¸¸ï¼šæ— æ³•è¿›å…¥ç™»å½•æ¡Œé¢ â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

