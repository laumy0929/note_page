<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>å¹³å¤´å“¥E90Xå¼‚å¸¸å¤„ç† - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#_1">ä¸Šä¸‹æ–‡å…¥æ ˆä¿å­˜</a><ul></ul></li><li><a href="#_2">æ£€æŸ¥æ˜¯åŒæ­¥å¼‚å¸¸</a><ul></ul></li><li><a href="#_3">å¼‚å¸¸å¤„ç†</a><ul></ul></li><li><a href="#_4">ä¸Šä¸‹æ–‡å‡ºæ ˆ</a><ul></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>å¹³å¤´å“¥E90Xå¼‚å¸¸å¤„ç†</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2024-05-09
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      risc-v
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><h2 id="_1">ä¸Šä¸‹æ–‡å…¥æ ˆä¿å­˜</h2>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">addi</span><span class="w"> </span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">portCONTEXT_SIZE</span><span class="w">          </span><span class="o">----</span><span class="n">å¼€è¾Ÿä¸€æ®µæ ˆç©ºé—´</span><span class="err">ï¼Œ</span><span class="n">è¿™é‡Œçš„spå¯èƒ½æ˜¯ä¸»æ ˆæˆ–ä»»åŠ¡æ ˆ</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="o">----</span><span class="n">ä¾æ¬¡å­˜å‚¨ç›¸å…³å¯„å­˜å™¨</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x6</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x7</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x8</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x9</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x10</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x11</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x12</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x13</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x14</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x15</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x16</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x17</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x18</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x19</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x20</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x21</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x22</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x23</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x24</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x25</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x26</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x27</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x28</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x29</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x30</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x31</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w">  </span><span class="mi">31</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">x4</span><span class="p">,</span><span class="w">  </span><span class="mi">32</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>

<span class="w">    </span><span class="n">mv</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span>
<span class="w">    </span><span class="n">addi</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="n">portCONTEXT_SIZE</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w">  </span><span class="mi">30</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="o">---</span><span class="n">å°†æ ˆèµ·å§‹åœ°å€ä¿å­˜åˆ°æ ˆç©ºé—´ä¸­</span>

<span class="w">    </span><span class="n">csrr</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="n">mepc</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="o">---</span><span class="n">å°†mepcä¿å­˜åˆ°æ ˆç©ºé—´ä¸­</span>
<span class="w">    </span><span class="n">csrr</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="n">mscratch</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="o">---</span><span class="n">å°†mscratchä¿å­˜åˆ°æ ˆç©ºé—´ä¸­</span>

<span class="w">    </span><span class="n">csrr</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="n">mstatus</span><span class="w">                    </span><span class="cm">/* Required for MPIE bit. */</span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="n">å°†mstatusä¿å­˜åˆ°æ ˆç©ºé—´ä¸­</span>

<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="n">pxCurrentTCB</span><span class="w">            </span><span class="cm">/* Load pxCurrentTCB. */</span>
<span class="w">    </span><span class="n">store_x</span><span class="w">  </span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">(</span><span class="w"> </span><span class="n">t0</span><span class="w"> </span><span class="p">)</span><span class="w">                </span><span class="cm">/* Write sp to first TCB member. */</span>
<span class="w">                                         </span><span class="n">å°†spå†™å…¥pxCurrentTCB</span><span class="o">-&gt;</span><span class="n">pxTopOfStack</span>
<span class="w">                               </span><span class="n">å³å°†spä¿å­˜åˆ°ä»»åŠ¡çš„æ§åˆ¶å—ä¸­</span><span class="err">ï¼Œ</span><span class="n">æ¯ä¸ªä»»åŠ¡éƒ½æœ‰ä¸€ä¸ªå…¨å±€çš„æ§åˆ¶å—</span>
<span class="w">                               </span><span class="n">å½“æ¢å¤çš„æ—¶å€™</span><span class="err">ï¼Œ</span><span class="n">ä¹Ÿæ˜¯é€šè¿‡pxCurrentTCBå…ˆè·å–åˆ°sp</span><span class="err">ã€‚</span>
</code></pre></div>
<h2 id="_2">æ£€æŸ¥æ˜¯åŒæ­¥å¼‚å¸¸</h2>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">csrr</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="n">mcause</span><span class="w">        </span><span class="o">---</span><span class="n">a0</span><span class="o">=</span><span class="n">mcause</span>
<span class="w">    </span><span class="n">csrr</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">mepc</span><span class="w">          </span><span class="o">---</span><span class="n">a1</span><span class="o">=</span><span class="n">mepc</span>

<span class="nl">test_if_asynchronous</span><span class="p">:</span>
<span class="w">    </span><span class="n">srli</span><span class="w"> </span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="n">__riscv_xlen</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w">   </span><span class="o">--</span><span class="n">å°†a0å³ç§»63ä½</span><span class="err">ï¼ˆ</span><span class="mi">64</span><span class="n">ä½ç³»ç»Ÿ</span><span class="err">ï¼‰ï¼Œ</span><span class="n">å³è·å–mcauseæœ€é«˜ä½</span><span class="err">ï¼Œ</span><span class="n">èµ‹å€¼ä¸ºa2</span>
<span class="w">    </span><span class="n">beq</span><span class="w"> </span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="n">x0</span><span class="p">,</span><span class="w"> </span><span class="n">handle_synchronous</span><span class="w"> </span><span class="o">--</span><span class="n">åˆ¤æ–­a2æ˜¯å¦ä¸º0</span><span class="err">ï¼Œ</span><span class="n">å¦‚æœæ˜¯0</span><span class="err">ï¼Œ</span><span class="n">åˆ™æ˜¯åŒæ­¥å¼‚å¸¸</span><span class="err">ï¼Œ</span><span class="n">è·³è½¬å¤„ç†</span><span class="err">ï¼Œ</span><span class="n">å¦åˆ™æ˜¯ä¸­æ–­</span><span class="err">ã€‚</span>
</code></pre></div>
<h2 id="_3">å¼‚å¸¸å¤„ç†</h2>
<div class="codehilite"><pre><span></span><code><span class="nl">handle_synchronous</span><span class="p">:</span>
<span class="w">    </span><span class="n">csrr</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="n">mcause</span><span class="w">         </span><span class="o">--</span><span class="n">è·å–mcasueåˆ°t0ä¸­</span>
<span class="w">    </span><span class="n">andi</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7ff</span><span class="w">     </span>
<span class="w">    </span><span class="n">mv</span><span class="w">   </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="n">t0</span>
<span class="w">    </span><span class="n">addi</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w">      </span>
<span class="w">    </span><span class="n">store_x</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>

<span class="nl">test_if_environment_call</span><span class="p">:</span>
<span class="w">    </span><span class="n">li</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="w">                   </span>
<span class="w">    </span><span class="n">bne</span><span class="w"> </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="n">is_exception</span><span class="w">            </span>
<span class="w">    </span><span class="n">load_x</span><span class="w"> </span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="n">xISRStackTop</span><span class="w">         </span>
<span class="w">    </span><span class="n">call</span><span class="w"> </span><span class="n">vTaskSwitchContext</span>
<span class="w">    </span><span class="n">j</span><span class="w"> </span><span class="n">processed_source</span>

<span class="nl">is_exception</span><span class="p">:</span>
<span class="w">    </span><span class="n">csrr</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="n">mcause</span><span class="w">                 </span>
<span class="w">    </span><span class="n">csrr</span><span class="w"> </span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">mepc</span><span class="w">                   </span>
<span class="w">    </span><span class="n">csrr</span><span class="w"> </span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="n">mtval</span>
<span class="w">    </span><span class="n">mv</span><span class="w">   </span><span class="n">a0</span><span class="p">,</span><span class="w"> </span><span class="n">t0</span>
<span class="w">    </span><span class="n">mv</span><span class="w">   </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span>
<span class="w">    </span><span class="n">mv</span><span class="w">   </span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span>
<span class="w">    </span><span class="n">mv</span><span class="w">   </span><span class="n">a3</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span>
<span class="w">    </span><span class="n">call</span><span class="w"> </span><span class="n">enter_interrupt_handler</span>
<span class="w">    </span><span class="n">call</span><span class="w"> </span><span class="n">riscv_cpu_handle_exception</span><span class="w">          </span><span class="o">----</span><span class="n">å¼‚å¸¸å¤„ç†å‡½æ•°</span>
<span class="w">    </span><span class="n">call</span><span class="w"> </span><span class="n">exit_interrupt_handler</span>
<span class="w">    </span><span class="n">j</span><span class="w"> </span><span class="n">is_exception</span><span class="w">                      </span>
</code></pre></div>
<h2 id="_4">ä¸Šä¸‹æ–‡å‡ºæ ˆ</h2>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">pxCurrentTCB</span><span class="w">            </span><span class="cm">/* Load pxCurrentTCB. */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">(</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="p">)</span><span class="w">                 </span><span class="cm">/* Read sp from first TCB member. */</span>

<span class="w">    </span><span class="n">load_x</span><span class="w"> </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">--</span><span class="n">è·å–ä¸­æ–­è¿”å›å</span><span class="err">ï¼Œ</span><span class="n">è¦æ‰§è¡Œçš„PC</span><span class="err">ï¼Œ</span><span class="n">å…¶ä¿å­˜åœ¨æ ˆçš„ç¬¬ä¸€ä¸ªä½ç½®</span>
<span class="w">    </span><span class="n">csrw</span><span class="w"> </span><span class="n">mepc</span><span class="p">,</span><span class="w"> </span><span class="n">t0</span><span class="w">  </span>

<span class="w">    </span><span class="cm">/* Load mstatus with the interrupt enable bits used by the task. */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">t0</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">csrw</span><span class="w"> </span><span class="n">mstatus</span><span class="p">,</span><span class="w"> </span><span class="n">t0</span><span class="w">                        </span><span class="n">æ¢å¤mstatus</span><span class="err">ï¼ˆ</span><span class="n">æ‰“å¼€ä¸­æ–­</span><span class="err">ï¼‰</span>

<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="cm">/* t0 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x6</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="cm">/* t1 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x7</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="cm">/* t2 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x8</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="cm">/* s0/fp */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x9</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="cm">/* s1 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x10</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">    </span><span class="cm">/* a0 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x11</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">    </span><span class="cm">/* a1 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x12</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">    </span><span class="cm">/* a2 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x13</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* a3 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x14</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* a4 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x15</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* a5 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x16</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* a6 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x17</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* a7 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x18</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* s2 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x19</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* s3 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x20</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* s4 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x21</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* s5 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x22</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* s6 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x23</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* s7 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x24</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* s8 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x25</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* s9 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x26</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* s10 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x27</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* s11 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x28</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* t3 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x29</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* t4 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x30</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* t5 */</span>
<span class="w">    </span><span class="n">load_x</span><span class="w">  </span><span class="n">x31</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">portWORD_SIZE</span><span class="p">(</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="cm">/* t6 */</span>
<span class="w">    </span><span class="n">addi</span><span class="w"> </span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="n">portCONTEXT_SIZE</span><span class="w">        </span><span class="o">-----</span><span class="n">æ ˆç©ºé—´é‡Šæ”¾</span>

<span class="w">    </span><span class="n">mret</span><span class="w">        </span><span class="o">---</span><span class="n">ä¸­æ–­è¿”å›</span>
</code></pre></div></div>
  <div class="post-nav">
    <a class="prev" href="risc-væ¶æ„ä¸freertosä»»åŠ¡æ ˆå˜åŒ–.html">â† RISC-Væ¶æ„ä¸FreeRTOSä»»åŠ¡æ ˆå˜åŒ–</a>
    <a class="next" href="å¹³å¤´å“¥e90xçš„head-såˆ†æ.html">å¹³å¤´å“¥E90Xçš„head.Såˆ†æ â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

