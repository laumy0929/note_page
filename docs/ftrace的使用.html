<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ftraceçš„ä½¿ç”¨ - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#tracer">tracer</a><ul><li><a href="#irqsoff">irqsoff</a></li><li><a href="#function">function</a></li><li><a href="#function-graph-tracer">function graph tracer</a></li><li><a href="#dynamic-ftrace">dynamic ftrace</a></li><li><a href="#dynamic-ftrace-with-function-graph-tracer">dynamic ftrace with function graph tracer</a></li><li><a href="#other">other</a></li></ul></li><li><a href="#events">eventsä½¿ç”¨</a><ul><li><a href="#sched_switch">sched_switch</a></li><li><a href="#irq">irq</a></li><li><a href="#_1">å°ç»“</a></li></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>ftraceçš„ä½¿ç”¨</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2024-08-27
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      linux
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><h2 id="tracer">tracer</h2>
<h3 id="irqsoff">irqsoff</h3>
<p>å½“å…³é—­ä¸­æ–­æ—¶ï¼ŒCPUå°±æ— æ³•å“åº”ä¸­æ–­äº†ï¼ˆNMIå’ŒSMIé™¤å¤–ï¼‰ï¼Œæ— æ³•å“åº”å¤–éƒ¨äº‹ä»¶åšå‡ºååº”ã€‚è¿™ä¼šé˜»æ­¢å®šæ—¶å™¨è§¦å‘æˆ–é¼ æ ‡ä¸­æ–­è§¦å‘ï¼Œå¯¼è‡´ç³»ç»Ÿå»¶è¿Ÿã€‚ irqsoffè·Ÿè¸ªå™¨è·Ÿè¸ªä¸­æ–­è¢«ç¦ç”¨çš„æ—¶é—´ï¼Œå½“è¾¾åˆ°æ–°çš„æœ€å¤§å»¶è¿Ÿæ—¶ï¼Œè·Ÿè¸ªå™¨ä¼šä¿å­˜å¯¼è‡´è¯¥å»¶è¿Ÿç‚¹çš„è·Ÿè¸ªï¼Œä¸€è¾¹æ¯æ¬¡è¾¾åˆ°æ–°çš„æœ€å¤§å€¼ï¼Œæ—§çš„ä¿å­˜çš„è·Ÿè¸ªä¼šè¢«ä¸¢å¼ƒï¼Œæ–°çš„è·Ÿè¸ªä¼šè¢«ä¿å­˜ã€‚å¦‚æœè¦é‡ç½®æœ€å¤§å€¼ï¼Œç”¨echo 0å†™åˆ°tracing_max_latencyä¸­ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="cp"># echo 0 &gt; options/function-trace</span>
<span class="cp"># echo irqsoff &gt; current_tracer</span>
<span class="cp"># echo 1 &gt; tracing_on</span>
<span class="cp"># echo 0 &gt; tracing_max_latency</span>
<span class="cp"># ls -ltr</span>
<span class="p">[...]</span>
<span class="cp"># echo 0 &gt; tracing_on</span>
<span class="cp"># cat trace</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_3b7340fb5fcf13be7e879fb3db8587bf.jpg"><img alt="" src="assets/doc/01-linux/æ€§èƒ½å·¥å…·/tracerçš„ä½¿ç”¨/images/wp_editor_md_3b7340fb5fcf13be7e879fb3db8587bf.jpg"/></a></p>
<p>ä¸Šå›¾ç¤ºä¾‹å¯ä»¥æœ€å¤§å»¶è¿Ÿä¸º3603usï¼Œåœ¨default_idle_callå’Œ__do_softirqä¸­ç¦ç”¨äº†ä¸­æ–­ï¼Œä¸»è¦çœ‹=&gt; started at:default_idle_callå’Œ=&gt; ended at: __do_softirqã€‚è¡¨ç¤ºå…³ä¸­æ–­çš„å¼€å§‹å‡½æ•°å’Œå¼€ä¸­æ–­çš„å‡½æ•°ã€‚</p>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œå°†funciton-traceå…³æ‰äº†ï¼Œæ²¡æœ‰å¯ç”¨æ­¤tracerè¿‡ç¨‹çš„å‡½æ•°è·Ÿè¸ªã€‚å¦‚æœè®¾ç½®function-traceï¼Œå°±ä¼šæœ‰å¾ˆå¤šçš„æ‰“å°ï¼Œä¼šå°†æ­¤è¿‡ç¨‹ä¸­çš„å‡½æ•°æ‰§è¡Œtraceæ‰“å°å‡ºæ¥ã€‚echo 1 &gt; options/function-traceã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_a77a2861cca77d80dac12cbbb1713743.jpg"><img alt="" src="assets/doc/01-linux/æ€§èƒ½å·¥å…·/tracerçš„ä½¿ç”¨/images/wp_editor_md_a77a2861cca77d80dac12cbbb1713743.jpg"/></a></p>
<p>å¦‚æœæƒ³è¦ä»¥å‡½æ•°å›¾è°ƒç”¨çš„æ–¹å¼æ‰“å°ï¼Œé‚£ä¹ˆwith echo 1 &gt; options/display-graphã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_a185de881d78bbe6c37c61b9034edb78.jpg"><img alt="" src="assets/doc/01-linux/æ€§èƒ½å·¥å…·/tracerçš„ä½¿ç”¨/images/wp_editor_md_a185de881d78bbe6c37c61b9034edb78.jpg"/></a></p>
<p>æœ‰æ—¶å€™cat traceæ˜¯ç©ºçš„ï¼Œå¯èƒ½è®¾ç½®çš„è¿½è¸ªé˜ˆå€¼å¤ªé•¿ï¼Œå¯ä»¥ä¿®æ”¹çŸ­ä¸€ç‚¹ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tracing_thresh</span><span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">è®¾ç½®é˜ˆå€¼ä¸º</span><span class="w"> </span><span class="mi">5</span><span class="n">Î¼s</span>
</code></pre></div>
<h3 id="function">function</h3>
<p>functionä¸ºå‡½æ•°è·Ÿè¸ªå™¨ï¼Œå¯ä»¥ä»è°ƒè¯•æ–‡ä»¶ç³»ç»Ÿå¯åŠ¨å‡½æ•°è·Ÿè¸ªå™¨ï¼Œecho function &gt; current_tracerã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="cp"># echo function &gt; current_tracer</span>
<span class="cp"># echo 1 &gt; tracing_on</span>
<span class="cp"># usleep 1</span>
<span class="cp"># echo 0 &gt; tracing_on</span>
<span class="cp"># cat trace</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_927e9c7fdecaad83273a99daece51b00.jpg"><img alt="" src="assets/doc/01-linux/æ€§èƒ½å·¥å…·/tracerçš„ä½¿ç”¨/images/wp_editor_md_927e9c7fdecaad83273a99daece51b00.jpg"/></a></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œfunction tracerä½¿ç”¨ç¯å½¢ç¼“å†²åŒºæ¥å­˜å‚¨ä¸Šè¿°æ•°æ®ï¼Œæœ€æ–°æ•°æ®å¯èƒ½ä¼šè¦†ç›–æœ€æ—§çš„æ•°æ®ï¼Œæœ‰æ—¶ä½¿ç”¨echo æ¥åœæ­¢è·Ÿè¸ªå™¨æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºè·Ÿè¸ªå¯èƒ½ä¼šè¦†ç›–æ‚¨æƒ³è¦è®°å½•çš„æ•°æ®ã€‚å› æ­¤æœ€å¥½ç›´æ¥ä»ç¨‹åºä¸­ç¦ç”¨è·Ÿè¸ªï¼Œå…è®¸æ‚¨åœ¨åˆ°è¾¾ä½ æ„Ÿå…´è¶£çš„éƒ¨åˆ†æ—¶åœæ­¢è·Ÿè¸ªï¼Œå¦‚æœè¦ä»Cç¨‹åºç¦ç”¨è·Ÿè¸ªï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼ä¸‹é¢ä»£ç ï¼›</p>
<div class="codehilite"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">trace_fd</span><span class="p">;</span>
<span class="p">[...]</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">[...]</span>
<span class="w">    </span><span class="n">trace_fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">tracing_file</span><span class="p">(</span><span class="s">"tracing_on"</span><span class="p">),</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="p">);</span>
<span class="w">    </span><span class="p">[...]</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">condition_hit</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">write</span><span class="p">(</span><span class="n">trace_fd</span><span class="p">,</span><span class="w"> </span><span class="s">"0"</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">[...]</span>
<span class="p">}</span>
</code></pre></div>
<p>å•ä¸ªçº¿ç¨‹çš„è·Ÿè¸ªï¼Œ</p>
<div class="codehilite"><pre><span></span><code><span class="cp"># cat set_ftrace_pid</span>
<span class="w">  </span><span class="n">no</span><span class="w"> </span><span class="n">pid</span>
<span class="cp"># echo 3111 &gt; set_ftrace_pid</span>
<span class="cp"># cat set_ftrace_pid</span>
<span class="w">  </span><span class="mi">3111</span>
<span class="cp"># echo function &gt; current_tracer</span>
<span class="cp"># cat trace | head</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_b5ee0bfadcf5e2ed872399ce46577143.jpg"><img alt="" src="assets/doc/01-linux/æ€§èƒ½å·¥å…·/tracerçš„ä½¿ç”¨/images/wp_editor_md_b5ee0bfadcf5e2ed872399ce46577143.jpg"/></a></p>
<p>å¦‚æœæƒ³è¦traceä¸€ä¸ªå‡½æ•°åœ¨å¯åŠ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç¤ºä¾‹ç¨‹åºã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/stat.h&gt;</span>
<span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fcntl.h&gt;</span>
<span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>

<span class="w">    </span><span class="cp">#define _STR(x) #x</span>
<span class="w">    </span><span class="cp">#define STR(x) _STR(x)</span>
<span class="w">    </span><span class="cp">#define MAX_PATH 256</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">find_tracefs</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">           </span><span class="k">static</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">tracefs</span><span class="p">[</span><span class="n">MAX_PATH</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="w">           </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tracefs_found</span><span class="p">;</span>
<span class="w">           </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
<span class="w">           </span><span class="kt">FILE</span><span class="w"> </span><span class="o">*</span><span class="n">fp</span><span class="p">;</span>

<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tracefs_found</span><span class="p">)</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="n">tracefs</span><span class="p">;</span>

<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">fp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="s">"/proc/mounts"</span><span class="p">,</span><span class="s">"r"</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="n">perror</span><span class="p">(</span><span class="s">"/proc/mounts"</span><span class="p">);</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">           </span><span class="p">}</span>

<span class="w">           </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">fscanf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="s">"%*s %"</span>
<span class="w">                     </span><span class="n">STR</span><span class="p">(</span><span class="n">MAX_PATH</span><span class="p">)</span>
<span class="w">                     </span><span class="s">"s %99s %*s %*d %*d</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span>
<span class="w">                     </span><span class="n">tracefs</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="s">"tracefs"</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                       </span><span class="k">break</span><span class="p">;</span>
<span class="w">           </span><span class="p">}</span>
<span class="w">           </span><span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="s">"tracefs"</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">"tracefs not mounted"</span><span class="p">);</span>
<span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">           </span><span class="p">}</span>

<span class="w">           </span><span class="n">strcat</span><span class="p">(</span><span class="n">tracefs</span><span class="p">,</span><span class="w"> </span><span class="s">"/tracing/"</span><span class="p">);</span>
<span class="w">           </span><span class="n">tracefs_found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">           </span><span class="k">return</span><span class="w"> </span><span class="n">tracefs</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">tracing_file</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">file_name</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">           </span><span class="k">static</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">trace_file</span><span class="p">[</span><span class="n">MAX_PATH</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="w">           </span><span class="n">snprintf</span><span class="p">(</span><span class="n">trace_file</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_PATH</span><span class="p">,</span><span class="w"> </span><span class="s">"%s/%s"</span><span class="p">,</span><span class="w"> </span><span class="n">find_tracefs</span><span class="p">(),</span><span class="w"> </span><span class="n">file_name</span><span class="p">);</span>
<span class="w">           </span><span class="k">return</span><span class="w"> </span><span class="n">trace_file</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="n">exit</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fork</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">ffd</span><span class="p">;</span>
<span class="w">                </span><span class="kt">char</span><span class="w"> </span><span class="n">line</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>

<span class="w">                </span><span class="n">ffd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">tracing_file</span><span class="p">(</span><span class="s">"current_tracer"</span><span class="p">),</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ffd</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                        </span><span class="n">exit</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<span class="w">                </span><span class="n">write</span><span class="p">(</span><span class="n">ffd</span><span class="p">,</span><span class="w"> </span><span class="s">"nop"</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="w">                </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">tracing_file</span><span class="p">(</span><span class="s">"set_ftrace_pid"</span><span class="p">),</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="p">);</span>
<span class="w">                </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="w"> </span><span class="s">"%d</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span><span class="w"> </span><span class="n">getpid</span><span class="p">());</span>
<span class="w">                </span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">);</span>

<span class="w">                </span><span class="n">write</span><span class="p">(</span><span class="n">ffd</span><span class="p">,</span><span class="w"> </span><span class="s">"function"</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>

<span class="w">                </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
<span class="w">                </span><span class="n">close</span><span class="p">(</span><span class="n">ffd</span><span class="p">);</span>

<span class="w">                </span><span class="n">execvp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">argv</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç®€å•çš„è„šæ­¥æ¥å®ç°</p>
<div class="codehilite"><pre><span></span><code><span class="n">Or</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">simple</span><span class="w"> </span><span class="n">script</span><span class="o">!</span>
<span class="o">::</span>

<span class="w">  </span><span class="cp">#!/bin/bash</span>

<span class="w">  </span><span class="n">tracefs</span><span class="o">=</span><span class="err">`</span><span class="n">sed</span><span class="w"> </span><span class="o">-</span><span class="n">ne</span><span class="w"> </span><span class="err">\'</span><span class="n">s</span><span class="o">/^</span><span class="n">tracefs</span><span class="w"> </span><span class="err">\\</span><span class="p">(.</span><span class="o">*</span><span class="err">\\</span><span class="p">)</span><span class="w"> </span><span class="n">tracefs</span><span class="p">.</span><span class="o">*/</span><span class="err">\\</span><span class="mi">1</span><span class="o">/</span><span class="n">p</span><span class="err">\'</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">mounts</span><span class="err">`</span>
<span class="w">  </span><span class="n">echo</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">$tracefs</span><span class="o">/</span><span class="n">tracing_on</span>
<span class="w">  </span><span class="n">echo</span><span class="w"> </span><span class="n">$$</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">$tracefs</span><span class="o">/</span><span class="n">set_ftrace_pid</span>
<span class="w">  </span><span class="n">echo</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">$tracefs</span><span class="o">/</span><span class="n">current_tracer</span>
<span class="w">  </span><span class="n">echo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">$tracefs</span><span class="o">/</span><span class="n">tracing_on</span>
<span class="w">  </span><span class="n">exec</span><span class="w"> </span><span class="err">\</span><span class="s">"$@</span><span class="se">\"</span>
</code></pre></div>
<h3 id="function-graph-tracer">function graph tracer</h3>
<p>function graph tracerä¸function tracerç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä¼šåœ¨å‡½æ•°è¿›å…¥å’Œé€€å‡ºæ—¶å¯¹å…¶è¿›è¡Œæ¢æµ‹ï¼Œè¿™æ˜¯é€šè¿‡æ¯ä¸ªtask_structä¸­ä½¿ç”¨åŠ¨æ€åˆ†é…çš„è¿”å›åœ°å€å †æ ˆæ¥å®ç°çš„ã€‚åœ¨å‡½æ•°è¿›å…¥æ—¶ï¼Œè·Ÿè¸ªå™¨ä¼šè¦†ç›–è·Ÿè¸ªæ¯ä¸ªå‡½æ•°çš„è¿”å›åœ°å€ä»¥è®¾ç½®è‡ªå®šä¹‰æ¢æµ‹å™¨ï¼Œå› æ­¤åŸå§‹è¿”å›åœ°å€å­˜å‚¨åœ¨task_structä¸­çš„è¿”å›åœ°å€å †æ ˆä¸­ã€‚åœ¨å‡½æ•°ä¸¤ç«¯è¿›è¡Œæ¢æµ‹å¯å®ç°ç‰¹æ®ŠåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šæµ‹é‡å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‹¥æœ‰å¯é è°ƒç”¨å †æ ˆæ¥ç»˜åˆ¶å‡½æ•°çš„è°ƒç”¨å›¾ã€‚è¿™ç§è·Ÿè¸ªå™¨åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µå¾ˆæœ‰ç”¨ï¼š</p>
<ul>
<li>æ‰¾åˆ°å¥‡æ€ªå†…æ ¸è¡Œä¸ºçš„åŸå› ï¼Œè¯¦ç»†äº†è§£ä»»ä½•åŒºåŸŸå‘ç”Ÿçš„æƒ…å†µã€‚</li>
<li>é‡åˆ°å¥‡æ€ªçš„å»¶è¿Ÿï¼Œä½†å¾ˆéš¾æ‰¾åˆ°æ ¹æºã€‚</li>
<li>å¿«é€Ÿæ‰¾åˆ°ç‰¹å®šå‡½æ•°çš„è°ƒç”¨è·¯å¾„ã€‚</li>
<li>çª¥è§†æ­£åœ¨è¿è¡Œçš„å†…æ ¸å¹¶æŸ¥çœ‹å‘ç”Ÿäº†ä»€ä¹ˆã€‚</li>
</ul>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_eded07629091b16a6b594469a0278ba3.jpg"><img alt="" src="assets/doc/01-linux/æ€§èƒ½å·¥å…·/tracerçš„ä½¿ç”¨/images/wp_editor_md_eded07629091b16a6b594469a0278ba3.jpg"/></a></p>
<p>æœ‰å‡ åˆ—æ˜¯å¯ä»¥åŠ¨æ€å¯ç”¨å’Œç¦æ­¢çš„ã€‚ - cpu numberæ˜¯é»˜è®¤ä¼šå¯åŠ¨å‡½æ•°æ‰§è¡Œçš„cpuç¼–å·ï¼Œæœ‰æ—¶å€™æœ€å¥½åªè·Ÿè¸ªä¸€ä¸ªcpuï¼ˆtracing_cpu_maskï¼‰ï¼Œå¦åˆ™åœ¨cpuè·Ÿè¸ªæ˜¯ï¼Œä¼šçœ‹åˆ°æ— é¡»çš„å‡½æ•°è°ƒç”¨ã€‚éšè—cpu: echo nofuncgraph-cpu &gt; trace_optionsã€‚ - durationè¡¨ç¤ºå‡½æ•°æ‰§è¡Œçš„æ—¶é—´ï¼Œä¼šæ˜¾ç¤ºåœ¨å‡½æ•°ç»“æŸæ‹¬å·è¡Œä¸Šã€‚å¦‚æœæ˜¯å¶å‡½æ•°ï¼Œåˆ™æ˜¾ç¤ºåœ¨å½“å‰å‡½æ•°çš„åŒä¸€è¡Œã€‚å¦‚æœè¦å…³æ‰ï¼Œåˆ™echo nofuncgraph-duration &gt; trace_optionsã€‚ å¦‚æœå‡½æ•°çš„å¼€å¤´ä¸åœ¨è·Ÿè¸ªç¼“å†²åŒºï¼Œåˆ™å‡½æ•°åç§°å¯ä»¥æ˜¾ç¤ºåˆ°å‡½æ•°çš„å³æ‹¬å·åé¢ï¼Œå¯ä»¥echo funcgraph-tail &gt; trace_optionsè¿›è¡Œä½¿èƒ½ã€‚</p>
<h3 id="dynamic-ftrace">dynamic ftrace</h3>
<p>å¦‚æœä½¿èƒ½äº†CONFIG_DYNAMIC_FTRACEï¼Œåˆ™åœ¨ç¦ç”¨å‡½æ•°è·Ÿè¸ªæ—¶ï¼Œç³»ç»Ÿå°†å‡ ä¹ä¸äº§ç”Ÿä»»ä½•å¼€é”€ã€‚å…¶å·¥ä½œåŸç†æ˜¯ä½¿èƒ½äº†gccçš„-pgå‚æ•°ä¼šè‡ªåŠ¨åœ¨å†…æ ¸çš„å‡½æ•°å¼€å¤´æ’æ¡©mcountå‡½æ•°ï¼ˆä¸æ¶æ„æœ‰å…³ç³»ï¼Œgcc 4.6ç‰ˆæœ¬å¼€å§‹ï¼Œx86æ¶æ„æ·»åŠ mfentryï¼Œå®ƒè°ƒç”¨â€œ<strong>fentry</strong>â€è€Œä¸æ˜¯â€œmcountâ€ï¼‰ã€‚ åœ¨ç¼–è¯‘æ—¶ï¼Œæ¯ä¸ªCæ–‡ä»¶å¯¹è±¡é€šè¿‡recordmcountç¨‹åºï¼ˆä½äºè„šæœ¬ç›®å½•ï¼‰è¿è¡Œï¼Œè¯¥ç¨‹åºå°†è§£æCå¯¹è±¡çš„ELFæ ‡å¤´ï¼ŒæŸ¥æ‰¾.textéƒ¨åˆ†ä¸­è°ƒç”¨mcountçš„æ‰€æœ‰ä½ç½®ã€‚ NOTE:æ³¨æ„çš„æ˜¯å¹¶éæ‰€æœ‰çš„sectionéƒ½è¢«è·Ÿè¸ªï¼Œå¯ä»¥é€šè¿‡notraceæˆ–å…¶ä»–åŠæ³•æ¥ä¸è®©å…¶è·Ÿè¸ªï¼Œå¹¶ä¸”ä¸ä¼šè·Ÿè¸ªæ‰€æœ‰çš„å†…è”å‡½æ•°ï¼Œå¯ä»¥cat available_filter_functionsèŠ‚ç‚¹æ¥æŸ¥çœ‹å¯ä»¥è·Ÿè¸ªé‚£äº›å‡½æ•°ã€‚ åˆ›å»ºä¸€ä¸ªâ€œ__mcount_locâ€çš„æ®µï¼ˆsectionï¼‰ï¼Œè¯¥æ®µä¸­è®°å½•äº†æ‰€æœ‰åŒ…å«åœ¨.textä¸­å¯¹mcountè°ƒç”¨ç‚¹çš„å¼•ç”¨ä½ç½®ã€‚æœ€å__mcount_locåœ¨é“¾æ¥æ—¶ç»Ÿä¸€é“¾æ¥åˆ°ä¸€ä¸ª__mcount_locä¸­ã€‚</p>
<p>å…·ä½“çš„è¿‡ç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œåˆå§‹åŒ–SMPä¹‹å‰ï¼ŒåŠ¨æ€ftraceä»£ç ä¼šæ‰«ææ­¤è¡¨å¹¶å°†æ‰€æœ‰ä½ç½®æ›´æ–°ä¸ºæ›¿æ¢ä¸ºnopæŒ‡ä»¤ï¼ŒåŒæ—¶è¿˜ä¼šè®°å½•ä½ç½®ï¼Œè¿™äº›ä½ç½®è¢«æ·»åŠ åˆ°available_filter_functionsè¡¨ä¸­ã€‚åœ¨æ¨¡å—åŠ è½½å’Œæ‰§è¡Œä¹‹å‰è¿›è¡Œå¤„ç†ï¼Œå¸è½½æ¨¡å—æ—¶ï¼Œå®ƒè¿˜ä¼šä»ftraceå‡½æ•°åˆ—è¡¨ä¸­åˆ é™¤å…¶å‡½æ•°ã€‚ åœ¨å¯åŠ¨åŠ¨æ€è·Ÿè¸ªåï¼Œä¿®æ”¹å‡½æ•°è·Ÿè¸ªç‚¹çš„è¿‡ç¨‹å–å†³äºå…·ä½“çš„archã€‚ä¿®æ”¹å‡½æ•°è·Ÿè¸ªç‚¹çš„æ–¹æ³•æ—¶è¦ä¿®æ”¹ä½ç½®æ”¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼ŒåŒæ­¥æ‰€æœ‰çš„CPUã€‚æ¥ç€ä¿®æ”¹å…¶æŒ‡ä»¤ï¼ŒåŒæ­¥ç»™æ‰€æœ‰çš„CPUå†æŠŠæ–­ç‚¹ç§»é™¤ã€‚é€šè¿‡è¿™æ ·åŠ¨æ€çš„æ–¹å¼ï¼Œå¯ä»¥åšåˆ°æœ‰é€‰æ‹©çš„è·Ÿè¸ªæŒ‡å®šå‡½æ•°ï¼Œå…¶ä»–ä¸æƒ³è·Ÿè¸ªçš„å‡½æ•°å°±çš„ä½ç½®æ‰§è¡Œçš„æ˜¯nopæŒ‡ä»¤ï¼Œä¸è‡³äºå½±å“æ€§èƒ½ã€‚ å†…æ ¸ä¸­ä½¿ç”¨ä¸¤ä¸ªæ–‡ä»¶ç”¨äºå¯åŠ¨å’Œç¦ç”¨æŒ‡å®šçš„å‡½æ•°è·Ÿè¸ªåˆ†åˆ«æ˜¯set_ftrace_filterå’Œset_ftrace_notraceã€‚å¯ä»¥é€šè¿‡available_filter_functionsæ¥æŸ¥çœ‹è·Ÿè¸ªçš„å‡½æ•°ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="cp"># echo sys_nanosleep hrtimer_interrupt &gt; set_ftrace_filter</span>
<span class="cp"># echo function &gt; current_tracer</span>
<span class="cp"># echo 1 &gt; tracing_on</span>
<span class="cp"># usleep 1</span>
<span class="cp"># echo 0 &gt; tracing_on</span>
<span class="cp"># cat trace</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_7c4c59a5986dc23ef9dc65b006826f86.jpg"><img alt="" src="assets/doc/01-linux/æ€§èƒ½å·¥å…·/tracerçš„ä½¿ç”¨/images/wp_editor_md_7c4c59a5986dc23ef9dc65b006826f86.jpg"/></a></p>
<p>è®¾ç½®set_ftrace_filterå¯ä»¥ä½¿ç”¨é€šé…ç¬¦åŒ¹é…ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="err">``</span><span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;*</span><span class="err">``</span><span class="w"> </span><span class="err">ï¼š</span><span class="n">åŒ¹é…</span><span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span><span class="n">å¼€å¤´çš„å‡½æ•°</span>
<span class="err">``</span><span class="o">*&lt;</span><span class="n">match</span><span class="o">&gt;</span><span class="err">``ï¼š</span><span class="n">åŒ¹é…</span><span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span><span class="n">ç»“å°¾çš„å‡½æ•°</span>
<span class="err">``</span><span class="o">*&lt;</span><span class="n">match</span><span class="o">&gt;*</span><span class="err">``ï¼š</span><span class="n">åŒ¹é…å…¶ä¸­åŒ…å«</span><span class="o">&lt;</span><span class="n">match</span><span class="o">&gt;</span><span class="n">çš„å‡½æ•°</span>
<span class="err">``</span><span class="o">&lt;</span><span class="n">match1</span><span class="o">&gt;*&lt;</span><span class="n">match2</span><span class="o">&gt;</span><span class="err">``ï¼š</span><span class="n">åŒ¹é…</span><span class="o">&lt;</span><span class="n">match1</span><span class="o">&gt;</span><span class="n">å¼€å¤´å¹¶ä»¥</span><span class="o">&lt;</span><span class="n">match2</span><span class="o">&gt;</span><span class="n">ç»“å°¾çš„å‡½æ•°</span>
</code></pre></div>
<p>è®¾ç½®set_ftrace_filteræ¥å£æ”¯æŒè¿‡æ»¤å‘½ä»¤ï¼Œæ ¼å¼ä¸º\:\:\</p>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="n">mod</span><span class="o">:</span><span class="w"> </span><span class="n">å¯ç”¨æ¯ä¸ªæ¨¡å—çš„åŠŸèƒ½è¿‡æ»¤</span><span class="p">,</span><span class="n">å¦‚åªéœ€è¦ext3æ¨¡å—ä¸­çš„write</span><span class="o">*</span><span class="n">åŠŸèƒ½</span>
<span class="w">      </span><span class="n">echo</span><span class="w"> </span><span class="err">\'</span><span class="n">write</span><span class="o">*:</span><span class="n">mod</span><span class="o">:</span><span class="n">ext3</span><span class="err">\'</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">set_ftrace_filter</span>
<span class="o">-</span><span class="n">traceon</span><span class="o">/</span><span class="n">traceoff</span><span class="o">:</span><span class="w"> </span><span class="n">æŒ‡å®šå‡½æ•°æ‰“å¼€å’Œå…³é—­æ—¶è·Ÿè¸ª</span><span class="err">ï¼Œ</span><span class="n">å‚æ•°ç¡®å®šè·Ÿè¸ªç³»ç»Ÿæ‰“å¼€å’Œå…³é—­çš„æ¬¡æ•°</span><span class="err">ï¼Œ</span><span class="n">å¦‚æœä¸ºæŒ‡å®š</span><span class="err">ï¼Œ</span><span class="n">åˆ™æ²¡æœ‰é™åˆ¶</span><span class="err">ï¼Œ</span><span class="n">ä¾‹å¦‚åœ¨å‰5æ­¤é‡åˆ°é”™è¯¯æ—¶ç¦æ­¢è·Ÿè¸ª</span>
<span class="w">      </span><span class="n">echo</span><span class="w"> </span><span class="err">\'</span><span class="n">__schedule_bug</span><span class="o">:</span><span class="n">traceoff</span><span class="o">:</span><span class="mi">5</span><span class="err">\'</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">set_ftrace_filter</span>
</code></pre></div>
<h3 id="dynamic-ftrace-with-function-graph-tracer">dynamic ftrace with function graph tracer</h3>
<p>ä¸Šé¢è§£é‡Šäº†function tracerå’Œfunction graph tracerï¼Œä½†æœ‰äº›ç‰¹æ®ŠåŠŸèƒ½åªåœ¨function graph tracerä¸­å¯ç”¨ã€‚å¦‚æœè·Ÿè¸ªä¸€ä¸ªå‡½æ•°åŠå…¶å­å‡½æ•°ï¼Œåªéœ€è¦å‡½æ•°å°†å…¶åç§°å†™åˆ°set_graph_functionä¸­ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="n">function_graph</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">current_tracer</span>
<span class="n">echo</span><span class="w"> </span><span class="n">__do_fault</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">set_graph_function</span>
<span class="n">echo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tracing_on</span>
<span class="p">...</span>
<span class="n">echo</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tracing_on</span>
</code></pre></div>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/08/wp_editor_md_958013c75a14a224243a149ba98973ef.jpg"><img alt="" src="assets/doc/01-linux/æ€§èƒ½å·¥å…·/tracerçš„ä½¿ç”¨/images/wp_editor_md_958013c75a14a224243a149ba98973ef.jpg"/></a></p>
<h3 id="other">other</h3>
<p>ftraceæœ‰ä¸€ä¸ªæ€»å¼€å…³ï¼Œ/proc/sys/kernel/ftrace_enabledï¼Œå‘å…¶å†™0æˆ–1è¡¨ç¤ºå…³é—­å’Œä½¿èƒ½ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„çŠ¶æ€ã€‚æ›´å¤šç»†èŠ‚å‚è€ƒï¼šDocumentation/trace/ftrace.rstã€‚</p>
<h2 id="events">eventsä½¿ç”¨</h2>
<h3 id="sched_switch">sched_switch</h3>
<p>sched_switchæ˜¯é™æ€Tracepointäº‹ä»¶è¿½è¸ªï¼Œä¸‹é¢æ˜¯ç¤ºä¾‹</p>
<div class="codehilite"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="c1">//kernel/debug/tracing/events/sched/sched_switch/enable</span>
<span class="cp"># ä½¿èƒ½sched_switch</span>

<span class="n">echo</span><span class="w"> </span><span class="err">'</span><span class="n">prev_pid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1162</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">next_pid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1244</span><span class="err">'</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">events</span><span class="o">/</span><span class="n">sched</span><span class="o">/</span><span class="n">sched_switch</span><span class="o">/</span><span class="n">filter</span>
<span class="cp">#è®¾ç½®sched_switch äº‹ä»¶çš„è¿‡æ»¤æ¡ä»¶ï¼Œä½¿å¾—åªæœ‰å½“è¿›ç¨‹IDä¸º1162çš„è¿›ç¨‹</span>
<span class="cp">#åˆ‡æ¢ä¸ºè¿›ç¨‹IDä¸º1244çš„è¿›ç¨‹æ—¶ï¼Œæ‰ä¼šè®°å½•è¿™ä¸ªäº‹ä»¶ï¼Œå¦åˆ™æ‰“å°å¤ªå¤šäº†</span>

<span class="n">echo</span><span class="w"> </span><span class="s">""</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">trace</span>
<span class="cp"># æ¸…é™¤trace buffer</span>

<span class="n">echo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">tracing_on</span>
<span class="cp"># å¼€å§‹tracing</span>

<span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">trace</span>
<span class="cp"># æŸ¥çœ‹ç»“æœ</span>

<span class="n">è¿è¡Œç»“æœå¦‚ä¸‹</span><span class="err">ï¼š</span>

<span class="cp"># tracer: nop</span>
<span class="cp">#</span>
<span class="cp"># nop latency trace v1.1.5 on 5.15.147</span>
<span class="cp"># --------------------------------------------------------------------</span>
<span class="cp"># latency: 0 us, #15/15, CPU#1 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span>
<span class="cp">#    -----------------</span>
<span class="cp">#    | task: -0 (uid:0 nice:0 policy:0 rt_prio:0)</span>
<span class="cp">#    -----------------</span>
<span class="cp">#</span>
<span class="cp">#                    _------=&gt; CPU#            </span>
<span class="cp">#                   / _-----=&gt; irqs-off        </span>
<span class="cp">#                  | / _----=&gt; need-resched    </span>
<span class="cp">#                  || / _---=&gt; hardirq/softirq </span>
<span class="cp">#                  ||| / _--=&gt; preempt-depth   </span>
<span class="cp">#                  |||| / _-=&gt; migrate-disable </span>
<span class="cp">#                  ||||| /     delay           </span>
<span class="cp">#  cmd     pid     |||||| time  |   caller     </span>
<span class="cp">#     \   /        ||||||  \    |    /       </span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">         </span><span class="mi">0</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">95713u</span><span class="n">s$</span><span class="o">:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">swapper</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">R</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">wpa_supplicant</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">1244</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">         </span><span class="mi">0</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">10104901u</span><span class="n">s$</span><span class="o">:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">swapper</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">R</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">wpa_supplicant</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">1244</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">         </span><span class="mi">0</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">20114087u</span><span class="n">s$</span><span class="o">:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">swapper</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">R</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">wpa_supplicant</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">1244</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>
<span class="n">wifi_dae</span><span class="mi">-1162</span><span class="w">      </span><span class="mi">2</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">25998599u</span><span class="n">s</span><span class="o">!:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">wifi_daemon</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">1162</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">R</span><span class="o">+</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">sugov</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">88</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">-1</span>
<span class="n">wifi_dae</span><span class="mi">-1162</span><span class="w">      </span><span class="mi">2</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">25999269u</span><span class="n">s</span><span class="o">!:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">wifi_daemon</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">1162</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">R</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">sugov</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">88</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">-1</span>
<span class="n">wifi_dae</span><span class="mi">-1162</span><span class="w">      </span><span class="mi">2</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">25999412u</span><span class="n">s</span><span class="o">!:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">wifi_daemon</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">1162</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">R</span><span class="o">+</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">sugov</span><span class="o">:</span><span class="mi">0</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">88</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">-1</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">         </span><span class="mi">0</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">25999584u</span><span class="n">s</span><span class="o">!:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">swapper</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">R</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">wpa_supplicant</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">1244</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>
<span class="n">wifi_dae</span><span class="mi">-1162</span><span class="w">      </span><span class="mi">3</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">26000075u</span><span class="n">s</span><span class="o">*:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">wifi_daemon</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">1162</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">swapper</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">         </span><span class="mi">0</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">26012127u</span><span class="n">s</span><span class="o">!:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">swapper</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">R</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">wpa_supplicant</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">1244</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">         </span><span class="mi">0</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">26012552u</span><span class="n">s</span><span class="o">!:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">swapper</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">R</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">wpa_supplicant</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">1244</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>
<span class="w"> </span><span class="n">logread</span><span class="mi">-495</span><span class="w">       </span><span class="mi">0</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">26013054u</span><span class="n">s$</span><span class="o">:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">logread</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">495</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">wpa_supplicant</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">1244</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>
<span class="n">rcu_pree</span><span class="mi">-14</span><span class="w">        </span><span class="mi">3</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">27564266u</span><span class="n">s</span><span class="err">#</span><span class="o">:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">rcu_preempt</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">14</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">I</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">wpa_supplicant</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">1244</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>
<span class="w">   </span><span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span><span class="mi">-1163</span><span class="w">      </span><span class="mi">3</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">27567664u</span><span class="n">s</span><span class="o">!:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">wifi_daemon</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">1163</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">wpa_supplicant</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">1244</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>
<span class="w">   </span><span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span><span class="mi">-1163</span><span class="w">      </span><span class="mi">3</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">27568473u</span><span class="n">s$</span><span class="o">:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">wifi_daemon</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">1163</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">S</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">wpa_supplicant</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">1244</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">         </span><span class="mi">3</span><span class="n">d</span><span class="p">.</span><span class="mf">.2</span><span class="p">.</span><span class="w"> </span><span class="mi">30116102u</span><span class="n">s</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">sched_switch</span><span class="o">:</span><span class="w"> </span><span class="n">prev_comm</span><span class="o">=</span><span class="n">swapper</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="n">prev_pid</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">prev_prio</span><span class="o">=</span><span class="mi">120</span><span class="w"> </span><span class="n">prev_state</span><span class="o">=</span><span class="n">R</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">next_comm</span><span class="o">=</span><span class="n">wpa_supplicant</span><span class="w"> </span><span class="n">next_pid</span><span class="o">=</span><span class="mi">1244</span><span class="w"> </span><span class="n">next_prio</span><span class="o">=</span><span class="mi">120</span>

<span class="n">ä»ä¸Šé¢çš„æ‰“å°ç»“æœå¯ä»¥çœ‹åˆ°</span><span class="err">ï¼Œ</span><span class="n">åªä¼šæ‰“å°ä¸‹ä¸€ä¸ªè°ƒåº¦è¿›ç¨‹ä¸ºnext_pid</span><span class="o">=</span><span class="mi">1244</span><span class="n">æˆ–è€…ä¸Šä¸€ä¸ªè°ƒåº¦è¿›ç¨‹ä¸ºprev_pid</span><span class="o">=</span><span class="mi">1162</span><span class="n">çš„ä¸¤ä¸ªè¿›ç¨‹</span><span class="err">ã€‚</span>
</code></pre></div>
<h3 id="irq">irq</h3>
<div class="codehilite"><pre><span></span><code><span class="n">echo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">events</span><span class="o">/</span><span class="n">irq</span><span class="o">/</span><span class="n">irq_handler_entry</span><span class="o">/</span><span class="n">enable</span>
<span class="n">echo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">events</span><span class="o">/</span><span class="n">irq</span><span class="o">/</span><span class="n">irq_handler_exit</span><span class="o">/</span><span class="n">enable</span>
<span class="cp"># ä½¿èƒ½æœ€ç»ˆä¸­æ–­çš„è¿›å…¥å’Œé€€å‡ºè¿½è¸ªã€‚</span>

<span class="n">echo</span><span class="w"> </span><span class="s">"irq == 62"</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">events</span><span class="o">/</span><span class="n">irq</span><span class="o">/</span><span class="n">irq_handler_exit</span><span class="o">/</span><span class="n">filter</span>
<span class="n">echo</span><span class="w"> </span><span class="s">"irq == 62"</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">events</span><span class="o">/</span><span class="n">irq</span><span class="o">/</span><span class="n">irq_handler_entry</span><span class="o">/</span><span class="n">filter</span>
<span class="cp">#è®¾ç½®irqçš„è¿‡æ»¤ï¼Œè¦è¿‡æ»¤çš„ä¸­æ–­å·å¯ä»¥é€šè¿‡cat /proc/interruptsè·å–ã€‚</span>

<span class="n">echo</span><span class="w"> </span><span class="s">""</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">trace</span>
<span class="cp"># æ¸…é™¤trace buffer</span>

<span class="n">echo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">tracing_on</span>
<span class="cp"># å¼€å§‹tracing</span>

<span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">trace</span>
<span class="cp"># æŸ¥çœ‹ç»“æœ</span>

<span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">trace</span>
<span class="cp"># tracer: nop</span>
<span class="cp">#</span>
<span class="cp"># entries-in-buffer/entries-written: 354/354   #P:4</span>
<span class="cp">#</span>
<span class="cp">#                                _-----=&gt; irqs-off</span>
<span class="cp">#                               / _----=&gt; need-resched</span>
<span class="cp">#                              | / _---=&gt; hardirq/softirq</span>
<span class="cp">#                              || / _--=&gt; preempt-depth</span>
<span class="cp">#                              ||| / _-=&gt; migrate-disable</span>
<span class="cp">#                              |||| /     delay</span>
<span class="cp">#           TASK-PID     CPU#  |||||  TIMESTAMP  FUNCTION</span>
<span class="cp">#              | |         |   |||||     |         |</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h</span><span class="p">..</span><span class="w">  </span><span class="mf">1306.666839</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h</span><span class="p">..</span><span class="w">  </span><span class="mf">1306.666847</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h</span><span class="p">..</span><span class="w">  </span><span class="mf">1306.667226</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h</span><span class="p">..</span><span class="w">  </span><span class="mf">1306.667229</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.673856</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.673864</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.722395</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.722414</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">dNh1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.722680</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">dNh1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.722688</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.722773</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.722778</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.730310</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.730313</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.734280</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.734292</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.734520</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.734526</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.734717</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.734722</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">dNh1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.757440</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">dNh1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.757453</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.757530</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.757536</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.792327</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.792340</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">dNh1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.792629</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">dNh1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.792636</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h</span><span class="p">..</span><span class="w">  </span><span class="mf">1306.792811</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h</span><span class="p">..</span><span class="w">  </span><span class="mf">1306.792817</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.821387</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">idle</span><span class="o">&gt;</span><span class="mi">-0</span><span class="w">       </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h1</span><span class="p">.</span><span class="w"> </span><span class="mf">1306.821407</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h</span><span class="p">..</span><span class="w">  </span><span class="mf">1306.821615</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_entry</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">rwnx_hostwake_irq</span>
<span class="w">         </span><span class="nl">sugov</span><span class="p">:</span><span class="mi">0-86</span><span class="w">      </span><span class="p">[</span><span class="mo">000</span><span class="p">]</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">h</span><span class="p">..</span><span class="w">  </span><span class="mf">1306.821620</span><span class="o">:</span><span class="w"> </span><span class="n">irq_handler_exit</span><span class="o">:</span><span class="w"> </span><span class="n">irq</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="n">ret</span><span class="o">=</span><span class="n">handled</span>
</code></pre></div>
<p>irqsoffå’Œevents/irqæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ irqsoffæ˜¯ç»Ÿè®¡ä¸­æ–­å…³é—­æ—¶é—´ï¼Œè€Œevents/irqæ˜¯ä¸»è¦ç”¨äºè®°å½•ä¸­æ–­å¤„ç†çš„æ´»åŠ¨ï¼ŒåŒ…æ‹¬è¿›å…¥ä¸­æ–­ã€é€€å‡ºä¸­æ–­ç­‰ç­‰ã€‚</p>
<h3 id="_1">å°ç»“</h3>
<div class="codehilite"><pre><span></span><code><span class="cp"># å¯åŠ¨sched_switchè¿½è¸ªå¯ä»¥æœ‰ä¸€ä¸‹3ç§æ–¹å¼ã€‚</span>
<span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="n">sched</span><span class="o">:</span><span class="n">sched_switch</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">set_event</span>
<span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="n">sched_switch</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">set_event</span>
<span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">events</span><span class="o">/</span><span class="n">sched</span><span class="o">/</span><span class="n">sched_switch</span><span class="o">/</span><span class="n">enable</span>

<span class="cp"># å¯ä»¥é€šè¿‡cat set_eventæ¥æŸ¥çœ‹è¿½è¸ªçš„event</span>

<span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">set_event</span>

<span class="cp"># ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®set_event_pidæ¥è¿‡æ»¤è¿›ç¨‹</span>
<span class="n">echo</span><span class="w"> </span><span class="mi">1244</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">set_event_pid</span>

<span class="cp"># å¯ä»¥cat trace_pipeæ¥å®æ—¶è§‚å¯Ÿè¿½è¸ªä¿¡æ¯</span>
<span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tracing</span><span class="o">/</span><span class="n">trace_pipe</span>

<span class="cp">#å¦‚æœè¦æ¸…ç©ºè®¾ç½®çš„è¿‡æ»¤,å†™0,</span>
<span class="n">echo</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">events</span><span class="o">/</span><span class="n">irq</span><span class="o">/</span><span class="n">irq_handler_exit</span><span class="o">/</span><span class="n">filter</span>
</code></pre></div>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>traceræœ‰function/graphç­‰è¿½è¸ªå™¨ï¼Œæ²¡æœ‰è®¾ç½®è¿‡æ»¤çš„è¯å°±æ˜¯å…¨å±€çš„ã€‚è€Œeventæ˜¯åœ¨ç‰¹å®šå‡½æ•°å‡ºå…¥å£ç»Ÿè®¡è·Ÿè¸ªï¼Œä¸€èˆ¬ç³»ç»Ÿæœ‰å†…ç½®çš„æ¨¡å—æ¯”å¦‚irqï¼Œsched_switchç­‰ã€‚</li>
<li>tracing_onæ˜¯æ€»å¼€å…³ï¼Œé€šè¿‡ä½¿èƒ½1æˆ–0æ¥å¼€å…³ã€‚</li>
<li>traceæ˜¯ftraceè·Ÿè¸ªç³»ç»Ÿçš„ä¸»è¾“å‡ºæ–‡ä»¶ï¼Œç”¨äºè®°å½•æ‰€æœ‰çš„è·Ÿè¸ªäº‹ä»¶ï¼Œä½†æ˜¯ä¼šä¿ç•™å†å²è®°å½•ä¿¡æ¯ï¼Œä¸éœ€è¦çš„è¯éœ€è¦echo "" &gt; trace æ¸…ç©ºã€‚trace_pipeæ˜¯ä¸€ä¸ªå®æ—¶è·Ÿè¸ªè¾“å‡ºæ–‡ä»¶ï¼Œè€Œä¸ä¼šä¿å­˜å†å²æ•°æ®ï¼Œå®ƒæä¾›äº†å®æ—¶çš„æ•°æ®æµã€‚</li>
<li>eventå’Œtracerå¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚</li>
</ul></div>
  <div class="post-nav">
    <a class="prev" href="ftrace-æ¦‚è¿°.html">â† ftrace-æ¦‚è¿°</a>
    <a class="next" href="archåˆå§‹åŒ–.html">archåˆå§‹åŒ– â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

