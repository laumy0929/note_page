<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>STUNåè®® - Laumyçš„æŠ€æœ¯æ ˆ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJaxæ”¯æŒLaTeXæ•°å­¦å…¬å¼ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumyçš„æŠ€æœ¯æ ˆ</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="è¾“å…¥å…³é”®è¯å›è½¦æœç´¢">
        </div>
        <div class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" id="theme-toggle">â˜¾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">é¦–é¡µ</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="è®¿é—®ä¸»ç«™">ä¸»ç«™ç‚¹:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">æ–‡ç« ç›®å½•</div>
          <nav id="toc"><ul><li><a href="#nat">NATå¢™</a><ul><li><a href="#_1">å®Œå…¨é”¥å½¢</a></li><li><a href="#ip">IPé™åˆ¶å‹é”¥å½¢</a></li><li><a href="#_2">ç«¯å£é™åˆ¶å‹é”¥å½¢</a></li><li><a href="#_3">å¯¹ç§°å‹</a></li></ul></li><li><a href="#nat_1">NATç©¿é€</a><ul></ul></li><li><a href="#stun">STUNåè®®ç®€ä»‹</a><ul><li><a href="#_4">ç»‘å®šè¯·æ±‚ä¸å“åº”</a></li><li><a href="#_5">è¿æ¥æ£€æŸ¥</a></li><li><a href="#_6">å®è·µæµç¨‹åˆ†æ</a></li><li><a href="#a_1">æ¿å­Aè¯·æ±‚æ£€æŸ¥</a></li></ul></li><li><a href="#turn">TURNåè®®</a><ul><li><a href="#allocate">Allocate</a></li><li><a href="#send">Sendæœºåˆ¶</a></li><li><a href="#chanel">Chanelæœºåˆ¶</a></li></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>STUNåè®®</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">ğŸ•’</i>
      2024-11-26
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ“‚</i>
      ç½‘ç»œ
    </span>
    <span class="meta-item">
      <i class="icon">ğŸ‘¤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><h2 id="nat">NATå¢™</h2>
<h3 id="_1">å®Œå…¨é”¥å½¢</h3>
<h3 id="ip">IPé™åˆ¶å‹é”¥å½¢</h3>
<h3 id="_2">ç«¯å£é™åˆ¶å‹é”¥å½¢</h3>
<h3 id="_3">å¯¹ç§°å‹</h3>
<h2 id="nat_1">NATç©¿é€</h2>
<h2 id="stun">STUNåè®®ç®€ä»‹</h2>
<p>STUNï¼ˆSession Traversal Utilities for NATï¼‰æ˜¯ä¸€ä¸ªç”¨äºå¸®åŠ©å®¢æˆ·ç«¯å‘ç°å…¶æ‰€åœ¨NATä¹‹åçš„å…¬ç½‘IPåœ°å€å’Œç«¯å£å·ã€‚é€šä¿¡çš„åŒæ–¹éƒ½èƒ½çŸ¥é“æ‰€åœ¨çš„å…¬ç½‘IPï¼Œå¹¶ä¸”èƒ½å¤Ÿè®©å…¬ç½‘çš„NATå¸®åŠ©è½¬å‘ï¼Œä»è€Œå®ç°NATç©¿é€ã€‚STUNåè®®å¹¿æ³›åº”ç”¨åœ¨WebRTCå®æ—¶é€šä¿¡ç³»ç»Ÿä¸­ã€‚STUNäº¤äº’è¿‡ç¨‹ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯å‘ STUN æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚</li>
<li>STUN æœåŠ¡å™¨å¤„ç†å¹¶å“åº”ã€‚</li>
<li>å®¢æˆ·ç«¯æ¥æ”¶å“åº”å¹¶è§£æå…¬å…±IPå’Œç«¯å£ã€‚</li>
<li>å®¢æˆ·ç«¯æ ¹æ®æ”¶åˆ°çš„å…¬å…± IP å’Œç«¯å£è¿›è¡Œ NAT ç©¿è¶Šå’Œè·¯å¾„é€‰æ‹©ã€‚</li>
</ul>
<h3 id="_4">ç»‘å®šè¯·æ±‚ä¸å“åº”</h3>
<h4 id="stun_1">å®¢æˆ·ç«¯å‘STUNè¯·æ±‚</h4>
<p>å®¢æˆ·ç«¯å‘é€STUNè¯·æ±‚ï¼ŒåŒ…çš„ç±»å‹ä¸ºBinding Requestã€‚è¯·æ±‚çš„ç›®æ ‡æ˜¯è®©STUN æœåŠ¡å™¨è¿”å›å®¢æˆ·ç«¯çš„å…¬ç½‘IPåœ°å€å’Œç«¯å£ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">STUN</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Header</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0001</span><span class="w"> </span><span class="p">(</span><span class="n">Binding</span><span class="w"> </span><span class="n">Request</span><span class="p">)</span><span class="w"> </span><span class="c1">//ç±»å‹</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Length</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0000</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Magic</span><span class="w"> </span><span class="n">Cookie</span><span class="o">:</span><span class="w"> </span><span class="mh">0x2112A442</span><span class="w">               </span><span class="c1">//å›ºå®šå€¼ï¼Œç”¨äºæ ‡è¯†STUN</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Transaction</span><span class="w"> </span><span class="n">ID</span><span class="o">:</span><span class="w"> </span><span class="mh">0x63f96d584f90a66d18b68202</span><span class="w"> </span><span class="c1">//ç”¨äºå”¯ä¸€æ ‡è¯†è¯¥è¯·æ±‚çš„IDï¼ŒåŒ¹é…å“åº”</span>

<span class="n">STUN</span><span class="w"> </span><span class="n">Attributes</span><span class="w"> </span><span class="p">(</span><span class="n">Optional</span><span class="p">)</span><span class="o">:</span><span class="w">  </span><span class="c1">//ä»¥ä¸‹æ˜¯é™„åŠ ä¿¡æ¯</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Username</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Integrity</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">HMAC</span><span class="o">-</span><span class="n">SHA1</span><span class="w"> </span><span class="n">signature</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Fingerprint</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">CRC</span><span class="mi">-32</span><span class="n">C</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">message</span><span class="o">&gt;</span>
</code></pre></div>
<h4 id="stun_2">STUNæœåŠ¡ç«¯å“åº”</h4>
<p>STUNæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œä¼šæ”¾binding responseå›å¤ï¼Œå†…å®¹ä¸­æºå¸¦äº†å®¢æˆ·ç«¯çš„å…¬ç½‘IPå’Œç«¯å£å·ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">STUN</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Header</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0101</span><span class="w"> </span><span class="p">(</span><span class="n">Binding</span><span class="w"> </span><span class="n">Response</span><span class="p">)</span><span class="w">  </span><span class="c1">//è¡¨æ˜æ˜¯ä¸€ä¸ª Binding Response</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Length</span><span class="o">:</span><span class="w"> </span><span class="mh">0x000C</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Magic</span><span class="w"> </span><span class="n">Cookie</span><span class="o">:</span><span class="w"> </span><span class="mh">0x2112A442</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Transaction</span><span class="w"> </span><span class="n">ID</span><span class="o">:</span><span class="w"> </span><span class="mh">0x63f96d584f90a66d18b68202</span>

<span class="n">STUN</span><span class="w"> </span><span class="n">Attributes</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Mapped</span><span class="w"> </span><span class="n">Address</span><span class="o">:</span><span class="w"> </span>
<span class="w">      </span><span class="nl">Family</span><span class="p">:</span><span class="w"> </span><span class="n">IPv4</span>
<span class="w">      </span><span class="nl">Address</span><span class="p">:</span><span class="w"> </span><span class="mf">203.0.113.1</span><span class="w">     </span><span class="c1">//å…¬ç½‘çš„IP</span>
<span class="w">      </span><span class="nl">Port</span><span class="p">:</span><span class="w"> </span><span class="mi">3478</span><span class="w">               </span><span class="c1">//å…¬ç½‘çš„ç«¯å£</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Username</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Integrity</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">HMAC</span><span class="o">-</span><span class="n">SHA1</span><span class="w"> </span><span class="n">signature</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Fingerprint</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">CRC</span><span class="mi">-32</span><span class="n">C</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">message</span><span class="o">&gt;</span>
</code></pre></div>
<h3 id="_5">è¿æ¥æ£€æŸ¥</h3>
<p>ä»¥webrtcä¸¾ä¾‹ï¼Œå½“éœ€è¦é€šä¿¡çš„åŒæ–¹ï¼Œé€šè¿‡ä¿¡ä»¤äº¤äº’SDPï¼ˆåœ¨libpeeræ–‡ç« ä¸­ï¼Œæ˜¯é€šè¿‡mqttï¼‰ä¸­äº¤äº’çš„åŒæ–¹å„è‡ªçš„å…¬ç½‘IPåœ°å€ä¿¡æ¯åï¼Œå¯ä»¥ä½¿ç”¨STUNçš„binding requestå’Œbinding responseæ£€æŸ¥P2Pçš„è¿é€šæ€§ï¼Œä»¥ç¡®ä¿P2Pé“¾è·¯å¯è¾¾ã€‚</p>
<p>é¦–å…ˆä¸€èˆ¬ç”±ä¸€ç«¯ç‡å…ˆå‘èµ·binding requestã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">STUN</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Header</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0001</span><span class="w"> </span><span class="p">(</span><span class="n">Binding</span><span class="w"> </span><span class="n">Request</span><span class="p">)</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Length</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0008</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Magic</span><span class="w"> </span><span class="n">Cookie</span><span class="o">:</span><span class="w"> </span><span class="mh">0x2112A442</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Transaction</span><span class="w"> </span><span class="n">ID</span><span class="o">:</span><span class="w"> </span><span class="mh">0x63f96d584f90a32d18b68202</span>

<span class="n">STUN</span><span class="w"> </span><span class="n">Attributes</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Username</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">peer</span><span class="o">-</span><span class="n">username</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Integrity</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">HMAC</span><span class="o">-</span><span class="n">SHA1</span><span class="w"> </span><span class="n">signature</span><span class="o">&gt;</span>
</code></pre></div>
<p>æ¥ç€ç­‰å¾…å¯¹ç«¯å›å¤binding response</p>
<div class="codehilite"><pre><span></span><code><span class="n">STUN</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Header</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0101</span><span class="w"> </span><span class="p">(</span><span class="n">Binding</span><span class="w"> </span><span class="n">Response</span><span class="p">)</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="n">Length</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0008</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Magic</span><span class="w"> </span><span class="n">Cookie</span><span class="o">:</span><span class="w"> </span><span class="mh">0x2112A442</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Transaction</span><span class="w"> </span><span class="n">ID</span><span class="o">:</span><span class="w"> </span><span class="mh">0x63f96d584f90a32d18b68202</span>

<span class="n">STUN</span><span class="w"> </span><span class="n">Attributes</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Mapped</span><span class="w"> </span><span class="n">Address</span><span class="o">:</span><span class="w"> </span>
<span class="w">      </span><span class="nl">Family</span><span class="p">:</span><span class="w"> </span><span class="n">IPv4</span>
<span class="w">      </span><span class="nl">Address</span><span class="p">:</span><span class="w"> </span><span class="mf">203.0.113.10</span>
<span class="w">      </span><span class="nl">Port</span><span class="p">:</span><span class="w"> </span><span class="mi">3479</span>
</code></pre></div>
<p>å½“å‘èµ·æ–¹æ¥å—åˆ°binding responseåï¼Œè¡¨æ˜è¿é€šæ€§æ­£å¸¸ï¼Œä¸‹é¢æ˜¯ä»£ç çš„æµç¨‹ç¤ºä¾‹ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">agent_connectivity_check</span><span class="err">ï¼ˆï¼‰</span>
<span class="p">{</span>
<span class="w">    </span><span class="cm">/*1. å‘é€ binding request*/</span>
<span class="w">    </span><span class="n">agent_create_binding_request</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span>
<span class="w">        </span><span class="n">stun_msg_create</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">STUN_CLASS_REQUEST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">STUN_METHOD_BINDING</span><span class="p">);</span>
<span class="w">        </span><span class="n">stun_msg_write_attr</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">STUN_ATTR_TYPE_USERNAME</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">username</span><span class="p">),</span><span class="w"> </span><span class="n">username</span><span class="p">);</span>
<span class="w">        </span><span class="n">stun_msg_write_attr</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">STUN_ATTR_TYPE_PRIORITY</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">agent</span><span class="o">-&gt;</span><span class="n">nominated_pair</span><span class="o">-&gt;</span><span class="n">priority</span><span class="p">);</span>
<span class="w">        </span><span class="n">stun_msg_finish</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">STUN_CREDENTIAL_SHORT_TERM</span><span class="p">,</span><span class="w"> </span><span class="n">agent</span><span class="o">-&gt;</span><span class="n">remote_upwd</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">agent</span><span class="o">-&gt;</span><span class="n">remote_upwd</span><span class="p">));</span>
<span class="w">    </span><span class="n">agent_socket_send</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">agent</span><span class="o">-&gt;</span><span class="n">nominated_pair</span><span class="o">-&gt;</span><span class="n">remote</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">size</span><span class="p">);</span><span class="c1">//å‘é€ï¼Œè¿™é‡Œç›®æ ‡çš„ipå’Œç«¯å£å°±æ˜¯å¯¹ç«¯çš„ipåœ°å€å’Œç«¯å£å·ã€‚</span>

<span class="w">    </span><span class="cm">/*2. ç­‰å¾…æ¥å—*/</span>
<span class="w">    </span><span class="n">agent_recv</span>
<span class="w">        </span><span class="nf">switch</span><span class="w"> </span><span class="p">(</span><span class="n">stun_msg</span><span class="p">.</span><span class="n">stunclass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="cm">/*æ”¶åˆ°å¯¹ç«¯å‘é€çš„binding requestï¼Œæ„å»ºä¸€ä¸ªresponseå‘é€å›å»ã€‚*/</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">STUN_CLASS_REQUEST</span><span class="p">:</span>
<span class="w">                </span><span class="n">agent_process_stun_request</span>
<span class="w">                    </span><span class="n">agent_create_binding_response</span>
<span class="w">                    </span><span class="n">stun_set_mapped_address</span>
<span class="w">                    </span><span class="n">agent_socket_send</span>
<span class="w">            </span><span class="cm">/*æ”¶åˆ°å¯¹ç«¯å›å¤çš„binding responseï¼Œå°†stateè®¾ç½®ä¸ºsuccess*/</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">STUN_CLASS_RESPONSE</span><span class="err">ï¼š</span>
<span class="w">                </span><span class="no">agent_process_stun_response</span>
<span class="w">                    </span><span class="no">agent</span><span class="o">-&gt;</span><span class="no">nominated_pair</span><span class="o">-&gt;</span><span class="no">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">ICE_CANDIDATE_STATE_SUCCEEDED</span><span class="err">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="err">}</span>
</code></pre></div>
<h3 id="_6">å®è·µæµç¨‹åˆ†æ</h3>
<p>æœ¬æ¬¡å®éªŒä½¿ç”¨çš„stunæœåŠ¡å™¨æ˜¯ï¼Œæœ‰ä¸¤ä¸ªè®¾å¤‡ï¼Œè®¾å¤‡Aæ˜¯ä¸€å—å¼€å‘æ¿ï¼Œè®¾å¤‡Bæ˜¯ç”µè„‘ï¼Œåˆ†åˆ«è¿æ¥åˆ°åŒä¸€ä¸ªè·¯ç”±å™¨ä¸Šã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">Resolved</span><span class="w"> </span><span class="n">stun</span><span class="p">.</span><span class="n">l</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mf">74.125.250.129</span><span class="err">ï¼Œ</span>
<span class="n">Resolved</span><span class="w"> </span><span class="n">stun</span><span class="o">/</span><span class="n">turn</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="mf">74.125.250.129</span><span class="o">:</span><span class="mi">19302</span>
</code></pre></div>
<p>è®¾å¤‡Aï¼ˆå¼€å‘æ¿ï¼‰çš„IPåœ°å€ä¿¡æ¯æ˜¯</p>
<div class="codehilite"><pre><span></span><code><span class="n">inet</span><span class="w"> </span><span class="n">addr</span><span class="o">:</span><span class="mf">192.168.51.127</span>
</code></pre></div>
<p>è®¾å¤‡Bï¼ˆç”µè„‘ï¼‰çš„IPåœ°å€ä¿¡æ¯æ˜¯</p>
<div class="codehilite"><pre><span></span><code><span class="mf">192.168.51.227</span>
</code></pre></div>
<h4 id="stun_3">è®¾å¤‡å‘é€å‘STUNæœåŠ¡ç«¯å‘é€è¯·æ±‚</h4>
<h5 id="binding-request">å¼€å‘æ¿å‘é€binding request</h5>
<p>è¿™é‡Œæ˜¯è®¾å¤‡å‘stun.l.google.comï¼š74.125.250.129:19302æœåŠ¡å‘é€binding requestè¯·æ±‚ã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/12/wp_editor_md_ab489a74a77e9b82ed1d9d7fa6aa9b2c.jpg"><img alt="" src="assets/doc/08-ç½‘ç»œ/stunåè®®/images/wp_editor_md_ab489a74a77e9b82ed1d9d7fa6aa9b2c.jpg"/></a></p>
<h5 id="binding-request_1">ç”µè„‘å‘é€binding request</h5>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/12/wp_editor_md_06efcf8e4abbfd6e9ee2e25e832782c9.jpg"><img alt="" src="assets/doc/08-ç½‘ç»œ/stunåè®®/images/wp_editor_md_06efcf8e4abbfd6e9ee2e25e832782c9.jpg"/></a></p>
<p>è®¾å¤‡çš„ç”µè„‘ä¸€ä¸‹å‘äº†3ä¸ªbinding requestï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å‘é€ç»™google stunæœåŠ¡å™¨çš„ï¼Œä½†æ˜¯å¦å¤–ä¸¤ä¸ªå®é™…ä¸Šæ˜¯å‘ç»™è®¾å¤‡Açš„æœ¬åœ°IPå’ŒNATå¢™çš„IPï¼Œå¯èƒ½æ˜¯æ­¤å‰è¿æ¥è¿‡ï¼Œæµè§ˆå™¨ç¼“å­˜äº†ä¿¡æ¯ã€‚</p>
<h4 id="_7">æœåŠ¡ç«¯å›å¤</h4>
<h5 id="a">è®¾å¤‡Aæ”¶åˆ°å›å¤</h5>
<p>stun.l.google.comå›å¤äº†binding success responseã€‚å¹¶è¡¨æ˜äº†è®¾å¤‡çš„å…¬ç½‘IPä¸º120.236.240.177ï¼Œå…¶ç«¯å£ä¸º8139ã€‚</p>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/12/wp_editor_md_abac79e966c195b9025bfe2393e04773.jpg"><img alt="" src="assets/doc/08-ç½‘ç»œ/stunåè®®/images/wp_editor_md_abac79e966c195b9025bfe2393e04773.jpg"/></a></p>
<h5 id="b">ç”µè„‘Bæ”¶åˆ°å›å¤</h5>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/12/wp_editor_md_f4a29ee31d223286727656e53d4580fe.jpg"><img alt="" src="assets/doc/08-ç½‘ç»œ/stunåè®®/images/wp_editor_md_f4a29ee31d223286727656e53d4580fe.jpg"/></a></p>
<p>é€šè¿‡message transaction IDå¯ä»¥çœ‹åˆ°ç”µè„‘æ”¶åˆ°äº†Google STUNå›å¤çš„binding success responseï¼Œå‘ŠçŸ¥å…¶NATåœ°å€ä¸º120.236.240.177ï¼Œç«¯å£å·æ˜¯8140ã€‚å› ä¸ºè¿æ¥çš„æ˜¯åŒä¸€ä¸ªè·¯ç”±å™¨ï¼Œæ‰€ä»¥NATæ˜¯ä¸€æ ·çš„ã€‚åŒæ—¶æ¿å­Aè®¾å¤‡192.168.51.127ä¹Ÿå¯¹é½å›å¤äº†binding success responseï¼Œå‘ŠçŸ¥å…¶åœ°å€ä¸º192.168.51.227:59777ã€‚</p>
<h3 id="a_1">æ¿å­Aè¯·æ±‚æ£€æŸ¥</h3>
<p><a href="https://www.laumy.tech/wp-content/uploads/2024/12/wp_editor_md_a46fc1700d926970a5daf3cd7024a542.jpg"><img alt="" src="assets/doc/08-ç½‘ç»œ/stunåè®®/images/wp_editor_md_a46fc1700d926970a5daf3cd7024a542.jpg"/></a></p>
<p>æ¿å­Aå‘é€äº†ä¸€ä¸ªbinding requestï¼Œå¯¹ç«¯å›å¤äº†ä¸€ä¸ªbinding success responseï¼Œåˆ™è¡¨ç¤ºè”é€šå·²å»ºç«‹ã€‚</p>
<h2 id="turn">TURNåè®®</h2>
<p>TURNåè®®æ˜¯åœ¨STUNçš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸­ç»§åŠŸèƒ½ï¼Œè§£å†³çš„æ˜¯å¯¹ç§°å‹NATæ— æ³•ç©¿é€çš„é—®é¢˜ã€‚å¦‚ä¸‹å›¾çš„ç»“æ„ä½“ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨TURNä½œä¸ºä¸­ç»§è½¬å‘ï¼Œä¼ è¾“çš„è®¾å¤‡ä¸€æ–¹å¼TURN Clientï¼Œå¦ä¸€æ–¹æ˜¯Peer Aã€‚å³TURN Clientéœ€è¦ä¸TURN Serverå»ºç«‹TURNåè®®äº¤äº’ï¼Œè€ŒPeer Aä¸TURN Serveråªéœ€è¦åšSTUNåè®®äº¤äº’ã€‚æ­¤å‰è°ƒè¯•äº†ä¸¤ä¸ªé€šä¿¡è®¾å¤‡ï¼Œä¸¤ç«¯éƒ½æ˜¯ä½¿ç”¨TURNåè®®å‘èµ·è¿æ¥ï¼Œå¯¼è‡´ä¸€ç«¯checkingå¤±è´¥ï¼Œæœ€åå°†ä¸€ç«¯ä¿®æ”¹ä¸ºSTUNåè®®äº¤äº’å³å¯ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="w">                                        </span><span class="n">Peer</span><span class="w"> </span><span class="n">A</span>
<span class="w">                                        </span><span class="n">Server</span><span class="o">-</span><span class="n">Reflexive</span><span class="w">    </span><span class="o">+---------+</span>
<span class="w">                                        </span><span class="n">Transport</span><span class="w"> </span><span class="n">Address</span><span class="w">   </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="w">                                        </span><span class="mf">192.0.2.150</span><span class="o">:</span><span class="mi">32102</span><span class="w">   </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="w">                                            </span><span class="o">|</span><span class="w">              </span><span class="o">/|</span><span class="w">         </span><span class="o">|</span>
<span class="w">                          </span><span class="n">TURN</span><span class="w">              </span><span class="o">|</span><span class="w">            </span><span class="o">/</span><span class="w"> </span><span class="o">^|</span><span class="w">  </span><span class="n">Peer</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">|</span>
<span class="w">    </span><span class="n">Client</span><span class="err">â€™</span><span class="n">s</span><span class="w">              </span><span class="n">Server</span><span class="w">            </span><span class="o">|</span><span class="w">           </span><span class="o">/</span><span class="w">  </span><span class="o">||</span><span class="w">         </span><span class="o">|</span>
<span class="w">    </span><span class="n">Host</span><span class="w"> </span><span class="n">Transport</span><span class="w">        </span><span class="n">Transport</span><span class="w">         </span><span class="o">|</span><span class="w">         </span><span class="c1">//   ||         |</span>
<span class="w">    </span><span class="n">Address</span><span class="w">               </span><span class="n">Address</span><span class="w">           </span><span class="o">|</span><span class="w">       </span><span class="c1">//     |+---------+</span>
<span class="w">   </span><span class="mf">10.1.1.2</span><span class="o">:</span><span class="mi">49721</span><span class="w">       </span><span class="mf">192.0.2.15</span><span class="o">:</span><span class="mi">3478</span><span class="w">     </span><span class="o">|+-+</span><span class="w">  </span><span class="c1">//     Peer A</span>
<span class="w">            </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w">               </span><span class="o">||</span><span class="n">N</span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w">       </span><span class="n">Host</span><span class="w"> </span><span class="n">Transport</span>
<span class="w">            </span><span class="o">|</span><span class="w">   </span><span class="o">+-+</span><span class="w">         </span><span class="o">|</span><span class="w">               </span><span class="o">||</span><span class="n">A</span><span class="o">|/</span><span class="w">        </span><span class="n">Address</span>
<span class="w">            </span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">               </span><span class="n">v</span><span class="o">|</span><span class="n">T</span><span class="o">|</span><span class="w">     </span><span class="mf">192.168.100.2</span><span class="o">:</span><span class="mi">49582</span>
<span class="w">            </span><span class="o">|</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">               </span><span class="o">/+-+</span>
<span class="w"> </span><span class="o">+---------+|</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">|+---------+</span><span class="w">   </span><span class="o">/</span><span class="w">              </span><span class="o">+---------+</span>
<span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">||</span><span class="w">   </span><span class="o">|</span><span class="n">N</span><span class="o">|</span><span class="w">         </span><span class="o">||</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="c1">//               |         |</span>
<span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">TURN</span><span class="w">    </span><span class="o">|</span><span class="n">v</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">v</span><span class="o">|</span><span class="w"> </span><span class="n">TURN</span><span class="w">    </span><span class="o">|/</span><span class="w">                 </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Client</span><span class="w">  </span><span class="o">|----|</span><span class="n">A</span><span class="o">|----------|</span><span class="w"> </span><span class="n">Server</span><span class="w">  </span><span class="o">|------------------|</span><span class="w">  </span><span class="n">Peer</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">|</span>
<span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">|^</span><span class="w">         </span><span class="o">|</span><span class="w">         </span><span class="o">|^</span><span class="w">                </span><span class="o">^|</span><span class="w">         </span><span class="o">|</span>
<span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="o">|</span><span class="n">T</span><span class="o">||</span><span class="w">         </span><span class="o">|</span><span class="w">         </span><span class="o">||</span><span class="w">                </span><span class="o">||</span><span class="w">         </span><span class="o">|</span>
<span class="w"> </span><span class="o">+---------+</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="o">||</span><span class="w">         </span><span class="o">+---------+|</span><span class="w">                </span><span class="o">|+---------+</span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="o">||</span><span class="w">                    </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="o">||</span><span class="w">                    </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="w">                </span><span class="o">+-+|</span><span class="w">                    </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="w">                   </span><span class="o">|</span><span class="w">                    </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="w">                   </span><span class="o">|</span><span class="w">                    </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="w">             </span><span class="n">Client</span><span class="err">â€™</span><span class="n">s</span><span class="w">                   </span><span class="o">|</span><span class="w">            </span><span class="n">Peer</span><span class="w"> </span><span class="n">B</span>
<span class="w">             </span><span class="n">Server</span><span class="o">-</span><span class="n">Reflexive</span><span class="w">    </span><span class="n">Relayed</span><span class="w">             </span><span class="n">Transport</span>
<span class="w">             </span><span class="n">Transport</span><span class="w"> </span><span class="n">Address</span><span class="w">   </span><span class="n">Transport</span><span class="w"> </span><span class="n">Address</span><span class="w">   </span><span class="n">Address</span>
<span class="w">             </span><span class="mf">192.0.2.1</span><span class="o">:</span><span class="mi">7000</span><span class="w">      </span><span class="mf">192.0.2.15</span><span class="o">:</span><span class="mi">50000</span><span class="w">     </span><span class="mf">192.0.2.210</span><span class="o">:</span><span class="mi">49191</span>
</code></pre></div>
<h3 id="allocate">Allocate</h3>
<p>è¯·æ±‚æœåŠ¡å™¨ï¼Œåˆ†é…ä¸€ä¸ªä¸­ç»§æœåŠ¡ã€‚ä¸­ç»§å»ºç«‹è¿æ¥åï¼Œå®¢æˆ·ç«¯éœ€è¦è¿›è¡Œä¿æ´»ï¼Œå®šæœŸå‘é€refresh requestç»™æœåŠ¡å™¨ç«¯ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">TURN</span><span class="w">                                 </span><span class="n">TURN</span><span class="w">           </span><span class="n">Peer</span><span class="w">          </span><span class="n">Peer</span>
<span class="n">client</span><span class="w">                               </span><span class="n">server</span><span class="w">          </span><span class="n">A</span><span class="w">             </span><span class="n">B</span>
<span class="w">  </span><span class="o">|--</span><span class="w"> </span><span class="n">Allocate</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">---------------&gt;|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|&lt;---------------</span><span class="w"> </span><span class="n">Allocate</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="o">--|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                 </span><span class="p">(</span><span class="mi">401</span><span class="w"> </span><span class="n">Unauthorized</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|--</span><span class="w"> </span><span class="n">Allocate</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">---------------&gt;|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|&lt;----------</span><span class="w"> </span><span class="n">Allocate</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">--|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="p">(</span><span class="mf">192.0.2.15</span><span class="o">:</span><span class="mi">50000</span><span class="p">)</span><span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">/</span><span class="w">                                   </span><span class="o">/</span><span class="w">            </span><span class="o">/</span><span class="w">            </span><span class="o">/</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|--</span><span class="w"> </span><span class="n">Refresh</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">----------------&gt;|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|&lt;-----------</span><span class="w"> </span><span class="n">Refresh</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">--|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
</code></pre></div>
<p>å¦‚ä¸Šç¤ºä¾‹ï¼Œå®¢æˆ·ç«¯å…ˆå‘é€ä¸å¸¦éªŒè¯ä¿¡æ¯çš„Allocateè¯·æ±‚ï¼Œæ­¤æ—¶STUNæœåŠ¡å™¨ä¼šè¿”å›error responseï¼Œå®¢æˆ·ç«¯æ”¶åˆ°é”™è¯¯ååŠ ä¸ŠéªŒè¯ä¿¡æ¯å†æ¬¡è¯·æ±‚ã€‚ä»¥IPCé€šä¿¡ä¸ºä¾‹ï¼Œæ‘„åƒå¤´ç«¯æ˜¯Peer Aï¼ˆèµ„æºæœ‰é™ï¼Œä¸æ”¯æŒè¯ä¹¦è¯·æ±‚ç­‰åè®®ï¼‰ï¼Œå‘èµ·çš„æ˜¯STUNåè®®ï¼Œè€Œæ‰‹æœºé¢„è§ˆç«¯æ˜¯TURN Clientï¼Œå‘èµ·çš„æ˜¯TURNäº¤äº’åè®®ã€‚</p>
<h3 id="send">Sendæœºåˆ¶</h3>
<p>å®¢æˆ·ç«¯å’Œpeerç›´æ¥é€šä¿¡å¯ä»¥é€šè¿‡TURN serverè¿›è¡Œè½¬å‘ä¿¡æ¯ï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯ä½¿ç”¨Send/dataæ–¹å¼ï¼Œç¬¬äºŒç§æ˜¯ä½¿ç”¨channelsæ–¹å¼ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯é€šè¿‡æŸç§æ–¹å¼å‘ŠçŸ¥æœåŠ¡å™¨ï¼Œä»clientæ¥æ”¶åˆ°çš„æ•°æ®åº”è¯¥å‘ç»™é‚£ä¸ªpeerã€‚ä¸‹é¢æ˜¯Send/dataæœºåˆ¶ã€‚</p>
<p>TURN Serveråœ¨è¿›è¡Œè½¬å‘å‰ï¼Œéœ€è¦clientå…ˆå®‰è£…ä¸€ä¸ªåˆ°å¯¹ç­‰ç«¯çš„è®¸å¯(permission),è®¸å¯è¯å¯ä»¥é€šè¿‡CreatePermission request/respæ¥è¿›è¡Œäº¤äº’ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">TURN</span><span class="w">                                 </span><span class="n">TURN</span><span class="w">           </span><span class="n">Peer</span><span class="w">          </span><span class="n">Peer</span>
<span class="n">client</span><span class="w">                               </span><span class="n">server</span><span class="w">          </span><span class="n">A</span><span class="w">             </span><span class="n">B</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|--</span><span class="w"> </span><span class="n">CreatePermission</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="p">(</span><span class="n">Peer</span><span class="w"> </span><span class="n">A</span><span class="p">)</span><span class="w"> </span><span class="o">--&gt;|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|&lt;--</span><span class="w"> </span><span class="n">CreatePermission</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">--|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|---</span><span class="w"> </span><span class="n">Send</span><span class="w"> </span><span class="n">ind</span><span class="w"> </span><span class="p">(</span><span class="n">Peer</span><span class="w"> </span><span class="n">A</span><span class="p">)</span><span class="o">--------------&gt;|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|===</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">===&gt;|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|&lt;==</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">====|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|&lt;--------------</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">ind</span><span class="w"> </span><span class="p">(</span><span class="n">Peer</span><span class="w"> </span><span class="n">A</span><span class="p">)</span><span class="w"> </span><span class="o">--|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|---</span><span class="w"> </span><span class="n">Send</span><span class="w"> </span><span class="n">ind</span><span class="w"> </span><span class="p">(</span><span class="n">Peer</span><span class="w"> </span><span class="n">B</span><span class="p">)</span><span class="o">--------------&gt;|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w"> </span><span class="n">dropped</span><span class="w">     </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|&lt;==</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">==================|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                            </span><span class="n">dropped</span><span class="w"> </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
</code></pre></div>
<h3 id="chanel">Chanelæœºåˆ¶</h3>
<p>ç­‰åŒäºsend/dataæœºåˆ¶ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="n">TURN</span><span class="w">                                 </span><span class="n">TURN</span><span class="w">           </span><span class="n">Peer</span><span class="w">          </span><span class="n">Peer</span>
<span class="n">client</span><span class="w">                               </span><span class="n">server</span><span class="w">          </span><span class="n">A</span><span class="w">             </span><span class="n">B</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|--</span><span class="w"> </span><span class="n">ChannelBind</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">----------------&gt;|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">Peer</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mh">0x4001</span><span class="p">)</span><span class="w">                 </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|&lt;----------</span><span class="w"> </span><span class="n">ChannelBind</span><span class="w"> </span><span class="n">succ</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">--|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|--</span><span class="w"> </span><span class="p">[</span><span class="mh">0x4001</span><span class="p">]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">------------------&gt;|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|===</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">===&gt;|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|&lt;==</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">====|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|&lt;------------------</span><span class="w"> </span><span class="p">[</span><span class="mh">0x4001</span><span class="p">]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">--|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|---</span><span class="w"> </span><span class="n">Send</span><span class="w"> </span><span class="n">ind</span><span class="w"> </span><span class="p">(</span><span class="n">Peer</span><span class="w"> </span><span class="n">A</span><span class="p">)</span><span class="o">--------------&gt;|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|===</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">===&gt;|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|&lt;==</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">====|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|&lt;------------------</span><span class="w"> </span><span class="p">[</span><span class="mh">0x4001</span><span class="p">]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">--|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="w">  </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
</code></pre></div>
<p>å‚è€ƒï¼š</p>
<ol>
<li>
<p><a href="https://mp.weixin.qq.com/s/XMhSDABc74dpALIHrPPt7w">https://mp.weixin.qq.com/s/XMhSDABc74dpALIHrPPt7w</a></p>
</li>
<li>
<p><a href="https://www.ctyun.cn/developer/article/586260405821509">https://www.ctyun.cn/developer/article/586260405821509</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/pannengzhi/p/5048965.html">https://www.cnblogs.com/pannengzhi/p/5048965.html</a></p>
</li>
</ol></div>
  <div class="post-nav">
    <a class="prev" href="coturnå®‰è£….html">â† coturnå®‰è£…</a>
    <a class="next" href="libpeeråˆ†æ.html">libpeeråˆ†æ â†’</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright Â©2022-2025 laumy ç‰ˆæƒæ‰€æœ‰</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

