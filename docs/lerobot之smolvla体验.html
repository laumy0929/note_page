<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>lerobot之smolvla体验 - Laumy的技术栈</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- MathJax支持LaTeX数学公式 -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true
        },
        options: {
          ignoreHtmlClass: 'tex2jax_ignore',
          processHtmlClass: 'tex2jax_process'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="logo" href="./">Laumy的技术栈</a>
        <div class="search">
          <input id="search-input" type="text" placeholder="输入关键词回车搜索">
        </div>
        <div class="theme-toggle" title="切换主题" id="theme-toggle">☾</div>
        <nav class="top-nav">
          <div class="nav-item"><a href="./">首页</a></div>
          <div class="nav-item site-link">
            <a href="https://www.laumy.tech" target="_blank" title="访问主站">主站点:www.laumy.tech</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="container layout">
      <aside class="left-nav">
        
        <div class="card">
          <div class="card-title">文章目录</div>
          <nav id="toc"><ul><li><a href="#_1">环境安装</a><ul></ul></li><li><a href="#_2">启动训练</a><ul></ul></li><li><a href="#_3">推理验证</a><ul></ul></li><li><a href="#_4">常见问题</a><ul></ul></li></ul></nav>
        </div>
        
      </aside>

      <section class="content">
        
<article class="card post">
  <h1>lerobot之smolvla体验</h1>
  <div class="meta">
    <span class="meta-item">
      <i class="icon">🕒</i>
      2025-08-18
    </span>
    <span class="meta-item">
      <i class="icon">📂</i>
      ai
    </span>
    <span class="meta-item">
      <i class="icon">👤</i>
      laumy
    </span>
  </div>
  <div class="post-content"><h2 id="_1">环境安装</h2>
<div class="codehilite"><pre><span></span><code><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="s2">".[smolvla]"</span>
</code></pre></div>
<p>在原来lerobot的环境基础上。</p>
<h2 id="_2">启动训练</h2>
<p>本文主要是记录复现lerobot smolvla策略的效果，为了快速看到效果，这里不进行采集数据了，直接用此前ACT采集的数据，将数据打包放到autodl云服务器上进行训练。</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">lerobot</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">train</span><span class="o">.</span><span class="n">py</span> \
    <span class="o">--</span><span class="n">dataset</span><span class="o">.</span><span class="n">root</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="n">autodl</span><span class="o">-</span><span class="n">tmp</span><span class="o">/</span><span class="n">lerobot</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">record</span><span class="o">-</span><span class="mi">07271539</span> \
    <span class="o">--</span><span class="n">dataset</span><span class="o">.</span><span class="n">repo_id</span><span class="o">=</span><span class="n">laumy</span><span class="o">/</span><span class="n">record</span><span class="o">-</span><span class="mi">07271539</span> \
    <span class="o">--</span><span class="n">policy</span><span class="o">.</span><span class="n">push_to_hub</span><span class="o">=</span><span class="n">false</span>   \
    <span class="o">--</span><span class="n">policy</span><span class="o">.</span><span class="n">path</span><span class="o">=</span><span class="n">lerobot</span><span class="o">/</span><span class="n">smolvla_base</span> \
    <span class="o">--</span><span class="n">policy</span><span class="o">.</span><span class="n">device</span><span class="o">=</span><span class="n">cuda</span>   \
    <span class="o">--</span><span class="n">output_dir</span><span class="o">=</span><span class="n">outputs</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">smolvla_test</span>   \
    <span class="o">--</span><span class="n">job_name</span><span class="o">=</span><span class="n">smolvla_test</span>   <span class="o">--</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span> \
     <span class="o">--</span><span class="n">steps</span><span class="o">=</span><span class="mi">20000</span>   <span class="o">--</span><span class="n">wandb</span><span class="o">.</span><span class="n">enable</span><span class="o">=</span><span class="n">false</span>

<span class="n">或者</span>
    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">lerobot</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">train</span> \
      <span class="o">--</span><span class="n">policy</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">smolvla</span> \
      <span class="o">--</span><span class="n">policy</span><span class="o">.</span><span class="n">vlm_model_name</span><span class="o">=</span><span class="n">HuggingFaceTB</span><span class="o">/</span><span class="n">SmolVLM2</span><span class="o">-</span><span class="mi">500</span><span class="n">M</span><span class="o">-</span><span class="n">Video</span><span class="o">-</span><span class="n">Instruct</span> \
      <span class="o">--</span><span class="n">policy</span><span class="o">.</span><span class="n">load_vlm_weights</span><span class="o">=</span><span class="n">true</span> \
      <span class="o">--</span><span class="n">policy</span><span class="o">.</span><span class="n">num_vlm_layers</span><span class="o">=</span><span class="mi">16</span> \
      <span class="o">--</span><span class="n">policy</span><span class="o">.</span><span class="n">num_expert_layers</span><span class="o">=</span><span class="mi">8</span> \
      <span class="o">--</span><span class="n">dataset</span><span class="o">.</span><span class="n">repo_id</span><span class="o">=</span><span class="n">laumy</span><span class="o">/</span><span class="n">record</span><span class="o">-</span><span class="mi">07271539</span> \
      <span class="o">--</span><span class="n">output_dir</span><span class="o">=</span><span class="n">outputs</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">smolvla_test2</span> \
      <span class="o">--</span><span class="n">job_name</span><span class="o">=</span><span class="n">smolvla_test</span> \
      <span class="o">--</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span> <span class="o">--</span><span class="n">steps</span><span class="o">=</span><span class="mi">20000</span> <span class="o">--</span><span class="n">wandb</span><span class="o">.</span><span class="n">enable</span><span class="o">=</span><span class="n">false</span>
</code></pre></div>
<p>如果数据集在huggingface上面，则需要先登陆hugging face</p>
<div class="codehilite"><pre><span></span><code><span class="n">huggingface</span><span class="o">-</span><span class="n">cli</span> <span class="n">login</span>

<span class="n">填写token</span><span class="o">.</span>

<span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">lerobot</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">train</span><span class="o">.</span><span class="n">py</span> \
    <span class="o">--</span><span class="n">dataset</span><span class="o">.</span><span class="n">repo_id</span><span class="o">=</span><span class="n">laumy0929</span><span class="o">/</span><span class="n">grab_candy_or_lemon</span> \
    <span class="o">--</span><span class="n">policy</span><span class="o">.</span><span class="n">path</span><span class="o">=</span><span class="n">lerobot</span><span class="o">/</span><span class="n">smolvla_base</span> \
    <span class="o">--</span><span class="n">policy</span><span class="o">.</span><span class="n">device</span><span class="o">=</span><span class="n">cuda</span>   \
    <span class="o">--</span><span class="n">policy</span><span class="o">.</span><span class="n">repo_id</span><span class="o">=</span><span class="n">laumy0929</span><span class="o">/</span><span class="n">smolvla_test</span> \
    <span class="o">--</span><span class="n">output_dir</span><span class="o">=</span><span class="n">outputs</span><span class="o">/</span><span class="n">train</span><span class="o">/</span><span class="n">smolvla_test</span>   \
    <span class="o">--</span><span class="n">job_name</span><span class="o">=</span><span class="n">smolvla_test</span>   <span class="o">--</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span> \
     <span class="o">--</span><span class="n">steps</span><span class="o">=</span><span class="mi">20000</span>   <span class="o">--</span><span class="n">wandb</span><span class="o">.</span><span class="n">enable</span><span class="o">=</span><span class="n">false</span>
</code></pre></div>
<p>关于数据集的获取取决于两个参数，一个是repo_id另外一个是dataset.root。</p>
<ul>
<li>repo_id: 必填字段，是在 Hugging Face Hub 上的数据集标识（datasets 仓库名）。</li>
<li>dataset.root ：选填字段，是本地数据集所在目录。</li>
</ul>
<p>训练首先从 dataset.root 读取本地数据；如果本地缺失需要的文件，才会用 repo_id 到 Hub 拉取缺的内容到这个 root 目录里。</p>
<p>下面有几个场景。</p>
<p><strong>如果同时给定了dataset.root和dataset.repo_id</strong></p>
<ul>
<li>如果 root 目录已经是规范的 LeRobot v2 数据集结构（有 meta/info.json、data/.parquet、可选 videos/.mp4），会直接用本地文件，不会下载。</li>
<li>如果本地缺少 meta（或部分 data 文件），代码会用 repo_id 从 Hub 把缺的部分同步到你指定的 root 目录后再加载。</li>
</ul>
<p><strong>如果只传dataset.repo_id</strong> 会把本地根目录设为默认缓存：~/.cache/huggingface/lerobot/{repo_id}（若设置了环境变量 LEROBOT_HOME，则用 $LEROBOT_HOME/{repo_id}），如果本地缓存里已经有完整数据，则直接用本地文件，不再下载。如果本地没有缓存，远端也没有数据，就会报错。</p>
<h2 id="_3">推理验证</h2>
<div class="codehilite"><pre><span></span><code><span class="nx">python</span><span class="w"> </span><span class="o">-</span><span class="nx">m</span><span class="w"> </span><span class="nx">lerobot</span><span class="p">.</span><span class="nx">record</span><span class="w">    </span>\
<span class="w">    </span><span class="o">--</span><span class="nx">robot</span><span class="p">.</span><span class="k">type</span><span class="p">=</span><span class="nx">so101_follower</span><span class="w">   </span>\
<span class="w">    </span><span class="o">--</span><span class="nx">robot</span><span class="p">.</span><span class="nx">disable_torque_on_disconnect</span><span class="p">=</span><span class="kc">true</span><span class="w">   </span>\
<span class="w">    </span><span class="o">--</span><span class="nx">robot</span><span class="p">.</span><span class="nx">port</span><span class="p">=</span><span class="o">/</span><span class="nx">dev</span><span class="o">/</span><span class="nx">ttyACM0</span><span class="w"> </span><span class="o">--</span><span class="nx">robot</span><span class="p">.</span><span class="nx">cameras</span><span class="p">=</span><span class="s">"{ handeye: {type: opencv, index_or_path: 4, width: 640, height: 480, fps: 30}, fixed: {type: opencv, index_or_path: 6, width: 640, height: 480, fps: 30}}"</span><span class="w">   </span>\
<span class="w">    </span><span class="o">--</span><span class="nx">robot</span><span class="p">.</span><span class="nx">id</span><span class="p">=</span><span class="nx">R12252801</span><span class="w">   </span>\
<span class="w">    </span><span class="o">--</span><span class="nx">display_data</span><span class="p">=</span><span class="kc">false</span><span class="w">   </span>\
<span class="w">    </span><span class="o">--</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">single_task</span><span class="p">=</span><span class="s">"Grab the cube"</span><span class="w">   </span>\
<span class="w">    </span><span class="o">--</span><span class="nx">policy</span><span class="p">.</span><span class="nx">path</span><span class="p">=</span><span class="nx">outputs</span><span class="o">/</span><span class="nx">smolvla_weigh_08181710</span><span class="o">/</span><span class="nx">pretrained_model</span><span class="w">  </span>\
<span class="w">    </span><span class="o">--</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">episode_time_s</span><span class="p">=</span><span class="mi">240</span><span class="w">    </span>\
<span class="w">    </span><span class="o">--</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">repo_id</span><span class="p">=</span><span class="nx">laumy</span><span class="o">/</span><span class="nx">eval_smolvla_08181710</span>
</code></pre></div>
<h2 id="_4">常见问题</h2>
<p>训练报错如下：</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Traceback</span><span class="w"> </span><span class="p">(</span><span class="nx">most</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="nx">call</span><span class="w"> </span><span class="nx">last</span><span class="p">):</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/urllib3/connection.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">198</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">_new_conn</span>
<span class="w">    </span><span class="nx">sock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">connection</span><span class="p">.</span><span class="nx">create_connection</span><span class="p">(</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/urllib3/util/connection.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">create_connection</span>
<span class="w">    </span><span class="nx">raise</span><span class="w"> </span><span class="nx">err</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/urllib3/util/connection.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">73</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">create_connection</span>
<span class="w">    </span><span class="nx">sock</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">sa</span><span class="p">)</span>
<span class="nx">TimeoutError</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nx">Errno</span><span class="w"> </span><span class="mi">110</span><span class="p">]</span><span class="w"> </span><span class="nx">Connection</span><span class="w"> </span><span class="nx">timed</span><span class="w"> </span><span class="nx">out</span>

<span class="nx">The</span><span class="w"> </span><span class="nx">above</span><span class="w"> </span><span class="nx">exception</span><span class="w"> </span><span class="nx">was</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">direct</span><span class="w"> </span><span class="nx">cause</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">following</span><span class="w"> </span><span class="nx">exception</span><span class="p">:</span>

<span class="nx">Traceback</span><span class="w"> </span><span class="p">(</span><span class="nx">most</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="nx">call</span><span class="w"> </span><span class="nx">last</span><span class="p">):</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/urllib3/connectionpool.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">787</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">urlopen</span>
<span class="w">    </span><span class="nx">response</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kp">self</span><span class="p">.</span><span class="nx">_make_request</span><span class="p">(</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/urllib3/connectionpool.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">488</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">_make_request</span>
<span class="w">    </span><span class="nx">raise</span><span class="w"> </span><span class="nx">new_e</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/urllib3/connectionpool.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">464</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">_make_request</span>
<span class="w">    </span><span class="kp">self</span><span class="p">.</span><span class="nx">_validate_conn</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/urllib3/connectionpool.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">1093</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">_validate_conn</span>
<span class="w">    </span><span class="nx">conn</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/urllib3/connection.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">753</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">connect</span>
<span class="w">    </span><span class="kp">self</span><span class="p">.</span><span class="nx">sock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">sock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kp">self</span><span class="p">.</span><span class="nx">_new_conn</span><span class="p">()</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/urllib3/connection.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">207</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">_new_conn</span>
<span class="w">    </span><span class="nx">raise</span><span class="w"> </span><span class="nx">ConnectTimeoutError</span><span class="p">(</span>
<span class="nx">urllib3</span><span class="p">.</span><span class="nx">exceptions</span><span class="p">.</span><span class="nx">ConnectTimeoutError</span><span class="p">:</span><span class="w"> </span><span class="p">(&lt;</span><span class="nx">urllib3</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">HTTPSConnection</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="mh">0x7fe651566380</span><span class="p">&gt;,</span><span class="w"> </span><span class="err">'</span><span class="nx">Connection</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">huggingface</span><span class="p">.</span><span class="nx">co</span><span class="w"> </span><span class="nx">timed</span><span class="w"> </span><span class="nx">out</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nx">connect</span><span class="w"> </span><span class="nx">timeout</span><span class="p">=</span><span class="nx">None</span><span class="p">)</span><span class="err">'</span><span class="p">)</span>

<span class="nx">The</span><span class="w"> </span><span class="nx">above</span><span class="w"> </span><span class="nx">exception</span><span class="w"> </span><span class="nx">was</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">direct</span><span class="w"> </span><span class="nx">cause</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">following</span><span class="w"> </span><span class="nx">exception</span><span class="p">:</span>

<span class="nx">Traceback</span><span class="w"> </span><span class="p">(</span><span class="nx">most</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="nx">call</span><span class="w"> </span><span class="nx">last</span><span class="p">):</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/requests/adapters.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">667</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">send</span>
<span class="w">    </span><span class="nx">resp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">urlopen</span><span class="p">(</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/urllib3/connectionpool.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">841</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">urlopen</span>
<span class="w">    </span><span class="nx">retries</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">retries</span><span class="p">.</span><span class="nx">increment</span><span class="p">(</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/urllib3/util/retry.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">519</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">increment</span>
<span class="w">    </span><span class="nx">raise</span><span class="w"> </span><span class="nx">MaxRetryError</span><span class="p">(</span><span class="nx">_pool</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">reason</span><span class="p">)</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">reason</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">ignore</span><span class="p">[</span><span class="nx">arg</span><span class="o">-</span><span class="k">type</span><span class="p">]</span>
<span class="nx">urllib3</span><span class="p">.</span><span class="nx">exceptions</span><span class="p">.</span><span class="nx">MaxRetryError</span><span class="p">:</span><span class="w"> </span><span class="nx">HTTPSConnectionPool</span><span class="p">(</span><span class="nx">host</span><span class="p">=</span><span class="err">'</span><span class="nx">huggingface</span><span class="p">.</span><span class="nx">co</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">=</span><span class="mi">443</span><span class="p">):</span><span class="w"> </span><span class="nx">Max</span><span class="w"> </span><span class="nx">retries</span><span class="w"> </span><span class="nx">exceeded</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">url</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="kn">api</span><span class="o">/</span><span class="nx">models</span><span class="o">/</span><span class="nx">HuggingFaceTB</span><span class="o">/</span><span class="nx">SmolVLM2</span><span class="o">-</span><span class="mi">500</span><span class="nx">M</span><span class="o">-</span><span class="nx">Video</span><span class="o">-</span><span class="nx">Instruct</span><span class="o">/</span><span class="nx">tree</span><span class="o">/</span><span class="nx">main</span><span class="o">/</span><span class="nx">additional_chat_templates</span><span class="p">?</span><span class="nx">recursive</span><span class="p">=</span><span class="nx">False</span><span class="o">&amp;</span><span class="nx">expand</span><span class="p">=</span><span class="nx">False</span><span class="w"> </span><span class="p">(</span><span class="nx">Caused</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">ConnectTimeoutError</span><span class="p">(&lt;</span><span class="nx">urllib3</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">HTTPSConnection</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="mh">0x7fe651566380</span><span class="p">&gt;,</span><span class="w"> </span><span class="err">'</span><span class="nx">Connection</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">huggingface</span><span class="p">.</span><span class="nx">co</span><span class="w"> </span><span class="nx">timed</span><span class="w"> </span><span class="nx">out</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nx">connect</span><span class="w"> </span><span class="nx">timeout</span><span class="p">=</span><span class="nx">None</span><span class="p">)</span><span class="err">'</span><span class="p">))</span>

<span class="nx">During</span><span class="w"> </span><span class="nx">handling</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">above</span><span class="w"> </span><span class="nx">exception</span><span class="p">,</span><span class="w"> </span><span class="nx">another</span><span class="w"> </span><span class="nx">exception</span><span class="w"> </span><span class="nx">occurred</span><span class="p">:</span>

<span class="nx">Traceback</span><span class="w"> </span><span class="p">(</span><span class="nx">most</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="nx">call</span><span class="w"> </span><span class="nx">last</span><span class="p">):</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/autodl-tmp/lerobot/src/lerobot/scripts/train.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">291</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">&lt;</span><span class="nx">module</span><span class="p">&gt;</span>
<span class="w">    </span><span class="nx">train</span><span class="p">()</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/autodl-tmp/lerobot/src/lerobot/configs/parser.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">226</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">wrapper_inner</span>
<span class="w">    </span><span class="nx">response</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">fn</span><span class="p">(</span><span class="nx">cfg</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/autodl-tmp/lerobot/src/lerobot/scripts/train.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">139</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">train</span>
<span class="w">    </span><span class="nx">policy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">make_policy</span><span class="p">(</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/autodl-tmp/lerobot/src/lerobot/policies/factory.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">168</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">make_policy</span>
<span class="w">    </span><span class="nx">policy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">policy_cls</span><span class="p">.</span><span class="nx">from_pretrained</span><span class="p">(</span><span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/autodl-tmp/lerobot/src/lerobot/policies/pretrained.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">from_pretrained</span>
<span class="w">    </span><span class="nx">instance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cls</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/autodl-tmp/lerobot/src/lerobot/policies/smolvla/modeling_smolvla.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">356</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">__init__</span>
<span class="w">    </span><span class="kp">self</span><span class="p">.</span><span class="nx">language_tokenizer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">AutoProcessor</span><span class="p">.</span><span class="nx">from_pretrained</span><span class="p">(</span><span class="kp">self</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">vlm_model_name</span><span class="p">).</span><span class="nx">tokenizer</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/transformers/models/auto/processing_auto.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">288</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">from_pretrained</span>
<span class="w">    </span><span class="nx">config_dict</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ProcessorMixin</span><span class="p">.</span><span class="nx">get_processor_dict</span><span class="p">(</span><span class="nx">pretrained_model_name_or_path</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/transformers/processing_utils.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">873</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">get_processor_dict</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">template</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">list_repo_templates</span><span class="p">(</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/transformers/utils/hub.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">161</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">list_repo_templates</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/transformers/utils/hub.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">161</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">&lt;</span><span class="nx">listcomp</span><span class="p">&gt;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/huggingface_hub/hf_api.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">3168</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">list_repo_tree</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">path_info</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">paginate</span><span class="p">(</span><span class="nx">path</span><span class="p">=</span><span class="nx">tree_url</span><span class="p">,</span><span class="w"> </span><span class="nx">headers</span><span class="p">=</span><span class="nx">headers</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="p">={</span><span class="s">"recursive"</span><span class="p">:</span><span class="w"> </span><span class="nx">recursive</span><span class="p">,</span><span class="w"> </span><span class="s">"expand"</span><span class="p">:</span><span class="w"> </span><span class="nx">expand</span><span class="p">}):</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/huggingface_hub/utils/_pagination.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">36</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">paginate</span>
<span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">session</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="p">=</span><span class="nx">params</span><span class="p">,</span><span class="w"> </span><span class="nx">headers</span><span class="p">=</span><span class="nx">headers</span><span class="p">)</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/requests/sessions.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">602</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">get</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kp">self</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s">"GET"</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/requests/sessions.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">589</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">request</span>
<span class="w">    </span><span class="nx">resp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kp">self</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">prep</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="nx">send_kwargs</span><span class="p">)</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/requests/sessions.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">703</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">send</span>
<span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">adapter</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/huggingface_hub/utils/_http.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">96</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">send</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">super</span><span class="p">().</span><span class="nx">send</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span>
<span class="w">  </span><span class="nx">File</span><span class="w"> </span><span class="s">"/root/miniconda3/envs/lerobot/lib/python3.10/site-packages/requests/adapters.py"</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="mi">688</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">send</span>
<span class="w">    </span><span class="nx">raise</span><span class="w"> </span><span class="nx">ConnectTimeout</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="w"> </span><span class="nx">request</span><span class="p">=</span><span class="nx">request</span><span class="p">)</span>
<span class="nx">requests</span><span class="p">.</span><span class="nx">exceptions</span><span class="p">.</span><span class="nx">ConnectTimeout</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nx">MaxRetryError</span><span class="p">(</span><span class="s">"HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/HuggingFaceTB/SmolVLM2-500M-Video-Instruct/tree/main/additional_chat_templates?recursive=False&amp;expand=False (Caused by ConnectTimeoutError(&lt;urllib3.connection.HTTPSConnection object at 0x7fe651566380&gt;, 'Connection to huggingface.co timed out. (connect timeout=None)'))"</span><span class="p">),</span><span class="w"> </span><span class="err">'</span><span class="p">(</span><span class="nx">Request</span><span class="w"> </span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="nx">f4d5747</span><span class="o">-</span><span class="nx">ec95</span><span class="o">-</span><span class="mi">47</span><span class="nx">cc</span><span class="o">-</span><span class="nx">a55f</span><span class="o">-</span><span class="nx">cb3e230c52e2</span><span class="p">)</span><span class="err">'</span><span class="p">)</span>
</code></pre></div>
<p>原因是训练在初始化 SmolVLA 的 VLM 时需要从 Hugging Face Hub 拉取资源（AutoProcessor.from_pretrained 默认用 vlm_model_name=HuggingFaceTB/SmolVLM2-500M-Video-Instruct）。你的机器连到 huggingface.co 超时，导致下载失败并报 ConnectTimeout。</p>
<p>解决办法：export HF_ENDPOINT=https://hf-mirror.com</p>
<p>把原本指向 https://huggingface.co 的所有 Hub 请求（模型/数据集下载、API 调用）改走 <a href="https://hf-mirror.com">https://hf-mirror.com</a>。作用范围仅当前这个终端会话。关闭终端或开新终端就失效。</p>
<p>训练过程过程中警告</p>
<div class="codehilite"><pre><span></span><code><span class="n">huggingface</span><span class="o">/</span><span class="n">tokenizers</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">forked</span><span class="p">,</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">used</span><span class="p">.</span><span class="w"> </span><span class="n">Disabling</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">deadlocks</span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">disable</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">warning</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">either</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Avoid</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n n-Quoted">`tokenizers`</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fork</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">TOKENIZERS_PARALLELISM</span><span class="o">=</span><span class="p">(</span><span class="no">true</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">false</span><span class="p">)</span>
<span class="n">huggingface</span><span class="o">/</span><span class="n">tokenizers</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">forked</span><span class="p">,</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">used</span><span class="p">.</span><span class="w"> </span><span class="n">Disabling</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">deadlocks</span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">disable</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">warning</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">either</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Avoid</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n n-Quoted">`tokenizers`</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fork</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">TOKENIZERS_PARALLELISM</span><span class="o">=</span><span class="p">(</span><span class="no">true</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">false</span><span class="p">)</span>
<span class="n">huggingface</span><span class="o">/</span><span class="n">tokenizers</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">forked</span><span class="p">,</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">used</span><span class="p">.</span><span class="w"> </span><span class="n">Disabling</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">deadlocks</span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">disable</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">warning</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">either</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Avoid</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n n-Quoted">`tokenizers`</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fork</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">TOKENIZERS_PARALLELISM</span><span class="o">=</span><span class="p">(</span><span class="no">true</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">false</span><span class="p">)</span>
<span class="n">huggingface</span><span class="o">/</span><span class="n">tokenizers</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">forked</span><span class="p">,</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">used</span><span class="p">.</span><span class="w"> </span><span class="n">Disabling</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">deadlocks</span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">disable</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">warning</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">either</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Avoid</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n n-Quoted">`tokenizers`</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fork</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">TOKENIZERS_PARALLELISM</span><span class="o">=</span><span class="p">(</span><span class="no">true</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">false</span><span class="p">)</span>
<span class="n">huggingface</span><span class="o">/</span><span class="n">tokenizers</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">forked</span><span class="p">,</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">used</span><span class="p">.</span><span class="w"> </span><span class="n">Disabling</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">deadlocks</span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">disable</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">warning</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">either</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Avoid</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n n-Quoted">`tokenizers`</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fork</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">TOKENIZERS_PARALLELISM</span><span class="o">=</span><span class="p">(</span><span class="no">true</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">false</span><span class="p">)</span>
<span class="n">huggingface</span><span class="o">/</span><span class="n">tokenizers</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">forked</span><span class="p">,</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">used</span><span class="p">.</span><span class="w"> </span><span class="n">Disabling</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">deadlocks</span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">disable</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">warning</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">either</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Avoid</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n n-Quoted">`tokenizers`</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fork</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">TOKENIZERS_PARALLELISM</span><span class="o">=</span><span class="p">(</span><span class="no">true</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">false</span><span class="p">)</span>
<span class="n">huggingface</span><span class="o">/</span><span class="n">tokenizers</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">forked</span><span class="p">,</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">used</span><span class="p">.</span><span class="w"> </span><span class="n">Disabling</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">deadlocks</span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">disable</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">warning</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">either</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Avoid</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n n-Quoted">`tokenizers`</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fork</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">TOKENIZERS_PARALLELISM</span><span class="o">=</span><span class="p">(</span><span class="no">true</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">false</span><span class="p">)</span>
<span class="n">huggingface</span><span class="o">/</span><span class="n">tokenizers</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">forked</span><span class="p">,</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">used</span><span class="p">.</span><span class="w"> </span><span class="n">Disabling</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">deadlocks</span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">disable</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">warning</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">either</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Avoid</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n n-Quoted">`tokenizers`</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fork</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">TOKENIZERS_PARALLELISM</span><span class="o">=</span><span class="p">(</span><span class="no">true</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">false</span><span class="p">)</span>
<span class="n">huggingface</span><span class="o">/</span><span class="n">tokenizers</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">forked</span><span class="p">,</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">used</span><span class="p">.</span><span class="w"> </span><span class="n">Disabling</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">deadlocks</span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">disable</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">warning</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">either</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Avoid</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n n-Quoted">`tokenizers`</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fork</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">TOKENIZERS_PARALLELISM</span><span class="o">=</span><span class="p">(</span><span class="no">true</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">false</span><span class="p">)</span>
<span class="n">huggingface</span><span class="o">/</span><span class="n">tokenizers</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">process</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">got</span><span class="w"> </span><span class="n">forked</span><span class="p">,</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">used</span><span class="p">.</span><span class="w"> </span><span class="n">Disabling</span><span class="w"> </span><span class="n">parallelism</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">deadlocks</span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">disable</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">warning</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">either</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Avoid</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n n-Quoted">`tokenizers`</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fork</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">possible</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">TOKENIZERS_PARALLELISM</span><span class="o">=</span><span class="p">(</span><span class="no">true</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">false</span><span class="p">)</span>
</code></pre></div>
<p>TOKENIZERS_PARALLELISM是分词器在一次调用会开多线程并行处理文本。分词器库是hugging Face的分词器库，负责把文本指令变成模型可用的token id序列，也能把id还原会文本，跟我们此前在<a href="https://www.laumy.tech/2509.html/%e4%b8%80%e6%ad%a5%e6%ad%a5%e5%ae%9e%e7%8e%b0transformer/#sec-6" title="一步步实现transformer">一步步实现transformer</a></p>
<p>的词表类型。出现这样的警告是tokenizers它开了多线程并发，而 DataLoader 再 fork 出子进程并发（本身DataLoader是可以并发），这样容易有死锁风险，为安全起见，库检测到这种顺序就自动把自己的多线程并行关掉，并给出提示。如果要关掉tokenizers的多线程并发，export TOKENIZERS_PARALLELISM=false。</p></div>
  <div class="post-nav">
    <a class="prev" href="解读vit-transformer-在视觉领域如何落地.html">← 解读ViT：Transformer 在视觉领域如何落地</a>
    <a class="next" href="一步步实现transformer.html">一步步实现transformer →</a>
  </div>
</article>

      </section>

      <aside class="right-panel">
        
      </aside>
    </main>

    <footer class="site-footer">
      <div class="container">Copyright ©2022-2025 laumy 版权所有</div>
    </footer>

    <script src="assets/site.js"></script>
  </body>
  </html>

